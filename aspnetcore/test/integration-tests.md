---
title: ASP.NET core'da tümleştirme testleri
author: guardrex
description: Bir uygulamanın bileşenleri doğru veritabanı, dosya sistemi ve ağ gibi altyapı düzeyinde çalışması tümleştirme testleri nasıl emin öğrenin.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 02/25/2019
uid: test/integration-tests
ms.openlocfilehash: 053713e148df70b0be6bb567b55b2381a78d6c3e
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57067416"
---
# <a name="integration-tests-in-aspnet-core"></a><span data-ttu-id="398a2-103">ASP.NET core'da tümleştirme testleri</span><span class="sxs-lookup"><span data-stu-id="398a2-103">Integration tests in ASP.NET Core</span></span>

<span data-ttu-id="398a2-104">Tarafından [Luke Latham](https://github.com/guardrex) ve [Steve Smith](https://ardalis.com/)</span><span class="sxs-lookup"><span data-stu-id="398a2-104">By [Luke Latham](https://github.com/guardrex) and [Steve Smith](https://ardalis.com/)</span></span>

<span data-ttu-id="398a2-105">Tümleştirme testleri, bir uygulamanın bileşenleri içeren bir veritabanı, dosya sistemi ve ağ gibi uygulamanın destekleyen altyapı düzeyinde düzgün emin olun.</span><span class="sxs-lookup"><span data-stu-id="398a2-105">Integration tests ensure that an app's components function correctly at a level that includes the app's supporting infrastructure, such as the database, file system, and network.</span></span> <span data-ttu-id="398a2-106">ASP.NET Core, tümleştirme testlerini bir test web ana bilgisayarı ve bir bellek içi test sunucusu ile birim testi çerçevesini kullanarak destekler.</span><span class="sxs-lookup"><span data-stu-id="398a2-106">ASP.NET Core supports integration tests using a unit test framework with a test web host and an in-memory test server.</span></span>

<span data-ttu-id="398a2-107">Bu konuda, birim testleri temel bir anlayış varsayılır.</span><span class="sxs-lookup"><span data-stu-id="398a2-107">This topic assumes a basic understanding of unit tests.</span></span> <span data-ttu-id="398a2-108">Bilinmeyen test kavramlarına aşina değilse [birim testi .NET Core ve .NET Standard](/dotnet/core/testing/) konu ve bağlantılı içeriği.</span><span class="sxs-lookup"><span data-stu-id="398a2-108">If unfamiliar with test concepts, see the [Unit Testing in .NET Core and .NET Standard](/dotnet/core/testing/) topic and its linked content.</span></span>

<span data-ttu-id="398a2-109">[Görüntüleme veya indirme örnek kodu](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples) ([nasıl indirileceğini](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="398a2-109">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

<span data-ttu-id="398a2-110">Örnek uygulama bir Razor sayfaları uygulamasıdır ve Razor sayfaları temel bir anlayış varsayar.</span><span class="sxs-lookup"><span data-stu-id="398a2-110">The sample app is a Razor Pages app and assumes a basic understanding of Razor Pages.</span></span> <span data-ttu-id="398a2-111">Tanınmayan Razor sayfalarıyla istiyorsanız, aşağıdaki konulara bakın:</span><span class="sxs-lookup"><span data-stu-id="398a2-111">If unfamiliar with Razor Pages, see the following topics:</span></span>

* [<span data-ttu-id="398a2-112">Razor Pages’e giriş</span><span class="sxs-lookup"><span data-stu-id="398a2-112">Introduction to Razor Pages</span></span>](xref:razor-pages/index)
* [<span data-ttu-id="398a2-113">Razor Sayfaları kullanmaya başlama</span><span class="sxs-lookup"><span data-stu-id="398a2-113">Get started with Razor Pages</span></span>](xref:tutorials/razor-pages/razor-pages-start)
* [<span data-ttu-id="398a2-114">Razor Sayfaları birim testleri</span><span class="sxs-lookup"><span data-stu-id="398a2-114">Razor Pages unit tests</span></span>](xref:test/razor-pages-tests)

> [!NOTE]
> <span data-ttu-id="398a2-115">Spa'lar test etmek için bir aracı gibi önerilir [Selenium](https://www.seleniumhq.org/), bir tarayıcı getirmenizi.</span><span class="sxs-lookup"><span data-stu-id="398a2-115">For testing SPAs, we recommended a tool such as [Selenium](https://www.seleniumhq.org/), which can automate a browser.</span></span>

## <a name="introduction-to-integration-tests"></a><span data-ttu-id="398a2-116">Tümleştirme testleri giriş</span><span class="sxs-lookup"><span data-stu-id="398a2-116">Introduction to integration tests</span></span>

<span data-ttu-id="398a2-117">Bir uygulamanın bileşenleri daha geniş bir düzeyde tümleştirme testleri değerlendirmek [birim testleri](/dotnet/core/testing/).</span><span class="sxs-lookup"><span data-stu-id="398a2-117">Integration tests evaluate an app's components on a broader level than [unit tests](/dotnet/core/testing/).</span></span> <span data-ttu-id="398a2-118">Birim testleri gibi tek tek sınıf yöntemlerini yalıtılmış yazılım bileşenlerini test etmek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="398a2-118">Unit tests are used to test isolated software components, such as individual class methods.</span></span> <span data-ttu-id="398a2-119">Tümleştirme testleri, iki veya daha fazla uygulama bileşenleri birlikte büyük olasılıkla tam olarak bir isteği işlemek için gerekli her bileşen dahil olmak üzere bir beklenen sonucu verecek çalıştığını doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="398a2-119">Integration tests confirm that two or more app components work together to produce an expected result, possibly including every component required to fully process a request.</span></span>

<span data-ttu-id="398a2-120">Daha geniş olan bu testler, uygulamanın altyapı ve genellikle aşağıdaki bileşenler dahil olmak üzere tüm framework test etmek için kullanılır:</span><span class="sxs-lookup"><span data-stu-id="398a2-120">These broader tests are used to test the app's infrastructure and whole framework, often including the following components:</span></span>

* <span data-ttu-id="398a2-121">Veritabanı</span><span class="sxs-lookup"><span data-stu-id="398a2-121">Database</span></span>
* <span data-ttu-id="398a2-122">Dosya sistemi</span><span class="sxs-lookup"><span data-stu-id="398a2-122">File system</span></span>
* <span data-ttu-id="398a2-123">Ağ Gereçleri</span><span class="sxs-lookup"><span data-stu-id="398a2-123">Network appliances</span></span>
* <span data-ttu-id="398a2-124">İstek-yanıt işlem hattı</span><span class="sxs-lookup"><span data-stu-id="398a2-124">Request-response pipeline</span></span>

<span data-ttu-id="398a2-125">Birim testleri üretilmiş kullanım bileşenleri olarak bilinen *fakes* veya *sahte nesneler*, altyapı bileşenlerini yerine.</span><span class="sxs-lookup"><span data-stu-id="398a2-125">Unit tests use fabricated components, known as *fakes* or *mock objects*, in place of infrastructure components.</span></span>

<span data-ttu-id="398a2-126">Birim testleri aksine, tümleştirme testleri:</span><span class="sxs-lookup"><span data-stu-id="398a2-126">In contrast to unit tests, integration tests:</span></span>

* <span data-ttu-id="398a2-127">Üretim ortamında uygulamanın kullandığı gerçek bileşenlerini kullanın.</span><span class="sxs-lookup"><span data-stu-id="398a2-127">Use the actual components that the app uses in production.</span></span>
* <span data-ttu-id="398a2-128">Daha fazla kod ve veri işleme gerektirir.</span><span class="sxs-lookup"><span data-stu-id="398a2-128">Require more code and data processing.</span></span>
* <span data-ttu-id="398a2-129">Çalıştırmak için daha uzun sürer.</span><span class="sxs-lookup"><span data-stu-id="398a2-129">Take longer to run.</span></span>

<span data-ttu-id="398a2-130">Bu nedenle, tümleştirme testlerini en önemli altyapı senaryolarından kullanımını sınırlayın.</span><span class="sxs-lookup"><span data-stu-id="398a2-130">Therefore, limit the use of integration tests to the most important infrastructure scenarios.</span></span> <span data-ttu-id="398a2-131">Bir davranış birim testi veya bir tümleştirme testi kullanılarak test edilebilir, birim testi seçin.</span><span class="sxs-lookup"><span data-stu-id="398a2-131">If a behavior can be tested using either a unit test or an integration test, choose the unit test.</span></span>

> [!TIP]
> <span data-ttu-id="398a2-132">Her olası permütasyon ile veritabanları ve dosya sistemleri veri ve dosya erişimi için tümleştirme testleri yazmayın.</span><span class="sxs-lookup"><span data-stu-id="398a2-132">Don't write integration tests for every possible permutation of data and file access with databases and file systems.</span></span> <span data-ttu-id="398a2-133">Bir uygulama arasında kaç yerleştirir bağımsız olarak veritabanları ve dosya sistemleri, testleri yeterince test veritabanı genellikle uyumlu ve dosya sistemi okuma, yazma, güncelleştirme ve silme tümleştirme odaklanmış bir dizi ile etkileşim.</span><span class="sxs-lookup"><span data-stu-id="398a2-133">Regardless of how many places across an app interact with databases and file systems, a focused set of read, write, update, and delete integration tests are usually capable of adequately testing database and file system components.</span></span> <span data-ttu-id="398a2-134">Bu bileşenlerle etkileşime düzenli testler yöntemi mantığı için kullanım birim testleri.</span><span class="sxs-lookup"><span data-stu-id="398a2-134">Use unit tests for routine tests of method logic that interact with these components.</span></span> <span data-ttu-id="398a2-135">Birim testlerinde altyapı kullanımını fakes/daha hızlı bir testi çalıştırma sonucu mocks.</span><span class="sxs-lookup"><span data-stu-id="398a2-135">In unit tests, the use of infrastructure fakes/mocks result in faster test execution.</span></span>

> [!NOTE]
> <span data-ttu-id="398a2-136">Test edilen projenin sık olarak adlandırılan tümleştirme testleri tartışmalara *test altındaki sistem*, veya kısaca "SUT".</span><span class="sxs-lookup"><span data-stu-id="398a2-136">In discussions of integration tests, the tested project is frequently called the *system under test*, or "SUT" for short.</span></span>

## <a name="aspnet-core-integration-tests"></a><span data-ttu-id="398a2-137">ASP.NET Core tümleştirme testleri</span><span class="sxs-lookup"><span data-stu-id="398a2-137">ASP.NET Core integration tests</span></span>

<span data-ttu-id="398a2-138">ASP.NET core'da tümleştirme testleri aşağıdakileri gerektirir:</span><span class="sxs-lookup"><span data-stu-id="398a2-138">Integration tests in ASP.NET Core require the following:</span></span>

* <span data-ttu-id="398a2-139">Bir test projesi içeren ve testleri yürütmek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="398a2-139">A test project is used to contain and execute the tests.</span></span> <span data-ttu-id="398a2-140">Test projesi adlı test edilmiş ASP.NET Core projesi bir başvuru içeriyor *test altındaki sistem* (SUT).</span><span class="sxs-lookup"><span data-stu-id="398a2-140">The test project has a reference to the tested ASP.NET Core project, called the *system under test* (SUT).</span></span> <span data-ttu-id="398a2-141">_"SUT" Bu konu başlığı altında yaptığımız, test edilen uygulamaya başvurmak için kullanılır._</span><span class="sxs-lookup"><span data-stu-id="398a2-141">_"SUT" is used throughout this topic to refer to the tested app._</span></span>
* <span data-ttu-id="398a2-142">Test projesi SUT için bir test web ana bilgisayar oluşturur ve bir test sunucusu istemci isteklerinin ve yanıtlarının SUT işlemek için kullanır.</span><span class="sxs-lookup"><span data-stu-id="398a2-142">The test project creates a test web host for the SUT and uses a test server client to handle requests and responses to the SUT.</span></span>
* <span data-ttu-id="398a2-143">Test Çalıştırıcısı, test sonuçlarını rapor ve testleri yürütmek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="398a2-143">A test runner is used to execute the tests and report the test results.</span></span>

<span data-ttu-id="398a2-144">Tümleştirme testleri, normal içeren olayların sırasını izleyin *Yerleştir*, *Yasası*, ve *Assert* test adımları:</span><span class="sxs-lookup"><span data-stu-id="398a2-144">Integration tests follow a sequence of events that include the usual *Arrange*, *Act*, and *Assert* test steps:</span></span>

1. <span data-ttu-id="398a2-145">SUT'ın web ana bilgisayarı yapılandırılır.</span><span class="sxs-lookup"><span data-stu-id="398a2-145">The SUT's web host is configured.</span></span>
1. <span data-ttu-id="398a2-146">Bir test sunucusu istemci uygulamanın istekleri göndermek için oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="398a2-146">A test server client is created to submit requests to the app.</span></span>
1. <span data-ttu-id="398a2-147">*Yerleştir* test adımı yürütülür: Bir isteği test uygulaması hazırlar.</span><span class="sxs-lookup"><span data-stu-id="398a2-147">The *Arrange* test step is executed: The test app prepares a request.</span></span>
1. <span data-ttu-id="398a2-148">*Yasası* test adımı yürütülür: İstemci isteği gönderir ve yanıtı alır.</span><span class="sxs-lookup"><span data-stu-id="398a2-148">The *Act* test step is executed: The client submits the request and receives the response.</span></span>
1. <span data-ttu-id="398a2-149">*Assert* test adımı yürütülür: *Gerçek* yanıt olarak doğrulanmış bir *geçirmek* veya *başarısız* dayalı bir *beklenen* yanıt.</span><span class="sxs-lookup"><span data-stu-id="398a2-149">The *Assert* test step is executed: The *actual* response is validated as a *pass* or *fail* based on an *expected* response.</span></span>
1. <span data-ttu-id="398a2-150">İşlem, tüm testleri yürütülür kadar devam eder.</span><span class="sxs-lookup"><span data-stu-id="398a2-150">The process continues until all of the tests are executed.</span></span>
1. <span data-ttu-id="398a2-151">Test sonuçları raporlanır.</span><span class="sxs-lookup"><span data-stu-id="398a2-151">The test results are reported.</span></span>

<span data-ttu-id="398a2-152">Genellikle, uygulamanın normal web ana bilgisayarı için test çalıştıran çok test web ana bilgisayarı farklı şekilde yapılandırılır.</span><span class="sxs-lookup"><span data-stu-id="398a2-152">Usually, the test web host is configured differently than the app's normal web host for the test runs.</span></span> <span data-ttu-id="398a2-153">Örneğin, farklı bir veritabanı veya farklı uygulama ayarları testler için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="398a2-153">For example, a different database or different app settings might be used for the tests.</span></span>

<span data-ttu-id="398a2-154">Test web ana bilgisayarı ve bellek içi test sunucusuna gibi altyapı bileşenlerini ([TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver)), sağlanan veya yönetilen [Microsoft.AspNetCore.Mvc.Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) paket.</span><span class="sxs-lookup"><span data-stu-id="398a2-154">Infrastructure components, such as the test web host and in-memory test server ([TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver)), are provided or managed by the [Microsoft.AspNetCore.Mvc.Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) package.</span></span> <span data-ttu-id="398a2-155">Bu paket kullanımını test oluşturma ve yürütme kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="398a2-155">Use of this package streamlines test creation and execution.</span></span>

<span data-ttu-id="398a2-156">`Microsoft.AspNetCore.Mvc.Testing` Paket, aşağıdaki görevleri gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="398a2-156">The `Microsoft.AspNetCore.Mvc.Testing` package handles the following tasks:</span></span>

* <span data-ttu-id="398a2-157">Bağımlılıkları dosyayı kopyalar (*\*.deps*) test projesinin içine SUT gelen *bin* klasör.</span><span class="sxs-lookup"><span data-stu-id="398a2-157">Copies the dependencies file (*\*.deps*) from the SUT into the test project's *bin* folder.</span></span>
* <span data-ttu-id="398a2-158">Böylece, testler yürütülmeden statik dosyalar ve sayfalar/görünümler bulunur içerik kök SUT'ın Proje kök dizinine ayarlar.</span><span class="sxs-lookup"><span data-stu-id="398a2-158">Sets the content root to the SUT's project root so that static files and pages/views are found when the tests are executed.</span></span>
* <span data-ttu-id="398a2-159">Sağlar [WebApplicationFactory](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1) ile SUT önyükleme kolaylaştırmak için sınıf `TestServer`.</span><span class="sxs-lookup"><span data-stu-id="398a2-159">Provides the [WebApplicationFactory](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1) class to streamline bootstrapping the SUT with `TestServer`.</span></span>

<span data-ttu-id="398a2-160">[Birim testleri](/dotnet/articles/core/testing/unit-testing-with-dotnet-test) belgeleri nasıl bir test projesi ve test Çalıştırıcısı, testleri ve öneriler için nasıl adı testleri çalıştırmak ve test sınıflarına konusunda ayrıntılı yönergeler birlikte ayarlanacağı açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="398a2-160">The [unit tests](/dotnet/articles/core/testing/unit-testing-with-dotnet-test) documentation describes how to set up a test project and test runner, along with detailed instructions on how to run tests and recommendations for how to name tests and test classes.</span></span>

> [!NOTE]
> <span data-ttu-id="398a2-161">Bir uygulama için bir test projesi oluştururken, birim testleri tümleştirme testleri farklı projelere ayırma ayırın.</span><span class="sxs-lookup"><span data-stu-id="398a2-161">When creating a test project for an app, separate the unit tests from the integration tests into different projects.</span></span> <span data-ttu-id="398a2-162">Bu, birim testlerine dahil altyapı test bileşenlerini yanlışlıkla olmadığından emin olun yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="398a2-162">This helps ensure that infrastructure testing components aren't accidently included in the unit tests.</span></span> <span data-ttu-id="398a2-163">Ayrıca birim ve tümleştirme testleri ayrımı sağlar hangi testler küme üzerinde çalıştırılır denetleyen.</span><span class="sxs-lookup"><span data-stu-id="398a2-163">Separation of unit and integration tests also allows control over which set of tests are run.</span></span>

<span data-ttu-id="398a2-164">Razor sayfaları uygulamaların testler için yapılandırma ve MVC uygulamaları arasındaki neredeyse hiçbir fark yoktur.</span><span class="sxs-lookup"><span data-stu-id="398a2-164">There's virtually no difference between the configuration for tests of Razor Pages apps and MVC apps.</span></span> <span data-ttu-id="398a2-165">Tek fark, testleri nasıl adlandırıldığı ' dir.</span><span class="sxs-lookup"><span data-stu-id="398a2-165">The only difference is in how the tests are named.</span></span> <span data-ttu-id="398a2-166">Bir Razor sayfaları uygulamasında sayfasında uç noktası testleri genellikle sonra sayfa modeli sınıfı adlandırılır (örneğin, `IndexPageTests` bileşen tümleştirme dizin sayfası için test etmek için).</span><span class="sxs-lookup"><span data-stu-id="398a2-166">In a Razor Pages app, tests of page endpoints are usually named after the page model class (for example, `IndexPageTests` to test component integration for the Index page).</span></span> <span data-ttu-id="398a2-167">Bir MVC uygulamasında testleri genellikle denetleyicisi sınıfları tarafından düzenlenen ve bunlar test denetleyicileri sonra adlı (örneğin, `HomeControllerTests` bileşen tümleştirme giriş denetleyicisine için test etmek için).</span><span class="sxs-lookup"><span data-stu-id="398a2-167">In an MVC app, tests are usually organized by controller classes and named after the controllers they test (for example, `HomeControllerTests` to test component integration for the Home controller).</span></span>

## <a name="test-app-prerequisites"></a><span data-ttu-id="398a2-168">Test uygulama önkoşulları</span><span class="sxs-lookup"><span data-stu-id="398a2-168">Test app prerequisites</span></span>

<span data-ttu-id="398a2-169">Test projesi gerekir:</span><span class="sxs-lookup"><span data-stu-id="398a2-169">The test project must:</span></span>

* <span data-ttu-id="398a2-170">Aşağıdaki paketler başvuru:</span><span class="sxs-lookup"><span data-stu-id="398a2-170">Reference the following packages:</span></span>
  * [<span data-ttu-id="398a2-171">Microsoft.AspNetCore.App</span><span class="sxs-lookup"><span data-stu-id="398a2-171">Microsoft.AspNetCore.App</span></span>](https://www.nuget.org/packages/Microsoft.AspNetCore.App/)
  * [<span data-ttu-id="398a2-172">Microsoft.AspNetCore.Mvc.Testing</span><span class="sxs-lookup"><span data-stu-id="398a2-172">Microsoft.AspNetCore.Mvc.Testing</span></span>](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing/)
* <span data-ttu-id="398a2-173">Proje dosyasında Web SDK'sı belirtin (`<Project Sdk="Microsoft.NET.Sdk.Web">`).</span><span class="sxs-lookup"><span data-stu-id="398a2-173">Specify the Web SDK in the project file (`<Project Sdk="Microsoft.NET.Sdk.Web">`).</span></span> <span data-ttu-id="398a2-174">Web SDK'sı başvururken gereklidir [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app).</span><span class="sxs-lookup"><span data-stu-id="398a2-174">The Web SDK is required when referencing the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app).</span></span>

<span data-ttu-id="398a2-175">Bu Önkoşullar şurada görülebilir [örnek uygulaması](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples/).</span><span class="sxs-lookup"><span data-stu-id="398a2-175">These prerequisites can be seen in the [sample app](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples/).</span></span> <span data-ttu-id="398a2-176">İnceleme *tests/RazorPagesProject.Tests/RazorPagesProject.Tests.csproj* dosya.</span><span class="sxs-lookup"><span data-stu-id="398a2-176">Inspect the *tests/RazorPagesProject.Tests/RazorPagesProject.Tests.csproj* file.</span></span> <span data-ttu-id="398a2-177">Örnek uygulama kullandığı [xUnit](https://xunit.github.io/) test çerçevesi ve [AngleSharp](https://anglesharp.github.io/) örnek uygulamasını da başvurduğu için ayrıştırıcı kitaplığı:</span><span class="sxs-lookup"><span data-stu-id="398a2-177">The sample app uses the [xUnit](https://xunit.github.io/) test framework and the [AngleSharp](https://anglesharp.github.io/) parser library, so the sample app also references:</span></span>

* [<span data-ttu-id="398a2-178">xunit</span><span class="sxs-lookup"><span data-stu-id="398a2-178">xunit</span></span>](https://www.nuget.org/packages/xunit/)
* [<span data-ttu-id="398a2-179">xunit.Runner.VisualStudio</span><span class="sxs-lookup"><span data-stu-id="398a2-179">xunit.runner.visualstudio</span></span>](https://www.nuget.org/packages/xunit.runner.visualstudio/)
* [<span data-ttu-id="398a2-180">AngleSharp</span><span class="sxs-lookup"><span data-stu-id="398a2-180">AngleSharp</span></span>](https://www.nuget.org/packages/AngleSharp/)

## <a name="sut-environment"></a><span data-ttu-id="398a2-181">SUT ortamı</span><span class="sxs-lookup"><span data-stu-id="398a2-181">SUT environment</span></span>

<span data-ttu-id="398a2-182">Varsa SUT'ın [ortam](xref:fundamentals/environments) ayarlanmamış, geliştirme ortamı varsayılanlara.</span><span class="sxs-lookup"><span data-stu-id="398a2-182">If the SUT's [environment](xref:fundamentals/environments) isn't set, the environment defaults to Development.</span></span>

## <a name="basic-tests-with-the-default-webapplicationfactory"></a><span data-ttu-id="398a2-183">' % S'varsayılan WebApplicationFactory temel testleri</span><span class="sxs-lookup"><span data-stu-id="398a2-183">Basic tests with the default WebApplicationFactory</span></span>

<span data-ttu-id="398a2-184">[WebApplicationFactory&lt;TEntryPoint&gt; ](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1) oluşturmak için kullanılan bir [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver) tümleştirme testleri için.</span><span class="sxs-lookup"><span data-stu-id="398a2-184">[WebApplicationFactory&lt;TEntryPoint&gt;](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1) is used to create a [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver) for the integration tests.</span></span> <span data-ttu-id="398a2-185">`TEntryPoint` Giriş noktası SUT genellikle sınıfıdır `Startup` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="398a2-185">`TEntryPoint` is the entry point class of the SUT, usually the `Startup` class.</span></span>

<span data-ttu-id="398a2-186">Test sınıfları uygulama bir *sınıfı düzeni* arabirimi ([IClassFixture](https://xunit.github.io/docs/shared-context#class-fixture)) sınıfı testleri içeren ve paylaşılan nesne örneklerini sınıfındaki sağlamak belirtmek için.</span><span class="sxs-lookup"><span data-stu-id="398a2-186">Test classes implement a *class fixture* interface ([IClassFixture](https://xunit.github.io/docs/shared-context#class-fixture)) to indicate the class contains tests and provide shared object instances across the tests in the class.</span></span>

### <a name="basic-test-of-app-endpoints"></a><span data-ttu-id="398a2-187">Uygulama uç noktalar için temel test</span><span class="sxs-lookup"><span data-stu-id="398a2-187">Basic test of app endpoints</span></span>

<span data-ttu-id="398a2-188">Aşağıdaki test sınıfı `BasicTests`, kullandığı `WebApplicationFactory` SUT bootstrap ve sağlamak için bir [HttpClient](/dotnet/api/system.net.http.httpclient) bir test yöntemine `Get_EndpointsReturnSuccessAndCorrectContentType`.</span><span class="sxs-lookup"><span data-stu-id="398a2-188">The following test class, `BasicTests`, uses the `WebApplicationFactory` to bootstrap the SUT and provide an [HttpClient](/dotnet/api/system.net.http.httpclient) to a test method, `Get_EndpointsReturnSuccessAndCorrectContentType`.</span></span> <span data-ttu-id="398a2-189">Yöntemi, yanıt durumu kodu başarılı olup olmadığını denetler (200 299 aralıktaki durum kodları) ve `Content-Type` üstbilgisi `text/html; charset=utf-8` birkaç uygulama sayfaları için.</span><span class="sxs-lookup"><span data-stu-id="398a2-189">The method checks if the response status code is successful (status codes in the range 200-299) and the `Content-Type` header is `text/html; charset=utf-8` for several app pages.</span></span>

<span data-ttu-id="398a2-190">[CreateClient](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createclient) örneği oluşturur `HttpClient` otomatik olarak yeniden yönlendirmeleri takip eden ve tanımlama bilgilerini işler.</span><span class="sxs-lookup"><span data-stu-id="398a2-190">[CreateClient](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createclient) creates an instance of `HttpClient` that automatically follows redirects and handles cookies.</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/BasicTests.cs?name=snippet1)]

### <a name="test-a-secure-endpoint"></a><span data-ttu-id="398a2-191">Güvenli bir uç nokta test</span><span class="sxs-lookup"><span data-stu-id="398a2-191">Test a secure endpoint</span></span>

<span data-ttu-id="398a2-192">Başka bir testte `BasicTests` sınıfı denetler güvenli bir uç noktası kimliği doğrulanmamış bir kullanıcı uygulamanın oturum açma sayfasına yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="398a2-192">Another test in the `BasicTests` class checks that a secure endpoint redirects an unauthenticated user to the app's Login page.</span></span>

<span data-ttu-id="398a2-193">SUT içinde `/SecurePage` sayfasında kullanan bir [AuthorizePage](/dotnet/api/microsoft.extensions.dependencyinjection.pageconventioncollectionextensions.authorizepage) kuralı uygulamak için bir [AuthorizeFilter](/dotnet/api/microsoft.aspnetcore.mvc.authorization.authorizefilter) sayfası.</span><span class="sxs-lookup"><span data-stu-id="398a2-193">In the SUT, the `/SecurePage` page uses an [AuthorizePage](/dotnet/api/microsoft.extensions.dependencyinjection.pageconventioncollectionextensions.authorizepage) convention to apply an [AuthorizeFilter](/dotnet/api/microsoft.aspnetcore.mvc.authorization.authorizefilter) to the page.</span></span> <span data-ttu-id="398a2-194">Daha fazla bilgi için [Razor sayfaları yetkilendirmesi kuralları](xref:security/authorization/razor-pages-authorization#require-authorization-to-access-a-page).</span><span class="sxs-lookup"><span data-stu-id="398a2-194">For more information, see [Razor Pages authorization conventions](xref:security/authorization/razor-pages-authorization#require-authorization-to-access-a-page).</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/src/RazorPagesProject/Startup.cs?name=snippet1)]

<span data-ttu-id="398a2-195">İçinde `Get_SecurePageRequiresAnAuthenticatedUser` test, bir [WebApplicationFactoryClientOptions](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions) ayarlayarak yeniden yönlendirmeleri izin vermeyecek şekilde [AllowAutoRedirect](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.allowautoredirect) için `false`:</span><span class="sxs-lookup"><span data-stu-id="398a2-195">In the `Get_SecurePageRequiresAnAuthenticatedUser` test, a [WebApplicationFactoryClientOptions](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions) is set to disallow redirects by setting [AllowAutoRedirect](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.allowautoredirect) to `false`:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/BasicTests.cs?name=snippet2)]

<span data-ttu-id="398a2-196">Yeniden yönlendirme izlemek için istemci engelleyerek, aşağıdaki denetimleri hale getirilebilir:</span><span class="sxs-lookup"><span data-stu-id="398a2-196">By disallowing the client to follow the redirect, the following checks can be made:</span></span>

* <span data-ttu-id="398a2-197">SUT tarafından döndürülen durum kodu denetlenebilir beklenen karşı [HttpStatusCode.Redirect](/dotnet/api/system.net.httpstatuscode) sonuç, son durum kodu değil olabilecek oturum açma sayfasına yeniden yönlendirme sonra [HttpStatusCode.OK](/dotnet/api/system.net.httpstatuscode).</span><span class="sxs-lookup"><span data-stu-id="398a2-197">The status code returned by the SUT can be checked against the expected [HttpStatusCode.Redirect](/dotnet/api/system.net.httpstatuscode) result, not the final status code after the redirect to the Login page, which would be [HttpStatusCode.OK](/dotnet/api/system.net.httpstatuscode).</span></span>
* <span data-ttu-id="398a2-198">`Location` Yanıt üstbilgilerini üst bilgi değeri ile başlayan onaylamak için işaretli `http://localhost/Identity/Account/Login`, olmayan son oturum açma sayfası yanıt, burada `Location` üstbilgi mıydı mevcut olabilir.</span><span class="sxs-lookup"><span data-stu-id="398a2-198">The `Location` header value in the response headers is checked to confirm that it starts with `http://localhost/Identity/Account/Login`, not the final Login page response, where the `Location` header wouldn't be present.</span></span>

<span data-ttu-id="398a2-199">Daha fazla bilgi için `WebApplicationFactoryClientOptions`, bkz: [istemci seçenekleri](#client-options) bölümü.</span><span class="sxs-lookup"><span data-stu-id="398a2-199">For more information on `WebApplicationFactoryClientOptions`, see the [Client options](#client-options) section.</span></span>

## <a name="customize-webapplicationfactory"></a><span data-ttu-id="398a2-200">WebApplicationFactory özelleştirme</span><span class="sxs-lookup"><span data-stu-id="398a2-200">Customize WebApplicationFactory</span></span>

<span data-ttu-id="398a2-201">Web ana bilgisayar yapılandırması oluşturulabilir bağımsız olarak test sınıflarında devralarak `WebApplicationFactory` bir veya daha fazla özel fabrikaları oluşturmak için:</span><span class="sxs-lookup"><span data-stu-id="398a2-201">Web host configuration can be created independently of the test classes by inheriting from `WebApplicationFactory` to create one or more custom factories:</span></span>

1. <span data-ttu-id="398a2-202">Devralınan `WebApplicationFactory` ve geçersiz kılma [ConfigureWebHost](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.configurewebhost).</span><span class="sxs-lookup"><span data-stu-id="398a2-202">Inherit from `WebApplicationFactory` and override [ConfigureWebHost](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.configurewebhost).</span></span> <span data-ttu-id="398a2-203">[IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) hizmet koleksiyonuyla yapılandırılmasını sağlayan [Createservicereplicalisteners()](/dotnet/api/microsoft.aspnetcore.hosting.istartup.configureservices):</span><span class="sxs-lookup"><span data-stu-id="398a2-203">The [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) allows the configuration of the service collection with [ConfigureServices](/dotnet/api/microsoft.aspnetcore.hosting.istartup.configureservices):</span></span>

   [!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/CustomWebApplicationFactory.cs?name=snippet1)]

   <span data-ttu-id="398a2-204">Veritabanı içinde dengeli dağıtım [örnek uygulaması](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples) tarafından gerçekleştirilen `InitializeDbForTests` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="398a2-204">Database seeding in the [sample app](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples) is performed by the `InitializeDbForTests` method.</span></span> <span data-ttu-id="398a2-205">Yöntem açıklanan [tümleştirme testleri örnek: Test uygulama kuruluş](#test-app-organization) bölümü.</span><span class="sxs-lookup"><span data-stu-id="398a2-205">The method is described in the [Integration tests sample: Test app organization](#test-app-organization) section.</span></span>

2. <span data-ttu-id="398a2-206">Özel kullanmanın `CustomWebApplicationFactory` test sınıflarında.</span><span class="sxs-lookup"><span data-stu-id="398a2-206">Use the custom `CustomWebApplicationFactory` in test classes.</span></span> <span data-ttu-id="398a2-207">Aşağıdaki örnek, fabrikada kullanır `IndexPageTests` sınıfı:</span><span class="sxs-lookup"><span data-stu-id="398a2-207">The following example uses the factory in the `IndexPageTests` class:</span></span>

   [!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet1)]

   <span data-ttu-id="398a2-208">Örnek uygulamanın istemci engelleyecek şekilde yapılandırılmış `HttpClient` gelen aşağıdaki yeniden yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="398a2-208">The sample app's client is configured to prevent the `HttpClient` from following redirects.</span></span> <span data-ttu-id="398a2-209">İçinde anlatıldığı gibi [güvenli bir uç nokta Test](#test-a-secure-endpoint) bölümünde bu verir testleri uygulamanın ilk yanıtın sonucunu denetle.</span><span class="sxs-lookup"><span data-stu-id="398a2-209">As explained in the [Test a secure endpoint](#test-a-secure-endpoint) section, this permits tests to check the result of the app's first response.</span></span> <span data-ttu-id="398a2-210">İlk yanıt, bir yeniden yönlendirme ile bu testleri birçok bir `Location` başlığı.</span><span class="sxs-lookup"><span data-stu-id="398a2-210">The first response is a redirect in many of these tests with a `Location` header.</span></span>

3. <span data-ttu-id="398a2-211">Tipik bir test kullanan `HttpClient` ve istek ve yanıt işlemek için yardımcı yöntemler:</span><span class="sxs-lookup"><span data-stu-id="398a2-211">A typical test uses the `HttpClient` and helper methods to process the request and the response:</span></span>

   [!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet2)]

<span data-ttu-id="398a2-212">SUT yapılan tüm POST istekleri otomatik olarak uygulama tarafından yapılan antiforgery onay karşılamalıdır [veri koruma sisteminde antiforgery](xref:security/data-protection/introduction).</span><span class="sxs-lookup"><span data-stu-id="398a2-212">Any POST request to the SUT must satisfy the antiforgery check that's automatically made by the app's [data protection antiforgery system](xref:security/data-protection/introduction).</span></span> <span data-ttu-id="398a2-213">Bir testin POST isteği için düzenlemek için test uygulaması gerekir:</span><span class="sxs-lookup"><span data-stu-id="398a2-213">In order to arrange for a test's POST request, the test app must:</span></span>

1. <span data-ttu-id="398a2-214">Sayfa için bir istek olun.</span><span class="sxs-lookup"><span data-stu-id="398a2-214">Make a request for the page.</span></span>
1. <span data-ttu-id="398a2-215">İstek Doğrulama belirtecini yanıtından ve antiforgery tanımlama bilgisi ayrıştırılamıyor.</span><span class="sxs-lookup"><span data-stu-id="398a2-215">Parse the antiforgery cookie and request validation token from the response.</span></span>
1. <span data-ttu-id="398a2-216">POST isteğini antiforgery tanımlama bilgisi ve istek doğrulama ile yerinde belirteci olun.</span><span class="sxs-lookup"><span data-stu-id="398a2-216">Make the POST request with the antiforgery cookie and request validation token in place.</span></span>

<span data-ttu-id="398a2-217">`SendAsync` Yardımcı uzantı yöntemleri (*Helpers/HttpClientExtensions.cs*) ve `GetDocumentAsync` yardımcı yöntemini (*Helpers/HtmlHelpers.cs*) içinde [örnekuygulaması](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples/) kullanın [AngleSharp](https://anglesharp.github.io/) aşağıdaki yöntemlerle antiforgery onay işlemek için ayrıştırıcı:</span><span class="sxs-lookup"><span data-stu-id="398a2-217">The `SendAsync` helper extension methods (*Helpers/HttpClientExtensions.cs*) and the `GetDocumentAsync` helper method (*Helpers/HtmlHelpers.cs*) in the [sample app](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples/) use the [AngleSharp](https://anglesharp.github.io/) parser to handle the antiforgery check with the following methods:</span></span>

* <span data-ttu-id="398a2-218">`GetDocumentAsync` &ndash; Alan [HttpResponseMessage](/dotnet/api/system.net.http.httpresponsemessage) ve döndüren bir `IHtmlDocument`.</span><span class="sxs-lookup"><span data-stu-id="398a2-218">`GetDocumentAsync` &ndash; Receives the [HttpResponseMessage](/dotnet/api/system.net.http.httpresponsemessage) and returns an `IHtmlDocument`.</span></span> <span data-ttu-id="398a2-219">`GetDocumentAsync` hazırlayan bir Fabrika kullanan bir *sanal yanıt* özgün tabanlı `HttpResponseMessage`.</span><span class="sxs-lookup"><span data-stu-id="398a2-219">`GetDocumentAsync` uses a factory that prepares a *virtual response* based on the original `HttpResponseMessage`.</span></span> <span data-ttu-id="398a2-220">Daha fazla bilgi için [AngleSharp belgeleri](https://github.com/AngleSharp/AngleSharp#documentation).</span><span class="sxs-lookup"><span data-stu-id="398a2-220">For more information, see the [AngleSharp documentation](https://github.com/AngleSharp/AngleSharp#documentation).</span></span>
* <span data-ttu-id="398a2-221">`SendAsync` için genişletme yöntemleri `HttpClient` oluşturan bir [HttpRequestMessage](/dotnet/api/system.net.http.httprequestmessage) ve çağrı [SendAsync(HttpRequestMessage)](/dotnet/api/system.net.http.httpclient.sendasync#System_Net_Http_HttpClient_SendAsync_System_Net_Http_HttpRequestMessage_) SUT istekleri göndermek için.</span><span class="sxs-lookup"><span data-stu-id="398a2-221">`SendAsync` extension methods for the `HttpClient` compose an [HttpRequestMessage](/dotnet/api/system.net.http.httprequestmessage) and call [SendAsync(HttpRequestMessage)](/dotnet/api/system.net.http.httpclient.sendasync#System_Net_Http_HttpClient_SendAsync_System_Net_Http_HttpRequestMessage_) to submit requests to the SUT.</span></span> <span data-ttu-id="398a2-222">İçin aşırı yüklediği `SendAsync` HTML formu kabul (`IHtmlFormElement`) ve aşağıdaki:</span><span class="sxs-lookup"><span data-stu-id="398a2-222">Overloads for `SendAsync` accept the HTML form (`IHtmlFormElement`) and the following:</span></span>
  * <span data-ttu-id="398a2-223">Düğmeyi form gönderme (`IHtmlElement`)</span><span class="sxs-lookup"><span data-stu-id="398a2-223">Submit button of the form (`IHtmlElement`)</span></span>
  * <span data-ttu-id="398a2-224">Form değerleri koleksiyonunu (`IEnumerable<KeyValuePair<string, string>>`)</span><span class="sxs-lookup"><span data-stu-id="398a2-224">Form values collection (`IEnumerable<KeyValuePair<string, string>>`)</span></span>
  * <span data-ttu-id="398a2-225">Gönder düğmesine (`IHtmlElement`) ve form değerleri (`IEnumerable<KeyValuePair<string, string>>`)</span><span class="sxs-lookup"><span data-stu-id="398a2-225">Submit button (`IHtmlElement`) and form values (`IEnumerable<KeyValuePair<string, string>>`)</span></span>

> [!NOTE]
> <span data-ttu-id="398a2-226">[AngleSharp](https://anglesharp.github.io/) üçüncü taraf ayrıştırma olan bu konu ve örnek uygulamayı tanıtım amacıyla kullanılan kitaplığı.</span><span class="sxs-lookup"><span data-stu-id="398a2-226">[AngleSharp](https://anglesharp.github.io/) is a third-party parsing library used for demonstration purposes in this topic and the sample app.</span></span> <span data-ttu-id="398a2-227">AngleSharp desteklenen veya tümleştirme ASP.NET Core uygulamalarını test etmek için gerekli değildir.</span><span class="sxs-lookup"><span data-stu-id="398a2-227">AngleSharp isn't supported or required for integration testing of ASP.NET Core apps.</span></span> <span data-ttu-id="398a2-228">Diğer Çözümleyicileri, aşağıdaki gibi kullanılabilir [Html çevikliği paketi (HAP)](http://html-agility-pack.net/).</span><span class="sxs-lookup"><span data-stu-id="398a2-228">Other parsers can be used, such as the [Html Agility Pack (HAP)](http://html-agility-pack.net/).</span></span> <span data-ttu-id="398a2-229">Başka bir yaklaşım antiforgery sistemin istek Doğrulama belirtecini ve antiforgery tanımlama bilgisi doğrudan işlemek için kod yazmaktır.</span><span class="sxs-lookup"><span data-stu-id="398a2-229">Another approach is to write code to handle the antiforgery system's request verification token and antiforgery cookie directly.</span></span>

## <a name="customize-the-client-with-withwebhostbuilder"></a><span data-ttu-id="398a2-230">WithWebHostBuilder istemcisiyle özelleştirme</span><span class="sxs-lookup"><span data-stu-id="398a2-230">Customize the client with WithWebHostBuilder</span></span>

<span data-ttu-id="398a2-231">Bir test yöntemi içinde ek yapılandırma gerektiğinde [WithWebHostBuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.withwebhostbuilder) yeni bir oluşturur `WebApplicationFactory` ile bir [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) , daha fazla özelleştirilmiş yapılandırma.</span><span class="sxs-lookup"><span data-stu-id="398a2-231">When additional configuration is required within a test method, [WithWebHostBuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.withwebhostbuilder) creates a new `WebApplicationFactory` with an [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) that is further customized by configuration.</span></span>

<span data-ttu-id="398a2-232">`Post_DeleteMessageHandler_ReturnsRedirectToRoot` Test yöntemi [örnek uygulaması](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples) kullanımını gösteren `WithWebHostBuilder`.</span><span class="sxs-lookup"><span data-stu-id="398a2-232">The `Post_DeleteMessageHandler_ReturnsRedirectToRoot` test method of the [sample app](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples) demonstrates the use of `WithWebHostBuilder`.</span></span> <span data-ttu-id="398a2-233">Bu test, bir form gönderimi SUT tetikleyerek, veritabanında bir kayıt silme gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="398a2-233">This test performs a record delete in the database by triggering a form submission in the SUT.</span></span>

<span data-ttu-id="398a2-234">Çünkü başka test `IndexPageTests` sınıfı tüm veritabanındaki kayıtları siler ve önce çalıştırılabilir bir işlem gerçekleştiren `Post_DeleteMessageHandler_ReturnsRedirectToRoot` yöntem, veritabanı çekirdek değeri oluşturulmuş bir kaydı silmek için SUT mevcut olduğundan emin olmak için bu test yönteminde.</span><span class="sxs-lookup"><span data-stu-id="398a2-234">Because another test in the `IndexPageTests` class performs an operation that deletes all of the records in the database and may run before the `Post_DeleteMessageHandler_ReturnsRedirectToRoot` method, the database is seeded in this test method to ensure that a record is present for the SUT to delete.</span></span> <span data-ttu-id="398a2-235">Seçme `deleteBtn1` düğmesini `messages` SUT biçiminde benzetimli SUT isteğinde:</span><span class="sxs-lookup"><span data-stu-id="398a2-235">Selecting the `deleteBtn1` button of the `messages` form in the SUT is simulated in the request to the SUT:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet3)]

## <a name="client-options"></a><span data-ttu-id="398a2-236">İstemci seçenekleri</span><span class="sxs-lookup"><span data-stu-id="398a2-236">Client options</span></span>

<span data-ttu-id="398a2-237">Aşağıdaki tabloda, varsayılan gösterilmektedir [WebApplicationFactoryClientOptions](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions) oluşturulurken kullanılabilir `HttpClient` örnekleri.</span><span class="sxs-lookup"><span data-stu-id="398a2-237">The following table shows the default [WebApplicationFactoryClientOptions](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions) available when creating `HttpClient` instances.</span></span>

| <span data-ttu-id="398a2-238">Seçenek</span><span class="sxs-lookup"><span data-stu-id="398a2-238">Option</span></span> | <span data-ttu-id="398a2-239">Açıklama</span><span class="sxs-lookup"><span data-stu-id="398a2-239">Description</span></span> | <span data-ttu-id="398a2-240">Varsayılan</span><span class="sxs-lookup"><span data-stu-id="398a2-240">Default</span></span> |
| ------ | ----------- | ------- |
| [<span data-ttu-id="398a2-241">AllowAutoRedirect</span><span class="sxs-lookup"><span data-stu-id="398a2-241">AllowAutoRedirect</span></span>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.allowautoredirect) | <span data-ttu-id="398a2-242">Alır veya ayarlar olsun veya olmasın `HttpClient` örnekleri otomatik olarak yeniden yönlendirme yanıtlarını izlemelidir.</span><span class="sxs-lookup"><span data-stu-id="398a2-242">Gets or sets whether or not `HttpClient` instances should automatically follow redirect responses.</span></span> | `true` |
| [<span data-ttu-id="398a2-243">BaseAddress</span><span class="sxs-lookup"><span data-stu-id="398a2-243">BaseAddress</span></span>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.baseaddress) | <span data-ttu-id="398a2-244">Alır veya ayarlar temel adresini `HttpClient` örnekleri.</span><span class="sxs-lookup"><span data-stu-id="398a2-244">Gets or sets the base address of `HttpClient` instances.</span></span> | `http://localhost` |
| [<span data-ttu-id="398a2-245">HandleCookies</span><span class="sxs-lookup"><span data-stu-id="398a2-245">HandleCookies</span></span>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.handlecookies) | <span data-ttu-id="398a2-246">Alır veya ayarlar olmadığını `HttpClient` örnekleri tanımlama bilgilerini işleme.</span><span class="sxs-lookup"><span data-stu-id="398a2-246">Gets or sets whether `HttpClient` instances should handle cookies.</span></span> | `true` |
| [<span data-ttu-id="398a2-247">MaxAutomaticRedirections</span><span class="sxs-lookup"><span data-stu-id="398a2-247">MaxAutomaticRedirections</span></span>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.maxautomaticredirections) | <span data-ttu-id="398a2-248">Alır veya ayarlar yeniden yönlendirme yanıtlarını sayısı `HttpClient` örnekleri izlemelidir.</span><span class="sxs-lookup"><span data-stu-id="398a2-248">Gets or sets the maximum number of redirect responses that `HttpClient` instances should follow.</span></span> | <span data-ttu-id="398a2-249">7</span><span class="sxs-lookup"><span data-stu-id="398a2-249">7</span></span> |

<span data-ttu-id="398a2-250">Oluşturma `WebApplicationFactoryClientOptions` sınıfı ve geçirin [CreateClient](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createclient) yöntemi (varsayılan değerler, aşağıdaki kod örneğinde gösterilmiştir):</span><span class="sxs-lookup"><span data-stu-id="398a2-250">Create the `WebApplicationFactoryClientOptions` class and pass it to the [CreateClient](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createclient) method (default values are shown in the code example):</span></span>

```csharp
// Default client option values are shown
var clientOptions = new WebApplicationFactoryClientOptions();
clientOptions.AllowAutoRedirect = true;
clientOptions.BaseAddress = new Uri("http://localhost");
clientOptions.HandleCookies = true;
clientOptions.MaxAutomaticRedirections = 7;

_client = _factory.CreateClient(clientOptions);
```

## <a name="inject-mock-services"></a><span data-ttu-id="398a2-251">Sahte Hizmetleri ekleme</span><span class="sxs-lookup"><span data-stu-id="398a2-251">Inject mock services</span></span>

<span data-ttu-id="398a2-252">Hizmetleri, bir test çağrısı ile kılınabilir [ConfigureTestServices](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.configuretestservices) üzerinde konak Oluşturucusu.</span><span class="sxs-lookup"><span data-stu-id="398a2-252">Services can be overridden in a test with a call to [ConfigureTestServices](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.configuretestservices) on the host builder.</span></span> <span data-ttu-id="398a2-253">**Sahte Hizmetleri eklemesine SUT olmalıdır bir `Startup` sınıfıyla birlikte bir `Startup.ConfigureServices` yöntemi.**</span><span class="sxs-lookup"><span data-stu-id="398a2-253">**To inject mock services, the SUT must have a `Startup` class with a `Startup.ConfigureServices` method.**</span></span>

<span data-ttu-id="398a2-254">Örnek SUT teklif döndüren bir kapsamlı hizmet içerir.</span><span class="sxs-lookup"><span data-stu-id="398a2-254">The sample SUT includes a scoped service that returns a quote.</span></span> <span data-ttu-id="398a2-255">Dizin Sayfası istendiğinde teklif gizli alanda dizin sayfasına katıştırılır.</span><span class="sxs-lookup"><span data-stu-id="398a2-255">The quote is embedded in a hidden field on the Index page when the Index page is requested.</span></span>

<span data-ttu-id="398a2-256">*Services/IQuoteService.cs*:</span><span class="sxs-lookup"><span data-stu-id="398a2-256">*Services/IQuoteService.cs*:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/src/RazorPagesProject/Services/IQuoteService.cs?name=snippet1)]

<span data-ttu-id="398a2-257">*Services/QuoteService.cs*:</span><span class="sxs-lookup"><span data-stu-id="398a2-257">*Services/QuoteService.cs*:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/src/RazorPagesProject/Services/QuoteService.cs?name=snippet1)]

<span data-ttu-id="398a2-258">*Startup.cs*:</span><span class="sxs-lookup"><span data-stu-id="398a2-258">*Startup.cs*:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/src/RazorPagesProject/Startup.cs?name=snippet2)]

<span data-ttu-id="398a2-259">*Pages/Index.cshtml.cs*:</span><span class="sxs-lookup"><span data-stu-id="398a2-259">*Pages/Index.cshtml.cs*:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/src/RazorPagesProject/Pages/Index.cshtml.cs?name=snippet1&highlight=4,9,20,26)]

<span data-ttu-id="398a2-260">*Pages/Index.cs*:</span><span class="sxs-lookup"><span data-stu-id="398a2-260">*Pages/Index.cs*:</span></span>

[!code-cshtml[](integration-tests/samples/2.x/IntegrationTestsSample/src/RazorPagesProject/Pages/Index.cshtml?name=snippet_Quote)]

<span data-ttu-id="398a2-261">Aşağıdaki biçimlendirmede SUT uygulama çalıştırıldığında oluşturulur:</span><span class="sxs-lookup"><span data-stu-id="398a2-261">The following markup is generated when the SUT app is run:</span></span>

```html
<input id="quote" type="hidden" value="Come on, Sarah. We&#x27;ve an appointment in 
    London, and we&#x27;re already 30,000 years late.">
```

<span data-ttu-id="398a2-262">Bir tümleştirme testi hizmet ve teklif ekleme için sahte bir hizmet tarafından test SUT eklenmiş olur.</span><span class="sxs-lookup"><span data-stu-id="398a2-262">To test the service and quote injection in an integration test, a mock service is injected into the SUT by the test.</span></span> <span data-ttu-id="398a2-263">Sahte hizmet uygulamanın yerini alan `QuoteService` test uygulama tarafından sağlanan bir hizmetle adlı `TestQuoteService`:</span><span class="sxs-lookup"><span data-stu-id="398a2-263">The mock service replaces the app's `QuoteService` with a service provided by the test app, called `TestQuoteService`:</span></span>

<span data-ttu-id="398a2-264">*IntegrationTests.IndexPageTests.cs*:</span><span class="sxs-lookup"><span data-stu-id="398a2-264">*IntegrationTests.IndexPageTests.cs*:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet4)]

<span data-ttu-id="398a2-265">`ConfigureTestServices` olarak adlandırılan ve kapsamlı hizmet kayıtlı:</span><span class="sxs-lookup"><span data-stu-id="398a2-265">`ConfigureTestServices` is called, and the scoped service is registered:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet5&highlight=7-10,17,20-21)]

<span data-ttu-id="398a2-266">Test yürütme sırasında üretilen biçimlendirme tarafından sağlanan teklif metin yansıtır `TestQuoteService`, bu nedenle onaylama geçişleri:</span><span class="sxs-lookup"><span data-stu-id="398a2-266">The markup produced during the test's execution reflects the quote text supplied by `TestQuoteService`, thus the assertion passes:</span></span>

```html
<input id="quote" type="hidden" value="Something&#x27;s interfering with time, 
    Mr. Scarman, and time is my business.">
```

## <a name="how-the-test-infrastructure-infers-the-app-content-root-path"></a><span data-ttu-id="398a2-267">Sınama altyapının uygulama içerik kök yolu nasıl algılar</span><span class="sxs-lookup"><span data-stu-id="398a2-267">How the test infrastructure infers the app content root path</span></span>

<span data-ttu-id="398a2-268">`WebApplicationFactory` Oluşturucusu çıkarsar uygulama içerik kök yolu arayarak bir [WebApplicationFactoryContentRootAttribute](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactorycontentrootattribute) eşit bir anahtarla tümleştirme testleri içeren derleme üzerinde `TEntryPoint` derleme`System.Reflection.Assembly.FullName`.</span><span class="sxs-lookup"><span data-stu-id="398a2-268">The `WebApplicationFactory` constructor infers the app content root path by searching for a [WebApplicationFactoryContentRootAttribute](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactorycontentrootattribute) on the assembly containing the integration tests with a key equal to the `TEntryPoint` assembly `System.Reflection.Assembly.FullName`.</span></span> <span data-ttu-id="398a2-269">Özniteliğin doğru anahtarla bulunamadığında durumda `WebApplicationFactory` bir çözüm dosyası için aramaya geri döner (*\*.sln*) ve ekler `TEntryPoint` çözüm dizinine derleme adı.</span><span class="sxs-lookup"><span data-stu-id="398a2-269">In case an attribute with the correct key isn't found, `WebApplicationFactory` falls back to searching for a solution file (*\*.sln*) and appends the `TEntryPoint` assembly name to the solution directory.</span></span> <span data-ttu-id="398a2-270">Uygulama kök dizinindeki (içerik kök yol), görünümleri ve içerik dosyalarını bulmak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="398a2-270">The app root directory (the content root path) is used to discover views and content files.</span></span>

<span data-ttu-id="398a2-271">Arama mantığı çalışma zamanında doğru içerik kök genellikle bulur. çoğu durumda, bu uygulama içerik kök açıkça ayarlamak gerekli değildir.</span><span class="sxs-lookup"><span data-stu-id="398a2-271">In most cases, it isn't necessary to explicitly set the app content root, as the search logic usually finds the correct content root at runtime.</span></span> <span data-ttu-id="398a2-272">İçerik kök bulunduğu değil özel senaryolarda yerleşik arama algoritması, uygulama kök açıkça veya özel mantığı kullanarak belirtilen içerik kullanma.</span><span class="sxs-lookup"><span data-stu-id="398a2-272">In special scenarios where the content root isn't found using the built-in search algorithm, the app content root can be specified explicitly or by using custom logic.</span></span> <span data-ttu-id="398a2-273">Bu senaryolarda uygulama içerik kök ayarlamak için çağrı `UseSolutionRelativeContentRoot` şuradan genişleme metodu [Microsoft.AspNetCore.TestHost](https://www.nuget.org/packages/Microsoft.AspNetCore.TestHost) paket.</span><span class="sxs-lookup"><span data-stu-id="398a2-273">To set the app content root in those scenarios, call the `UseSolutionRelativeContentRoot` extension method from the [Microsoft.AspNetCore.TestHost](https://www.nuget.org/packages/Microsoft.AspNetCore.TestHost) package.</span></span> <span data-ttu-id="398a2-274">Çözümün göreli yol ve dosya adı veya glob deseni isteğe bağlı bir çözüm sağlamak (varsayılan = `*.sln`).</span><span class="sxs-lookup"><span data-stu-id="398a2-274">Supply the solution's relative path and optional solution file name or glob pattern (default = `*.sln`).</span></span>

<span data-ttu-id="398a2-275">Çağrı [UseSolutionRelativeContentRoot](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.usesolutionrelativecontentroot) uzantısı yöntemiyle *bir* aşağıdaki yaklaşımlardan biri:</span><span class="sxs-lookup"><span data-stu-id="398a2-275">Call the [UseSolutionRelativeContentRoot](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.usesolutionrelativecontentroot) extension method using *ONE* of the following approaches:</span></span>

* <span data-ttu-id="398a2-276">Test sınıflarıyla yapılandırırken `WebApplicationFactory`, özel bir yapılandırma sağlamak [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder):</span><span class="sxs-lookup"><span data-stu-id="398a2-276">When configuring test classes with `WebApplicationFactory`, provide a custom configuration with the [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder):</span></span>

   ```csharp
   public IndexPageTests(
       WebApplicationFactory<RazorPagesProject.Startup> factory)
   {
       var _factory = factory.WithWebHostBuilder(builder =>
       {
           builder.UseSolutionRelativeContentRoot("<SOLUTION-RELATIVE-PATH>");

           ...
       });
   }
   ```

* <span data-ttu-id="398a2-277">Özel bir test sınıflarında yapılandırırken `WebApplicationFactory`, devralınan `WebApplicationFactory` ve geçersiz kılma [ConfigureWebHost](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.configurewebhost):</span><span class="sxs-lookup"><span data-stu-id="398a2-277">When configuring test classes with a custom `WebApplicationFactory`, inherit from `WebApplicationFactory` and override [ConfigureWebHost](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.configurewebhost):</span></span>

   ```csharp
   public class CustomWebApplicationFactory<TStartup>
       : WebApplicationFactory<RazorPagesProject.Startup>
   {
       protected override void ConfigureWebHost(IWebHostBuilder builder)
       {
           builder.ConfigureServices(services =>
           {
               builder.UseSolutionRelativeContentRoot("<SOLUTION-RELATIVE-PATH>");

               ...
           });
       }
   }
   ```

## <a name="disable-shadow-copying"></a><span data-ttu-id="398a2-278">Gölge kopyalama devre dışı bırak</span><span class="sxs-lookup"><span data-stu-id="398a2-278">Disable shadow copying</span></span>

<span data-ttu-id="398a2-279">Gölge kopyalama çıktı klasörünü farklı bir klasörde yürütülecek testleri neden olur.</span><span class="sxs-lookup"><span data-stu-id="398a2-279">Shadow copying causes the tests to execute in a different folder than the output folder.</span></span> <span data-ttu-id="398a2-280">Gölge kopyalama düzgün çalışması testleri için devre dışı bırakılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="398a2-280">For tests to work properly, shadow copying must be disabled.</span></span> <span data-ttu-id="398a2-281">[Örnek uygulaması](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples) xUnit kullanır ve dahil ederek xUnit için gölge kopyalama devre dışı bırakan bir *xunit.runner.json* doğru yapılandırma ayarı dosyası.</span><span class="sxs-lookup"><span data-stu-id="398a2-281">The [sample app](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples) uses xUnit and disables shadow copying for xUnit by including an *xunit.runner.json* file with the correct configuration setting.</span></span> <span data-ttu-id="398a2-282">Daha fazla bilgi için [xUnit.net ile JSON yapılandırma](https://xunit.github.io/docs/configuring-with-json.html).</span><span class="sxs-lookup"><span data-stu-id="398a2-282">For more information, see [Configuring xUnit.net with JSON](https://xunit.github.io/docs/configuring-with-json.html).</span></span>

<span data-ttu-id="398a2-283">Ekleme *xunit.runner.json* dosya aşağıdaki içeriğe sahip test projesinin kök:</span><span class="sxs-lookup"><span data-stu-id="398a2-283">Add the *xunit.runner.json* file to root of the test project with the following content:</span></span>

```json
{
  "shadowCopy": false
}
```

## <a name="disposal-of-objects"></a><span data-ttu-id="398a2-284">Nesne çıkarma</span><span class="sxs-lookup"><span data-stu-id="398a2-284">Disposal of objects</span></span>

<span data-ttu-id="398a2-285">Testleri sonra `IClassFixture` uygulama yürütüldüğünde, [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver) ve [HttpClient](/dotnet/api/system.net.http.httpclient) xUnit, siler, elden [WebApplicationFactory](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1) .</span><span class="sxs-lookup"><span data-stu-id="398a2-285">After the tests of the `IClassFixture` implementation are executed, [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver) and [HttpClient](/dotnet/api/system.net.http.httpclient) are disposed when xUnit disposes of the [WebApplicationFactory](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1).</span></span> <span data-ttu-id="398a2-286">Geliştirici tarafından oluşturulan nesneler elden ihtiyacınız varsa, dispose `IClassFixture` uygulaması.</span><span class="sxs-lookup"><span data-stu-id="398a2-286">If objects instantiated by the developer require disposal, dispose of them in the `IClassFixture` implementation.</span></span> <span data-ttu-id="398a2-287">Daha fazla bilgi için [Dispose yöntemi uygulama](/dotnet/standard/garbage-collection/implementing-dispose).</span><span class="sxs-lookup"><span data-stu-id="398a2-287">For more information, see [Implementing a Dispose method](/dotnet/standard/garbage-collection/implementing-dispose).</span></span>

## <a name="integration-tests-sample"></a><span data-ttu-id="398a2-288">Tümleştirme testleri örneği</span><span class="sxs-lookup"><span data-stu-id="398a2-288">Integration tests sample</span></span>

<span data-ttu-id="398a2-289">[Örnek uygulaması](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples) iki uygulama oluşur:</span><span class="sxs-lookup"><span data-stu-id="398a2-289">The [sample app](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/integration-tests/samples) is composed of two apps:</span></span>

| <span data-ttu-id="398a2-290">Uygulama</span><span class="sxs-lookup"><span data-stu-id="398a2-290">App</span></span> | <span data-ttu-id="398a2-291">Proje klasörü</span><span class="sxs-lookup"><span data-stu-id="398a2-291">Project folder</span></span> | <span data-ttu-id="398a2-292">Açıklama</span><span class="sxs-lookup"><span data-stu-id="398a2-292">Description</span></span> |
| --- | -------------- | ----------- |
| <span data-ttu-id="398a2-293">İleti uygulaması (SUT)</span><span class="sxs-lookup"><span data-stu-id="398a2-293">Message app (the SUT)</span></span> | <span data-ttu-id="398a2-294">*src/RazorPagesProject*</span><span class="sxs-lookup"><span data-stu-id="398a2-294">*src/RazorPagesProject*</span></span> | <span data-ttu-id="398a2-295">Eklemek, silmek, tüm silmek ve iletileri çözümleme açmasına olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="398a2-295">Allows a user to add, delete one, delete all, and analyze messages.</span></span> |
| <span data-ttu-id="398a2-296">Test uygulaması</span><span class="sxs-lookup"><span data-stu-id="398a2-296">Test app</span></span> | <span data-ttu-id="398a2-297">*tests/RazorPagesProject.Tests*</span><span class="sxs-lookup"><span data-stu-id="398a2-297">*tests/RazorPagesProject.Tests*</span></span> | <span data-ttu-id="398a2-298">Tümleştirme testi SUT için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="398a2-298">Used to integration test the SUT.</span></span> |

<span data-ttu-id="398a2-299">Bir IDE özelliklerini yerleşik test gibi kullanarak testler çalıştırılabilir [Visual Studio](https://www.visualstudio.com/vs/).</span><span class="sxs-lookup"><span data-stu-id="398a2-299">The tests can be run using the built-in test features of an IDE, such as [Visual Studio](https://www.visualstudio.com/vs/).</span></span> <span data-ttu-id="398a2-300">Kullanıyorsanız [Visual Studio Code](https://code.visualstudio.com/) veya bir komut isteminde aşağıdaki komutu yürütün komut satırının *tests/RazorPagesProject.Tests* klasörü:</span><span class="sxs-lookup"><span data-stu-id="398a2-300">If using [Visual Studio Code](https://code.visualstudio.com/) or the command line, execute the following command at a command prompt in the *tests/RazorPagesProject.Tests* folder:</span></span>

```console
dotnet test
```

### <a name="message-app-sut-organization"></a><span data-ttu-id="398a2-301">İleti uygulaması (SUT) kuruluş</span><span class="sxs-lookup"><span data-stu-id="398a2-301">Message app (SUT) organization</span></span>

<span data-ttu-id="398a2-302">Aşağıdaki özelliklere sahip bir Razor sayfaları ileti sistemi SUT şöyledir:</span><span class="sxs-lookup"><span data-stu-id="398a2-302">The SUT is a Razor Pages message system with the following characteristics:</span></span>

* <span data-ttu-id="398a2-303">Uygulama dizin sayfasına (*Pages/Index.cshtml* ve *Pages/Index.cshtml.cs*) UI ve sayfa ekleme, silme ve analiz iletilerinin (ileti başına ortalama kelimeler) denetlemek için model yöntemleri sağlar. .</span><span class="sxs-lookup"><span data-stu-id="398a2-303">The Index page of the app (*Pages/Index.cshtml* and *Pages/Index.cshtml.cs*) provides a UI and page model methods to control the addition, deletion, and analysis of messages (average words per message).</span></span>
* <span data-ttu-id="398a2-304">İleti tarafından açıklanan `Message` sınıfı (*Data/Message.cs*) iki özelliğe sahip: `Id` (anahtar) ve `Text` (mesaj).</span><span class="sxs-lookup"><span data-stu-id="398a2-304">A message is described by the `Message` class (*Data/Message.cs*) with two properties: `Id` (key) and `Text` (message).</span></span> <span data-ttu-id="398a2-305">`Text` Özelliği gereklidir ve 200 karakterle sınırlıdır.</span><span class="sxs-lookup"><span data-stu-id="398a2-305">The `Text` property is required and limited to 200 characters.</span></span>
* <span data-ttu-id="398a2-306">İletileri kullanarak depolanan [Entity Framework'ün bellek içi veritabanına](/ef/core/providers/in-memory/)&#8224;.</span><span class="sxs-lookup"><span data-stu-id="398a2-306">Messages are stored using [Entity Framework's in-memory database](/ef/core/providers/in-memory/)&#8224;.</span></span>
* <span data-ttu-id="398a2-307">Uygulama, veritabanı bağlamı sınıfının bir veri erişim katmanı (DAL) içeren `AppDbContext` (*Data/AppDbContext.cs*).</span><span class="sxs-lookup"><span data-stu-id="398a2-307">The app contains a data access layer (DAL) in its database context class, `AppDbContext` (*Data/AppDbContext.cs*).</span></span>
* <span data-ttu-id="398a2-308">Uygulama başlangıcında veritabanı boşsa, ileti deposu üç iletileri ile başlatılır.</span><span class="sxs-lookup"><span data-stu-id="398a2-308">If the database is empty on app startup, the message store is initialized with three messages.</span></span>
* <span data-ttu-id="398a2-309">Uygulamayı içeren bir `/SecurePage` , yalnızca erişilebilir bir kimliği doğrulanmış kullanıcı tarafından.</span><span class="sxs-lookup"><span data-stu-id="398a2-309">The app includes a `/SecurePage` that can only be accessed by an authenticated user.</span></span>

<span data-ttu-id="398a2-310">&#8224;EF konu [Inmemory ile Test](/ef/core/miscellaneous/testing/in-memory), MSTest ile testleri için bellek içi veritabanına nasıl kullanıldığını açıklar.</span><span class="sxs-lookup"><span data-stu-id="398a2-310">&#8224;The EF topic, [Test with InMemory](/ef/core/miscellaneous/testing/in-memory), explains how to use an in-memory database for tests with MSTest.</span></span> <span data-ttu-id="398a2-311">Bu konuda kullanan [xUnit](https://xunit.github.io/) test çerçevesi.</span><span class="sxs-lookup"><span data-stu-id="398a2-311">This topic uses the [xUnit](https://xunit.github.io/) test framework.</span></span> <span data-ttu-id="398a2-312">Test kavramları ve test uygulamaları arasında farklı test çerçeveleri benzer, ancak aynı değildir.</span><span class="sxs-lookup"><span data-stu-id="398a2-312">Test concepts and test implementations across different test frameworks are similar but not identical.</span></span>

<span data-ttu-id="398a2-313">Uygulama deposu düzeni kullanmaz ve etkili bir örneği değil ancak [iş birimi (UoW) deseni](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor sayfaları geliştirme bu desenleri destekler.</span><span class="sxs-lookup"><span data-stu-id="398a2-313">Although the app doesn't use the repository pattern and isn't an effective example of the [Unit of Work (UoW) pattern](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor Pages supports these patterns of development.</span></span> <span data-ttu-id="398a2-314">Daha fazla bilgi için [altyapı Kalıcılık katmanını tasarlama](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) ve [Test denetleyicisi mantığı](/aspnet/core/mvc/controllers/testing) (örnek depo Yapılacaklar listesi).</span><span class="sxs-lookup"><span data-stu-id="398a2-314">For more information, see [Designing the infrastructure persistence layer](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) and [Test controller logic](/aspnet/core/mvc/controllers/testing) (the sample implements the repository pattern).</span></span>

### <a name="test-app-organization"></a><span data-ttu-id="398a2-315">Test uygulama kuruluş</span><span class="sxs-lookup"><span data-stu-id="398a2-315">Test app organization</span></span>

<span data-ttu-id="398a2-316">Bir konsol uygulaması içinde test uygulamasıdır *tests/RazorPagesProject.Tests* klasör.</span><span class="sxs-lookup"><span data-stu-id="398a2-316">The test app is a console app inside the *tests/RazorPagesProject.Tests* folder.</span></span>

| <span data-ttu-id="398a2-317">Test uygulama klasörü</span><span class="sxs-lookup"><span data-stu-id="398a2-317">Test app folder</span></span> | <span data-ttu-id="398a2-318">Açıklama</span><span class="sxs-lookup"><span data-stu-id="398a2-318">Description</span></span> |
| --------------- | ----------- |
| <span data-ttu-id="398a2-319">*BasicTests*</span><span class="sxs-lookup"><span data-stu-id="398a2-319">*BasicTests*</span></span> | <span data-ttu-id="398a2-320">*BasicTests.cs* yönlendirme, güvenli bir sayfa kimliği doğrulanmamış bir kullanıcı tarafından erişme ve GitHub kullanıcı profili edinme ve profilinin kullanıcı oturum açma denetimi için test yöntemleri içerir.</span><span class="sxs-lookup"><span data-stu-id="398a2-320">*BasicTests.cs* contains test methods for routing, accessing a secure page by an unauthenticated user, and obtaining a GitHub user profile and checking the profile's user login.</span></span> |
| <span data-ttu-id="398a2-321">*IntegrationTests*</span><span class="sxs-lookup"><span data-stu-id="398a2-321">*IntegrationTests*</span></span> | <span data-ttu-id="398a2-322">*IndexPageTests.cs* özel kullanarak dizin sayfasına için tümleştirme testleri içeren `WebApplicationFactory` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="398a2-322">*IndexPageTests.cs* contains the integration tests for the Index page using custom `WebApplicationFactory` class.</span></span> |
| <span data-ttu-id="398a2-323">*Yardımcıları/yardımcı programları*</span><span class="sxs-lookup"><span data-stu-id="398a2-323">*Helpers/Utilities*</span></span> | <ul><li><span data-ttu-id="398a2-324">*Utilities.cs* içeren `InitializeDbForTests` test verileri ile veritabanının çekirdeğini oluşturma için kullanılan yöntem.</span><span class="sxs-lookup"><span data-stu-id="398a2-324">*Utilities.cs* contains the `InitializeDbForTests` method used to seed the database with test data.</span></span></li><li><span data-ttu-id="398a2-325">*HtmlHelpers.cs* bir AngleSharp döndürmek için bir yöntem sağlar `IHtmlDocument` test yöntemleri tarafından kullanılacak.</span><span class="sxs-lookup"><span data-stu-id="398a2-325">*HtmlHelpers.cs* provides a method to return an AngleSharp `IHtmlDocument` for use by the test methods.</span></span></li><li><span data-ttu-id="398a2-326">*HttpClientExtensions.cs* için aşırı yüklemeler sağlar `SendAsync` SUT istekleri göndermek için.</span><span class="sxs-lookup"><span data-stu-id="398a2-326">*HttpClientExtensions.cs* provide overloads for `SendAsync` to submit requests to the SUT.</span></span></li></ul> |

<span data-ttu-id="398a2-327">Test çerçevesi [xUnit](https://xunit.github.io/).</span><span class="sxs-lookup"><span data-stu-id="398a2-327">The test framework is [xUnit](https://xunit.github.io/).</span></span> <span data-ttu-id="398a2-328">Tümleştirme testleri kullanarak gerçekleştirilen [Microsoft.AspNetCore.TestHost](/dotnet/api/microsoft.aspnetcore.testhost), içeren [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver).</span><span class="sxs-lookup"><span data-stu-id="398a2-328">Integration tests are conducted using the [Microsoft.AspNetCore.TestHost](/dotnet/api/microsoft.aspnetcore.testhost), which includes the [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver).</span></span> <span data-ttu-id="398a2-329">Çünkü [Microsoft.AspNetCore.Mvc.Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) paket test ana bilgisayarı ve test sunucuyu yapılandırmak için kullanılan `TestHost` ve `TestServer` paketi doğrudan paket başvuruları test uygulamanın proje dosyasında gerektirir yok veya test uygulamadaki Geliştirici yapılandırması.</span><span class="sxs-lookup"><span data-stu-id="398a2-329">Because the [Microsoft.AspNetCore.Mvc.Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) package is used to configure the test host and test server, the `TestHost` and `TestServer` packages don't require direct package references in the test app's project file or developer configuration in the test app.</span></span>

<span data-ttu-id="398a2-330">**Test etmek için veritabanı dengeli dağıtım**</span><span class="sxs-lookup"><span data-stu-id="398a2-330">**Seeding the database for testing**</span></span>

<span data-ttu-id="398a2-331">Tümleştirme testleri genellikle test yürütülmeden önce veritabanında küçük bir veri kümesi gerektirir.</span><span class="sxs-lookup"><span data-stu-id="398a2-331">Integration tests usually require a small dataset in the database prior to the test execution.</span></span> <span data-ttu-id="398a2-332">Örneğin, bir silme test çağrıları için veritabanı kayıt silme işlemi, bu nedenle veritabanı silme isteği başarılı olması için en az bir kayıt olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="398a2-332">For example, a delete test calls for a database record deletion, so the database must have at least one record for the delete request to succeed.</span></span>

<span data-ttu-id="398a2-333">Örnek uygulamayı üç iletilerinde veritabanıyla çekirdeğini *Utilities.cs* bunlar yürüttüğünüzde testlerini kullanabilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="398a2-333">The sample app seeds the database with three messages in *Utilities.cs* that tests can use when they execute:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/Helpers/Utilities.cs?name=snippet1)]

## <a name="additional-resources"></a><span data-ttu-id="398a2-334">Ek kaynaklar</span><span class="sxs-lookup"><span data-stu-id="398a2-334">Additional resources</span></span>

* [<span data-ttu-id="398a2-335">Birim testleri</span><span class="sxs-lookup"><span data-stu-id="398a2-335">Unit tests</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)
* [<span data-ttu-id="398a2-336">Razor Sayfaları birim testleri</span><span class="sxs-lookup"><span data-stu-id="398a2-336">Razor Pages unit tests</span></span>](xref:test/razor-pages-tests)
* [<span data-ttu-id="398a2-337">Ara Yazılım</span><span class="sxs-lookup"><span data-stu-id="398a2-337">Middleware</span></span>](xref:fundamentals/middleware/index)
* [<span data-ttu-id="398a2-338">Test denetleyicileri</span><span class="sxs-lookup"><span data-stu-id="398a2-338">Test controllers</span></span>](xref:mvc/controllers/testing)
