---
uid: aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server
title: OWIN OAuth 2.0 Yetkilendirme Sunucusu | Microsoft Dokümanlar
author: hongyes
description: Bu öğretici, OWIN OAuth aracını kullanarak Bir OAuth 2.0 Yetkilendirme Sunucusu'nu nasıl uygulayacağınız konusunda size rehberlik edecektir. Bu gelişmiş bir öğretici olduğunu sadece outlin ...
ms.author: riande
ms.date: 03/20/2014
ms.assetid: 20acee16-c70c-41e9-b38f-92bfcf9a4c1c
msc.legacyurl: /aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server
msc.type: authoredcontent
ms.openlocfilehash: d758fa2639d10e1b7be8d87c5d1f7adb7e292ac7
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/17/2020
ms.locfileid: "81540434"
---
<a name="owin-oauth-20-authorization-server"></a><span data-ttu-id="388c8-104">OWIN OAuth 2.0 Yetkilendirme Sunucusu</span><span class="sxs-lookup"><span data-stu-id="388c8-104">OWIN OAuth 2.0 Authorization Server</span></span>
====================
<span data-ttu-id="388c8-105">Tarafından [Hongye Sun](https://github.com/hongyes) ve [Praburaj Thiagarajan](https://github.com/Praburaj)</span><span class="sxs-lookup"><span data-stu-id="388c8-105">by [Hongye Sun](https://github.com/hongyes) and [Praburaj Thiagarajan](https://github.com/Praburaj)</span></span>

> <span data-ttu-id="388c8-106">Bu öğretici, OWIN OAuth aracını kullanarak Bir OAuth 2.0 Yetkilendirme Sunucusu'nu nasıl uygulayacağınız konusunda size rehberlik edecektir.</span><span class="sxs-lookup"><span data-stu-id="388c8-106">This tutorial will guide you on how to implement an OAuth 2.0 Authorization Server using OWIN OAuth middleware.</span></span> <span data-ttu-id="388c8-107">Bu, yalnızca Bir OWIN OAuth 2.0 Yetkilendirme Sunucusu oluşturmak için adımları özetleyen gelişmiş bir öğreticidir.</span><span class="sxs-lookup"><span data-stu-id="388c8-107">This is an advanced tutorial that only outlines the steps to create an OWIN OAuth 2.0 Authorization Server.</span></span> <span data-ttu-id="388c8-108">Bu adım öğretici bir adım değildir.</span><span class="sxs-lookup"><span data-stu-id="388c8-108">This is not a step by step tutorial.</span></span> <span data-ttu-id="388c8-109">[Örnek kodu indirin.](https://code.msdn.microsoft.com/OWIN-OAuth-20-Authorization-ba2b8783/file/114932/1/AuthorizationServer.zip)</span><span class="sxs-lookup"><span data-stu-id="388c8-109">[Download the sample code](https://code.msdn.microsoft.com/OWIN-OAuth-20-Authorization-ba2b8783/file/114932/1/AuthorizationServer.zip).</span></span>
>
> > [!NOTE]
> > <span data-ttu-id="388c8-110">Bu anahat, güvenli bir üretim uygulaması oluşturmak için kullanılmak üzere tasarlanmamalıdır.</span><span class="sxs-lookup"><span data-stu-id="388c8-110">This outline should not be intended to be used for creating a secure production app.</span></span> <span data-ttu-id="388c8-111">Bu öğretici, OWIN OAuth aracını kullanarak bir OAuth 2.0 Yetkilendirme Sunucusunun nasıl uygulanacağı hakkında yalnızca bir anahat sağlamak için tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="388c8-111">This tutorial is intended to provide only an outline on how to implement an OAuth 2.0 Authorization Server using OWIN OAuth middleware.</span></span>
>
>
> ## <a name="software-versions"></a><span data-ttu-id="388c8-112">Yazılım sürümleri</span><span class="sxs-lookup"><span data-stu-id="388c8-112">Software versions</span></span>
>
> | <span data-ttu-id="388c8-113">**Öğreticide gösterilen**</span><span class="sxs-lookup"><span data-stu-id="388c8-113">**Shown in the tutorial**</span></span> | <span data-ttu-id="388c8-114">**Ayrıca ile çalışır**</span><span class="sxs-lookup"><span data-stu-id="388c8-114">**Also works with**</span></span> |
> | --- | --- |
> | <span data-ttu-id="388c8-115">Windows 8.1</span><span class="sxs-lookup"><span data-stu-id="388c8-115">Windows 8.1</span></span> | <span data-ttu-id="388c8-116">Windows 8, Windows 7</span><span class="sxs-lookup"><span data-stu-id="388c8-116">Windows 8, Windows 7</span></span> |
> | [<span data-ttu-id="388c8-117">Görsel Stüdyo 2013</span><span class="sxs-lookup"><span data-stu-id="388c8-117">Visual Studio 2013</span></span>](https://my.visualstudio.com/Downloads?q=visual%20studio%202013) | <span data-ttu-id="388c8-118">[Visual Studio 2013 Masaüstü için Express](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express).</span><span class="sxs-lookup"><span data-stu-id="388c8-118">[Visual Studio 2013 Express for Desktop](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express).</span></span> <span data-ttu-id="388c8-119">Visual Studio 2012 ile en son güncelleme çalışması gerekir, ancak öğretici ile test edilmemiştir ve bazı menü seçimleri ve iletişim kutuları farklıdır.</span><span class="sxs-lookup"><span data-stu-id="388c8-119">Visual Studio 2012 with the latest update should work, but the tutorial has not been tested with it, and some menu selections and dialog boxes are different.</span></span> |
> | <span data-ttu-id="388c8-120">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="388c8-120">.NET 4.5</span></span> |  |
>
> ## <a name="questions-and-comments"></a><span data-ttu-id="388c8-121">Sorular ve Yorumlar</span><span class="sxs-lookup"><span data-stu-id="388c8-121">Questions and Comments</span></span>
>
> <span data-ttu-id="388c8-122">Öğreticiyle doğrudan ilgili olmayan sorularınız varsa, bunları [GitHub'daki Katana Projesi'nde](https://github.com/aspnet/AspNetKatana/)yayınlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="388c8-122">If you have questions that are not directly related to the tutorial, you can post them at [Katana Project on GitHub](https://github.com/aspnet/AspNetKatana/).</span></span> <span data-ttu-id="388c8-123">Öğreticinin kendisi yle ilgili soru ve yorumlar için sayfanın altındaki yorumlar bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="388c8-123">For questions and comments regarding the tutorial itself, see the comments section at the bottom of the page.</span></span>


<span data-ttu-id="388c8-124">[OAuth 2.0 çerçevesi,](http://tools.ietf.org/html/rfc6749) bir üçüncü taraf uygulamasının bir HTTP hizmetine sınırlı erişim elde etmesini sağlar.</span><span class="sxs-lookup"><span data-stu-id="388c8-124">The [OAuth 2.0 framework](http://tools.ietf.org/html/rfc6749) enables a third-party app to obtain limited access to an HTTP service.</span></span> <span data-ttu-id="388c8-125">İstemci, korumalı bir kaynağa erişmek için kaynak sahibinin kimlik bilgilerini kullanmak yerine, bir erişim belirteci (belirli bir kapsam, yaşam süresi ve diğer erişim özniteliklerini gösteren bir dize) alır.</span><span class="sxs-lookup"><span data-stu-id="388c8-125">Instead of using the resource owner's credentials to access a protected resource, the client obtains an access token (which is a string denoting a specific scope, lifetime, and other access attributes).</span></span> <span data-ttu-id="388c8-126">Erişim belirteçleri, kaynak sahibinin onayı ile bir yetkilendirme sunucusu tarafından üçüncü taraf istemcilere verilir.</span><span class="sxs-lookup"><span data-stu-id="388c8-126">Access tokens are issued to third-party clients by an authorization server with the approval of the resource owner.</span></span>

<span data-ttu-id="388c8-127">Bu öğretici kapsayacak:</span><span class="sxs-lookup"><span data-stu-id="388c8-127">This tutorial will cover:</span></span>

- <span data-ttu-id="388c8-128">Dört yetkilendirme hibe türünü desteklemek ve belirteçleri yenilemek için bir yetkilendirme sunucusu oluşturma:</span><span class="sxs-lookup"><span data-stu-id="388c8-128">How to create an authorization server to support four authorization grant types and refresh tokens:</span></span>
    - <span data-ttu-id="388c8-129">Yetkilendirme kodu hibesi</span><span class="sxs-lookup"><span data-stu-id="388c8-129">Authorization code grant</span></span>
    - <span data-ttu-id="388c8-130">Örtülü Hibe</span><span class="sxs-lookup"><span data-stu-id="388c8-130">Implicit Grant</span></span>
    - <span data-ttu-id="388c8-131">Kaynak Sahibi Şifre Kimlik Bilgileri Hibesi</span><span class="sxs-lookup"><span data-stu-id="388c8-131">Resource Owner Password Credentials Grant</span></span>
    - <span data-ttu-id="388c8-132">Müşteri Kimlik Bilgileri Hibesi</span><span class="sxs-lookup"><span data-stu-id="388c8-132">Client Credentials Grant</span></span>
- <span data-ttu-id="388c8-133">Erişim belirteci tarafından korunan bir kaynak sunucusu oluşturma.</span><span class="sxs-lookup"><span data-stu-id="388c8-133">Creating a resource server which is protected by an access token.</span></span>
- <span data-ttu-id="388c8-134">OAuth 2.0 istemcileri oluşturma.</span><span class="sxs-lookup"><span data-stu-id="388c8-134">Creating OAuth 2.0 clients.</span></span>

<a id="prerequisites"></a>
## <a name="prerequisites"></a><span data-ttu-id="388c8-135">Ön koşullar</span><span class="sxs-lookup"><span data-stu-id="388c8-135">Prerequisites</span></span>

- <span data-ttu-id="388c8-136">[Visual Studio 2013](https://www.microsoft.com/visualstudio/eng/downloads#d-2013-editions) veya ücretsiz [Visual Studio Express 2013](https://www.microsoft.com/visualstudio/eng/downloads#d-2013-express), sayfanın üst kısmında **Yazılım Sürümleri** belirtildiği gibi.</span><span class="sxs-lookup"><span data-stu-id="388c8-136">[Visual Studio 2013](https://www.microsoft.com/visualstudio/eng/downloads#d-2013-editions) or the free [Visual Studio Express 2013](https://www.microsoft.com/visualstudio/eng/downloads#d-2013-express), as indicated in **Software Versions** at the top of the page.</span></span>
- <span data-ttu-id="388c8-137">OWIN ile aşinalık.</span><span class="sxs-lookup"><span data-stu-id="388c8-137">Familiarity with OWIN.</span></span> <span data-ttu-id="388c8-138">Katana Projesi ve OWIN ve [Katana yeniliklerle](index.md) [başlarken](https://msdn.microsoft.com/magazine/dn451439.aspx) bakın.</span><span class="sxs-lookup"><span data-stu-id="388c8-138">See [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx) and [What's new in OWIN and Katana](index.md).</span></span>
- <span data-ttu-id="388c8-139">[Roller,](http://tools.ietf.org/html/rfc6749#section-1.1) [Protokol Akışı](http://tools.ietf.org/html/rfc6749#section-1.2)ve [Yetki Lendirme Desteği](http://tools.ietf.org/html/rfc6749#section-1.3)de dahil olmak üzere [OAuth](http://tools.ietf.org/html/rfc6749) terminolojisi ile aşinalık.</span><span class="sxs-lookup"><span data-stu-id="388c8-139">Familiarity with [OAuth](http://tools.ietf.org/html/rfc6749) terminology, including [Roles](http://tools.ietf.org/html/rfc6749#section-1.1), [Protocol Flow](http://tools.ietf.org/html/rfc6749#section-1.2), and [Authorization Grant](http://tools.ietf.org/html/rfc6749#section-1.3).</span></span> <span data-ttu-id="388c8-140">[OAuth 2.0 giriş](http://tools.ietf.org/html/rfc6749#section-1) iyi bir giriş sağlar.</span><span class="sxs-lookup"><span data-stu-id="388c8-140">[OAuth 2.0 introduction](http://tools.ietf.org/html/rfc6749#section-1) provides a good introduction.</span></span>

## <a name="create-an-authorization-server"></a><span data-ttu-id="388c8-141">Yetkilendirme Sunucusu Oluşturma</span><span class="sxs-lookup"><span data-stu-id="388c8-141">Create an Authorization Server</span></span>

<span data-ttu-id="388c8-142">Bu öğreticide, bir yetkilendirme sunucusu oluşturmak için [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) ve ASP.NET MVC'nin nasıl kullanılacağını kabaca çizeceğiz.</span><span class="sxs-lookup"><span data-stu-id="388c8-142">In this tutorial, we will roughly sketch out how to use [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) and ASP.NET MVC to create an authorization server.</span></span> <span data-ttu-id="388c8-143">Bu öğretici her adımı içermemektedir gibi, yakında tamamlanan örnek için bir indirme sağlamak umuyoruz.</span><span class="sxs-lookup"><span data-stu-id="388c8-143">We hope to soon provide a download for the completed sample, as this tutorial does not include each step.</span></span> <span data-ttu-id="388c8-144">İlk olarak, *AuthorizationServer* adında boş bir web uygulaması oluşturun ve aşağıdaki paketleri yükleyin:</span><span class="sxs-lookup"><span data-stu-id="388c8-144">First, create an empty web app named *AuthorizationServer* and install the following packages:</span></span>

- <span data-ttu-id="388c8-145">Microsoft.AspNet.Mvc</span><span class="sxs-lookup"><span data-stu-id="388c8-145">Microsoft.AspNet.Mvc</span></span>
- <span data-ttu-id="388c8-146">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="388c8-146">Microsoft.Owin.Host.SystemWeb</span></span>
- <span data-ttu-id="388c8-147">Microsoft.Owin.Security.OAuth</span><span class="sxs-lookup"><span data-stu-id="388c8-147">Microsoft.Owin.Security.OAuth</span></span>
- <span data-ttu-id="388c8-148">Microsoft.Owin.Security.Cookies</span><span class="sxs-lookup"><span data-stu-id="388c8-148">Microsoft.Owin.Security.Cookies</span></span>
- <span data-ttu-id="388c8-149">Microsoft.Owin.Security.Google (Veya Microsoft.Owin.Security.Facebook gibi diğer sosyal giriş paketi)</span><span class="sxs-lookup"><span data-stu-id="388c8-149">Microsoft.Owin.Security.Google (Or any other social login package such as Microsoft.Owin.Security.Facebook)</span></span>

<span data-ttu-id="388c8-150">*Başlangıç*adlı proje kök klasörü altında bir [OWIN Başlangıç sınıfı](owin-startup-class-detection.md) ekleyin.</span><span class="sxs-lookup"><span data-stu-id="388c8-150">Add an [OWIN Startup class](owin-startup-class-detection.md) under the project root folder named *Startup*.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample1.cs?highlight=8)]

<span data-ttu-id="388c8-151">Bir *App\_Start* klasörü oluşturun.</span><span class="sxs-lookup"><span data-stu-id="388c8-151">Create an *App\_Start* folder.</span></span> <span data-ttu-id="388c8-152">*App\_Start* klasörünü seçin ve *YetkilendirmeServer\App\_Start\Startup.Auth.cs* dosyasının indirilen sürümünü eklemek için Shift+Alt+A'yı kullanın.</span><span class="sxs-lookup"><span data-stu-id="388c8-152">Select the *App\_Start* folder and use Shift+Alt+A to add the downloaded version of the *AuthorizationServer\App\_Start\Startup.Auth.cs* file.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample2.cs)]

<span data-ttu-id="388c8-153">Yukarıdaki kod, hesapları yönetmek için yetkilendirme sunucusunun kendisi tarafından kullanılan uygulama/dış oturum açma tanımlama bilgileri ve Google kimlik doğrulaması sağlar.</span><span class="sxs-lookup"><span data-stu-id="388c8-153">The code above enables application/external sign in cookies and Google authentication, which are used by authorization server itself to manage accounts.</span></span>

<span data-ttu-id="388c8-154">Uzantı `UseOAuthAuthorizationServer` yöntemi yetkilendirme sunucusunu kurmaktır.</span><span class="sxs-lookup"><span data-stu-id="388c8-154">The `UseOAuthAuthorizationServer` extension method is to setup the authorization server.</span></span> <span data-ttu-id="388c8-155">Kurulum seçenekleri şunlardır:</span><span class="sxs-lookup"><span data-stu-id="388c8-155">The setup options are:</span></span>

- <span data-ttu-id="388c8-156">`AuthorizeEndpointPath`: İstemci uygulamalarının kullanıcı aracısını yeniden yönlendireceği istek yolu, kullanıcıların bir belirteç veya kod verme izni almasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="388c8-156">`AuthorizeEndpointPath`: The request path where client applications will redirect the user-agent in order to obtain the users consent to issue a token or code.</span></span> <span data-ttu-id="388c8-157">Örneğin,`/Authorize`önde gelen bir kesikle başlamalı.</span><span class="sxs-lookup"><span data-stu-id="388c8-157">It must begin with a leading slash, for example, "`/Authorize`".</span></span>
- <span data-ttu-id="388c8-158">`TokenEndpointPath`: İstek yolu istemci uygulamaları doğrudan erişim belirteci elde etmek için iletişim.</span><span class="sxs-lookup"><span data-stu-id="388c8-158">`TokenEndpointPath`: The request path client applications directly communicate to obtain the access token.</span></span> <span data-ttu-id="388c8-159">"/Token" gibi önde gelen bir kesikle başlamalıdır.</span><span class="sxs-lookup"><span data-stu-id="388c8-159">It must begin with a leading slash, like "/Token".</span></span> <span data-ttu-id="388c8-160">İstemciye bir [\_istemci sırrı](http://tools.ietf.org/html/rfc6749#appendix-A.2)verilirse, bu uç noktaya sağlanmalıdır.</span><span class="sxs-lookup"><span data-stu-id="388c8-160">If the client is issued a [client\_secret](http://tools.ietf.org/html/rfc6749#appendix-A.2), it must be provided to this endpoint.</span></span>
- <span data-ttu-id="388c8-161">`ApplicationCanDisplayErrors`: Web `true` `/Authorize` uygulaması, uç noktadaistemci doğrulama hataları için özel bir hata sayfası oluşturmak isterse ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="388c8-161">`ApplicationCanDisplayErrors`: Set to `true` if the web application wants to generate a custom error page for the client validation errors on `/Authorize` endpoint.</span></span> <span data-ttu-id="388c8-162">Bu yalnızca tarayıcının istemci uygulamasına geri yönlendirilen olmadığı durumlar için gereklidir, örneğin, tarayıcı yanlış olduğunda `client_id` veya `redirect_uri` yanlışolduğunda.</span><span class="sxs-lookup"><span data-stu-id="388c8-162">This is only needed for cases where the browser is not redirected back to the client application, for example, when the `client_id` or `redirect_uri` are incorrect.</span></span> <span data-ttu-id="388c8-163">Bitiş `/Authorize` noktası "oauth görmek için bekleyebilirsiniz. Hata", "oauth. Hata Açıklaması", ve "oauth. ErrorUri" özellikleri OWIN ortamına eklenir.</span><span class="sxs-lookup"><span data-stu-id="388c8-163">The `/Authorize` endpoint should expect to see the "oauth.Error", "oauth.ErrorDescription", and "oauth.ErrorUri" properties are added to the OWIN environment.</span></span>

    > [!NOTE]
    > <span data-ttu-id="388c8-164">Doğru değilse, yetkilendirme sunucusu hata ayrıntılarıyla birlikte varsayılan bir hata sayfası döndürecektir.</span><span class="sxs-lookup"><span data-stu-id="388c8-164">If not true, the authorization server will return a default error page with the error details.</span></span>
- <span data-ttu-id="388c8-165">`AllowInsecureHttp`: Yetki lendirme ve belirteç isteklerinin HTTP URI adreslerine ulaşmasına izin vermek ve gelen `redirect_uri` yetkilendirme isteği parametrelerinin HTTP URI adreslerine sahip olmasını sağlamak için geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="388c8-165">`AllowInsecureHttp`: True to allow authorize and token requests to arrive on HTTP URI addresses, and to allow incoming `redirect_uri` authorize request parameters to have HTTP URI addresses.</span></span>

    > [!WARNING]
    > <span data-ttu-id="388c8-166">Güvenlik - Bu sadece geliştirme içindir.</span><span class="sxs-lookup"><span data-stu-id="388c8-166">Security - This is for development only.</span></span>
- <span data-ttu-id="388c8-167">`Provider`: Yetkilendirme Sunucusu ara ware tarafından yükseltilen olayları işlemek için uygulama tarafından sağlanan nesne.</span><span class="sxs-lookup"><span data-stu-id="388c8-167">`Provider`: The object provided by the application to process events raised by the Authorization Server middleware.</span></span> <span data-ttu-id="388c8-168">Uygulama arabirimi tam olarak uygulayabilir veya bu `OAuthAuthorizationServerProvider` sunucunun desteklediği OAuth akışları için gerekli olan temsilcilerin bir örneğini oluşturabilir ve atayabilir.</span><span class="sxs-lookup"><span data-stu-id="388c8-168">The application may implement the interface fully, or it may create an instance of `OAuthAuthorizationServerProvider` and assign delegates necessary for the OAuth flows this server supports.</span></span>
- <span data-ttu-id="388c8-169">`AuthorizationCodeProvider`: İstemci uygulamasına dönmek için tek kullanımlık bir yetkilendirme kodu üretir.</span><span class="sxs-lookup"><span data-stu-id="388c8-169">`AuthorizationCodeProvider`: Produces a single-use authorization code to return to the client application.</span></span> <span data-ttu-id="388c8-170">OAuth sunucusunun güvenli olması için `AuthorizationCodeProvider` uygulama, `OnCreate/OnCreateAsync` olay tarafından üretilen belirteç için yalnızca bir `OnReceive/OnReceiveAsync`çağrı için geçerli kabul edildiği bir örnek **sağlamalı.**</span><span class="sxs-lookup"><span data-stu-id="388c8-170">For the OAuth server to be secure the application **MUST** provide an instance for `AuthorizationCodeProvider` where the token produced by the `OnCreate/OnCreateAsync` event is considered valid for only one call to `OnReceive/OnReceiveAsync`.</span></span>
- <span data-ttu-id="388c8-171">`RefreshTokenProvider`: Gerektiğinde yeni bir erişim belirteci üretmek için kullanılabilecek bir yenileme belirteci üretir.</span><span class="sxs-lookup"><span data-stu-id="388c8-171">`RefreshTokenProvider`: Produces a refresh token which may be used to produce a new access token when needed.</span></span> <span data-ttu-id="388c8-172">Yetkilendirme sunucusu `/Token` sağlanmadıysa, bitiş noktasından yenileme belirteçlerini döndürmez.</span><span class="sxs-lookup"><span data-stu-id="388c8-172">If not provided the authorization server will not return refresh tokens from the `/Token` endpoint.</span></span>

## <a name="account-management"></a><span data-ttu-id="388c8-173">Hesap Yönetimi</span><span class="sxs-lookup"><span data-stu-id="388c8-173">Account Management</span></span>

<span data-ttu-id="388c8-174">OAuth, kullanıcı hesabı bilgilerinizi nerede veya nasıl yönettiğinizi umursamaz.</span><span class="sxs-lookup"><span data-stu-id="388c8-174">OAuth doesn't care where or how you manage your user account information.</span></span> <span data-ttu-id="388c8-175">Bundan sorumlu olan [ASP.NET kimliktir.](../../../identity/index.md)</span><span class="sxs-lookup"><span data-stu-id="388c8-175">It's [ASP.NET Identity](../../../identity/index.md) which is responsible for it.</span></span> <span data-ttu-id="388c8-176">Bu eğitimde, hesap yönetim kodunu basitleştirecek ve kullanıcının OWIN çerez aracını kullanarak oturum açabilmesini sağlayacağız.</span><span class="sxs-lookup"><span data-stu-id="388c8-176">In this tutorial, we will simplify the account management code and just make sure that user can login using OWIN cookie middleware.</span></span> <span data-ttu-id="388c8-177">Burada basitleştirilmiş örnek `AccountController`kodu:</span><span class="sxs-lookup"><span data-stu-id="388c8-177">Here is the simplified sample code for the `AccountController`:</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample3.cs)]

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample4.cs?highlight=1)]

<span data-ttu-id="388c8-178">`ValidateClientRedirectUri`kayıtlı yönlendirme URL'si ile istemciyi doğrulamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="388c8-178">`ValidateClientRedirectUri` is used to validate the client with its registered redirect URL.</span></span> <span data-ttu-id="388c8-179">`ValidateClientAuthentication`istemcinin kimlik bilgilerini almak için temel şema üstbilgisini ve form gövdesini denetler.</span><span class="sxs-lookup"><span data-stu-id="388c8-179">`ValidateClientAuthentication` checks the basic scheme header and form body to get the client's credentials.</span></span>

<span data-ttu-id="388c8-180">Giriş sayfası aşağıda gösterilmiştir:</span><span class="sxs-lookup"><span data-stu-id="388c8-180">The login page is shown below:</span></span>

![](owin-oauth-20-authorization-server/_static/image1.png)

<span data-ttu-id="388c8-181">Şimdi IETF's OAuth 2 [Yetki Kodu Hibe](http://tools.ietf.org/html/rfc6749#section-4.1) bölümünü inceleyin.</span><span class="sxs-lookup"><span data-stu-id="388c8-181">Review the IETF's OAuth 2 [Authorization Code Grant](http://tools.ietf.org/html/rfc6749#section-4.1) section now.</span></span>

<span data-ttu-id="388c8-182">**Sağlayıcı** (aşağıdaki tabloda) [OAuthAuthorizationServerOptions](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserveroptions(v=vs.111).aspx)olduğunu. Sağlayıcı, tüm OAuth sunucu olayları içeren türü, `OAuthAuthorizationServerProvider`dir.</span><span class="sxs-lookup"><span data-stu-id="388c8-182">**Provider** (in the table below) is [OAuthAuthorizationServerOptions](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserveroptions(v=vs.111).aspx).Provider, which is of type `OAuthAuthorizationServerProvider`, which contains all OAuth server events.</span></span>

| <span data-ttu-id="388c8-183">Yetkilendirme Kodu Hibe bölümünden akış adımları</span><span class="sxs-lookup"><span data-stu-id="388c8-183">Flow steps from Authorization Code Grant section</span></span> | <span data-ttu-id="388c8-184">Örnek indirme şu adımları gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="388c8-184">Sample download performs these steps with:</span></span> |
| --- | --- |
|  |  |
| <span data-ttu-id="388c8-185">(A) İstemci, kaynak sahibinin kullanıcı aracısını yetkilendirme bitiş noktasına yönlendirerek akışı başlatır.</span><span class="sxs-lookup"><span data-stu-id="388c8-185">(A) The client initiates the flow by directing the resource owner's user-agent to the authorization endpoint.</span></span> <span data-ttu-id="388c8-186">İstemci, istemci tanımlayıcısını, istenen kapsamı, yerel durumu ve yetkilendirme sunucusunun erişim verildikten (veya reddedildikten) sonra kullanıcı aracısını geri göndereceği bir yeniden yönlendirme URI'sini içerir.</span><span class="sxs-lookup"><span data-stu-id="388c8-186">The client includes its client identifier, requested scope, local state, and a redirection URI to which the authorization server will send the user-agent back once access is granted (or denied).</span></span> | <span data-ttu-id="388c8-187">Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint</span><span class="sxs-lookup"><span data-stu-id="388c8-187">Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint</span></span> |
|  |  |
| <span data-ttu-id="388c8-188">(B) Yetkilendirme sunucusu kaynak sahibinin kimliğini doğrular (kullanıcı aracısı aracılığıyla) ve kaynak sahibinin istemcinin erişim isteğini hibe edip etmediğini veya reddedip etmediğini belirler.</span><span class="sxs-lookup"><span data-stu-id="388c8-188">(B) The authorization server authenticates the resource owner (via the user-agent) and establishes whether the resource owner grants or denies the client's access request.</span></span> | <span data-ttu-id="388c8-189">**Kullanıcı erişim izni veriyorsa&gt; &lt;** Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint AuthorizationCodeProvider.CreateAsync</span><span class="sxs-lookup"><span data-stu-id="388c8-189">**&lt;If user grants access&gt;** Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint AuthorizationCodeProvider.CreateAsync</span></span> |
|  |  |
| <span data-ttu-id="388c8-190">(C) Kaynak sahibinin erişim sağladığını varsayarsak, yetkilendirme sunucusu kullanıcı aracısını daha önce sağlanan yeniden yönlendirme URI'yi kullanarak istemciye geri yönlendirir (istekte veya istemci kaydı sırasında).</span><span class="sxs-lookup"><span data-stu-id="388c8-190">(C) Assuming the resource owner grants access, the authorization server redirects the user-agent back to the client using the redirection URI provided earlier (in the request or during client registration).</span></span> <span data-ttu-id="388c8-191">...</span><span class="sxs-lookup"><span data-stu-id="388c8-191">...</span></span> |  |
|  |  |
| <span data-ttu-id="388c8-192">(D) İstemci, önceki adımda alınan yetkilendirme kodunu ekleyerek yetkilendirme sunucusunun belirteç bitiş noktasından bir erişim belirteci ister.</span><span class="sxs-lookup"><span data-stu-id="388c8-192">(D) The client requests an access token from the authorization server's token endpoint by including the authorization code received in the previous step.</span></span> <span data-ttu-id="388c8-193">İstek tevekkül ederken, istemci yetkilendirme sunucusuyla kimlik doğrulaması sağlar.</span><span class="sxs-lookup"><span data-stu-id="388c8-193">When making the request, the client authenticates with the authorization server.</span></span> <span data-ttu-id="388c8-194">İstemci, doğrulama için yetkilendirme kodunu elde etmek için kullanılan yeniden yönlendirme URI'yi içerir.</span><span class="sxs-lookup"><span data-stu-id="388c8-194">The client includes the redirection URI used to obtain the authorization code for verification.</span></span> | <span data-ttu-id="388c8-195">Provider.MatchEndpoint Provider.ValidateClientAuthentication AuthorizationCodeProvider.ReceiveAsync Provider.ValidateTokenRequest Provider.GrantAuthorizationCode Provider.TokenEndpoint AccessTokenProvider.CreateAsync RefreshTokenProvider.CreateAsync</span><span class="sxs-lookup"><span data-stu-id="388c8-195">Provider.MatchEndpoint Provider.ValidateClientAuthentication AuthorizationCodeProvider.ReceiveAsync Provider.ValidateTokenRequest Provider.GrantAuthorizationCode Provider.TokenEndpoint AccessTokenProvider.CreateAsync RefreshTokenProvider.CreateAsync</span></span> |

<span data-ttu-id="388c8-196">Yetkilendirme kodunun `AuthorizationCodeProvider.CreateAsync` `ReceiveAsync` oluşturulması ve doğrulanması için ve denetlemek için örnek bir uygulama aşağıda gösterilmiştir.</span><span class="sxs-lookup"><span data-stu-id="388c8-196">A sample implementation for `AuthorizationCodeProvider.CreateAsync` and `ReceiveAsync` to control the creation and validation of authorization code is shown below.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample5.cs)]

<span data-ttu-id="388c8-197">Yukarıdaki kod, kodu ve kimlik biletini depolamak ve kodu aldıktan sonra kimliği geri yüklemek için bellek içi eşzamanlı bir sözlük kullanır.</span><span class="sxs-lookup"><span data-stu-id="388c8-197">The code above uses an in-memory concurrent dictionary to store the code and identity ticket and restore the identity after receiving the code.</span></span> <span data-ttu-id="388c8-198">Gerçek bir uygulamada, kalıcı bir veri deposu tarafından değiştirilir.</span><span class="sxs-lookup"><span data-stu-id="388c8-198">In a real application, it would be replaced by a persistent data store.</span></span> <span data-ttu-id="388c8-199">Yetkilendirme bitiş noktası, kaynak sahibinin istemciye erişim izni vermesi içindir.</span><span class="sxs-lookup"><span data-stu-id="388c8-199">The authorization endpoint is for the resource owner to grant access to the client.</span></span> <span data-ttu-id="388c8-200">Genellikle, kullanıcının bir düğmeyi tıklatması ve hibeyi onaylaması için bir kullanıcı arabirimine ihtiyacı vardır.</span><span class="sxs-lookup"><span data-stu-id="388c8-200">Usually, it needs a user interface to allow the user to click a button and confirm the grant.</span></span> <span data-ttu-id="388c8-201">OWIN OAuth middleware uygulama kodu yetkilendirme bitiş noktası işlemek için izin verir.</span><span class="sxs-lookup"><span data-stu-id="388c8-201">OWIN OAuth middleware allows application code to handle the authorization endpoint.</span></span> <span data-ttu-id="388c8-202">Örnek uygulamamızda, onu işlemek için `OAuthController` çağrılan bir MVC denetleyicisi kullanırız.</span><span class="sxs-lookup"><span data-stu-id="388c8-202">In our sample app, we use an MVC controller called `OAuthController` to handle it.</span></span> <span data-ttu-id="388c8-203">İşte örnek uygulama:</span><span class="sxs-lookup"><span data-stu-id="388c8-203">Here is the sample implementation:</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample6.cs?highlight=15)]

<span data-ttu-id="388c8-204">Eylem `Authorize` ilk olarak kullanıcının yetkilendirme sunucusunda oturum açmış olup olmadığını denetler.</span><span class="sxs-lookup"><span data-stu-id="388c8-204">The `Authorize` action will first check if the user has logged in to the authorization server.</span></span> <span data-ttu-id="388c8-205">Değilse, kimlik doğrulama aracı arayanın "Uygulama" çerezini kullanarak kimliğini doğrulaması için zorlar ve giriş sayfasına yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="388c8-205">If not, the authentication middleware challenges the caller to authenticate using the "Application" cookie and redirects to the login page.</span></span> <span data-ttu-id="388c8-206">(Bkz. yukarıda vurgulanan kod.) Kullanıcı oturum açmışsa, aşağıda gösterildiği gibi Yetkilendirme görünümünü işleyecektir:</span><span class="sxs-lookup"><span data-stu-id="388c8-206">(See highlighted code above.) If user has logged in, it will render the Authorize view, as shown below:</span></span>

![](owin-oauth-20-authorization-server/_static/image2.png)

<span data-ttu-id="388c8-207">**Hibe** düğmesi seçilirse, `Authorize` eylem yeni bir "Taşıyıcı" kimliği oluşturur ve onunla oturum açtır.</span><span class="sxs-lookup"><span data-stu-id="388c8-207">If the **Grant** button is selected, the `Authorize` action will create a new "Bearer" identity and sign in with it.</span></span> <span data-ttu-id="388c8-208">Bir taşıyıcı belirteci oluşturmak ve JSON yükü ile istemciye geri göndermek için yetkilendirme sunucusu tetikler.</span><span class="sxs-lookup"><span data-stu-id="388c8-208">It will trigger the authorization server to generate a bearer token and send it back to the client with JSON payload.</span></span>

### <a name="implicit-grant"></a><span data-ttu-id="388c8-209">Örtülü Hibe</span><span class="sxs-lookup"><span data-stu-id="388c8-209">Implicit Grant</span></span>

<span data-ttu-id="388c8-210">Şimdi IETF's OAuth 2 [Örtülü Hibe](http://tools.ietf.org/html/rfc6749#section-4.2) bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="388c8-210">Refer to the IETF's OAuth 2 [Implicit Grant](http://tools.ietf.org/html/rfc6749#section-4.2) section now.</span></span>

 <span data-ttu-id="388c8-211">Şekil 4'te gösterilen [Örtük Hibe](http://tools.ietf.org/html/rfc6749#section-4.2) akışı, OWIN OAuth aracının izlediği akış ve haritalamadır.</span><span class="sxs-lookup"><span data-stu-id="388c8-211">The [Implicit Grant](http://tools.ietf.org/html/rfc6749#section-4.2) flow shown in Figure 4 is the flow and mapping which the OWIN OAuth middleware follows.</span></span>

| <span data-ttu-id="388c8-212">Örtülü Hibe bölümünden akış adımları</span><span class="sxs-lookup"><span data-stu-id="388c8-212">Flow steps from Implicit Grant section</span></span> | <span data-ttu-id="388c8-213">Örnek indirme şu adımları gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="388c8-213">Sample download performs these steps with:</span></span> |
| --- | --- |
|  |  |
| <span data-ttu-id="388c8-214">(A) İstemci, kaynak sahibinin kullanıcı aracısını yetkilendirme bitiş noktasına yönlendirerek akışı başlatır.</span><span class="sxs-lookup"><span data-stu-id="388c8-214">(A) The client initiates the flow by directing the resource owner's user-agent to the authorization endpoint.</span></span> <span data-ttu-id="388c8-215">İstemci, istemci tanımlayıcısını, istenen kapsamı, yerel durumu ve yetkilendirme sunucusunun erişim verildikten (veya reddedildikten) sonra kullanıcı aracısını geri göndereceği bir yeniden yönlendirme URI'sini içerir.</span><span class="sxs-lookup"><span data-stu-id="388c8-215">The client includes its client identifier, requested scope, local state, and a redirection URI to which the authorization server will send the user-agent back once access is granted (or denied).</span></span> | <span data-ttu-id="388c8-216">Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint</span><span class="sxs-lookup"><span data-stu-id="388c8-216">Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint</span></span> |
|  |  |
| <span data-ttu-id="388c8-217">(B) Yetkilendirme sunucusu kaynak sahibinin kimliğini doğrular (kullanıcı aracısı aracılığıyla) ve kaynak sahibinin istemcinin erişim isteğini hibe edip etmediğini veya reddedip etmediğini belirler.</span><span class="sxs-lookup"><span data-stu-id="388c8-217">(B) The authorization server authenticates the resource owner (via the user-agent) and establishes whether the resource owner grants or denies the client's access request.</span></span> | <span data-ttu-id="388c8-218">**Kullanıcı erişim izni veriyorsa&gt; &lt;** Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint AuthorizationCodeProvider.CreateAsync</span><span class="sxs-lookup"><span data-stu-id="388c8-218">**&lt;If user grants access&gt;** Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint AuthorizationCodeProvider.CreateAsync</span></span> |
|  |  |
| <span data-ttu-id="388c8-219">(C) Kaynak sahibinin erişim sağladığını varsayarsak, yetkilendirme sunucusu kullanıcı aracısını daha önce sağlanan yeniden yönlendirme URI'yi kullanarak istemciye geri yönlendirir (istekte veya istemci kaydı sırasında).</span><span class="sxs-lookup"><span data-stu-id="388c8-219">(C) Assuming the resource owner grants access, the authorization server redirects the user-agent back to the client using the redirection URI provided earlier (in the request or during client registration).</span></span> <span data-ttu-id="388c8-220">...</span><span class="sxs-lookup"><span data-stu-id="388c8-220">...</span></span> |  |
|  |  |
| <span data-ttu-id="388c8-221">(D) İstemci, önceki adımda alınan yetkilendirme kodunu ekleyerek yetkilendirme sunucusunun belirteç bitiş noktasından bir erişim belirteci ister.</span><span class="sxs-lookup"><span data-stu-id="388c8-221">(D) The client requests an access token from the authorization server's token endpoint by including the authorization code received in the previous step.</span></span> <span data-ttu-id="388c8-222">İstek tevekkül ederken, istemci yetkilendirme sunucusuyla kimlik doğrulaması sağlar.</span><span class="sxs-lookup"><span data-stu-id="388c8-222">When making the request, the client authenticates with the authorization server.</span></span> <span data-ttu-id="388c8-223">İstemci, doğrulama için yetkilendirme kodunu elde etmek için kullanılan yeniden yönlendirme URI'yi içerir.</span><span class="sxs-lookup"><span data-stu-id="388c8-223">The client includes the redirection URI used to obtain the authorization code for verification.</span></span> |  |

<span data-ttu-id="388c8-224">Yetkilendirme kodu hibesi için`OAuthController.Authorize` yetkilendirme bitiş noktasını (eylem) zaten uyguladığımız için, otomatik olarak örtülü akışı da sağlar.</span><span class="sxs-lookup"><span data-stu-id="388c8-224">Since we already implemented the authorization endpoint (`OAuthController.Authorize` action) for authorization code grant, it automatically enables implicit flow as well.</span></span> <span data-ttu-id="388c8-225">Not: `Provider.ValidateClientRedirectUri` dolaylı hibe akışını kötü amaçlı istemcilere[(ortadaki adam saldırısı)](https://www.owasp.org/index.php/Man-in-the-middle_attack)gönderen dolaylı hibe akışını koruyan yeniden yönlendirme URL'si ile istemci kimliğini doğrulamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="388c8-225">Note: `Provider.ValidateClientRedirectUri` is used to validate the client ID with its redirection URL, which protects the implicit grant flow from sending the access token to malicious clients ([Man-in-the-middle attack](https://www.owasp.org/index.php/Man-in-the-middle_attack)).</span></span>

### <a name="resource-owner-password-credentials-grant"></a><span data-ttu-id="388c8-226">Kaynak Sahibi Şifre Kimlik Bilgileri Hibesi</span><span class="sxs-lookup"><span data-stu-id="388c8-226">Resource Owner Password Credentials Grant</span></span>

<span data-ttu-id="388c8-227">Şimdi IETF's OAuth 2 [Kaynak Sahibi Şifre Kimlik Bilgileri Hibe](http://tools.ietf.org/html/rfc6749#section-4.3) bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="388c8-227">Refer to the IETF's OAuth 2 [Resource Owner Password Credentials Grant](http://tools.ietf.org/html/rfc6749#section-4.3) section now.</span></span>

 <span data-ttu-id="388c8-228">Şekil 5'te gösterilen [Kaynak Sahibi Parola Kimlik Bilgileri Hibe](http://tools.ietf.org/html/rfc6749#section-4.3) akışı, OWIN OAuth aracının izlediği akış ve eşlemedir.</span><span class="sxs-lookup"><span data-stu-id="388c8-228">The [Resource Owner Password Credentials Grant](http://tools.ietf.org/html/rfc6749#section-4.3) flow shown in Figure 5 is the flow and mapping which the OWIN OAuth middleware follows.</span></span>

| <span data-ttu-id="388c8-229">Kaynak Sahibi Parola Kimlik Bilgileri Hibe bölümünden akış adımları</span><span class="sxs-lookup"><span data-stu-id="388c8-229">Flow steps from Resource Owner Password Credentials Grant section</span></span> | <span data-ttu-id="388c8-230">Örnek indirme şu adımları gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="388c8-230">Sample download performs these steps with:</span></span> |
| --- | --- |
|  |  |
| <span data-ttu-id="388c8-231">(A) Kaynak sahibi istemciye kullanıcı adı ve parolasını verir.</span><span class="sxs-lookup"><span data-stu-id="388c8-231">(A) The resource owner provides the client with its username and password.</span></span> |  |
|  |  |
| <span data-ttu-id="388c8-232">(B) İstemci, kaynak sahibinden alınan kimlik bilgilerini ekleyerek yetkilendirme sunucusunun belirteç bitiş noktasından bir erişim belirteci ister.</span><span class="sxs-lookup"><span data-stu-id="388c8-232">(B) The client requests an access token from the authorization server's token endpoint by including the credentials received from the resource owner.</span></span> <span data-ttu-id="388c8-233">İstek tevekkül ederken, istemci yetkilendirme sunucusuyla kimlik doğrulaması sağlar.</span><span class="sxs-lookup"><span data-stu-id="388c8-233">When making the request, the client authenticates with the authorization server.</span></span> | <span data-ttu-id="388c8-234">Provider.MatchEndpoint Provider.ValidateClientAuthentication Provider.ValidateTokenRequest Provider.GrantResourceOwnerCredentials Provider.TokenEndpoint AccessToken Provider.CreateAsync RefreshTokenProvider.CreateAsync</span><span class="sxs-lookup"><span data-stu-id="388c8-234">Provider.MatchEndpoint Provider.ValidateClientAuthentication Provider.ValidateTokenRequest Provider.GrantResourceOwnerCredentials Provider.TokenEndpoint AccessToken Provider.CreateAsync RefreshTokenProvider.CreateAsync</span></span> |
|  |  |
| <span data-ttu-id="388c8-235">(C) Yetkilendirme sunucusu istemcinin kimliğini doğrular ve kaynak sahibi kimlik bilgilerini doğrular ve geçerliyse, bir erişim belirteci verir.</span><span class="sxs-lookup"><span data-stu-id="388c8-235">(C) The authorization server authenticates the client and validates the resource owner credentials, and if valid, issues an access token.</span></span> |  |

<span data-ttu-id="388c8-236">Burada örnek `Provider.GrantResourceOwnerCredentials`uygulama:</span><span class="sxs-lookup"><span data-stu-id="388c8-236">Here is the sample implementation for `Provider.GrantResourceOwnerCredentials`:</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample7.cs)]

> [!NOTE]
> <span data-ttu-id="388c8-237">Yukarıdaki kod öğreticinin bu bölümünü açıklamak için tasarlanmıştır ve güvenli veya üretim uygulamalarında kullanılmamalıdır.</span><span class="sxs-lookup"><span data-stu-id="388c8-237">The code above is intended to explain this section of the tutorial and should not be used in secure or production apps.</span></span> <span data-ttu-id="388c8-238">Kaynak sahiplerinin kimlik bilgilerini denetlemez.</span><span class="sxs-lookup"><span data-stu-id="388c8-238">It does not check the resource owners credentials.</span></span> <span data-ttu-id="388c8-239">Her kimlik bilgisinin geçerli olduğunu varsayar ve bunun için yeni bir kimlik oluşturur.</span><span class="sxs-lookup"><span data-stu-id="388c8-239">It assumes every credential is valid and creates a new identity for it.</span></span> <span data-ttu-id="388c8-240">Yeni kimlik, erişim belirteci oluşturmak ve belirteci yenilemek için kullanılacaktır.</span><span class="sxs-lookup"><span data-stu-id="388c8-240">The new identity will be used to generate the access token and refresh token.</span></span> <span data-ttu-id="388c8-241">Lütfen kodu kendi güvenli hesap yönetim kodunuzla değiştirin.</span><span class="sxs-lookup"><span data-stu-id="388c8-241">Please replace the code with your own secure account management code.</span></span>


### <a name="client-credentials-grant"></a><span data-ttu-id="388c8-242">Müşteri Kimlik Bilgileri Hibesi</span><span class="sxs-lookup"><span data-stu-id="388c8-242">Client Credentials Grant</span></span>

<span data-ttu-id="388c8-243">Şimdi IETF's OAuth 2 [Müşteri Kimlik Bilgileri Hibe](http://tools.ietf.org/html/rfc6749#section-4.4) bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="388c8-243">Refer to the IETF's OAuth 2 [Client Credentials Grant](http://tools.ietf.org/html/rfc6749#section-4.4) section now.</span></span>

 <span data-ttu-id="388c8-244">Şekil 6'da gösterilen [İstemci Kimlik Bilgileri Hibe](http://tools.ietf.org/html/rfc6749#section-4.4) akışı, OWIN OAuth aracının izlediği akış ve eşlemedir.</span><span class="sxs-lookup"><span data-stu-id="388c8-244">The [Client Credentials Grant](http://tools.ietf.org/html/rfc6749#section-4.4) flow shown in Figure 6 is the flow and mapping which the OWIN OAuth middleware follows.</span></span>

| <span data-ttu-id="388c8-245">İstemci Kimlik Bilgileri Hibe bölümünden akış adımları</span><span class="sxs-lookup"><span data-stu-id="388c8-245">Flow steps from Client Credentials Grant section</span></span> | <span data-ttu-id="388c8-246">Örnek indirme şu adımları gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="388c8-246">Sample download performs these steps with:</span></span> |
| --- | --- |
|  |  |
| <span data-ttu-id="388c8-247">(A) İstemci yetkilendirme sunucusuyla kimlik doğrular ve belirteç bitiş noktasından bir erişim belirteci ister.</span><span class="sxs-lookup"><span data-stu-id="388c8-247">(A) The client authenticates with the authorization server and requests an access token from the token endpoint.</span></span> | <span data-ttu-id="388c8-248">Provider.MatchEndpoint Provider.ValidateClientAuthentication Provider.ValidateTokenRequest Provider.GrantClientCredentials Provider.TokenEndpoint AccessTokenProvider.CreateAsync RefreshTokenProvider.CreateAsync</span><span class="sxs-lookup"><span data-stu-id="388c8-248">Provider.MatchEndpoint Provider.ValidateClientAuthentication Provider.ValidateTokenRequest Provider.GrantClientCredentials Provider.TokenEndpoint AccessTokenProvider.CreateAsync RefreshTokenProvider.CreateAsync</span></span> |
|  |  |
| <span data-ttu-id="388c8-249">(B) Yetkilendirme sunucusu istemcinin kimliğini doğrular ve geçerliyse, bir erişim belirteci sağlar.</span><span class="sxs-lookup"><span data-stu-id="388c8-249">(B) The authorization server authenticates the client, and if valid, issues an access token.</span></span> |  |

<span data-ttu-id="388c8-250">Burada örnek `Provider.GrantClientCredentials`uygulama:</span><span class="sxs-lookup"><span data-stu-id="388c8-250">Here is the sample implementation for `Provider.GrantClientCredentials`:</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample8.cs)]

> [!NOTE]
> <span data-ttu-id="388c8-251">Yukarıdaki kod öğreticinin bu bölümünü açıklamak için tasarlanmıştır ve güvenli veya üretim uygulamalarında kullanılmamalıdır.</span><span class="sxs-lookup"><span data-stu-id="388c8-251">The code above is intended to explain this section of the tutorial and should not be used in secure or production apps.</span></span> <span data-ttu-id="388c8-252">Lütfen kodu kendi güvenli istemci yönetim kodunuzla değiştirin.</span><span class="sxs-lookup"><span data-stu-id="388c8-252">Please replace the code with your own secure client management code.</span></span>


### <a name="refresh-token"></a><span data-ttu-id="388c8-253">Belirteci Yenile</span><span class="sxs-lookup"><span data-stu-id="388c8-253">Refresh Token</span></span>

<span data-ttu-id="388c8-254">Şimdi IETF's OAuth 2 [Yenile Token](http://tools.ietf.org/html/rfc6749#section-1.5) bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="388c8-254">Refer to the IETF's OAuth 2 [Refresh Token](http://tools.ietf.org/html/rfc6749#section-1.5) section now.</span></span>

 <span data-ttu-id="388c8-255">Şekil 2'de gösterilen [Token'i Yenile](http://tools.ietf.org/html/rfc6749#section-1.5) akışı, OWIN OAuth aracının izlediği akış ve haritalamadır.</span><span class="sxs-lookup"><span data-stu-id="388c8-255">The [Refresh Token](http://tools.ietf.org/html/rfc6749#section-1.5) flow shown in Figure 2 is the flow and mapping which the OWIN OAuth middleware follows.</span></span>

| <span data-ttu-id="388c8-256">İstemci Kimlik Bilgileri Hibe bölümünden akış adımları</span><span class="sxs-lookup"><span data-stu-id="388c8-256">Flow steps from Client Credentials Grant section</span></span> | <span data-ttu-id="388c8-257">Örnek indirme şu adımları gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="388c8-257">Sample download performs these steps with:</span></span> |
| --- | --- |
|  |  |
| <span data-ttu-id="388c8-258">(G) İstemci, yetkilendirme sunucusuyla kimlik doğrulaması yaparak ve yenileme belirteci sunarak yeni bir erişim belirteci ister.</span><span class="sxs-lookup"><span data-stu-id="388c8-258">(G) The client requests a new access token by authenticating with the authorization server and presenting the refresh token.</span></span> <span data-ttu-id="388c8-259">İstemci kimlik doğrulama gereksinimleri istemci türüne ve yetkilendirme sunucusu ilkelerine dayanır.</span><span class="sxs-lookup"><span data-stu-id="388c8-259">The client authentication requirements are based on the client type and on the authorization server policies.</span></span> | <span data-ttu-id="388c8-260">Provider.MatchEndpoint Provider.ValidateClientAuthentication RefreshTokenProvider.ReceiveAsync Provider.ValidateTokenRequest Provider.GrantRefreshRefreshToken Provider.TokenEndpoint AccessTokenProvider.CreateAsync RefreshTokenProvider.CreateAsync</span><span class="sxs-lookup"><span data-stu-id="388c8-260">Provider.MatchEndpoint Provider.ValidateClientAuthentication RefreshTokenProvider.ReceiveAsync Provider.ValidateTokenRequest Provider.GrantRefreshToken Provider.TokenEndpoint AccessTokenProvider.CreateAsync RefreshTokenProvider.CreateAsync</span></span> |
|  |  |
| <span data-ttu-id="388c8-261">(H) Yetkilendirme sunucusu istemcinin kimliğini doğrular ve yenileme belirteci doğrular ve geçerliyse, yeni bir erişim belirteci (ve isteğe bağlı olarak yeni bir yenileme belirteci) sorunları.</span><span class="sxs-lookup"><span data-stu-id="388c8-261">(H) The authorization server authenticates the client and validates the refresh token, and if valid, issues a new access token (and, optionally, a new refresh token).</span></span> |  |

<span data-ttu-id="388c8-262">Burada örnek `Provider.GrantRefreshToken`uygulama:</span><span class="sxs-lookup"><span data-stu-id="388c8-262">Here is the sample implementation for `Provider.GrantRefreshToken`:</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample9.cs)]

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample10.cs)]

## <a name="create-a-resource-server-which-is-protected-by-access-token"></a><span data-ttu-id="388c8-263">Access Token tarafından korunan bir Kaynak Sunucusu Oluşturma</span><span class="sxs-lookup"><span data-stu-id="388c8-263">Create a Resource Server which is protected by Access Token</span></span>

<span data-ttu-id="388c8-264">Boş bir web uygulaması projesi oluşturun ve projeye aşağıdaki paketleri yükleyin:</span><span class="sxs-lookup"><span data-stu-id="388c8-264">Create an empty web app project and install following packages in the project:</span></span>

- <span data-ttu-id="388c8-265">Microsoft.AspNet.WebApi.Owin</span><span class="sxs-lookup"><span data-stu-id="388c8-265">Microsoft.AspNet.WebApi.Owin</span></span>
- <span data-ttu-id="388c8-266">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="388c8-266">Microsoft.Owin.Host.SystemWeb</span></span>
- <span data-ttu-id="388c8-267">Microsoft.Owin.Security.OAuth</span><span class="sxs-lookup"><span data-stu-id="388c8-267">Microsoft.Owin.Security.OAuth</span></span>

<span data-ttu-id="388c8-268">Bir başlangıç sınıfı oluşturun ve kimlik doğrulaması ve Web API'sini yapılandırın.</span><span class="sxs-lookup"><span data-stu-id="388c8-268">Create a startup class and configure authentication and Web API.</span></span> <span data-ttu-id="388c8-269">Örnek indirmede *YetkilendirmeServer\ResourceServer\Startup.cs'ye* bakın.</span><span class="sxs-lookup"><span data-stu-id="388c8-269">See *AuthorizationServer\ResourceServer\Startup.cs* in the sample download.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample11.cs)]

<span data-ttu-id="388c8-270">Bkz. Örnek indirmede *\_YetkilendirmeServer\ResourceServer\App Start\Startup.Auth.cs.*</span><span class="sxs-lookup"><span data-stu-id="388c8-270">See *AuthorizationServer\ResourceServer\App\_Start\Startup.Auth.cs* in the sample download.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample12.cs)]

<span data-ttu-id="388c8-271">Bkz. Örnek indirmede *\_YetkilendirmeServer\ResourceServer\App Start\Startup.WebApi.cs.*</span><span class="sxs-lookup"><span data-stu-id="388c8-271">See *AuthorizationServer\ResourceServer\App\_Start\Startup.WebApi.cs* in the sample download.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample13.cs)]

- <span data-ttu-id="388c8-272">`UseCors`yöntem tüm etki alanları için CORS sağlar.</span><span class="sxs-lookup"><span data-stu-id="388c8-272">`UseCors` method allows CORS for all domains.</span></span>
- <span data-ttu-id="388c8-273">`UseOAuthBearerAuthentication`yöntem, istekteki yetkilendirme üstbilgisinden taşıyıcı belirteci belirteci nialını alacak ve doğrulayacak Olan OAuth taşıyıcı belirteç kimlik doğrulaması ara ware'i sağlar.</span><span class="sxs-lookup"><span data-stu-id="388c8-273">`UseOAuthBearerAuthentication` method enables OAuth bearer token authentication middleware which will receive and validate bearer token from authorization header in the request.</span></span>
- <span data-ttu-id="388c8-274">`Config.SuppressDefaultHostAuthenticaiton`varsayılan ana bilgisayar ını uygulamadan doğrulanmış ana bilgisayardan bastırır, bu nedenle bu çağrıdan sonra tüm istekler anonim olur.</span><span class="sxs-lookup"><span data-stu-id="388c8-274">`Config.SuppressDefaultHostAuthenticaiton` suppresses default host authenticated principal from the app, therefore all requests will be anonymous after this call.</span></span>
- <span data-ttu-id="388c8-275">`HostAuthenticationFilter`sadece belirtilen kimlik doğrulama türü için kimlik doğrulamasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="388c8-275">`HostAuthenticationFilter` enables authentication just for the specified authentication type.</span></span> <span data-ttu-id="388c8-276">Bu durumda, taşıyıcı kimlik doğrulama türüdür.</span><span class="sxs-lookup"><span data-stu-id="388c8-276">In this case, it's bearer authentication type.</span></span>

<span data-ttu-id="388c8-277">Kimlik doğrulaması yapılan kimliği göstermek için, geçerli kullanıcının taleplerini ortaya çıkarmak için bir ApiController oluştururuz.</span><span class="sxs-lookup"><span data-stu-id="388c8-277">In order to demonstrate the authenticated identity, we create an ApiController to output current user's claims.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample14.cs)]

<span data-ttu-id="388c8-278">Yetkilendirme sunucusu ve kaynak sunucusu aynı bilgisayarda değilse, OAuth aracı erişim belirtecişifrelemek ve şifresini çözmek için farklı makine anahtarlarını kullanır.</span><span class="sxs-lookup"><span data-stu-id="388c8-278">If the authorization server and the resource server are not on the same computer, the OAuth middleware will use the different machine keys to encrypt and decrypt bearer access token.</span></span> <span data-ttu-id="388c8-279">Her iki proje arasında aynı özel anahtarı paylaşmak `machinekey` için, her iki *web.config* dosyasına da aynı ayarı ekliyoruz.</span><span class="sxs-lookup"><span data-stu-id="388c8-279">In order to share the same private key between both projects, we add the same `machinekey` setting in both *web.config* files.</span></span>

[!code-xml[Main](owin-oauth-20-authorization-server/samples/sample15.xml?highlight=8-10)]

## <a name="create-oauth-20-clients"></a><span data-ttu-id="388c8-280">OAuth 2.0 İstemcileri Oluştur</span><span class="sxs-lookup"><span data-stu-id="388c8-280">Create OAuth 2.0 Clients</span></span>

 <span data-ttu-id="388c8-281">İstemci kodunu basitleştirmek için [DotNetOpenAuth.OAuth2.Client](http://www.nuget.org/packages/DotNetOpenAuth.OAuth2.Client) NuGet paketini kullanıyoruz.</span><span class="sxs-lookup"><span data-stu-id="388c8-281">We use the [DotNetOpenAuth.OAuth2.Client](http://www.nuget.org/packages/DotNetOpenAuth.OAuth2.Client) NuGet package to simplify the client code.</span></span>

### <a name="authorization-code-grant-client"></a><span data-ttu-id="388c8-282">Yetkilendirme Kodu Hibe İstemci</span><span class="sxs-lookup"><span data-stu-id="388c8-282">Authorization Code Grant Client</span></span>

 <span data-ttu-id="388c8-283">Bu istemci bir MVC uygulamasıdır.</span><span class="sxs-lookup"><span data-stu-id="388c8-283">This client is an MVC application.</span></span> <span data-ttu-id="388c8-284">Arka uçtan erişim belirteci almak için bir yetkilendirme kodu hibe akışını tetikler.</span><span class="sxs-lookup"><span data-stu-id="388c8-284">It will trigger an authorization code grant flow to get the access token from backend.</span></span> <span data-ttu-id="388c8-285">Aşağıda gösterildiği gibi tek bir sayfası vardır:</span><span class="sxs-lookup"><span data-stu-id="388c8-285">It has a single page as shown below:</span></span>

![](owin-oauth-20-authorization-server/_static/image3.png)

- <span data-ttu-id="388c8-286">**Yetkilendirme** düğmesi, bu istemciye erişim izni vermek için kaynak sahibine bildirmek için tarayıcıyı yetkilendirme sunucusuna yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="388c8-286">The **Authorize** button will redirect browser to the authorization server to notify the resource owner to grant access to this client.</span></span>
- <span data-ttu-id="388c8-287">**Yenile** düğmesi, geçerli yenileme belirteci kullanılarak yeni bir erişim belirteci alır ve belirteci yeniler.</span><span class="sxs-lookup"><span data-stu-id="388c8-287">The **Refresh** button will get a new access token and refresh token using the current refresh token.</span></span>
- <span data-ttu-id="388c8-288">**Access Protected Resource API** düğmesi, geçerli kullanıcının talep verilerini almak ve bunları sayfada göstermek için kaynak sunucusunu arar.</span><span class="sxs-lookup"><span data-stu-id="388c8-288">The **Access Protected Resource API** button will call the resource server to get current user's claims data and show them on the page.</span></span>

<span data-ttu-id="388c8-289">Burada istemcinin `HomeController` örnek kodudur.</span><span class="sxs-lookup"><span data-stu-id="388c8-289">Here is the sample code of the `HomeController` of the client.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample16.cs)]

<span data-ttu-id="388c8-290">`DotNetOpenAuth`varsayılan olarak SSL gerektirir.</span><span class="sxs-lookup"><span data-stu-id="388c8-290">`DotNetOpenAuth` requires SSL by default.</span></span> <span data-ttu-id="388c8-291">Demomuz HTTP kullandığından, config dosyasına aşağıdaki ayarı eklemeniz gerekir:</span><span class="sxs-lookup"><span data-stu-id="388c8-291">Since our demo is using HTTP, you need to add following setting in the config file:</span></span>

[!code-xml[Main](owin-oauth-20-authorization-server/samples/sample17.xml?highlight=4-6)]

> [!WARNING]
> <span data-ttu-id="388c8-292">Güvenlik - Bir üretim uygulamasında SSL'yi asla devre dışı kmayın.</span><span class="sxs-lookup"><span data-stu-id="388c8-292">Security - Never disable SSL in a production app.</span></span> <span data-ttu-id="388c8-293">Giriş kimlik bilgileriniz artık tüm kabloüzerinde açık metin olarak gönderiliyor.</span><span class="sxs-lookup"><span data-stu-id="388c8-293">Your login credentials are now being sent in clear-text across the wire.</span></span> <span data-ttu-id="388c8-294">Yukarıdaki kod sadece yerel örnek hata ayıklama ve keşif içindir.</span><span class="sxs-lookup"><span data-stu-id="388c8-294">The code above is just for local sample debugging and exploration.</span></span>


### <a name="implicit-grant-client"></a><span data-ttu-id="388c8-295">Örtülü Hibe İstemci</span><span class="sxs-lookup"><span data-stu-id="388c8-295">Implicit Grant Client</span></span>

<span data-ttu-id="388c8-296">Bu istemci:</span><span class="sxs-lookup"><span data-stu-id="388c8-296">This client is using JavaScript to:</span></span>

1. <span data-ttu-id="388c8-297">Yeni bir pencere açın ve Yetkilendirme Sunucusu'nun yetkili bitiş noktasına yönlendirin.</span><span class="sxs-lookup"><span data-stu-id="388c8-297">Open a new window and redirect to the authorize endpoint of the Authorization Server.</span></span>
2. <span data-ttu-id="388c8-298">Yeniden yönlendirildiğinde URL parçalarından erişim belirteci alın.</span><span class="sxs-lookup"><span data-stu-id="388c8-298">Get the access token from URL fragments when it redirects back.</span></span>

<span data-ttu-id="388c8-299">Aşağıdaki resim bu işlemi gösterir:</span><span class="sxs-lookup"><span data-stu-id="388c8-299">The following image shows this process:</span></span>

![](owin-oauth-20-authorization-server/_static/image4.png)

<span data-ttu-id="388c8-300">İstemcinin iki sayfası olmalıdır: biri ana sayfa, diğeri geri arama için. *Index.cshtml* dosyasında bulunan örnek JavaScript kodu aşağıdavelvere veda eder:</span><span class="sxs-lookup"><span data-stu-id="388c8-300">The client should have two pages: one for home page and the other for callback.Here is the sample JavaScript code found in the *Index.cshtml* file:</span></span>

[!code-cshtml[Main](owin-oauth-20-authorization-server/samples/sample18.cshtml)]

<span data-ttu-id="388c8-301">*SignIn.cshtml* dosyasındaki geri arama işleme kodu aşağıdavelvere işlenir:</span><span class="sxs-lookup"><span data-stu-id="388c8-301">Here is the callback handling code in *SignIn.cshtml* file:</span></span>

[!code-cshtml[Main](owin-oauth-20-authorization-server/samples/sample19.cshtml)]

> [!NOTE]
> <span data-ttu-id="388c8-302">En iyi yöntem, JavaScript'i harici bir dosyaya taşımak ve Razor biçimlendirmesiyle katıştırmamaktır.</span><span class="sxs-lookup"><span data-stu-id="388c8-302">A best practice is to move the JavaScript to an external file and not embed it with the Razor markup.</span></span> <span data-ttu-id="388c8-303">Bu örneği basit tutmak için birleştirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="388c8-303">To keep this sample simple, they have been combined.</span></span>


### <a name="resource-owner-password-credentials-grant-client"></a><span data-ttu-id="388c8-304">Kaynak Sahibi Şifre Kimlik Bilgileri Hibe İstemci</span><span class="sxs-lookup"><span data-stu-id="388c8-304">Resource Owner Password Credentials Grant Client</span></span>

<span data-ttu-id="388c8-305">Bu istemciyi çıkarmak için bir konsol uygulaması kullanıyoruz.</span><span class="sxs-lookup"><span data-stu-id="388c8-305">We uses a console app to demo this client.</span></span> <span data-ttu-id="388c8-306">Kod aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="388c8-306">Here is the code:</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample20.cs)]

### <a name="client-credentials-grant-client"></a><span data-ttu-id="388c8-307">İstemci Kimlik Bilgileri Hibe İstemci</span><span class="sxs-lookup"><span data-stu-id="388c8-307">Client Credentials Grant Client</span></span>

<span data-ttu-id="388c8-308">Kaynak Sahibi Parola Kimlik Bilgileri Hibebenzer, burada konsol uygulama kodu:</span><span class="sxs-lookup"><span data-stu-id="388c8-308">Similar to the Resource Owner Password Credentials Grant, here is console app code:</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample21.cs)]
