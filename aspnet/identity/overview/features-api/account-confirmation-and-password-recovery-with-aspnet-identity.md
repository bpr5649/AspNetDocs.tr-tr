---
uid: identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
title: Hesap onaylama & parola kurtarma-ASP.NET Identity (C#)-ASP.NET 4. x
author: HaoK
description: Bu öğreticiyi gerçekleştirmeden önce, oturum açma, e-posta onayı ve parola sıfırlama ile güvenli bir ASP.NET MVC 5 Web uygulaması oluşturma işlemi gerçekleştirmeniz gerekir. Bu öğretici...
ms.author: riande
ms.date: 01/23/2019
ms.assetid: 8d54180d-f826-4df7-b503-7debf5ed9fb3
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 4b2c88280df39aa81d60f9508910e8fe5d6db6b8
ms.sourcegitcommit: 88fc80e3f65aebdf61ec9414810ddbc31c543f04
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 01/22/2020
ms.locfileid: "76519121"
---
# <a name="account-confirmation-and-password-recovery-with-aspnet-identity-c"></a><span data-ttu-id="0d9f9-104">ASP.NET Identity (C#) ile hesap onaylama ve parola kurtarma</span><span class="sxs-lookup"><span data-stu-id="0d9f9-104">Account confirmation and password recovery with ASP.NET Identity (C#)</span></span>

> <span data-ttu-id="0d9f9-105">Bu öğreticiyi gerçekleştirmeden önce [, oturum açma, e-posta onayı ve parola sıfırlama ile güvenli bir ASP.NET MVC 5 Web uygulaması oluşturma](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md)işlemi gerçekleştirmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-105">Before doing this tutorial you should first complete [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span> <span data-ttu-id="0d9f9-106">Bu öğretici daha fazla ayrıntı içerir ve yerel hesap onayı için e-posta ayarlamayı ve kullanıcıların ASP.NET Identity unutulan parolalarını sıfırlamasına izin vermeyi gösterir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-106">This tutorial contains more details and will show you how to set up email for local account confirmation and allow users to reset their forgotten password in ASP.NET Identity.</span></span>

<span data-ttu-id="0d9f9-107">Yerel bir kullanıcı hesabı, kullanıcının hesap için bir parola oluşturmasını ve bu parolanın Web uygulamasında depolanmasını (güvenli şekilde) gerektirir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-107">A local user account requires the user to create a password for the account, and that password is stored (securely) in the web app.</span></span> <span data-ttu-id="0d9f9-108">ASP.NET Identity Ayrıca, kullanıcının uygulama için parola oluşturmasını gerektirmeyen sosyal hesapları da destekler.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-108">ASP.NET Identity also supports social accounts, which don't require the user to create a password for the app.</span></span> <span data-ttu-id="0d9f9-109">[Sosyal hesaplar](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) , kullanıcıların kimliğini doğrulamak için üçüncü taraf (örneğin, Google, Twitter, Facebook veya Microsoft) kullanır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-109">[Social accounts](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) use a third party (such as Google, Twitter, Facebook, or Microsoft) to authenticate users.</span></span> <span data-ttu-id="0d9f9-110">Bu konuda aşağıdakiler ele alınmaktadır:</span><span class="sxs-lookup"><span data-stu-id="0d9f9-110">This topic covers the following:</span></span>

- <span data-ttu-id="0d9f9-111">[Bir ASP.NET MVC uygulaması oluşturun](#createMvc) ve ASP.NET Identity özellikleri gezin.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-111">[Create an ASP.NET MVC app](#createMvc) and explore ASP.NET Identity features.</span></span>
- [<span data-ttu-id="0d9f9-112">Kimlik örneğini oluşturma</span><span class="sxs-lookup"><span data-stu-id="0d9f9-112">Build the Identity sample</span></span>](#build)
- [<span data-ttu-id="0d9f9-113">E-posta onayını ayarlama</span><span class="sxs-lookup"><span data-stu-id="0d9f9-113">Set up email confirmation</span></span>](#email)

<span data-ttu-id="0d9f9-114">Yeni kullanıcılar, bir yerel hesap oluşturan e-posta diğer adlarını kaydeder.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-114">New users register their email alias, which creates a local account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image1.png)

<span data-ttu-id="0d9f9-115">Kaydet düğmesinin seçilmesi, e-posta adreslerine doğrulama belirteci içeren bir onay e-postası gönderir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-115">Selecting the Register button sends a confirmation email containing a validation token to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image2.png)

<span data-ttu-id="0d9f9-116">Kullanıcıya, hesabı için bir onay belirteci içeren bir e-posta gönderilir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-116">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image3.png)

<span data-ttu-id="0d9f9-117">Bağlantıyı seçtiğinizde hesap onaylanır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-117">Selecting the link confirms the account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image4.png)

<a id="passwordReset"></a>

## <a name="password-recoveryreset"></a><span data-ttu-id="0d9f9-118">Parola kurtarma/sıfırlama</span><span class="sxs-lookup"><span data-stu-id="0d9f9-118">Password recovery/reset</span></span>

<span data-ttu-id="0d9f9-119">Parolasını unulayan yerel kullanıcıların, e-posta hesaplarına gönderilen bir güvenlik belirteci olabilir ve bunların parolalarını sıfırlamalarını sağlar.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-119">Local users who forget their password can have a security token sent to their email account, enabling them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image5.png)  
  
<span data-ttu-id="0d9f9-120">Kullanıcı yakında parolasını sıfırlamasına izin veren bir bağlantı içeren bir e-posta alır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-120">The user will soon get an email with a link allowing them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image6.png)  
<span data-ttu-id="0d9f9-121">Bağlantıyı seçtiğinizde sıfırlama sayfasına gidecektir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-121">Selecting the link will take them to the Reset page.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image7.png)  
  
<span data-ttu-id="0d9f9-122">**Sıfırla** düğmesinin seçilmesi parolanın sıfırlandığını onaylanır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-122">Selecting the **Reset** button will confirm the password has been reset.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image8.png)

<a id="createMvc"></a>

## <a name="create-an-aspnet-web-app"></a><span data-ttu-id="0d9f9-123">ASP.NET web uygulaması oluşturma</span><span class="sxs-lookup"><span data-stu-id="0d9f9-123">Create an ASP.NET web app</span></span>

<span data-ttu-id="0d9f9-124">[Visual Studio 2017](https://visualstudio.microsoft.com/)' i yükleyip çalıştırarak başlayın.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-124">Start by installing and running [Visual Studio 2017](https://visualstudio.microsoft.com/).</span></span>

1. <span data-ttu-id="0d9f9-125">Yeni bir ASP.NET Web projesi oluşturun ve MVC şablonunu seçin.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-125">Create a new ASP.NET Web project and select the MVC template.</span></span> <span data-ttu-id="0d9f9-126">Web Forms ASP.NET Identity da destekler, böylece bir Web Forms uygulamasında benzer adımları izleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-126">Web Forms also support ASP.NET Identity, so you could follow similar steps in a web forms app.</span></span>
2. <span data-ttu-id="0d9f9-127">Kimlik doğrulamasını **bireysel kullanıcı hesaplarıyla**değiştirin.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-127">Change the authentication to **Individual User Accounts**.</span></span>
3. <span data-ttu-id="0d9f9-128">Uygulamayı çalıştırın, **Kaydet** bağlantısını seçin ve bir Kullanıcı kaydedin.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-128">Run the app, select the **Register** link and register a user.</span></span> <span data-ttu-id="0d9f9-129">Bu noktada, e-postadaki tek doğrulama [[Emapostaadresi]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) özniteliğiyle aynıdır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-129">At this point, the only validation on the email is with the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute.</span></span>
4. <span data-ttu-id="0d9f9-130">Sunucu Gezgini ' de **veri bağlantısı \ Defaultconnection\tables\aspnetusers**' a gidin, sağ tıklayın ve **tablo tanımını aç**' ı seçin.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-130">In Server Explorer, navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right-click and select **Open table definition**.</span></span>

    <span data-ttu-id="0d9f9-131">Aşağıdaki görüntüde `AspNetUsers` şeması gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="0d9f9-131">The following image shows the `AspNetUsers` schema:</span></span>

    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image9.png)
5. <span data-ttu-id="0d9f9-132">**Aspnetusers** tablosuna sağ tıklayın ve **tablo verilerini göster**' i seçin.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-132">Right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image10.png)  
  
   <span data-ttu-id="0d9f9-133">Bu noktada e-posta onaylanmamıştır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-133">At this point the email has not been confirmed.</span></span>

<span data-ttu-id="0d9f9-134">ASP.NET Identity için varsayılan veri deposu Entity Framework, ancak başka veri depoları kullanmak ve ek alanlar eklemek için yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-134">The default data store for ASP.NET Identity is Entity Framework, but you can configure it to use other data stores and to add additional fields.</span></span> <span data-ttu-id="0d9f9-135">Bu öğreticinin sonundaki [ek kaynaklar](#addRes) bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-135">See [Additional Resources](#addRes) section at the end of this tutorial.</span></span>

<span data-ttu-id="0d9f9-136">[Owın başlangıç sınıfı](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ), uygulama başlatıldığında çağrılır ve *App\_Start\Startup.auth.cs*' de, owın ardışık düzenini yapılandıran ve ASP.NET Identity Başlatan `ConfigureAuth` yöntemini çağırır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-136">The [OWIN startup class](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) is called when the app starts and invokes the `ConfigureAuth` method in *App\_Start\Startup.Auth.cs*, which configures the OWIN pipeline and initializes ASP.NET Identity.</span></span> <span data-ttu-id="0d9f9-137">İnceleme `ConfigureAuth` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-137">Examine the `ConfigureAuth` method.</span></span> <span data-ttu-id="0d9f9-138">Her `CreatePerOwinContext` çağrısı, belirtilen türden bir örnek oluşturmak için her istek için bir kez çağrılacak bir geri çağırma (`OwinContext`kaydedilir) kaydeder.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-138">Each `CreatePerOwinContext` call registers a callback (saved in the `OwinContext`) that will be called once per request to create an instance of the specified type.</span></span> <span data-ttu-id="0d9f9-139">Her türde (`ApplicationDbContext, ApplicationUserManager`) oluşturucuda ve `Create` yönteminde bir kesme noktası ayarlayabilir ve bunların her istekte çağrıldığından emin olabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-139">You can set a break point in the constructor and `Create` method of each type (`ApplicationDbContext, ApplicationUserManager`) and verify they are called on each request.</span></span> <span data-ttu-id="0d9f9-140">`ApplicationDbContext` ve `ApplicationUserManager` bir örneği, uygulama genelinde erişilebilen OWIN bağlamında saklanır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-140">A instance of `ApplicationDbContext` and `ApplicationUserManager` is stored in the OWIN context, which can be accessed throughout the application.</span></span> <span data-ttu-id="0d9f9-141">Tanımlama bilgisi ara yazılımı aracılığıyla OWıN ardışık düzeninde kancalar ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-141">ASP.NET Identity hooks into the OWIN pipeline through cookie middleware.</span></span> <span data-ttu-id="0d9f9-142">Daha fazla bilgi için, bkz. [ASP.NET Identity Içindeki UserManager için istek ömrü yönetimi](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d9f9-142">For more information, see [Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span>

<span data-ttu-id="0d9f9-143">Güvenlik profilinizi değiştirdiğinizde, *Aspnetusers* tablosunun `SecurityStamp` alanında yeni bir güvenlik damgası oluşturulur ve depolanır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-143">When you change your security profile, a new security stamp is generated and stored in the `SecurityStamp` field of the *AspNetUsers* table.</span></span> <span data-ttu-id="0d9f9-144">`SecurityStamp` alanının güvenlik tanımlama bilgisinden farklı olduğunu aklınızda yapın.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-144">Note, the `SecurityStamp` field is different from the security cookie.</span></span> <span data-ttu-id="0d9f9-145">Güvenlik tanımlama bilgisi `AspNetUsers` tabloda (veya kimlik DB 'de başka herhangi bir yerde) depolanmaz.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-145">The security cookie is not stored in the `AspNetUsers` table (or anywhere else in the Identity DB).</span></span> <span data-ttu-id="0d9f9-146">Güvenlik tanımlama bilgisi belirteci, [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) kullanılarak kendinden imzalanır ve `UserId, SecurityStamp` ile sona erme saati bilgileriyle oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-146">The security cookie token is self-signed using [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) and is created with the `UserId, SecurityStamp` and expiration time information.</span></span>

<span data-ttu-id="0d9f9-147">Tanımlama bilgisi ara yazılımı her istek için tanımlama bilgisini denetler.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-147">The cookie middleware checks the cookie on each request.</span></span> <span data-ttu-id="0d9f9-148">`Startup` sınıfındaki `SecurityStampValidator` yöntemi DB 'ye rastla ve `validateInterval`belirtilen şekilde güvenlik damgasını düzenli olarak denetler.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-148">The `SecurityStampValidator` method in the `Startup` class hits the DB and checks security stamp periodically, as specified with the `validateInterval`.</span></span> <span data-ttu-id="0d9f9-149">Bu, güvenlik profilinizi değiştirmediğiniz müddetçe her 30 dakikada bir gerçekleşir (örneğimizde).</span><span class="sxs-lookup"><span data-stu-id="0d9f9-149">This only happens every 30 minutes (in our sample) unless you change your security profile.</span></span> <span data-ttu-id="0d9f9-150">Veritabanı gelişlerini en aza indirmek için 30 dakikalık Aralık seçildi.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-150">The 30 minute interval was chosen to minimize trips to the database.</span></span> <span data-ttu-id="0d9f9-151">Daha fazla ayrıntı için bkz. [iki öğeli kimlik doğrulama öğreticisi](index.md) .</span><span class="sxs-lookup"><span data-stu-id="0d9f9-151">See my [two-factor authentication tutorial](index.md) for more details.</span></span>

<span data-ttu-id="0d9f9-152">Koddaki açıklamalara göre `UseCookieAuthentication` yöntemi, tanımlama bilgisi kimlik doğrulamasını destekler.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-152">Per the comments in the code, the `UseCookieAuthentication` method supports cookie authentication.</span></span> <span data-ttu-id="0d9f9-153">`SecurityStamp` alanı ve ilişkili kod, uygulamanıza ek bir güvenlik katmanı sağlar, parolanızı değiştirdiğinizde, oturum açtığınız tarayıcıdan oturumunuz açılır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-153">The `SecurityStamp` field and associated code provides an extra layer of security to your app, when you change your password, you will be logged out of the browser you logged in with.</span></span> <span data-ttu-id="0d9f9-154">`SecurityStampValidator.OnValidateIdentity` yöntemi, bir parolayı değiştirirken veya dış oturum açma kullandığınızda kullanılan Kullanıcı oturum açtığında uygulamanın güvenlik belirtecini doğrulamasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-154">The `SecurityStampValidator.OnValidateIdentity` method enables the app to validate the security token when the user logs in, which is used when you change a password or use the external login.</span></span> <span data-ttu-id="0d9f9-155">Bu, eski parolayla oluşturulan belirteçlerin (tanımlama bilgilerinin) geçersiz kılındığından emin olmak için gereklidir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-155">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="0d9f9-156">Örnek projede, kullanıcılar parolasını değiştirirseniz, Kullanıcı için yeni bir belirteç oluşturulursa, önceki belirteçler geçersiz kılınır ve `SecurityStamp` alanı güncellenir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-156">In the sample project, if you change the users password then a new token is generated for the user, any previous tokens are invalidated and the `SecurityStamp` field is updated.</span></span>

<span data-ttu-id="0d9f9-157">Kimlik sistemi, kullanıcıların güvenlik profili değiştiğinde uygulamanızı yapılandırmanıza izin verir (örneğin, Kullanıcı parolasını değiştirdiğinde veya ilişkili oturum açma değişikliklerini (Facebook, Google, Microsoft hesabı vb. gibi), Kullanıcı tüm oturumunuzu açtı tarayıcı örnekleri.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-157">The Identity system allow you to configure your app so when the users security profile changes (for example, when the user changes their password or changes associated login (such as from Facebook, Google, Microsoft account, etc.), the user is logged out of all browser instances.</span></span> <span data-ttu-id="0d9f9-158">Örneğin, aşağıdaki görüntüde tek bir düğme seçerek kullanıcının tüm tarayıcı örneklerinin (Bu durumda, IE, Firefox ve Chrome) oturumunu açmasını sağlayan [tek bir SignOut örnek](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SingleSignOutSample) uygulaması gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-158">For example, the image below shows the [Single signout sample](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SingleSignOutSample) app, which allows the user to sign out of all browser instances (in this case, IE, Firefox and Chrome) by selecting one button.</span></span> <span data-ttu-id="0d9f9-159">Alternatif olarak, örnek yalnızca belirli bir tarayıcı örneğinin oturumunu kapatmanıza izin verir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-159">Alternatively, the sample allows you to only log out of a specific browser instance.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image11.png)

<span data-ttu-id="0d9f9-160">[Tek SignOut örnek](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SingleSignOutSample) uygulaması, ASP.NET Identity güvenlik belirtecini yeniden oluşturmanız için nasıl izin verdiğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-160">The [Single signout sample](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SingleSignOutSample) app shows how ASP.NET Identity allows you to regenerate the security token.</span></span> <span data-ttu-id="0d9f9-161">Bu, eski parolayla oluşturulan belirteçlerin (tanımlama bilgilerinin) geçersiz kılındığından emin olmak için gereklidir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-161">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="0d9f9-162">Bu özellik, uygulamanız için ek bir güvenlik katmanı sağlar; parolanızı değiştirdiğinizde, bu uygulamada oturum açmış olduğunuz yerde oturumunuz açılır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-162">This feature provides an extra layer of security to your application; when you change your password, you will be logged out where you have logged into this application.</span></span>

<span data-ttu-id="0d9f9-163">*Start\ıdentityconfig.cs dosyası\_uygulaması* `ApplicationUserManager`, `EmailService` ve `SmsService` sınıflarını içerir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-163">The *App\_Start\IdentityConfig.cs* file contains the `ApplicationUserManager`, `EmailService` and `SmsService` classes.</span></span> <span data-ttu-id="0d9f9-164">`EmailService` ve `SmsService` sınıfları `IIdentityMessageService` arabirimini uygular, bu nedenle e-posta ve SMS 'yi yapılandırmak için her sınıfta ortak yöntemlere sahip olursunuz.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-164">The `EmailService` and `SmsService` classes each implement the `IIdentityMessageService` interface, so you have common methods in each class to configure email and SMS.</span></span> <span data-ttu-id="0d9f9-165">Bu öğretici yalnızca [SendGrid](http://sendgrid.com/)aracılığıyla e-posta bildirimi Eklemeyi gösterir, ancak SMTP ve diğer mekanizmaları kullanarak e-posta gönderebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-165">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms.</span></span>

<span data-ttu-id="0d9f9-166">`Startup` sınıfı ayrıca sosyal oturumlar (Facebook, Twitter vb.) eklemek için Boiler levhası içerir. daha fazla bilgi için bkz. [Facebook, Twitter, LinkedIn ve Google OAuth2 oturum açma ile ilgili öğretici MVC 5 uygulaması](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) .</span><span class="sxs-lookup"><span data-stu-id="0d9f9-166">The `Startup` class also contains boiler plate to add social logins (Facebook, Twitter, etc.), see my tutorial [MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) for more info.</span></span>

<span data-ttu-id="0d9f9-167">Kullanıcı kimlik bilgilerini içeren `ApplicationUserManager` sınıfını inceleyin ve aşağıdaki özellikleri yapılandırır:</span><span class="sxs-lookup"><span data-stu-id="0d9f9-167">Examine the `ApplicationUserManager` class, which contains the users identity information and configures the following features:</span></span>

- <span data-ttu-id="0d9f9-168">Parola gücü gereksinimleri.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-168">Password strength requirements.</span></span>
- <span data-ttu-id="0d9f9-169">Kullanıcı kilidi (denemeler ve zaman).</span><span class="sxs-lookup"><span data-stu-id="0d9f9-169">User lock out (attempts and time).</span></span>
- <span data-ttu-id="0d9f9-170">İki öğeli kimlik doğrulaması (2FA).</span><span class="sxs-lookup"><span data-stu-id="0d9f9-170">Two-factor authentication (2FA).</span></span> <span data-ttu-id="0d9f9-171">Başka bir öğreticide 2FA ve SMS 'yi kapsayacağız.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-171">I'll cover 2FA and SMS in another tutorial.</span></span>
- <span data-ttu-id="0d9f9-172">E-posta ve SMS hizmetlerini birleştirme.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-172">Hooking up the email and SMS services.</span></span> <span data-ttu-id="0d9f9-173">(SMS 'yi başka bir öğreticide ele alacağız).</span><span class="sxs-lookup"><span data-stu-id="0d9f9-173">(I'll cover SMS in another tutorial).</span></span>

<span data-ttu-id="0d9f9-174">`ApplicationUserManager` sınıfı, genel `UserManager<ApplicationUser>` sınıfından türetilir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-174">The `ApplicationUserManager` class derives from the generic `UserManager<ApplicationUser>` class.</span></span> <span data-ttu-id="0d9f9-175">`ApplicationUser` [ıdentityuser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx)'tan türetilir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-175">`ApplicationUser` derives from [IdentityUser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx).</span></span> <span data-ttu-id="0d9f9-176">`IdentityUser` genel `IdentityUser` sınıfından türetiliyor:</span><span class="sxs-lookup"><span data-stu-id="0d9f9-176">`IdentityUser` derives from the generic `IdentityUser` class:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample1.cs)]

<span data-ttu-id="0d9f9-177">Yukarıdaki özellikler, yukarıda gösterilen `AspNetUsers` tablosundaki özelliklerle kesişmelidir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-177">The properties above coincide with the properties in the `AspNetUsers` table, shown above.</span></span>

<span data-ttu-id="0d9f9-178">`IUser` genel bağımsız değişkenleri, birincil anahtar için farklı türler kullanarak bir sınıfı türetmeye olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-178">Generic arguments on `IUser` enable you to derive a class using different types for the primary key.</span></span> <span data-ttu-id="0d9f9-179">Dizeden int veya GUID olarak birincil anahtarın nasıl değiştirileceğini gösteren [Changepk](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/ChangePK) örneğine bakın.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-179">See the [ChangePK](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/ChangePK) sample which shows how to change the primary key from string to int or GUID.</span></span>

### <a name="applicationuser"></a><span data-ttu-id="0d9f9-180">ApplicationUser</span><span class="sxs-lookup"><span data-stu-id="0d9f9-180">ApplicationUser</span></span>

<span data-ttu-id="0d9f9-181">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`), *Models\ıdentitymodels.cs* 'de şöyle tanımlanmıştır:</span><span class="sxs-lookup"><span data-stu-id="0d9f9-181">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`) is defined in *Models\IdentityModels.cs* as:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample2.cs?highlight=8-9)]

<span data-ttu-id="0d9f9-182">Yukarıdaki vurgulanan kod bir [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx)oluşturur.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-182">The highlighted code above generates a [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span></span> <span data-ttu-id="0d9f9-183">ASP.NET Identity ve OWıN tanımlama bilgisi kimlik doğrulaması talep tabanlıdır, bu nedenle Framework uygulamanın kullanıcı için bir `ClaimsIdentity` oluşturmasını gerektirir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-183">ASP.NET Identity and OWIN Cookie Authentication are claims-based, therefore the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> <span data-ttu-id="0d9f9-184">`ClaimsIdentity` kullanıcının adı, yaşı ve kullanıcının ait olduğu roller gibi tüm taleplerle ilgili bilgiler içerir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-184">`ClaimsIdentity` has information about all the claims for the user, such as the user's name, age and what roles the user belongs to.</span></span> <span data-ttu-id="0d9f9-185">Ayrıca bu aşamada Kullanıcı için daha fazla talep ekleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-185">You can also add more claims for the user at this stage.</span></span>

<span data-ttu-id="0d9f9-186">OWIN `AuthenticationManager.SignIn` yöntemi `ClaimsIdentity` geçer ve kullanıcının işaretini yapar:</span><span class="sxs-lookup"><span data-stu-id="0d9f9-186">The OWIN `AuthenticationManager.SignIn` method passes in the `ClaimsIdentity` and signs in the user:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample3.cs?highlight=4-6)]

<span data-ttu-id="0d9f9-187">[Facebook, Twitter, LinkedIn ve Google OAuth2 oturum açma Ile MVC 5 uygulaması](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) , `ApplicationUser` sınıfına nasıl ek özellikler ekleyebileceğiniz gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-187">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) shows how you can add additional properties to the `ApplicationUser` class.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="0d9f9-188">E-posta onayı</span><span class="sxs-lookup"><span data-stu-id="0d9f9-188">Email confirmation</span></span>

<span data-ttu-id="0d9f9-189">Yeni bir kullanıcının, başka birinin kimliğine bürünmediğinden emin olmak için (diğer bir deyişle, başka birinin e-postasına kaydolmadığını) doğrulamak iyi bir fikirdir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-189">It's a good idea to confirm the email a new user register with to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="0d9f9-190">Bir tartışma forumu olduğunu varsayalım, `"bob@example.com"` `"joe@contoso.com"`olarak kaydolmasını engellemek isteyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-190">Suppose you had a discussion forum, you would want to prevent `"bob@example.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="0d9f9-191">E-posta onayı olmadan `"joe@contoso.com"`, uygulamanızdan istenmeyen e-posta alabilir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-191">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="0d9f9-192">Emre 'nin yanlışlıkla `"bib@example.com"` olarak kaydolduğunu ve olduğunu fark etmemiş olduğunu varsayalım, uygulamanın doğru e-postası olmadığından parola kurtarma kullanamayacak.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-192">Suppose Bob accidentally registered as `"bib@example.com"` and hadn't noticed it, he wouldn't be able to use password recover because the app doesn't have his correct email.</span></span> <span data-ttu-id="0d9f9-193">E-posta onayı yalnızca botlardan sınırlı koruma sağlar ve belirlenen istenmeyen posta gönderenlerin korumasını sağlamaz, kaydolmak için kullanabilecekleri birçok çalışma e-posta diğer adı vardır. Aşağıdaki örnekte, Kullanıcı, hesabı onaylanana kadar parolasını değiştiremez (ile kaydoldukları e-posta hesabındaki bir onay bağlantısını seçerek). Bu iş akışını diğer senaryolara uygulayabilirsiniz. Örneğin, yönetici tarafından oluşturulan yeni hesaplara parolayı onaylamak ve sıfırlamak için bir bağlantı göndermek, kullanıcı profilini değiştirdiklerinde e-posta göndermek ve daha fazlasını yapmak için bir bağlantı göndermek.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-193">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers, they have many working email aliases they can use to register.In the sample below, the user won't be able to change their password until their account has been confirmed (by them selecting a confirmation link received on the email account they registered with.) You can apply this work flow to other scenarios, for example sending a link to confirm and reset the password on new accounts created by the administrator, sending the user an email when they have changed their profile and so on.</span></span> <span data-ttu-id="0d9f9-194">Genellikle yeni kullanıcıların e-posta, SMS mesajı veya başka bir mekanizma tarafından onaylanmadan önce Web sitenize veri göndermeleri önlemektir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-194">You generally want to prevent new users from posting any data to your web site before they have been confirmed by email, a SMS text message or another mechanism.</span></span> <a id="build"></a>

## <a name="build-a-more-complete-sample"></a><span data-ttu-id="0d9f9-195">Daha kapsamlı bir örnek oluşturun</span><span class="sxs-lookup"><span data-stu-id="0d9f9-195">Build a more complete sample</span></span>

<span data-ttu-id="0d9f9-196">Bu bölümde, birlikte çalışacağımız daha kapsamlı bir örnek indirmek için NuGet kullanacaksınız.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-196">In this section, you'll use NuGet to download a more complete sample we will work with.</span></span>

1. <span data-ttu-id="0d9f9-197">Yeni ***boş*** bir ASP.NET Web projesi oluşturun.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-197">Create a new ***empty*** ASP.NET Web project.</span></span>
2. <span data-ttu-id="0d9f9-198">Paket Yöneticisi konsolunda aşağıdaki komutları girin:</span><span class="sxs-lookup"><span data-stu-id="0d9f9-198">In the Package Manager Console, enter the following commands:</span></span> 

    [!code-console[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample4.cmd)]

   <span data-ttu-id="0d9f9-199">Bu öğreticide, e-posta göndermek için [SendGrid](http://sendgrid.com/) kullanacağız.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-199">In this tutorial, we'll use [SendGrid](http://sendgrid.com/) to send email.</span></span> <span data-ttu-id="0d9f9-200">`Identity.Samples` paketi, ile çalışduğumuz kodu yüklüyor.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-200">The `Identity.Samples` package installs the code we will be working with.</span></span>
3. <span data-ttu-id="0d9f9-201">[PROJEYI SSL kullanacak şekilde](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md)ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-201">Set the [project to use SSL](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
4. <span data-ttu-id="0d9f9-202">Uygulamayı çalıştırarak, **kayıt bağlantısını seçerek ve kayıt formu** naklederek yerel hesap oluşturmayı test edin.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-202">Test local account creation by running the app, selecting the **Register** link, and posting the registration form.</span></span>
5. <span data-ttu-id="0d9f9-203">E-posta onayını taklit eden tanıtım e-posta bağlantısını seçin.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-203">Select the demo email link, which simulates email confirmation.</span></span>
6. <span data-ttu-id="0d9f9-204">Örnek e-posta bağlantısı onay kodunu (hesap denetleyicisindeki `ViewBag.Link` kodu) kaldırın.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-204">Remove the demo email link confirmation code from the sample (The `ViewBag.Link` code in the account controller.</span></span> <span data-ttu-id="0d9f9-205">Bkz. `DisplayEmail` ve `ForgotPasswordConfirmation` eylem yöntemleri ve Razor görünümleri).</span><span class="sxs-lookup"><span data-stu-id="0d9f9-205">See the `DisplayEmail` and `ForgotPasswordConfirmation` action methods and razor views ).</span></span>

> [!WARNING]
> <span data-ttu-id="0d9f9-206">Bu örnekteki güvenlik ayarlarından herhangi birini değiştirirseniz, üretimlerin uygulamanın, yapılan değişiklikleri açıkça çağıran bir güvenlik denetimine gitmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-206">If you change any of the security settings in this sample, productions apps will need to undergo a security audit that explicitly calls the changes made.</span></span>

## <a name="examine-the-code-in-app_startidentityconfigcs"></a><span data-ttu-id="0d9f9-207">\_Start\ıdentityconfig.cs uygulamasındaki kodu inceleyin</span><span class="sxs-lookup"><span data-stu-id="0d9f9-207">Examine the code in App\_Start\IdentityConfig.cs</span></span>

<span data-ttu-id="0d9f9-208">Örnek, bir hesabın nasıl oluşturulduğunu ve *yönetici* rolüne nasıl ekleneceğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-208">The sample shows how to create an account and add it to the *Admin* role.</span></span> <span data-ttu-id="0d9f9-209">Örnekteki e-postayı, yönetici hesabı için kullandığınız e-postayla değiştirmelisiniz.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-209">You should replace the email in the sample with the email you will be using for the admin account.</span></span> <span data-ttu-id="0d9f9-210">Hemen bir yönetici hesabı oluşturmanın en kolay yolu `Seed` yönteminde programlı olarak kullanılır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-210">The easiest way right now to create an administrator account is programmatically in the `Seed` method.</span></span> <span data-ttu-id="0d9f9-211">Gelecekte kullanıcılar ve roller oluşturmanıza ve yönetmenize imkan tanıyan bir araç da sunacağız.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-211">We hope to have a tool in the future that will allow you to create and administer users and roles.</span></span> <span data-ttu-id="0d9f9-212">Örnek kod, kullanıcılar ve roller oluşturmanıza ve yönetmenize izin verir, ancak önce rolleri ve kullanıcı yönetici sayfalarını çalıştırmak için bir Yönetici hesabınızın olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-212">The sample code does let you create and manage users and roles, but you must first have an administrators account to run the roles and user admin pages.</span></span> <span data-ttu-id="0d9f9-213">Bu örnekte, VERITABANı çalıştırıldığında yönetici hesabı oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-213">In this sample, the admin account is created when the DB is seeded.</span></span>

<span data-ttu-id="0d9f9-214">Parolayı değiştirin ve adı e-posta bildirimleri alabileceğiniz bir hesapla değiştirin.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-214">Change the password and change the name to an account where you can receive email notifications.</span></span>

> [!WARNING]
> <span data-ttu-id="0d9f9-215">Güvenlik-önemli verileri hiçbir şekilde kaynak kodunuzda depolamayin.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-215">Security - Never store sensitive data in your source code.</span></span>

<span data-ttu-id="0d9f9-216">Daha önce belirtildiği gibi, başlangıç sınıfındaki `app.CreatePerOwinContext` çağrısı, uygulama DB içeriğinin, Kullanıcı yöneticisinin ve rol yöneticisi sınıflarının `Create` yöntemine geri çağrılar ekler.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-216">As mentioned previously, the `app.CreatePerOwinContext` call in the startup class adds callbacks to the `Create` method of the app DB content, user manager and role manger classes.</span></span> <span data-ttu-id="0d9f9-217">OWIN işlem hattı her bir istek için bu sınıflarda `Create` yöntemini çağırır ve her bir sınıfın bağlamını depolar.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-217">The OWIN pipeline calls the `Create` method on these classes for each request and stores the context for each class.</span></span> <span data-ttu-id="0d9f9-218">Hesap denetleyicisi, Kullanıcı yöneticisini HTTP bağlamından (OWıN bağlamını içerir) kullanıma sunar:</span><span class="sxs-lookup"><span data-stu-id="0d9f9-218">The account controller exposes the user manager from the HTTP context (which contains the OWIN context):</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample5.cs)]

<span data-ttu-id="0d9f9-219">Bir kullanıcı yerel bir hesabı kaydettiğinde `HTTP Post Register` yöntemi çağrılır:</span><span class="sxs-lookup"><span data-stu-id="0d9f9-219">When a user registers a local account, the `HTTP Post Register` method is called:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample6.cs)]

<span data-ttu-id="0d9f9-220">Yukarıdaki kod, girilen e-posta ve parolayı kullanarak yeni bir kullanıcı hesabı oluşturmak için model verilerini kullanır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-220">The code above uses the model data to create a new user account using the email and password entered.</span></span> <span data-ttu-id="0d9f9-221">E-posta diğer adı veri deposunda ise, hesap oluşturma başarısız olur ve form yeniden görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-221">If the email alias is in the data store, account creation fails and the form is displayed again.</span></span> <span data-ttu-id="0d9f9-222">`GenerateEmailConfirmationTokenAsync` yöntemi bir güvenli onay belirteci oluşturur ve ASP.NET Identity veri deposunda depolar.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-222">The `GenerateEmailConfirmationTokenAsync` method creates a secure confirmation token and stores it in the ASP.NET Identity data store.</span></span> <span data-ttu-id="0d9f9-223">[URL. Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) yöntemi, `UserId` ve onay belirtecini içeren bir bağlantı oluşturur.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-223">The [Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) method creates a link containing the `UserId` and confirmation token.</span></span> <span data-ttu-id="0d9f9-224">Bu bağlantı daha sonra kullanıcıya e-posta ile Kullanıcı hesabını onaylamak için e-posta uygulamasındaki bağlantıda seçim yapabilir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-224">This link is then emailed to the user, the user can select on the link in their email app to confirm their account.</span></span>

<a id="email"></a>

## <a name="set-up-email-confirmation"></a><span data-ttu-id="0d9f9-225">E-posta onayını ayarlama</span><span class="sxs-lookup"><span data-stu-id="0d9f9-225">Set up email confirmation</span></span>

<span data-ttu-id="0d9f9-226">[Azure SendGrid kaydolma sayfasına](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) gidin ve ücretsiz hesap için kaydolun.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-226">Go to the [Azure SendGrid sign up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free account.</span></span> <span data-ttu-id="0d9f9-227">SendGrid 'i yapılandırmak için aşağıdakine benzer bir kod ekleyin:</span><span class="sxs-lookup"><span data-stu-id="0d9f9-227">Add code similar to the following to configure SendGrid:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample7.cs?highlight=5)]

> [!NOTE]
> <span data-ttu-id="0d9f9-228">E-posta istemcileri genellikle yalnızca metin iletilerini kabul eder (HTML yok).</span><span class="sxs-lookup"><span data-stu-id="0d9f9-228">Email clients frequently accept only text messages (no HTML).</span></span> <span data-ttu-id="0d9f9-229">İletiyi metin ve HTML olarak sağlamalısınız.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-229">You should provide the message in text and HTML.</span></span> <span data-ttu-id="0d9f9-230">Yukarıdaki SendGrid örneğinde, bu, yukarıda gösterilen `myMessage.Text` ve `myMessage.Html` koduyla yapılır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-230">In the SendGrid sample above, this is done with the `myMessage.Text` and `myMessage.Html` code shown above.</span></span>

<span data-ttu-id="0d9f9-231">Aşağıdaki kod, `message.Body` yalnızca bağlantıyı döndürdüğü [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) sınıfını kullanarak e-postanın nasıl gönderileceğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-231">The following code shows how to send email using the [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) class where `message.Body` returns only the link.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample8.cs)]

> [!WARNING]
> <span data-ttu-id="0d9f9-232">Güvenlik-önemli verileri hiçbir şekilde kaynak kodunuzda depolamayin.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-232">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="0d9f9-233">Hesap ve kimlik bilgileri appSetting 'de depolanır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-233">The account and credentials are stored in the appSetting.</span></span> <span data-ttu-id="0d9f9-234">Azure 'da, bu değerleri Azure portal **[Yapılandır](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** sekmesinde güvenli bir şekilde depolayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-234">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="0d9f9-235">[ASP.net ve Azure 'a parola ve diğer hassas verileri dağıtmaya yönelik en iyi uygulamalar](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md)bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-235">See [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span></span>

<span data-ttu-id="0d9f9-236">SendGrid kimlik bilgilerinizi girin, uygulamayı çalıştırın, bir e-posta diğer adı ile kaydolun e-postalarınızın onaylama bağlantısını seçebilir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-236">Enter your SendGrid credentials, run the app, register with an email alias can select the confirm link in your email.</span></span> <span data-ttu-id="0d9f9-237">Bunu [Outlook.com](http://outlook.com) e-posta hesabınızla nasıl yapılacağını görmek için bkz. John Aton 'ın [ C# Outlook.com SMTP ana bilgisayarı için SMTP yapılandırması](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) ve[ASP.NET Identity 2,0: hesap doğrulaması ve iki öğeli yetkilendirme](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) gönderilerini ayarlama.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-237">To see how to do this with your [Outlook.com](http://outlook.com) email account, see John Atten's [C# SMTP Configuration for Outlook.Com SMTP Host](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) and his[ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) posts.</span></span>

<span data-ttu-id="0d9f9-238">Kullanıcı **Kaydet** düğmesini seçtiğinde, e-posta adreslerine doğrulama belirteci içeren bir onay e-postası gönderilir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-238">Once a user selects the **Register** button a confirmation email containing a validation token is sent to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image12.png)

<span data-ttu-id="0d9f9-239">Kullanıcıya, hesabı için bir onay belirteci içeren bir e-posta gönderilir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-239">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image13.png)

## <a name="examine-the-code"></a><span data-ttu-id="0d9f9-240">Kodu inceleme</span><span class="sxs-lookup"><span data-stu-id="0d9f9-240">Examine the code</span></span>

<span data-ttu-id="0d9f9-241">Aşağıdaki kodda `POST ForgotPassword` metodu gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-241">The following code shows the `POST ForgotPassword` method.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample9.cs)]

<span data-ttu-id="0d9f9-242">Kullanıcı e-postası onaylanmazsa Yöntem sessizce başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-242">The method fails silently if the user email has not been confirmed.</span></span> <span data-ttu-id="0d9f9-243">Geçersiz bir e-posta adresi için bir hata nakledilmişse, kötü amaçlı kullanıcılar bu bilgileri kullanarak saldırılara yönelik geçerli kullanıcı kimliği (e-posta diğer adları) bulabilir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-243">If an error was posted for an invalid email address, malicious users could use that information to find valid userId (email aliases) to attack.</span></span>

<span data-ttu-id="0d9f9-244">Aşağıdaki kod, Kullanıcı tarafından gönderilen e-postadaki onay bağlantısını seçtiğinde çağrılan hesap denetleyicisindeki `ConfirmEmail` yöntemini gösterir:</span><span class="sxs-lookup"><span data-stu-id="0d9f9-244">The following code shows the `ConfirmEmail` method in the account controller that is called when the user selects the confirmation link in the email sent to them:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample10.cs)]

<span data-ttu-id="0d9f9-245">Unutulan parola belirteci kullanıldığında, geçersiz kılınır.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-245">Once a forgotten password token has been used, it's invalidated.</span></span> <span data-ttu-id="0d9f9-246">`Create` yönteminde aşağıdaki kod değişikliği ( *uygulamada\_Start\ıdentityconfig.cs* ) belirteçleri 3 saat içinde dolacak şekilde ayarlar.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-246">The following code change in the `Create` method (in the *App\_Start\IdentityConfig.cs* file) sets the tokens to expire in 3 hours.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample11.cs?highlight=6-8)]

<span data-ttu-id="0d9f9-247">Yukarıdaki kodla, Unutulan parolanın ve e-posta onayı belirteçlerinin süresi 3 saat içinde dolacak.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-247">With the code above, the forgotten password and the email confirmation tokens will expire in 3 hours.</span></span> <span data-ttu-id="0d9f9-248">Varsayılan `TokenLifespan` bir gündür.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-248">The default `TokenLifespan` is one day.</span></span>

<span data-ttu-id="0d9f9-249">Aşağıdaki kod, e-posta onay yöntemini gösterir:</span><span class="sxs-lookup"><span data-stu-id="0d9f9-249">The following code shows the email confirmation method:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample12.cs)]

 <span data-ttu-id="0d9f9-250">Uygulamanızı daha güvenli hale getirmek için ASP.NET Identity Iki öğeli kimlik doğrulamayı (2FA) destekler.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-250">To make your app more secure, ASP.NET Identity supports Two-Factor authentication (2FA).</span></span> <span data-ttu-id="0d9f9-251">Bkz. ASP.NET Identity 2,0: John Aton tarafından [hesap doğrulaması ve Iki öğeli yetkilendirme ayarlama](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) .</span><span class="sxs-lookup"><span data-stu-id="0d9f9-251">See [ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) by John Atten.</span></span> <span data-ttu-id="0d9f9-252">Oturum açma parolası denemesi hatalarında hesap kilitlemeyi ayarlayabilseniz de bu yaklaşım, oturum açma bilgilerinizi [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) kilitlenmelerinden kaynaklanabilmesini sağlar.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-252">Although you can set account lockout on login password attempt failures, that approach makes your login susceptible to [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) lockouts.</span></span> <span data-ttu-id="0d9f9-253">Hesap kilitlemeyi yalnızca 2FA ile kullanmanızı öneririz.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-253">We recommend you use account lockout only with 2FA.</span></span>  
<a id="addRes"></a>

## <a name="additional-resources"></a><span data-ttu-id="0d9f9-254">Ek kaynaklar</span><span class="sxs-lookup"><span data-stu-id="0d9f9-254">Additional resources</span></span>

- [<span data-ttu-id="0d9f9-255">ASP.NET Identity için Özel Depolama Sağlayıcılarına Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="0d9f9-255">Overview of Custom Storage Providers for ASP.NET Identity</span></span>](../extensibility/overview-of-custom-storage-providers-for-aspnet-identity.md)
- <span data-ttu-id="0d9f9-256">[Facebook, Twitter, LinkedIn ve Google OAuth2 oturum açma Ile MVC 5 uygulaması](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) Ayrıca, profil bilgilerinin kullanıcılar tablosuna nasıl ekleneceğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-256">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) also shows how to add profile information to the users table.</span></span>
- <span data-ttu-id="0d9f9-257">[ASP.NET MVC ve kimlik 2,0:](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) John Aton 'un temellerini anlama.</span><span class="sxs-lookup"><span data-stu-id="0d9f9-257">[ASP.NET MVC and Identity 2.0: Understanding the Basics](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) by John Atten.</span></span>
- [<span data-ttu-id="0d9f9-258">ASP.NET Identity’ye Giriş</span><span class="sxs-lookup"><span data-stu-id="0d9f9-258">Introduction to ASP.NET Identity</span></span>](../getting-started/introduction-to-aspnet-identity.md)
- <span data-ttu-id="0d9f9-259">Pranav Oystogi tarafından [RTM ASP.NET Identity 2.0.0 duyurusu](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) .</span><span class="sxs-lookup"><span data-stu-id="0d9f9-259">[Announcing RTM of ASP.NET Identity 2.0.0](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) by Pranav Rastogi.</span></span>
