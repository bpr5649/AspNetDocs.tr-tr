---
uid: identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
title: Hesap onaylama ve parola kurtarma - ASP.NET Identity (C#)-ASP.NET 4.x
author: HaoK
description: Önce tamamlamanız gereken Bu öğreticiyi gerçekleştirmeden önce oturum açma, e-posta onayı ve parola sıfırlama ile güvenli bir ASP.NET MVC 5 web uygulaması oluşturun. Bu öğreticide...
ms.author: riande
ms.date: 01/23/2019
ms.assetid: 8d54180d-f826-4df7-b503-7debf5ed9fb3
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: ded3a9d931cc4cd4b99c1cb5012469fe66209f76
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65118031"
---
# <a name="account-confirmation-and-password-recovery-with-aspnet-identity-c"></a><span data-ttu-id="2a0f5-104">Hesap onaylama ve parola kurtarma ASP.NET Identity ile (C#)</span><span class="sxs-lookup"><span data-stu-id="2a0f5-104">Account confirmation and password recovery with ASP.NET Identity (C#)</span></span>

> <span data-ttu-id="2a0f5-105">Önce tamamlamanız gereken Bu öğreticiyi tamamlamadan önce [oturum açma, e-posta onayı ve parola sıfırlama ile güvenli bir ASP.NET MVC 5 web uygulaması oluşturma](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span><span class="sxs-lookup"><span data-stu-id="2a0f5-105">Before doing this tutorial you should first complete [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span> <span data-ttu-id="2a0f5-106">Bu öğretici, daha fazla ayrıntı içerir ve e-posta için yerel hesap onaylama ve ASP.NET ıdentity'de Unutulan parolalarını sıfırlamasına izin yapmayı gösterir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-106">This tutorial contains more details and will show you how to set up email for local account confirmation and allow users to reset their forgotten password in ASP.NET Identity.</span></span>

<span data-ttu-id="2a0f5-107">Kullanıcı hesabı için bir parola oluşturmak bir yerel kullanıcı hesabı gerektirir ve bu parola web uygulamasında (güvenli) depolanır.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-107">A local user account requires the user to create a password for the account, and that password is stored (securely) in the web app.</span></span> <span data-ttu-id="2a0f5-108">ASP.NET Identity, kullanıcının uygulama için bir parola oluşturması gerektirmeyen sosyal medya hesaplarını da destekler.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-108">ASP.NET Identity also supports social accounts, which don't require the user to create a password for the app.</span></span> <span data-ttu-id="2a0f5-109">[Sosyal medya hesaplarını](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) kullanıcıların kimliğini doğrulamak için bir üçüncü taraf (örneğin, Google, Twitter, Facebook veya Microsoft) kullanın.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-109">[Social accounts](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) use a third party (such as Google, Twitter, Facebook, or Microsoft) to authenticate users.</span></span> <span data-ttu-id="2a0f5-110">Bu konu başlığı altında aşağıdakileri içerir:</span><span class="sxs-lookup"><span data-stu-id="2a0f5-110">This topic covers the following:</span></span>

- <span data-ttu-id="2a0f5-111">[Bir ASP.NET MVC uygulaması oluşturma](#createMvc) ve ASP.NET Identity özelliklerini keşfedin.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-111">[Create an ASP.NET MVC app](#createMvc) and explore ASP.NET Identity features.</span></span>
- [<span data-ttu-id="2a0f5-112">Derleme kimliği örneği</span><span class="sxs-lookup"><span data-stu-id="2a0f5-112">Build the Identity sample</span></span>](#build)
- [<span data-ttu-id="2a0f5-113">E-posta onayı ayarlama</span><span class="sxs-lookup"><span data-stu-id="2a0f5-113">Set up email confirmation</span></span>](#email)

<span data-ttu-id="2a0f5-114">Yeni kullanıcılar yerel bir hesap oluşturur, e-posta diğer kaydedin.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-114">New users register their email alias, which creates a local account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image1.png)

<span data-ttu-id="2a0f5-115">Kayıt düğmesini seçerek bir e-posta adresi doğrulama belirteci içeren bir onay e-posta gönderir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-115">Selecting the Register button sends a confirmation email containing a validation token to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image2.png)

<span data-ttu-id="2a0f5-116">Kullanıcı, kendi hesabı için bir onay belirteci ile bir e-posta gönderilir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-116">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image3.png)

<span data-ttu-id="2a0f5-117">Bağlantıyı seçerek hesap onaylar.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-117">Selecting the link confirms the account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image4.png)

<a id="passwordReset"></a>

## <a name="password-recoveryreset"></a><span data-ttu-id="2a0f5-118">Parola kurtarma/sıfırlama</span><span class="sxs-lookup"><span data-stu-id="2a0f5-118">Password recovery/reset</span></span>

<span data-ttu-id="2a0f5-119">Kendi parolanızı unutursanız yerel kullanıcılar, bunları kullanıcının parolasını sıfırlamak etkinleştirme, e-posta hesabına gönderilen bir güvenlik belirteci olabilir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-119">Local users who forget their password can have a security token sent to their email account, enabling them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image5.png)  
  
<span data-ttu-id="2a0f5-120">Kullanıcı, yakında kullanıcının parolasını sıfırlamak için bir bağlantı ile bir e-posta alırsınız.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-120">The user will soon get an email with a link allowing them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image6.png)  
<span data-ttu-id="2a0f5-121">Bağlantıyı seçerek bunları sıfırlama sayfasına gideceksiniz.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-121">Selecting the link will take them to the Reset page.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image7.png)  
  
<span data-ttu-id="2a0f5-122">Seçme **sıfırlama** düğmesi, parola sıfırlama olmadığını onaylayın.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-122">Selecting the **Reset** button will confirm the password has been reset.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image8.png)

<a id="createMvc"></a>

## <a name="create-an-aspnet-web-app"></a><span data-ttu-id="2a0f5-123">ASP.NET web uygulaması oluşturma</span><span class="sxs-lookup"><span data-stu-id="2a0f5-123">Create an ASP.NET web app</span></span>

<span data-ttu-id="2a0f5-124">Yükleme ve çalıştırmaya başlayın [Visual Studio 2017](https://visualstudio.microsoft.com/).</span><span class="sxs-lookup"><span data-stu-id="2a0f5-124">Start by installing and running [Visual Studio 2017](https://visualstudio.microsoft.com/).</span></span>

1. <span data-ttu-id="2a0f5-125">Yeni ASP.NET Web projesi oluşturun ve MVC şablonu seçin.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-125">Create a new ASP.NET Web project and select the MVC template.</span></span> <span data-ttu-id="2a0f5-126">Bir web forms uygulaması benzer adımları izleyebilirsiniz. Bu nedenle web Forms, ASP.NET Identity da destekler.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-126">Web Forms also support ASP.NET Identity, so you could follow similar steps in a web forms app.</span></span>
2. <span data-ttu-id="2a0f5-127">Kimlik doğrulaması için değiştirmeniz **bireysel kullanıcı hesapları**.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-127">Change the authentication to **Individual User Accounts**.</span></span>
3. <span data-ttu-id="2a0f5-128">Uygulamayı çalıştırın, seçin **kaydetme** bağlamak ve bir kullanıcı kaydı.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-128">Run the app, select the **Register** link and register a user.</span></span> <span data-ttu-id="2a0f5-129">Yalnızca e-posta doğrulamasını bu noktada, olan [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) özniteliği.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-129">At this point, the only validation on the email is with the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute.</span></span>
4. <span data-ttu-id="2a0f5-130">Sunucu Gezgini'nde gidin **veri Connections\DefaultConnection\Tables\AspNetUsers**seçin ve sağ tıklatıp **tablo tanımını açın**.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-130">In Server Explorer, navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right-click and select **Open table definition**.</span></span>

    <span data-ttu-id="2a0f5-131">Aşağıdaki görüntüde `AspNetUsers` şema:</span><span class="sxs-lookup"><span data-stu-id="2a0f5-131">The following image shows the `AspNetUsers` schema:</span></span>

    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image9.png)
5. <span data-ttu-id="2a0f5-132">Sağ **AspNetUsers** tablosunu seçip **tablo verilerini Göster**.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-132">Right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image10.png)  
  
   <span data-ttu-id="2a0f5-133">Bu noktada e-posta onaylanmamıştır.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-133">At this point the email has not been confirmed.</span></span>

<span data-ttu-id="2a0f5-134">ASP.NET kimliği için varsayılan veri deposu, Entity Framework olmakla birlikte, ek alanlar eklenecek ve diğer veri depoları kullanmak üzere yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-134">The default data store for ASP.NET Identity is Entity Framework, but you can configure it to use other data stores and to add additional fields.</span></span> <span data-ttu-id="2a0f5-135">Bkz: [ek kaynaklar](#addRes) Bu öğreticinin sonunda bölüm.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-135">See [Additional Resources](#addRes) section at the end of this tutorial.</span></span>

<span data-ttu-id="2a0f5-136">[OWIN başlangıç sınıfı](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) uygulama başladığında ve çağırır olduğunda Aranan `ConfigureAuth` yönteminde *uygulama\_Start\Startup.Auth.cs*, OWIN ardışık düzenini yapılandırır ve ASP.NET Identity başlatır.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-136">The [OWIN startup class](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) is called when the app starts and invokes the `ConfigureAuth` method in *App\_Start\Startup.Auth.cs*, which configures the OWIN pipeline and initializes ASP.NET Identity.</span></span> <span data-ttu-id="2a0f5-137">İnceleme `ConfigureAuth` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-137">Examine the `ConfigureAuth` method.</span></span> <span data-ttu-id="2a0f5-138">Her `CreatePerOwinContext` çağrısı, bir geri çağırma kaydeder (kayıtlı `OwinContext`), çağrılacağı kez belirtilen türün bir örneğini oluşturmak için istek başına.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-138">Each `CreatePerOwinContext` call registers a callback (saved in the `OwinContext`) that will be called once per request to create an instance of the specified type.</span></span> <span data-ttu-id="2a0f5-139">Oluşturucu içinde bir kesme noktası ayarlayabilirsiniz ve `Create` yöntemi her türün (`ApplicationDbContext, ApplicationUserManager`) ve her istekte çağırılır bunlar doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-139">You can set a break point in the constructor and `Create` method of each type (`ApplicationDbContext, ApplicationUserManager`) and verify they are called on each request.</span></span> <span data-ttu-id="2a0f5-140">Bir örneğini `ApplicationDbContext` ve `ApplicationUserManager` uygulamanın tamamında erişilebilir OWIN bağlamında depolanır.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-140">A instance of `ApplicationDbContext` and `ApplicationUserManager` is stored in the OWIN context, which can be accessed throughout the application.</span></span> <span data-ttu-id="2a0f5-141">OWIN ardışık düzenini tanımlama bilgisi ara yazılım aracılığıyla içine ASP.NET Identity kancaları.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-141">ASP.NET Identity hooks into the OWIN pipeline through cookie middleware.</span></span> <span data-ttu-id="2a0f5-142">Daha fazla bilgi için [UserManager ASP.NET Identity sınıfında ömür yönetimini istek başına](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a0f5-142">For more information, see [Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span>

<span data-ttu-id="2a0f5-143">Güvenlik profilinizi değiştirdiğinizde, yeni bir güvenlik damgası oluşturulur ve depolanır `SecurityStamp` alanını *AspNetUsers* tablo.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-143">When you change your security profile, a new security stamp is generated and stored in the `SecurityStamp` field of the *AspNetUsers* table.</span></span> <span data-ttu-id="2a0f5-144">Not `SecurityStamp` alandır güvenlik tanımlama bilgisinden farklı.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-144">Note, the `SecurityStamp` field is different from the security cookie.</span></span> <span data-ttu-id="2a0f5-145">Güvenlik tanımlama bilgisi depolanmaz `AspNetUsers` tabloyu (veya kimlik DB'de başka bir yerde).</span><span class="sxs-lookup"><span data-stu-id="2a0f5-145">The security cookie is not stored in the `AspNetUsers` table (or anywhere else in the Identity DB).</span></span> <span data-ttu-id="2a0f5-146">Güvenlik tanımlama bilgisi belirteci kullanarak kendinden imzalı [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) ve ile oluşturulan `UserId, SecurityStamp` ve sona erme saati bilgileri.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-146">The security cookie token is self-signed using [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) and is created with the `UserId, SecurityStamp` and expiration time information.</span></span>

<span data-ttu-id="2a0f5-147">Tanımlama bilgisi Ara her istekte tanımlama bilgisi denetler.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-147">The cookie middleware checks the cookie on each request.</span></span> <span data-ttu-id="2a0f5-148">`SecurityStampValidator` Yönteminde `Startup` sınıfı DB denk gelir ve güvenlik damgasını düzenli aralıklarla denetleyen ile belirtilen `validateInterval`.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-148">The `SecurityStampValidator` method in the `Startup` class hits the DB and checks security stamp periodically, as specified with the `validateInterval`.</span></span> <span data-ttu-id="2a0f5-149">Bu yalnızca güvenlik profilinizi değiştirmediğiniz sürece her 30 dakikada bir (örneğimizi) gerçekleşir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-149">This only happens every 30 minutes (in our sample) unless you change your security profile.</span></span> <span data-ttu-id="2a0f5-150">30 dakikalık aralık gelişlerin veritabanına en aza indirmek için seçilmiştir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-150">The 30 minute interval was chosen to minimize trips to the database.</span></span> <span data-ttu-id="2a0f5-151">Bkz: benim [iki öğeli kimlik doğrulama öğreticisini](index.md) daha fazla ayrıntı için.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-151">See my [two-factor authentication tutorial](index.md) for more details.</span></span>

<span data-ttu-id="2a0f5-152">Kod açıklamaları başına `UseCookieAuthentication` yöntemi tanımlama bilgisi kimlik doğrulamasını destekler.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-152">Per the comments in the code, the `UseCookieAuthentication` method supports cookie authentication.</span></span> <span data-ttu-id="2a0f5-153">`SecurityStamp` Alan ve ilişkili kod ek bir koruma katmanı sağlar, parola değiştirdiğinizde, uygulamanıza güvenlik, oturumunuz ile tarayıcı dışında günlüğe kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-153">The `SecurityStamp` field and associated code provides an extra layer of security to your app, when you change your password, you will be logged out of the browser you logged in with.</span></span> <span data-ttu-id="2a0f5-154">`SecurityStampValidator.OnValidateIdentity` , Parola değiştirdiğinizde veya dış oturum kullandığınızda kullanılan uygulama kullanıcı oturum açtığında güvenlik belirteci doğrulamak yöntem sağlar.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-154">The `SecurityStampValidator.OnValidateIdentity` method enables the app to validate the security token when the user logs in, which is used when you change a password or use the external login.</span></span> <span data-ttu-id="2a0f5-155">Bu, eski parola ile oluşturulan tüm belirteçleri (tanımlama) geçersiz emin olmak için gereklidir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-155">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="2a0f5-156">Örnek Proje değiştirirseniz kullanıcı için kullanıcı parolalarının sonra yeni bir belirteç oluşturulur, önceki tarafından istenen belirteçleri geçersiz kılınır ve `SecurityStamp` alan güncelleştirilir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-156">In the sample project, if you change the users password then a new token is generated for the user, any previous tokens are invalidated and the `SecurityStamp` field is updated.</span></span>

<span data-ttu-id="2a0f5-157">Kimlik sistemi izin Uygulamanızı yapılandırmak için bunu kullanıcılar güvenlik profil değiştiğinde (örneğin, kullanıcı parolalarını veya değişiklikleri değiştiğinde giriş ilişkili (Facebook, Google'nın gelenler gibi Microsoft hesabı, vb.), tüm kullanıcı oturum Tarayıcı örnekleri.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-157">The Identity system allow you to configure your app so when the users security profile changes (for example, when the user changes their password or changes associated login (such as from Facebook, Google, Microsoft account, etc.), the user is logged out of all browser instances.</span></span> <span data-ttu-id="2a0f5-158">Örneğin, görüntüyü aşağıda gösterildiği [çoklu oturum kapatma örnek](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) tüm tarayıcı örnekleri (Bu durumda, IE, Firefox ve Chrome) dışında bir düğmeyi seçerek oturum açmasını sağlayan uygulama.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-158">For example, the image below shows the [Single signout sample](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) app, which allows the user to sign out of all browser instances (in this case, IE, Firefox and Chrome) by selecting one button.</span></span> <span data-ttu-id="2a0f5-159">Alternatif olarak, örnek bir belirli bir tarayıcı örneğinde dışında yalnızca oturum sağlar.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-159">Alternatively, the sample allows you to only log out of a specific browser instance.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image11.png)

<span data-ttu-id="2a0f5-160">[Çoklu oturum kapatma örnek](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) uygulama gösterir nasıl ASP.NET Identity güvenlik belirteci yeniden sağlar.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-160">The [Single signout sample](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) app shows how ASP.NET Identity allows you to regenerate the security token.</span></span> <span data-ttu-id="2a0f5-161">Bu, eski parola ile oluşturulan tüm belirteçleri (tanımlama) geçersiz emin olmak için gereklidir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-161">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="2a0f5-162">Bu özellik, güvenlik uygulamanıza ek bir koruma katmanı sağlar. Parolanızı değiştirdiğinizde, bu uygulamaya burada kapattınız kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-162">This feature provides an extra layer of security to your application; when you change your password, you will be logged out where you have logged into this application.</span></span>

<span data-ttu-id="2a0f5-163">*Uygulama\_Start\IdentityConfig.cs* dosyasını içeren `ApplicationUserManager`, `EmailService` ve `SmsService` sınıfları.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-163">The *App\_Start\IdentityConfig.cs* file contains the `ApplicationUserManager`, `EmailService` and `SmsService` classes.</span></span> <span data-ttu-id="2a0f5-164">`EmailService` Ve `SmsService` her uygulama sınıfları `IIdentityMessageService` arabirim için e-posta ve SMS yapılandırmak için her sınıfta ortak yöntemler vardır.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-164">The `EmailService` and `SmsService` classes each implement the `IIdentityMessageService` interface, so you have common methods in each class to configure email and SMS.</span></span> <span data-ttu-id="2a0f5-165">Bu öğreticide yalnızca e-posta bildirimi aracılığıyla ekleme gösterir, ancak [SendGrid](http://sendgrid.com/), SMTP ve başka mekanizmalar kullanılarak bir e-posta gönderebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-165">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms.</span></span>

<span data-ttu-id="2a0f5-166">`Startup` Sınıfı ayrıca içerir (Facebook, Twitter, vb.), sosyal oturum açma bilgilerini görmek my öğretici eklemek için kazan blondan [Facebook, Twitter, LinkedIn ve Google OAuth2 oturum açma ile MVC 5 uygulaması](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) daha fazla bilgi için.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-166">The `Startup` class also contains boiler plate to add social logins (Facebook, Twitter, etc.), see my tutorial [MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) for more info.</span></span>

<span data-ttu-id="2a0f5-167">İnceleme `ApplicationUserManager` sınıfı kullanıcıların kimlik bilgilerini içeren ve aşağıdaki özellikleri yapılandırır:</span><span class="sxs-lookup"><span data-stu-id="2a0f5-167">Examine the `ApplicationUserManager` class, which contains the users identity information and configures the following features:</span></span>

- <span data-ttu-id="2a0f5-168">Parola gücü gereksinimleri.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-168">Password strength requirements.</span></span>
- <span data-ttu-id="2a0f5-169">Kullanıcı kilitleme (denemeleri ve süresi).</span><span class="sxs-lookup"><span data-stu-id="2a0f5-169">User lock out (attempts and time).</span></span>
- <span data-ttu-id="2a0f5-170">İki öğeli kimlik doğrulamayı (2FA).</span><span class="sxs-lookup"><span data-stu-id="2a0f5-170">Two-factor authentication (2FA).</span></span> <span data-ttu-id="2a0f5-171">Başka bir öğreticinin 2FA ve SMS değineceğiz.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-171">I'll cover 2FA and SMS in another tutorial.</span></span>
- <span data-ttu-id="2a0f5-172">E-posta ve SMS hizmetlerini takma.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-172">Hooking up the email and SMS services.</span></span> <span data-ttu-id="2a0f5-173">(Ben SMS başka bir öğreticinin ele alacağız).</span><span class="sxs-lookup"><span data-stu-id="2a0f5-173">(I'll cover SMS in another tutorial).</span></span>

<span data-ttu-id="2a0f5-174">`ApplicationUserManager` Sınıfı türetilen genel `UserManager<ApplicationUser>` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-174">The `ApplicationUserManager` class derives from the generic `UserManager<ApplicationUser>` class.</span></span> <span data-ttu-id="2a0f5-175">`ApplicationUser` öğesinden türetilen [IdentityUser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a0f5-175">`ApplicationUser` derives from [IdentityUser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx).</span></span> <span data-ttu-id="2a0f5-176">`IdentityUser` Genel türetilen `IdentityUser` sınıfı:</span><span class="sxs-lookup"><span data-stu-id="2a0f5-176">`IdentityUser` derives from the generic `IdentityUser` class:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample1.cs)]

<span data-ttu-id="2a0f5-177">Yukarıdaki özellikleri Özellikler ile çakıştığı `AspNetUsers` yukarıda gösterilen tablo.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-177">The properties above coincide with the properties in the `AspNetUsers` table, shown above.</span></span>

<span data-ttu-id="2a0f5-178">Genel bağımsız değişkenler üzerinde `IUser` farklı türleri için birincil anahtarı kullanarak bir sınıf türetin olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-178">Generic arguments on `IUser` enable you to derive a class using different types for the primary key.</span></span> <span data-ttu-id="2a0f5-179">Bkz: [ChangePK](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/ChangePK/readme.txt) int veya GUID dizeden birincil anahtarı değiştirmek nasıl gösteren bir örnek.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-179">See the [ChangePK](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/ChangePK/readme.txt) sample which shows how to change the primary key from string to int or GUID.</span></span>

### <a name="applicationuser"></a><span data-ttu-id="2a0f5-180">ApplicationUser</span><span class="sxs-lookup"><span data-stu-id="2a0f5-180">ApplicationUser</span></span>

<span data-ttu-id="2a0f5-181">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`) tanımlanan *Models\IdentityModels.cs* olarak:</span><span class="sxs-lookup"><span data-stu-id="2a0f5-181">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`) is defined in *Models\IdentityModels.cs* as:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample2.cs?highlight=8-9)]

<span data-ttu-id="2a0f5-182">Yukarıdaki vurgulanan kod oluşturur bir [Claimsıdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a0f5-182">The highlighted code above generates a [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span></span> <span data-ttu-id="2a0f5-183">ASP.NET Identity ve OWIN tanımlama bilgisi kimlik doğrulaması talep tabanlı, bu nedenle framework oluşturulacak uygulamayı gerektirir bir `ClaimsIdentity` kullanıcı.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-183">ASP.NET Identity and OWIN Cookie Authentication are claims-based, therefore the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> <span data-ttu-id="2a0f5-184">`ClaimsIdentity` bilgileri gibi kullanıcının adını, kullanıcı için tüm talepleri hakkında yaş ve kullanıcının hangi rolleri ait.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-184">`ClaimsIdentity` has information about all the claims for the user, such as the user's name, age and what roles the user belongs to.</span></span> <span data-ttu-id="2a0f5-185">Bu aşamada kullanıcı için daha fazla talep de ekleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-185">You can also add more claims for the user at this stage.</span></span>

<span data-ttu-id="2a0f5-186">OWIN `AuthenticationManager.SignIn` yöntemi de geçer `ClaimsIdentity` ve kullanıcı oturum açtığında:</span><span class="sxs-lookup"><span data-stu-id="2a0f5-186">The OWIN `AuthenticationManager.SignIn` method passes in the `ClaimsIdentity` and signs in the user:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample3.cs?highlight=4-6)]

<span data-ttu-id="2a0f5-187">[Facebook, Twitter, LinkedIn ve Google OAuth2 oturum açma ile MVC 5 uygulaması](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) ek özelliklerini nasıl ekleyebileceğinizi gösterir `ApplicationUser` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-187">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) shows how you can add additional properties to the `ApplicationUser` class.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="2a0f5-188">E-posta onayı</span><span class="sxs-lookup"><span data-stu-id="2a0f5-188">Email confirmation</span></span>

<span data-ttu-id="2a0f5-189">Bunlar değil kimliğe bürünerek başka birisi doğrulamak için ile yeni bir kullanıcı kaydı e-postayı onaylamak için iyi bir fikirdir (diğer bir deyişle, bunlar başka birinin e-posta ile kayıtlı olmayabilirsiniz).</span><span class="sxs-lookup"><span data-stu-id="2a0f5-189">It's a good idea to confirm the email a new user register with to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="2a0f5-190">Tartışma Forumu tablonuz olduğunu varsayın engellemek istiyorsunuz `"bob@example.com"` olarak kaydetme gelen `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-190">Suppose you had a discussion forum, you would want to prevent `"bob@example.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="2a0f5-191">E-posta onayı olmadan `"joe@contoso.com"` uygulamanızdan istenmeyen e-posta alabilir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-191">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="2a0f5-192">Bob yanlışlıkla olarak kayıtlı varsayalım `"bib@example.com"` ve bunu fark yüklediniz o uygulamayı doğru e-postasını olmadığı için parola kurtarma kullanın saptayamazdınız.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-192">Suppose Bob accidentally registered as `"bib@example.com"` and hadn't noticed it, he wouldn't be able to use password recover because the app doesn't have his correct email.</span></span> <span data-ttu-id="2a0f5-193">E-posta onayı robotlar yalnızca sınırlı koruma sağlar ve belirlenen istenmeyen posta gönderenlere koruma sağlamaz, sahip oldukları çok sayıda çalışan e-posta diğer adlar kaydetmek için kullanabilirsiniz. Aşağıdaki örnekte, kullanıcı hesabını (göre bunları ile kayıtlı e-posta hesabı alınan bir onay bağlantısını seçerek.) onaylanana kadar parola değiştirmesi mümkün olmayacaktır Diğer senaryolarda, örneğin onaylamak ve profillerini vb. değiştirdikten sonra kullanıcı bir e-posta gönderme Yöneticisi tarafından oluşturulan yeni hesapları parola sıfırlama için bağlantı gönderme, bu iş akışı uygulayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-193">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers, they have many working email aliases they can use to register.In the sample below, the user won't be able to change their password until their account has been confirmed (by them selecting a confirmation link received on the email account they registered with.) You can apply this work flow to other scenarios, for example sending a link to confirm and reset the password on new accounts created by the administrator, sending the user an email when they have changed their profile and so on.</span></span> <span data-ttu-id="2a0f5-194">Genellikle, yeni kullanıcıların e-posta, SMS mesajı ya da başka bir mekanizma onaylanmıştır önce web sitenizi herhangi bir veri gönderme engellemek istiyorsunuz.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-194">You generally want to prevent new users from posting any data to your web site before they have been confirmed by email, a SMS text message or another mechanism.</span></span> <a id="build"></a>

## <a name="build-a-more-complete-sample"></a><span data-ttu-id="2a0f5-195">Daha eksiksiz bir örnek oluşturun</span><span class="sxs-lookup"><span data-stu-id="2a0f5-195">Build a more complete sample</span></span>

<span data-ttu-id="2a0f5-196">Bu bölümde, NuGet ile çalışacağız daha eksiksiz bir örnek yüklemek için kullanacaksınız.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-196">In this section, you'll use NuGet to download a more complete sample we will work with.</span></span>

1. <span data-ttu-id="2a0f5-197">Yeni bir ***boş*** ASP.NET Web projesi.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-197">Create a new ***empty*** ASP.NET Web project.</span></span>
2. <span data-ttu-id="2a0f5-198">Paket Yöneticisi konsolunda, aşağıdaki komutları girin:</span><span class="sxs-lookup"><span data-stu-id="2a0f5-198">In the Package Manager Console, enter the following commands:</span></span> 

    [!code-console[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample4.cmd)]

   <span data-ttu-id="2a0f5-199">Bu öğreticide, kullanacağız [SendGrid](http://sendgrid.com/) e-posta göndermek için.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-199">In this tutorial, we'll use [SendGrid](http://sendgrid.com/) to send email.</span></span> <span data-ttu-id="2a0f5-200">`Identity.Samples` Çalışmalarımız ile kod paketi yükler.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-200">The `Identity.Samples` package installs the code we will be working with.</span></span>
3. <span data-ttu-id="2a0f5-201">Ayarlama [SSL kullanmak üzere proje](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="2a0f5-201">Set the [project to use SSL](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
4. <span data-ttu-id="2a0f5-202">Yerel hesap oluşturma, uygulamayı çalıştırarak test seçerek **kaydetme** bağlantısını ve kayıt form gönderme.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-202">Test local account creation by running the app, selecting the **Register** link, and posting the registration form.</span></span>
5. <span data-ttu-id="2a0f5-203">E-posta onayı benzetim tanıtım e-posta bağlantısını seçin.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-203">Select the demo email link, which simulates email confirmation.</span></span>
6. <span data-ttu-id="2a0f5-204">Tanıtım e-posta bağlantısı onay kodu örnekten Kaldır ( `ViewBag.Link` kodunda hesap denetleyicisi.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-204">Remove the demo email link confirmation code from the sample (The `ViewBag.Link` code in the account controller.</span></span> <span data-ttu-id="2a0f5-205">Bkz: `DisplayEmail` ve `ForgotPasswordConfirmation` eylem yöntemleri ve razor görünümleri).</span><span class="sxs-lookup"><span data-stu-id="2a0f5-205">See the `DisplayEmail` and `ForgotPasswordConfirmation` action methods and razor views ).</span></span>

> [!WARNING]
> <span data-ttu-id="2a0f5-206">Bu örnekte güvenlik ayarlarından herhangi birini değiştirirseniz, üretim uygulamaları yapılan değişiklikleri açıkça çağıran bir güvenlik denetimi geçmeleri gerekir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-206">If you change any of the security settings in this sample, productions apps will need to undergo a security audit that explicitly calls the changes made.</span></span>

## <a name="examine-the-code-in-appstartidentityconfigcs"></a><span data-ttu-id="2a0f5-207">Uygulama kodu inceleyin\_Start\IdentityConfig.cs</span><span class="sxs-lookup"><span data-stu-id="2a0f5-207">Examine the code in App\_Start\IdentityConfig.cs</span></span>

<span data-ttu-id="2a0f5-208">Örnek bir hesap oluşturun ve ona ekleme işlemi gösterilmektedir *yönetici* rol.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-208">The sample shows how to create an account and add it to the *Admin* role.</span></span> <span data-ttu-id="2a0f5-209">Örnek e-postada, yönetici hesabı kullanarak e-posta ile değiştirmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-209">You should replace the email in the sample with the email you will be using for the admin account.</span></span> <span data-ttu-id="2a0f5-210">Şu anda bir yönetici hesabı oluşturmak için en kolay yolu program `Seed` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-210">The easiest way right now to create an administrator account is programmatically in the `Seed` method.</span></span> <span data-ttu-id="2a0f5-211">Gelecekte oluşturmak ve kullanıcıları ve rolleri yönetmek sağlayacak bir araç olmasını umuyoruz.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-211">We hope to have a tool in the future that will allow you to create and administer users and roles.</span></span> <span data-ttu-id="2a0f5-212">Örnek kod oluşturma ve kullanıcıları ve rolleri yönetme izin vermez ancak öncelikle rol ve kullanıcı yönetici sayfaları çalıştırmak için Yöneticiler hesabınız olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-212">The sample code does let you create and manage users and roles, but you must first have an administrators account to run the roles and user admin pages.</span></span> <span data-ttu-id="2a0f5-213">Bu örnekte, çekirdek değeri oluşturulmuş bir veritabanı yönetici hesabı oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-213">In this sample, the admin account is created when the DB is seeded.</span></span>

<span data-ttu-id="2a0f5-214">Parola değiştirme ve e-posta bildirimlerini nereden alacağınızı bir hesap için adı değiştirin.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-214">Change the password and change the name to an account where you can receive email notifications.</span></span>

> [!WARNING]
> <span data-ttu-id="2a0f5-215">Güvenlik - hiçbir zaman deposu hassas verileri, kaynak kodunuzdaki.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-215">Security - Never store sensitive data in your source code.</span></span>

<span data-ttu-id="2a0f5-216">Daha önce de belirtildiği `app.CreatePerOwinContext` başlangıç sınıfı çağrısında ekler geri çağırmalar için `Create` yöntemi sınıfların DB uygulama içeriği, Kullanıcı Yöneticisi ve Rol Yöneticisi.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-216">As mentioned previously, the `app.CreatePerOwinContext` call in the startup class adds callbacks to the `Create` method of the app DB content, user manager and role manger classes.</span></span> <span data-ttu-id="2a0f5-217">OWIN ardışık düzen çağrıları `Create` yöntemi bu sınıfların her istek için ve her sınıf için bağlam depolar.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-217">The OWIN pipeline calls the `Create` method on these classes for each request and stores the context for each class.</span></span> <span data-ttu-id="2a0f5-218">Hesap denetleyicisi (OWIN bağlamını içeren) HTTP bağlamdan Kullanıcı Yöneticisi'ni kullanıma sunar:</span><span class="sxs-lookup"><span data-stu-id="2a0f5-218">The account controller exposes the user manager from the HTTP context (which contains the OWIN context):</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample5.cs)]

<span data-ttu-id="2a0f5-219">Yerel hesap olarak bir kullanıcı kayıt olurkenki `HTTP Post Register` yöntemi çağrılır:</span><span class="sxs-lookup"><span data-stu-id="2a0f5-219">When a user registers a local account, the `HTTP Post Register` method is called:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample6.cs)]

<span data-ttu-id="2a0f5-220">Yukarıdaki kod, e-posta ve girilen parolayı kullanarak yeni bir kullanıcı hesabı oluşturmak için model verileri kullanır.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-220">The code above uses the model data to create a new user account using the email and password entered.</span></span> <span data-ttu-id="2a0f5-221">E-posta diğer veri deposunda ise, hesap oluşturma başarısız olur ve formu yeniden görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-221">If the email alias is in the data store, account creation fails and the form is displayed again.</span></span> <span data-ttu-id="2a0f5-222">`GenerateEmailConfirmationTokenAsync` Yöntemi güvenli onay belirteci oluşturur ve ASP.NET Identity veri deposunda saklar.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-222">The `GenerateEmailConfirmationTokenAsync` method creates a secure confirmation token and stores it in the ASP.NET Identity data store.</span></span> <span data-ttu-id="2a0f5-223">[Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) yöntemi oluşturur bağlantısı içeren `UserId` ve onay simgesi.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-223">The [Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) method creates a link containing the `UserId` and confirmation token.</span></span> <span data-ttu-id="2a0f5-224">Bu bağlantının ardından kullanıcıya e-posta ile, kullanıcı hesabını onaylamak için kendi e-posta uygulaması bağlantıya seçebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-224">This link is then emailed to the user, the user can select on the link in their email app to confirm their account.</span></span>

<a id="email"></a>

## <a name="set-up-email-confirmation"></a><span data-ttu-id="2a0f5-225">E-posta onayı ayarlama</span><span class="sxs-lookup"><span data-stu-id="2a0f5-225">Set up email confirmation</span></span>

<span data-ttu-id="2a0f5-226">Git [Azure SendGrid kayıt sayfasını](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) ve ücretsiz hesap kaydedin.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-226">Go to the [Azure SendGrid sign up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free account.</span></span> <span data-ttu-id="2a0f5-227">SendGrid yapılandırmak için aşağıdaki kodu ekleyin:</span><span class="sxs-lookup"><span data-stu-id="2a0f5-227">Add code similar to the following to configure SendGrid:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample7.cs?highlight=5)]

> [!NOTE]
> <span data-ttu-id="2a0f5-228">E-posta istemcileri genellikle yalnızca metin iletileri (HTML yok) kabul edin.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-228">Email clients frequently accept only text messages (no HTML).</span></span> <span data-ttu-id="2a0f5-229">Metin ve HTML iletisinde sağlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-229">You should provide the message in text and HTML.</span></span> <span data-ttu-id="2a0f5-230">SendGrid yukarıdaki örnekte, bu ile yapılır `myMessage.Text` ve `myMessage.Html` yukarıda gösterilen kodu.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-230">In the SendGrid sample above, this is done with the `myMessage.Text` and `myMessage.Html` code shown above.</span></span>

<span data-ttu-id="2a0f5-231">Aşağıdaki kodu kullanarak e-posta göndermek nasıl gösterir [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) sınıfı nerede `message.Body` yalnızca bağlantıyı döndürür.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-231">The following code shows how to send email using the [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) class where `message.Body` returns only the link.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample8.cs)]

> [!WARNING]
> <span data-ttu-id="2a0f5-232">Güvenlik - hiçbir zaman deposu hassas verileri, kaynak kodunuzdaki.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-232">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="2a0f5-233">Kimlik ve hesap appSetting içinde depolanır.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-233">The account and credentials are stored in the appSetting.</span></span> <span data-ttu-id="2a0f5-234">Azure üzerinde güvenli bir şekilde bu değerleri üzerinde depolamanın **[yapılandırma](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** Azure portalında sekmesi.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-234">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="2a0f5-235">Bkz: [parolalar ve diğer hassas verileri ASP.NET ve Azure'a dağıtmak için en iyi yöntemler](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span><span class="sxs-lookup"><span data-stu-id="2a0f5-235">See [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span></span>

<span data-ttu-id="2a0f5-236">SendGrid kimlik bilgilerinizi girin, uygulamayı çalıştırın, e-postanızda bir e-posta diğer kaydı Onayla bağlantı seçebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-236">Enter your SendGrid credentials, run the app, register with an email alias can select the confirm link in your email.</span></span> <span data-ttu-id="2a0f5-237">İle bunun nasıl yapılacağını görmek için [Outlook.com](http://outlook.com) hesabı e-posta, John Atten'ın bkz [ C# Outlook.Com SMTP konağı için SMTP Yapılandırması](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) ve parolasını[ASP.NET Identity 2.0: Hesap doğrulama ayarı ve iki Faktörlü yetkilendirmeyi](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) gönderir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-237">To see how to do this with your [Outlook.com](http://outlook.com) email account, see John Atten's [C# SMTP Configuration for Outlook.Com SMTP Host](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) and his[ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) posts.</span></span>

<span data-ttu-id="2a0f5-238">Bir kullanıcı seçtikten sonra **kaydetme** düğmesi için kendi e-posta adresi doğrulama belirteci içeren bir onay e-posta gönderilir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-238">Once a user selects the **Register** button a confirmation email containing a validation token is sent to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image12.png)

<span data-ttu-id="2a0f5-239">Kullanıcı, kendi hesabı için bir onay belirteci ile bir e-posta gönderilir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-239">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image13.png)

## <a name="examine-the-code"></a><span data-ttu-id="2a0f5-240">Kod İnceleme</span><span class="sxs-lookup"><span data-stu-id="2a0f5-240">Examine the code</span></span>

<span data-ttu-id="2a0f5-241">Aşağıdaki kodda `POST ForgotPassword` metodu gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-241">The following code shows the `POST ForgotPassword` method.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample9.cs)]

<span data-ttu-id="2a0f5-242">Kullanıcı e-posta onaylanmamıştır yöntemi sessizce başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-242">The method fails silently if the user email has not been confirmed.</span></span> <span data-ttu-id="2a0f5-243">Bir hata için bir geçersiz e-posta adresi gönderildi, kötü amaçlı kullanıcıların saldırmak için geçerli kullanıcı (e-posta takma adlardır) bulmak için bu bilgileri kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-243">If an error was posted for an invalid email address, malicious users could use that information to find valid userId (email aliases) to attack.</span></span>

<span data-ttu-id="2a0f5-244">Aşağıdaki kodda gösterildiği `ConfirmEmail` kullanıcı kendilerine gönderilen e-postada onay bağlantısını seçtiğinde çağrılır hesap denetleyicideki yöntemi:</span><span class="sxs-lookup"><span data-stu-id="2a0f5-244">The following code shows the `ConfirmEmail` method in the account controller that is called when the user selects the confirmation link in the email sent to them:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample10.cs)]

<span data-ttu-id="2a0f5-245">Unutulan parolayı belirteci kullanıldıktan sonra geçersiz kılınır.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-245">Once a forgotten password token has been used, it's invalidated.</span></span> <span data-ttu-id="2a0f5-246">Aşağıdaki kod değişikliği `Create` yöntemi (içinde *uygulama\_Start\IdentityConfig.cs* dosya) 3 saat içinde süresi dolacak şekilde belirteçleri ayarlar.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-246">The following code change in the `Create` method (in the *App\_Start\IdentityConfig.cs* file) sets the tokens to expire in 3 hours.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample11.cs?highlight=6-8)]

<span data-ttu-id="2a0f5-247">Yukarıdaki kod ile Unutulan parolayı ve e-posta onayı belirteçleri 3 saat içinde dolacak.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-247">With the code above, the forgotten password and the email confirmation tokens will expire in 3 hours.</span></span> <span data-ttu-id="2a0f5-248">Varsayılan `TokenLifespan` bir gündür.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-248">The default `TokenLifespan` is one day.</span></span>

<span data-ttu-id="2a0f5-249">Aşağıdaki kod, e-posta onayı yöntemi gösterir:</span><span class="sxs-lookup"><span data-stu-id="2a0f5-249">The following code shows the email confirmation method:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample12.cs)]

 <span data-ttu-id="2a0f5-250">Uygulamanızı daha güvenli hale getirmek için iki öğeli kimlik doğrulamayı (2FA) ASP.NET Identity destekler.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-250">To make your app more secure, ASP.NET Identity supports Two-Factor authentication (2FA).</span></span> <span data-ttu-id="2a0f5-251">Bkz: [ASP.NET Identity 2.0: Hesap doğrulama ve iki Faktörlü yetkilendirmeyi ayarlama](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) John Atten tarafından.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-251">See [ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) by John Atten.</span></span> <span data-ttu-id="2a0f5-252">Hesap kilitleme oturum açma parola denemesi hatalarında ayarlayabilirsiniz olsa da, bu yaklaşım, oturum açma bilgilerinizi getirir [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) kilitlemeleri uygulayın.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-252">Although you can set account lockout on login password attempt failures, that approach makes your login susceptible to [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) lockouts.</span></span> <span data-ttu-id="2a0f5-253">Hesap kilitleme yalnızca 2FA ile kullanmanızı öneririz.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-253">We recommend you use account lockout only with 2FA.</span></span>  
<a id="addRes"></a>

## <a name="additional-resources"></a><span data-ttu-id="2a0f5-254">Ek kaynaklar</span><span class="sxs-lookup"><span data-stu-id="2a0f5-254">Additional resources</span></span>

- [<span data-ttu-id="2a0f5-255">ASP.NET Identity için Özel Depolama Sağlayıcılarına Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="2a0f5-255">Overview of Custom Storage Providers for ASP.NET Identity</span></span>](../extensibility/overview-of-custom-storage-providers-for-aspnet-identity.md)
- <span data-ttu-id="2a0f5-256">[Facebook, Twitter, LinkedIn ve Google OAuth2 oturum açma ile MVC 5 uygulaması](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) Ayrıca kullanıcıların tablosuna profil bilgilerini ekleme işlemini gösterir.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-256">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) also shows how to add profile information to the users table.</span></span>
- <span data-ttu-id="2a0f5-257">[ASP.NET MVC ve 2.0 kimlik: Temellerini anlama](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) John Atten tarafından.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-257">[ASP.NET MVC and Identity 2.0: Understanding the Basics](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) by John Atten.</span></span>
- [<span data-ttu-id="2a0f5-258">ASP.NET Identity’ye Giriş</span><span class="sxs-lookup"><span data-stu-id="2a0f5-258">Introduction to ASP.NET Identity</span></span>](../getting-started/introduction-to-aspnet-identity.md)
- <span data-ttu-id="2a0f5-259">[ASP.NET kimlik 2.0.0 RTM Duyurusu](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) Pranav rastogi'nin.</span><span class="sxs-lookup"><span data-stu-id="2a0f5-259">[Announcing RTM of ASP.NET Identity 2.0.0](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) by Pranav Rastogi.</span></span>
