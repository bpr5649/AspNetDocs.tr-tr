---
uid: identity/overview/migrations/migrating-an-existing-website-from-sql-membership-to-aspnet-identity
title: Mevcut bir Web sitesini SQL üyeliğinden ASP.NET Identity'ye geçirme | Microsoft Docs
author: Rick-Anderson
description: Bu öğretici, kullanıcı ve rol verileri SQL üyelik yeni ASP.NET ıdentity'ye s kullanılarak oluşturulmuş mevcut bir web uygulamasını geçirme adımları göstermektedir...
ms.author: riande
ms.date: 12/19/2014
ms.assetid: 220d3d75-16b2-4240-beae-a5b534f06419
msc.legacyurl: /identity/overview/migrations/migrating-an-existing-website-from-sql-membership-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: b80f2f5cc4702c3e406d8989905c56508711e788
ms.sourcegitcommit: 289e051cc8a90e8f7127e239fda73047bde4de12
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/25/2019
ms.locfileid: "58426087"
---
# <a name="migrating-an-existing-website-from-sql-membership-to-aspnet-identity"></a><span data-ttu-id="1f18d-103">Mevcut Bir Web Sitesini SQL Üyeliğinden ASP.NET Identity’ye Geçirme</span><span class="sxs-lookup"><span data-stu-id="1f18d-103">Migrating an Existing Website from SQL Membership to ASP.NET Identity</span></span>

<span data-ttu-id="1f18d-104">tarafından [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="1f18d-104">by [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="1f18d-105">Bu öğretici, kullanıcı ve rol verileri SQL üyelik için yeni ASP.NET kimlik sistemi kullanılarak oluşturulmuş mevcut bir web uygulamasını geçirme adımları gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-105">This tutorial illustrates the steps to migrate an existing web application with user and role data created using SQL Membership to the new ASP.NET Identity system.</span></span> <span data-ttu-id="1f18d-106">Bu yaklaşım, bir ASP.NET Identity ve eski/yeni sınıfları, içindeki kanca gerekli var olan veritabanı şemasını değiştirilmesini kapsar.</span><span class="sxs-lookup"><span data-stu-id="1f18d-106">This approach involves changing the existing database schema to the one needed by the ASP.NET Identity and hook in the old/new classes to it.</span></span> <span data-ttu-id="1f18d-107">Veritabanınızı geçirildikten sonra bu yaklaşımı benimsemeye sonra kimlik gelecekteki güncelleştirmeleri kolayca ele alınacaktır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-107">After you adopt this approach, once your database is migrated, future updates to Identity will be handled effortlessly.</span></span>

<span data-ttu-id="1f18d-108">Bu öğreticide, biz kullanıcı ve rol verileri oluşturmak için Visual Studio 2010 kullanılarak oluşturulan bir web uygulaması şablonu (Web formları) olacaktır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-108">For this tutorial, we will take a web application template (Web Forms) created using Visual Studio 2010 to create user and role data.</span></span> <span data-ttu-id="1f18d-109">Ardından SQL betiklerini kimlik sistemi tarafından gerekli tabloları var olan veritabanını geçirmek için kullanacağız.</span><span class="sxs-lookup"><span data-stu-id="1f18d-109">We will then use SQL scripts to migrate the existing database to tables needed by the Identity system.</span></span> <span data-ttu-id="1f18d-110">Ardından gerekli NuGet paketlerini yükleyin ve kimlik sistemi için üyelik Yönetimi kullanan yeni hesabı yönetim sayfaları ekleyin.</span><span class="sxs-lookup"><span data-stu-id="1f18d-110">Next we'll install the necessary NuGet packages and add new account management pages which use the Identity system for membership management.</span></span> <span data-ttu-id="1f18d-111">Test geçiş olarak SQL üyelik kullanılarak oluşturulan kullanıcılar oturum açamaz ve yeni kullanıcılar kaydetme görüyor olmalısınız.</span><span class="sxs-lookup"><span data-stu-id="1f18d-111">As a test of migration, users created using SQL membership should be able to log in and new users should be able to register.</span></span> <span data-ttu-id="1f18d-112">Tam örnek bulabilirsiniz [burada](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SQLMembership-Identity-OWIN/).</span><span class="sxs-lookup"><span data-stu-id="1f18d-112">You can find the complete sample [here](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SQLMembership-Identity-OWIN/).</span></span> <span data-ttu-id="1f18d-113">Ayrıca bkz: [ASP.NET üyeliğinden ASP.NET Identity'ye geçirme](http://travis.io/blog/2015/03/24/migrate-from-aspnet-membership-to-aspnet-identity.html).</span><span class="sxs-lookup"><span data-stu-id="1f18d-113">See also [Migrating from ASP.NET Membership to ASP.NET Identity](http://travis.io/blog/2015/03/24/migrate-from-aspnet-membership-to-aspnet-identity.html).</span></span>

## <a name="getting-started"></a><span data-ttu-id="1f18d-114">Başlarken</span><span class="sxs-lookup"><span data-stu-id="1f18d-114">Getting started</span></span>

### <a name="creating-an-application-with-sql-membership"></a><span data-ttu-id="1f18d-115">SQL üyelik ile uygulama oluşturma</span><span class="sxs-lookup"><span data-stu-id="1f18d-115">Creating an application with SQL Membership</span></span>

1. <span data-ttu-id="1f18d-116">SQL üyelik kullanan ve kullanıcı ve rol verileri içeren varolan bir uygulama ile başlamaya ihtiyacımız var.</span><span class="sxs-lookup"><span data-stu-id="1f18d-116">We need to start with an existing application that uses SQL membership and has user and role data.</span></span> <span data-ttu-id="1f18d-117">Bu makalenin amacı, bir web uygulamasını Visual Studio 2010'da oluşturalım.</span><span class="sxs-lookup"><span data-stu-id="1f18d-117">For the purpose of this article, let's create a web application in Visual Studio 2010.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="1f18d-118">ASP.NET yapılandırma aracını kullanarak 2 kullanıcıları oluşturun: **oldAdminUser** ve **oldUser.**</span><span class="sxs-lookup"><span data-stu-id="1f18d-118">Using the ASP.NET Configuration tool, create 2 users: **oldAdminUser** and **oldUser.**</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image1.png)

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image2.jpg)
3. <span data-ttu-id="1f18d-119">Yönetici adlı bir rol oluşturun ve o roldeki bir kullanıcı olarak 'oldAdminUser' ekleyin.</span><span class="sxs-lookup"><span data-stu-id="1f18d-119">Create a role named Admin and add 'oldAdminUser' as a user in that role.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image2.png)
4. <span data-ttu-id="1f18d-120">Bir yönetici bölümü sitenin bir Default.aspx ile oluşturun.</span><span class="sxs-lookup"><span data-stu-id="1f18d-120">Create an Admin section of the site with a Default.aspx.</span></span> <span data-ttu-id="1f18d-121">Yalnızca yönetici rollerindeki kullanıcılara erişimi etkinleştirmek için web.config dosyasında yetkilendirme etiket ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-121">Set the authorization tag in the web.config file to enable access only to users in Admin roles.</span></span> <span data-ttu-id="1f18d-122">Daha fazla bilgi burada bulunabilir [https://www.asp.net/web-forms/tutorials/security/roles/role-based-authorization-cs](../../../web-forms/overview/older-versions-security/roles/role-based-authorization-cs.md)</span><span class="sxs-lookup"><span data-stu-id="1f18d-122">More information can be found here [https://www.asp.net/web-forms/tutorials/security/roles/role-based-authorization-cs](../../../web-forms/overview/older-versions-security/roles/role-based-authorization-cs.md)</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image3.png)
5. <span data-ttu-id="1f18d-123">SQL üyelik sistem tarafından oluşturulan tablolar anlamak için sunucu Gezgini'ndeki veritabanı görüntüleyin.</span><span class="sxs-lookup"><span data-stu-id="1f18d-123">View the database in Server Explorer to understand the tables created by the SQL membership system.</span></span> <span data-ttu-id="1f18d-124">Kullanıcı oturum açma verilerini ASP.NET içinde depolanan\_kullanıcılar ve aspnet\_üyelik tablo, içinde ASP.NET rol veri depolanma\_rolleri tablo.</span><span class="sxs-lookup"><span data-stu-id="1f18d-124">The user login data is stored in the aspnet\_Users and aspnet\_Membership tables, while role data is stored in the aspnet\_Roles table.</span></span> <span data-ttu-id="1f18d-125">Kullanıcılar olduğu konusunda hangi rollerinde aspnet içinde depolanan bilgi\_UsersInRoles tablo.</span><span class="sxs-lookup"><span data-stu-id="1f18d-125">Information about which users are in which roles is stored in the aspnet\_UsersInRoles table.</span></span> <span data-ttu-id="1f18d-126">Temel üyelik yönetimi için bağlantı noktası ASP.NET kimlik sistemi için yukarıdaki tabloların bilgilerinde yeterlidir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-126">For basic membership management it is sufficient to port the information in the above tables to the ASP.NET Identity system.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image4.png)

### <a name="migrating-to-visual-studio-2013"></a><span data-ttu-id="1f18d-127">Visual Studio 2013'e geçirme</span><span class="sxs-lookup"><span data-stu-id="1f18d-127">Migrating to Visual Studio 2013</span></span>

1. <span data-ttu-id="1f18d-128">Web veya ile birlikte Visual Studio 2013 için Visual Studio Express 2013 yükleme [en son güncelleştirmeleri](https://www.microsoft.com/download/details.aspx?id=44921).</span><span class="sxs-lookup"><span data-stu-id="1f18d-128">Install Visual Studio Express 2013 for Web or Visual Studio 2013 along with the [latest updates](https://www.microsoft.com/download/details.aspx?id=44921).</span></span>
2. <span data-ttu-id="1f18d-129">Yukarıdaki proje, yüklü Visual Studio sürümünde açın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-129">Open the above project in your installed version of Visual Studio.</span></span> <span data-ttu-id="1f18d-130">SQL Server Express bu makinede yüklü değilse, bağlantı dizesi, SQL Express kullandığından proje açtığınızda bir istem görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-130">If SQL Server Express is not installed on the machine, a prompt is displayed when you open the project, since the connection string uses SQL Express.</span></span> <span data-ttu-id="1f18d-131">SQL Express'i yükleyebilmek veya değişikliği geçici olarak LocalDb ile bağlantı dizesi çalışma ya da seçebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="1f18d-131">You can either choose to install SQL Express or as work around change the connection string to LocalDb.</span></span> <span data-ttu-id="1f18d-132">Bu makalede, yerel veritabanı'na değiştireceğiz.</span><span class="sxs-lookup"><span data-stu-id="1f18d-132">For this article we'll change it to LocalDb.</span></span>
3. <span data-ttu-id="1f18d-133">Web.config dosyasını açın ve bağlantı dizesini değiştirin. SQLExpress (LocalDb) v11.0 için.</span><span class="sxs-lookup"><span data-stu-id="1f18d-133">Open web.config and change the connection string from .SQLExpress to (LocalDb)v11.0.</span></span> <span data-ttu-id="1f18d-134">Kaldır ' kullanıcı örneği = true' bağlantı dizesinden.</span><span class="sxs-lookup"><span data-stu-id="1f18d-134">Remove 'User Instance=true' from the connection string.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image3.jpg)
4. <span data-ttu-id="1f18d-135">Sunucu Gezgini'ni açın ve tablo şemasını ve verileri gözlemlenen olduğunu doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-135">Open Server Explorer and verify that the table schema and data can be observed.</span></span>
5. <span data-ttu-id="1f18d-136">ASP.NET kimlik sistemi sürüm 4.5 veya framework'ün üstü ile çalışır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-136">The ASP.NET Identity system works with version 4.5 or higher of the framework.</span></span> <span data-ttu-id="1f18d-137">4.5 veya üzeri uygulamayı yeniden hedeflendi.</span><span class="sxs-lookup"><span data-stu-id="1f18d-137">Retarget the application to 4.5 or higher.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image5.png)

    <span data-ttu-id="1f18d-138">Herhangi bir hata olmadığını doğrulamak için projeyi derleyin.</span><span class="sxs-lookup"><span data-stu-id="1f18d-138">Build the project to verify that there are no errors.</span></span>

### <a name="installing-the-nuget-packages"></a><span data-ttu-id="1f18d-139">Nuget paketleri yükleniyor</span><span class="sxs-lookup"><span data-stu-id="1f18d-139">Installing the Nuget packages</span></span>

1. <span data-ttu-id="1f18d-140">Çözüm Gezgini'nde projeye sağ tıklayın &gt; **NuGet paketlerini Yönet**.</span><span class="sxs-lookup"><span data-stu-id="1f18d-140">In Solution Explorer, right-click the project &gt; **Manage NuGet Packages**.</span></span> <span data-ttu-id="1f18d-141">Arama kutusuna "Asp.net Identity" girin.</span><span class="sxs-lookup"><span data-stu-id="1f18d-141">In the search box, enter "Asp.net Identity".</span></span> <span data-ttu-id="1f18d-142">Sonuçlar listesinde paketi seçin ve Yükle'ye tıklayın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-142">Select the package in the list of results and click install.</span></span> <span data-ttu-id="1f18d-143">"Kabul ediyorum" düğmesine tıklayarak lisans sözleşmesini kabul edin.</span><span class="sxs-lookup"><span data-stu-id="1f18d-143">Accept the license agreement by clicking on "I Accept" button.</span></span> <span data-ttu-id="1f18d-144">Not: Bu paket bağımlılık paketlerini yükler EntityFramework ve Microsoft ASP.NET Identity çekirdek.</span><span class="sxs-lookup"><span data-stu-id="1f18d-144">Note that this package will install the dependency packages: EntityFramework and Microsoft ASP.NET Identity Core.</span></span> <span data-ttu-id="1f18d-145">Benzer şekilde (son 4 paketleri OWIN OAuth oturum açma etkinleştirmek istemiyorsanız atlayın) aşağıdaki paketleri yükleyin:</span><span class="sxs-lookup"><span data-stu-id="1f18d-145">Similarly install the following packages (skip the last 4 OWIN packages if you don't want to enable OAuth log-in):</span></span>

   - <span data-ttu-id="1f18d-146">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="1f18d-146">Microsoft.AspNet.Identity.Owin</span></span>
   - <span data-ttu-id="1f18d-147">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="1f18d-147">Microsoft.Owin.Host.SystemWeb</span></span>
   - <span data-ttu-id="1f18d-148">Microsoft.Owin.Security.Facebook</span><span class="sxs-lookup"><span data-stu-id="1f18d-148">Microsoft.Owin.Security.Facebook</span></span>
   - <span data-ttu-id="1f18d-149">Microsoft.Owin.Security.Google</span><span class="sxs-lookup"><span data-stu-id="1f18d-149">Microsoft.Owin.Security.Google</span></span>
   - <span data-ttu-id="1f18d-150">Microsoft.Owin.Security.MicrosoftAccount</span><span class="sxs-lookup"><span data-stu-id="1f18d-150">Microsoft.Owin.Security.MicrosoftAccount</span></span>
   - <span data-ttu-id="1f18d-151">Microsoft.Owin.Security.Twitter</span><span class="sxs-lookup"><span data-stu-id="1f18d-151">Microsoft.Owin.Security.Twitter</span></span>

     ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image6.png)

### <a name="migrate-database-to-the-new-identity-system"></a><span data-ttu-id="1f18d-152">Yeni kimlik sistemine veritabanını geçirme</span><span class="sxs-lookup"><span data-stu-id="1f18d-152">Migrate database to the new Identity system</span></span>

<span data-ttu-id="1f18d-153">Sonraki adım, ASP.NET Identity sistem için gerekli bir şema mevcut veritabanını geçirme sağlamaktır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-153">The next step is to migrate the existing database to a schema required by the ASP.NET Identity system.</span></span> <span data-ttu-id="1f18d-154">Elde etmek için bu bir SQL çalıştırıyoruz betik, yeni tablolar oluşturun ve mevcut kullanıcı bilgilerini geçirmek için yeni tablolar için komutları kümesi vardır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-154">To achieve this we run a SQL script which has a set of commands to create new tables and migrate existing user information to the new tables.</span></span> <span data-ttu-id="1f18d-155">Komut dosyası bulunabilir [burada](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SQLMembership-Identity-OWIN/Migrations.sql).</span><span class="sxs-lookup"><span data-stu-id="1f18d-155">The script file can be found [here](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SQLMembership-Identity-OWIN/Migrations.sql).</span></span>

<span data-ttu-id="1f18d-156">Bu komut dosyası, bu örnek için özeldir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-156">This script file is specific to this sample.</span></span> <span data-ttu-id="1f18d-157">Tablo için şema oluşturduysanız SQL üyelik kullanarak özelleştirilir veya betikleri buna uygun olarak değiştirilmesine gerek değiştirilemiyor.</span><span class="sxs-lookup"><span data-stu-id="1f18d-157">If the schema for the tables created using SQL membership is customized or modified the scripts need to be changed accordingly.</span></span>

### <a name="how-to-generate-the-sql-script-for-schema-migration"></a><span data-ttu-id="1f18d-158">Şema geçişi için SQL komut dosyası oluşturma</span><span class="sxs-lookup"><span data-stu-id="1f18d-158">How to generate the SQL script for schema migration</span></span>

<span data-ttu-id="1f18d-159">ASP.NET Identity sınıfları hazır varolan kullanıcı verileriyle çalışmaya ASP.NET Identity tarafından gereken bir veritabanı şeması geçirmek ihtiyacımız var.</span><span class="sxs-lookup"><span data-stu-id="1f18d-159">For ASP.NET Identity classes to work out of the box with the data of existing users, we need to migrate the database schema to the one needed by ASP.NET Identity.</span></span> <span data-ttu-id="1f18d-160">Biz yeni tablolar ekleyerek ve bu tablolarda mevcut bilgilerini kopyalama yapabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="1f18d-160">We can do this by adding new tables and copying the existing information to those tables.</span></span> <span data-ttu-id="1f18d-161">Varsayılan olarak, ASP.NET Identity depolama/bilgi almak için veritabanına geri kimlik modeli sınıflarını eşlemek için EntityFramework kullanır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-161">By default ASP.NET Identity uses EntityFramework to map the Identity model classes back to the database to store/retrieve information.</span></span> <span data-ttu-id="1f18d-162">Bu model sınıfları, kullanıcı ve rol nesneleri tanımlama temel kimlik arabirimler uygulayın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-162">These model classes implement the core Identity interfaces defining user and role objects.</span></span> <span data-ttu-id="1f18d-163">Tabloları ve sütunları veritabanında bu modeli sınıflarını temel alır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-163">The tables and the columns in the database are based on these model classes.</span></span> <span data-ttu-id="1f18d-164">Aşağıda tanımlanan kimlik v2.1.0 ve bunların özelliklerini EntityFramework model sınıfları şunlardır</span><span class="sxs-lookup"><span data-stu-id="1f18d-164">The EntityFramework model classes in Identity v2.1.0 and their properties are as defined below</span></span>

| <span data-ttu-id="1f18d-165">**IdentityUser**</span><span class="sxs-lookup"><span data-stu-id="1f18d-165">**IdentityUser**</span></span> | <span data-ttu-id="1f18d-166">**Tür**</span><span class="sxs-lookup"><span data-stu-id="1f18d-166">**Type**</span></span> | <span data-ttu-id="1f18d-167">**IdentityRole**</span><span class="sxs-lookup"><span data-stu-id="1f18d-167">**IdentityRole**</span></span> | <span data-ttu-id="1f18d-168">**IdentityUserRole**</span><span class="sxs-lookup"><span data-stu-id="1f18d-168">**IdentityUserRole**</span></span> | <span data-ttu-id="1f18d-169">**IdentityUserLogin**</span><span class="sxs-lookup"><span data-stu-id="1f18d-169">**IdentityUserLogin**</span></span> | <span data-ttu-id="1f18d-170">**IdentityUserClaim**</span><span class="sxs-lookup"><span data-stu-id="1f18d-170">**IdentityUserClaim**</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="1f18d-171">Kimliği</span><span class="sxs-lookup"><span data-stu-id="1f18d-171">Id</span></span> | <span data-ttu-id="1f18d-172">dize</span><span class="sxs-lookup"><span data-stu-id="1f18d-172">string</span></span> | <span data-ttu-id="1f18d-173">Kimliği</span><span class="sxs-lookup"><span data-stu-id="1f18d-173">Id</span></span> | <span data-ttu-id="1f18d-174">Rol Kimliği</span><span class="sxs-lookup"><span data-stu-id="1f18d-174">RoleId</span></span> | <span data-ttu-id="1f18d-175">ProviderKey</span><span class="sxs-lookup"><span data-stu-id="1f18d-175">ProviderKey</span></span> | <span data-ttu-id="1f18d-176">Kimliği</span><span class="sxs-lookup"><span data-stu-id="1f18d-176">Id</span></span> |
| <span data-ttu-id="1f18d-177">Kullanıcı adı</span><span class="sxs-lookup"><span data-stu-id="1f18d-177">Username</span></span> | <span data-ttu-id="1f18d-178">dize</span><span class="sxs-lookup"><span data-stu-id="1f18d-178">string</span></span> | <span data-ttu-id="1f18d-179">Ad</span><span class="sxs-lookup"><span data-stu-id="1f18d-179">Name</span></span> | <span data-ttu-id="1f18d-180">UserId</span><span class="sxs-lookup"><span data-stu-id="1f18d-180">UserId</span></span> | <span data-ttu-id="1f18d-181">UserId</span><span class="sxs-lookup"><span data-stu-id="1f18d-181">UserId</span></span> | <span data-ttu-id="1f18d-182">ClaimType</span><span class="sxs-lookup"><span data-stu-id="1f18d-182">ClaimType</span></span> |
| <span data-ttu-id="1f18d-183">PasswordHash</span><span class="sxs-lookup"><span data-stu-id="1f18d-183">PasswordHash</span></span> | <span data-ttu-id="1f18d-184">dize</span><span class="sxs-lookup"><span data-stu-id="1f18d-184">string</span></span> |  |  | <span data-ttu-id="1f18d-185">LoginProvider</span><span class="sxs-lookup"><span data-stu-id="1f18d-185">LoginProvider</span></span> | <span data-ttu-id="1f18d-186">ClaimValue</span><span class="sxs-lookup"><span data-stu-id="1f18d-186">ClaimValue</span></span> |
| <span data-ttu-id="1f18d-187">SecurityStamp</span><span class="sxs-lookup"><span data-stu-id="1f18d-187">SecurityStamp</span></span> | <span data-ttu-id="1f18d-188">dize</span><span class="sxs-lookup"><span data-stu-id="1f18d-188">string</span></span> |  |  |  | <span data-ttu-id="1f18d-189">Kullanıcı\_kimliği</span><span class="sxs-lookup"><span data-stu-id="1f18d-189">User\_Id</span></span> |
| <span data-ttu-id="1f18d-190">E-posta</span><span class="sxs-lookup"><span data-stu-id="1f18d-190">Email</span></span> | <span data-ttu-id="1f18d-191">dize</span><span class="sxs-lookup"><span data-stu-id="1f18d-191">string</span></span> |  |  |  |  |
| <span data-ttu-id="1f18d-192">EmailConfirmed</span><span class="sxs-lookup"><span data-stu-id="1f18d-192">EmailConfirmed</span></span> | <span data-ttu-id="1f18d-193">bool</span><span class="sxs-lookup"><span data-stu-id="1f18d-193">bool</span></span> |  |  |  |  |
| <span data-ttu-id="1f18d-194">PhoneNumber</span><span class="sxs-lookup"><span data-stu-id="1f18d-194">PhoneNumber</span></span> | <span data-ttu-id="1f18d-195">dize</span><span class="sxs-lookup"><span data-stu-id="1f18d-195">string</span></span> |  |  |  |  |
| <span data-ttu-id="1f18d-196">PhoneNumberConfirmed</span><span class="sxs-lookup"><span data-stu-id="1f18d-196">PhoneNumberConfirmed</span></span> | <span data-ttu-id="1f18d-197">bool</span><span class="sxs-lookup"><span data-stu-id="1f18d-197">bool</span></span> |  |  |  |  |
| <span data-ttu-id="1f18d-198">LockoutEnabled</span><span class="sxs-lookup"><span data-stu-id="1f18d-198">LockoutEnabled</span></span> | <span data-ttu-id="1f18d-199">bool</span><span class="sxs-lookup"><span data-stu-id="1f18d-199">bool</span></span> |  |  |  |  |
| <span data-ttu-id="1f18d-200">LockoutEndDate</span><span class="sxs-lookup"><span data-stu-id="1f18d-200">LockoutEndDate</span></span> | <span data-ttu-id="1f18d-201">DateTime</span><span class="sxs-lookup"><span data-stu-id="1f18d-201">DateTime</span></span> |  |  |  |  |
| <span data-ttu-id="1f18d-202">AccessFailedCount</span><span class="sxs-lookup"><span data-stu-id="1f18d-202">AccessFailedCount</span></span> | <span data-ttu-id="1f18d-203">int</span><span class="sxs-lookup"><span data-stu-id="1f18d-203">int</span></span> |  |  |  |  |

<span data-ttu-id="1f18d-204">Tablonuzun her Bu modeller için özelliklerine karşılık gelen sütun olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-204">We need to have tables for each of these models with columns corresponding to the properties.</span></span> <span data-ttu-id="1f18d-205">Sınıflar ve tablolar arasındaki eşlemeyi tanımlanan `OnModelCreating` yöntemi `IdentityDBContext`.</span><span class="sxs-lookup"><span data-stu-id="1f18d-205">The mapping between classes and tables is defined in the `OnModelCreating` method of the `IdentityDBContext`.</span></span> <span data-ttu-id="1f18d-206">Bu yapılandırma fluent API'si yöntemi olarak bilinir ve daha fazla bilgi bulunabilir [burada](https://msdn.microsoft.com/data/jj591617.aspx).</span><span class="sxs-lookup"><span data-stu-id="1f18d-206">This is known as the fluent API method of configuration and more information can be found [here](https://msdn.microsoft.com/data/jj591617.aspx).</span></span> <span data-ttu-id="1f18d-207">Sınıflar için aşağıda belirtildiği gibi bir yapılandırmadır</span><span class="sxs-lookup"><span data-stu-id="1f18d-207">The configuration for the classes is as mentioned below</span></span>

| <span data-ttu-id="1f18d-208">**Sınıfı**</span><span class="sxs-lookup"><span data-stu-id="1f18d-208">**Class**</span></span> | <span data-ttu-id="1f18d-209">**Tablo**</span><span class="sxs-lookup"><span data-stu-id="1f18d-209">**Table**</span></span> | <span data-ttu-id="1f18d-210">**Birincil anahtar**</span><span class="sxs-lookup"><span data-stu-id="1f18d-210">**Primary key**</span></span> | <span data-ttu-id="1f18d-211">**Yabancı anahtar**</span><span class="sxs-lookup"><span data-stu-id="1f18d-211">**Foreign key**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="1f18d-212">IdentityUser</span><span class="sxs-lookup"><span data-stu-id="1f18d-212">IdentityUser</span></span> | <span data-ttu-id="1f18d-213">AspnetUsers</span><span class="sxs-lookup"><span data-stu-id="1f18d-213">AspnetUsers</span></span> | <span data-ttu-id="1f18d-214">Kimliği</span><span class="sxs-lookup"><span data-stu-id="1f18d-214">Id</span></span> |  |
| <span data-ttu-id="1f18d-215">IdentityRole</span><span class="sxs-lookup"><span data-stu-id="1f18d-215">IdentityRole</span></span> | <span data-ttu-id="1f18d-216">AspnetRoles</span><span class="sxs-lookup"><span data-stu-id="1f18d-216">AspnetRoles</span></span> | <span data-ttu-id="1f18d-217">Kimliği</span><span class="sxs-lookup"><span data-stu-id="1f18d-217">Id</span></span> |  |
| <span data-ttu-id="1f18d-218">IdentityUserRole</span><span class="sxs-lookup"><span data-stu-id="1f18d-218">IdentityUserRole</span></span> | <span data-ttu-id="1f18d-219">AspnetUserRole</span><span class="sxs-lookup"><span data-stu-id="1f18d-219">AspnetUserRole</span></span> | <span data-ttu-id="1f18d-220">UserId + RoleId</span><span class="sxs-lookup"><span data-stu-id="1f18d-220">UserId + RoleId</span></span> | <span data-ttu-id="1f18d-221">User\_Id-&gt;AspnetUsers RoleId-&gt;AspnetRoles</span><span class="sxs-lookup"><span data-stu-id="1f18d-221">User\_Id-&gt;AspnetUsers RoleId-&gt;AspnetRoles</span></span> |
| <span data-ttu-id="1f18d-222">IdentityUserLogin</span><span class="sxs-lookup"><span data-stu-id="1f18d-222">IdentityUserLogin</span></span> | <span data-ttu-id="1f18d-223">AspnetUserLogins</span><span class="sxs-lookup"><span data-stu-id="1f18d-223">AspnetUserLogins</span></span> | <span data-ttu-id="1f18d-224">ProviderKey + UserID + LoginProvider</span><span class="sxs-lookup"><span data-stu-id="1f18d-224">ProviderKey+UserId + LoginProvider</span></span> | <span data-ttu-id="1f18d-225">UserId-&gt;AspnetUsers</span><span class="sxs-lookup"><span data-stu-id="1f18d-225">UserId-&gt;AspnetUsers</span></span> |
| <span data-ttu-id="1f18d-226">IdentityUserClaim</span><span class="sxs-lookup"><span data-stu-id="1f18d-226">IdentityUserClaim</span></span> | <span data-ttu-id="1f18d-227">AspnetUserClaims</span><span class="sxs-lookup"><span data-stu-id="1f18d-227">AspnetUserClaims</span></span> | <span data-ttu-id="1f18d-228">Kimliği</span><span class="sxs-lookup"><span data-stu-id="1f18d-228">Id</span></span> | <span data-ttu-id="1f18d-229">User\_Id-&gt;AspnetUsers</span><span class="sxs-lookup"><span data-stu-id="1f18d-229">User\_Id-&gt;AspnetUsers</span></span> |

<span data-ttu-id="1f18d-230">Bu bilgilerle yeni tablolar oluşturmak için SQL deyimleri oluşturabiliriz.</span><span class="sxs-lookup"><span data-stu-id="1f18d-230">With this information we can create SQL statements to create new tables.</span></span> <span data-ttu-id="1f18d-231">Biz tek tek her deyim yazma ya da biz daha sonra düzenleyebilirsiniz EntityFramework PowerShell komutlarından gerektiği gibi kullanarak tüm komut dosyası oluştur.</span><span class="sxs-lookup"><span data-stu-id="1f18d-231">We can either write each statement individually or generate the entire script using EntityFramework PowerShell commands which we can then edit as required.</span></span> <span data-ttu-id="1f18d-232">VS açma Bunu yapmak için **Paket Yöneticisi Konsolu** gelen **görünümü** veya **Araçları** menüsü</span><span class="sxs-lookup"><span data-stu-id="1f18d-232">To do this, in VS open the **Package Manager Console** from the **View** or **Tools** menu</span></span>

- <span data-ttu-id="1f18d-233">EntityFramework geçişler etkinleştirmek için "Geçişleri etkinleştir" komutunu çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-233">Run command "Enable-Migrations" to enable EntityFramework migrations.</span></span>
- <span data-ttu-id="1f18d-234">"C# veritabanı oluşturmak için ilk kurulum kodu oluşturan Ekle geçiş ilk" komutu Çalıştır / VB.</span><span class="sxs-lookup"><span data-stu-id="1f18d-234">Run command "Add-migration initial" which creates the initial setup code to create the database in C#/VB.</span></span>
- <span data-ttu-id="1f18d-235">Son adım çalıştırmaktır "veritabanını güncelleştir – betik" SQL betiğini oluşturan komut tabanlı üzerinde model sınıfları.</span><span class="sxs-lookup"><span data-stu-id="1f18d-235">The final step is to run "Update-Database –Script" command that generates the SQL script based on the model classes.</span></span>

[!INCLUDE[](../../../includes/identity/alter-command-exception.md)]

<span data-ttu-id="1f18d-236">Bu veritabanı oluşturma betiği burada size yeni sütunlar eklemek ve veri kopyalamak için ek değişiklikler yapmak bir başlangıç kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-236">This database generation script can be used as a start where we'll be making additional changes to add new columns and copy data.</span></span> <span data-ttu-id="1f18d-237">Bu avantajı, oluşturduğumuz olan `_MigrationHistory` EntityFramework tarafından değişiklik kimlik sürümleri gelecek sürümleri için model sınıfları veritabanı şemasını değiştirmek için kullanılan bir tablo.</span><span class="sxs-lookup"><span data-stu-id="1f18d-237">The advantage of this is that we generate the `_MigrationHistory` table which is used by EntityFramework to modify the database schema when the model classes change for future versions of Identity releases.</span></span>

<span data-ttu-id="1f18d-238">SQL üyelik kullanıcı bilgileri, diğer özellikler kimlik kullanıcı model sınıfında adlı e-posta ek olarak, parola denemesi, son oturum açma tarihi, son kilitleme tarihi vb. vardı. Bu yararlı bilgiler ve kimlik sistemi için devredilmesini kendisine istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="1f18d-238">The SQL membership user information had other properties in addition to the ones in the Identity user model class namely email, password attempts, last login date, last lock-out date etc. This is useful information and we would like it to be carried over to the Identity system.</span></span> <span data-ttu-id="1f18d-239">Bu ek özellikler kullanıcı modele ekleme ve bunları geri veritabanında tablo sütunlarını eşleme tarafından yapılabilir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-239">This can be done by adding additional properties to the user model and mapping them back to the table columns in the database.</span></span> <span data-ttu-id="1f18d-240">Bu sınıf ekleyerek alt sınıflara ayıran yapabiliriz `IdentityUser` modeli.</span><span class="sxs-lookup"><span data-stu-id="1f18d-240">We can do this by adding a class that subclasses the `IdentityUser` model.</span></span> <span data-ttu-id="1f18d-241">Bu özel bir sınıfa özellikleri ekleyin ve tablo oluştururken karşılık gelen sütun eklemek için SQL betiğini düzenleyin.</span><span class="sxs-lookup"><span data-stu-id="1f18d-241">We can add the properties to this custom class and edit the SQL script to add the corresponding columns when creating the table.</span></span> <span data-ttu-id="1f18d-242">Bu sınıfın kodu makalesinde daha ayrıntılı açıklanmıştır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-242">The code for this class is described further in the article.</span></span> <span data-ttu-id="1f18d-243">SQL komut dosyası oluşturmak için `AspnetUsers` yeni özellikler ekleme olacaktır sonra Tablo</span><span class="sxs-lookup"><span data-stu-id="1f18d-243">The SQL script for creating the `AspnetUsers` table after adding the new properties would be</span></span>

[!code-sql[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample1.sql)]

<span data-ttu-id="1f18d-244">Sonraki biz varolan bilgileri SQL üyelik veritabanından yeni eklenen tablolara kimliği kopyalamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-244">Next we need to copy the existing information from the SQL membership database to the newly added tables for Identity.</span></span> <span data-ttu-id="1f18d-245">Bu verileri doğrudan bir tablodan diğerine kopyalayarak SQL aracılığıyla yapılabilir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-245">This can be done through SQL by copying data directly from one table to another.</span></span> <span data-ttu-id="1f18d-246">Tablonun satırlarını veri eklemek için kullanırız `INSERT INTO [Table]` oluşturun.</span><span class="sxs-lookup"><span data-stu-id="1f18d-246">To add data into the rows of table, we use the `INSERT INTO [Table]` construct.</span></span> <span data-ttu-id="1f18d-247">Kullanabileceğiniz başka bir tabloya kopyalamak için `INSERT INTO` deyimi ile birlikte `SELECT` deyimi.</span><span class="sxs-lookup"><span data-stu-id="1f18d-247">To copy from another table we can use the `INSERT INTO` statement along with the `SELECT` statement.</span></span> <span data-ttu-id="1f18d-248">Sorgulamak için ihtiyacımız olan tüm kullanıcı bilgilerini almak için *aspnet\_kullanıcılar* ve *aspnet\_üyelik* tablolar ve veri kopyalama *AspNetUsers*tablo.</span><span class="sxs-lookup"><span data-stu-id="1f18d-248">To get all the user information we need to query the *aspnet\_Users* and *aspnet\_Membership* tables and copy the data to the *AspNetUsers* table.</span></span> <span data-ttu-id="1f18d-249">Kullandığımız `INSERT INTO` ve `SELECT` ile birlikte `JOIN` ve `LEFT OUTER JOIN` deyimleri.</span><span class="sxs-lookup"><span data-stu-id="1f18d-249">We use the `INSERT INTO` and `SELECT` along with `JOIN` and `LEFT OUTER JOIN` statements.</span></span> <span data-ttu-id="1f18d-250">Sorgulama ve tablolar arasında veri kopyalama hakkında daha fazla bilgi için [bu](https://technet.microsoft.com/library/ms190750%28v=sql.105%29.aspx) bağlantı.</span><span class="sxs-lookup"><span data-stu-id="1f18d-250">For more information about querying and copying data between tables, refer to [this](https://technet.microsoft.com/library/ms190750%28v=sql.105%29.aspx) link.</span></span> <span data-ttu-id="1f18d-251">İçin varsayılan eşlemeleri SQL üyelik hiçbir bilgi olduğundan ayrıca AspnetUserLogins ve AspnetUserClaims tablolar için boştur.</span><span class="sxs-lookup"><span data-stu-id="1f18d-251">Additionally the AspnetUserLogins and AspnetUserClaims tables are empty to begin with since there is no information in SQL membership that maps to this by default.</span></span> <span data-ttu-id="1f18d-252">Kopyalanan yalnızca kullanıcılar ve roller için bilgilerdir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-252">The only information copied is for users and roles.</span></span> <span data-ttu-id="1f18d-253">Önceki adımlarda oluşturduğunuz proje için SQL sorgu bilgileri kullanıcılar tabloya kopyalamak için olacaktır</span><span class="sxs-lookup"><span data-stu-id="1f18d-253">For the project created in the previous steps, the SQL query to copy information to the users table would be</span></span>

[!code-sql[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample2.sql)]

<span data-ttu-id="1f18d-254">Yukarıdaki SQL deyiminde, her kullanıcı hakkında bilgi *aspnet\_kullanıcılar* ve *aspnet\_üyelik* tabloları, sütunları kopyalanır  *AspnetUsers* tablo.</span><span class="sxs-lookup"><span data-stu-id="1f18d-254">In the above SQL statement, information about each user from the *aspnet\_Users* and *aspnet\_Membership* tables is copied into the columns of the *AspnetUsers* table.</span></span> <span data-ttu-id="1f18d-255">Biz parola kopyaladığınızda, burada yapılır yalnızca değişikliktir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-255">The only modification done here is when we copy the password.</span></span> <span data-ttu-id="1f18d-256">SQL üyelik parolalar için şifreleme algoritması 'PasswordSalt' ve 'PasswordFormat' kullandığından, bu parolanın şifresini çözmek için kimlik kullanılabilir, böylece biz, çok karma hale getirilen parolayla birlikte kopyalayın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-256">Since the encryption algorithm for passwords in SQL membership used 'PasswordSalt' and 'PasswordFormat', we copy that too along with the hashed password so that it can be used to decrypt the password by Identity.</span></span> <span data-ttu-id="1f18d-257">Bu özel parola karma değeri Oluşturucusu yakalarken makalesinde daha ayrıntılı açıklanmıştır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-257">This is explained further in the article when hooking up a custom password hasher.</span></span>

<span data-ttu-id="1f18d-258">Bu komut dosyası, bu örnek için özeldir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-258">This script file is specific to this sample.</span></span> <span data-ttu-id="1f18d-259">Ek tablolar olan uygulamalar için geliştiricilerin kullanıcı model sınıfı ek özellikleri ekleyin ve bunları AspnetUsers tablosundaki sütunlara eşlemek için benzer bir yaklaşım takip edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="1f18d-259">For applications which have additional tables, developers can follow a similar approach to add additional properties on the user model class and map them to columns in the AspnetUsers table.</span></span> <span data-ttu-id="1f18d-260">Betiği çalıştırmak için</span><span class="sxs-lookup"><span data-stu-id="1f18d-260">To run the script,</span></span>

1. <span data-ttu-id="1f18d-261">Sunucu Gezgini açın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-261">Open Server Explorer.</span></span> <span data-ttu-id="1f18d-262">Tabloları görüntülenecek 'ApplicationServices' bağlantı genişletin.</span><span class="sxs-lookup"><span data-stu-id="1f18d-262">Expand the 'ApplicationServices' connection to display the tables.</span></span> <span data-ttu-id="1f18d-263">Tablolar düğümü üzerinde sağ tıklayın ve 'Yeni sorgu' seçeneğini belirleyin</span><span class="sxs-lookup"><span data-stu-id="1f18d-263">Right click on the Tables node and select the 'New Query' option</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image7.png)
2. <span data-ttu-id="1f18d-264">Sorgu penceresine kopyalayın ve Migrations.sql dosyasındaki tüm SQL betiğini yapıştırın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-264">In the query window, copy and paste the entire SQL script from the Migrations.sql file.</span></span> <span data-ttu-id="1f18d-265">'Execute' okunu tuşlarına basarak komut dosyasını çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-265">Run the script file by hitting the 'Execute' arrow button.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image4.jpg)

    <span data-ttu-id="1f18d-266">Sunucu Gezgini penceresini yenileyin.</span><span class="sxs-lookup"><span data-stu-id="1f18d-266">Refresh the Server Explorer window.</span></span> <span data-ttu-id="1f18d-267">Beş yeni tablolar veritabanında oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="1f18d-267">Five new tables are created in the database.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image8.png)

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image9.png)

    <span data-ttu-id="1f18d-268">SQL üyelik sistemi tabloları bilgileri için yeni kimlik sistemi eşlendi nasıl aşağıdadır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-268">Below is how the information in the SQL membership tables are mapped to the new Identity system.</span></span>

    <span data-ttu-id="1f18d-269">ASP.NET\_rolleri--&gt; AspNetRoles</span><span class="sxs-lookup"><span data-stu-id="1f18d-269">aspnet\_Roles --&gt; AspNetRoles</span></span>

    <span data-ttu-id="1f18d-270">ASP\_netUsers ve asp\_netMembership--&gt; AspNetUsers</span><span class="sxs-lookup"><span data-stu-id="1f18d-270">asp\_netUsers and asp\_netMembership --&gt; AspNetUsers</span></span>

    <span data-ttu-id="1f18d-271">aspnet\_UserInRoles --&gt; AspNetUserRoles</span><span class="sxs-lookup"><span data-stu-id="1f18d-271">aspnet\_UserInRoles --&gt; AspNetUserRoles</span></span>

    <span data-ttu-id="1f18d-272">Yukarıdaki bölümde açıklandığı gibi AspNetUserClaims ve AspNetUserLogins tabloları boştur.</span><span class="sxs-lookup"><span data-stu-id="1f18d-272">As explained in the above section, the AspNetUserClaims and AspNetUserLogins tables are empty.</span></span> <span data-ttu-id="1f18d-273">AspNetUser tablosunda bulunan 'Ayrıştırıcı' alanının bir sonraki adım tanımlanan model sınıfı adı eşleşmelidir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-273">The 'Discriminator' field in the AspNetUser table should match the model class name which is defined as a next step.</span></span> <span data-ttu-id="1f18d-274">Ayrıca PasswordHash sütun biçiminde değilse ' şifreli parola | parola güvenlik değerini | parola biçimi '.</span><span class="sxs-lookup"><span data-stu-id="1f18d-274">Also the PasswordHash column is in the form 'encrypted password |password salt|password format'.</span></span> <span data-ttu-id="1f18d-275">Bu özel SQL üyelik şifre mantıksal eski parolaları yeniden kullanmanıza olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="1f18d-275">This enables you to use special SQL membership crypto logic so that you can reuse old passwords.</span></span> <span data-ttu-id="1f18d-276">Bu makalenin sonraki bölümlerinde açıklanan.</span><span class="sxs-lookup"><span data-stu-id="1f18d-276">That is explained in later in the article.</span></span>

### <a name="creating-models-and-membership-pages"></a><span data-ttu-id="1f18d-277">Modelleri ve üyelik sayfaları oluşturma</span><span class="sxs-lookup"><span data-stu-id="1f18d-277">Creating models and membership pages</span></span>

<span data-ttu-id="1f18d-278">Daha önce bahsedildiği gibi kimlik özelliği varsayılan olarak hesap bilgilerini depolamak için veritabanı konuşmak için Entity Framework kullanır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-278">As mentioned earlier, the Identity feature uses Entity Framework to talk to the database for storing account information by default.</span></span> <span data-ttu-id="1f18d-279">Tablodaki mevcut verilerle çalışmak için size geri tablolara eşleme ve kimlik sistemi içinde takma model sınıfları oluşturmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-279">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="1f18d-280">Kimlik sözleşmesinin bir parçası olarak model sınıfları Identity.Core dll içinde tanımlanan arabirimleri ya da uygulamanız gerekir veya Microsoft.ASPNET.Identity.entityframework içinde kullanılabilen bu arabirimlerin mevcut uygulamasına genişletebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="1f18d-280">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span>

<span data-ttu-id="1f18d-281">Örneğimizde AspNetRoles, AspNetUserClaims AspNetLogins ve AspNetUserRole tabloları kimlik sisteminin mevcut bir uygulamasına benzer bir sütun vardır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-281">In our sample, the AspNetRoles, AspNetUserClaims, AspNetLogins and AspNetUserRole tables have columns that are similar to the existing implementation of the Identity system.</span></span> <span data-ttu-id="1f18d-282">Bu nedenle Biz bu tablolara eşlemek için var olan sınıfları yeniden kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="1f18d-282">Hence we can reuse the existing classes to map to these tables.</span></span> <span data-ttu-id="1f18d-283">Ek SQL üyelik sistemi tabloları bilgileri depolamak için kullanılan bazı ek sütunlar AspNetUser tablo vardır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-283">The AspNetUser table has some additional columns which are used to store additional information from the SQL membership tables.</span></span> <span data-ttu-id="1f18d-284">Bu, mevcut 'IdentityUser' uygulamasını genişleten ve ek özellikleri ekleyin bir model sınıfı oluşturarak eşlenebilir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-284">This can be mapped by creating a model class that extend the existing implementation of 'IdentityUser' and add the additional properties.</span></span>

1. <span data-ttu-id="1f18d-285">Modeller klasörü projesi oluşturun ve kullanıcı bir sınıf ekleyin.</span><span class="sxs-lookup"><span data-stu-id="1f18d-285">Create a Models folder in the project and add a class User.</span></span> <span data-ttu-id="1f18d-286">Sınıf adı 'AspnetUsers' tablosunun 'Ayrıştırıcı' sütununa eklenen veriler eşleşmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-286">The name of the class should match the data added in the 'Discriminator' column of 'AspnetUsers' table.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image10.png)

    <span data-ttu-id="1f18d-287">Kullanıcı sınıfı bulundu IdentityUser sınıfı genişletmelidir *Microsoft.ASPNET.Identity.entityframework* dll.</span><span class="sxs-lookup"><span data-stu-id="1f18d-287">The User class should extend the IdentityUser class found in the *Microsoft.AspNet.Identity.EntityFramework* dll.</span></span> <span data-ttu-id="1f18d-288">AspNetUser sütunlara eşlemek sınıfı özelliklerinde bildirin.</span><span class="sxs-lookup"><span data-stu-id="1f18d-288">Declare the properties in class that map back to the AspNetUser columns.</span></span> <span data-ttu-id="1f18d-289">Özellikler kimliği, kullanıcı adı, PasswordHash ve SecurityStamp IdentityUser içinde tanımlanan ve bu nedenle göz ardı edilir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-289">The properties ID, Username, PasswordHash and SecurityStamp are defined in the IdentityUser and so are omitted.</span></span> <span data-ttu-id="1f18d-290">Aşağıda tüm özelliklere sahip kullanıcı sınıfın kodu verilmiştir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-290">Below is the code for the User class that has all the properties</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample3.cs)]
2. <span data-ttu-id="1f18d-291">Entity Framework DbContext sınıfına modelleri doldurmak tablolarından verileri alın ve kalıcı verileri tablolara geri modelleri için gereklidir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-291">An Entity Framework DbContext class is required in order to persist data in models back to tables and retrieve data from tables to populate the models.</span></span> <span data-ttu-id="1f18d-292">*Microsoft.AspNet.Identity.EntityFramework* dll defines the IdentityDbContext class which interacts with the Identity tables to retrieve and store information.</span><span class="sxs-lookup"><span data-stu-id="1f18d-292">*Microsoft.AspNet.Identity.EntityFramework* dll defines the IdentityDbContext class which interacts with the Identity tables to retrieve and store information.</span></span> <span data-ttu-id="1f18d-293">Identitydbcontext&lt;tuser&gt; IdentityUser sınıfını genişleten bir sınıfı olan 'TUser' sınıfı alır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-293">The IdentityDbContext&lt;tuser&gt; takes a 'TUser' class which can be any class that extends the IdentityUser class.</span></span>

    <span data-ttu-id="1f18d-294">1. adımda oluşturduğunuz 'User' sınıfında geçirme 'Model' klasörü altında Identitydbcontext genişleten ApplicationDBContext yeni bir sınıf oluşturun</span><span class="sxs-lookup"><span data-stu-id="1f18d-294">Create a new class ApplicationDBContext that extends IdentityDbContext under the 'Models' folder, passing in the 'User' class created in step 1</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample4.cs)]
3. <span data-ttu-id="1f18d-295">Kullanıcı Yönetimi yeni kimlik sisteminde yapılır UserManager kullanarak&lt;tuser&gt; sınıfı içinde tanımlanan *Microsoft.ASPNET.Identity.entityframework* dll.</span><span class="sxs-lookup"><span data-stu-id="1f18d-295">User management in the new Identity system is done using the UserManager&lt;tuser&gt; class defined in the *Microsoft.AspNet.Identity.EntityFramework* dll.</span></span> <span data-ttu-id="1f18d-296">1. adımda oluşturduğunuz 'User' sınıfında geçirme UserManager, genişleten özel bir sınıf oluşturmak ihtiyacımız var.</span><span class="sxs-lookup"><span data-stu-id="1f18d-296">We need to create a custom class that extends UserManager, passing in the 'User' class created in step 1.</span></span>

    <span data-ttu-id="1f18d-297">Modelleri klasöründe yeni bir sınıf UserManager genişleten UserManager oluşturun&lt;kullanıcı&gt;</span><span class="sxs-lookup"><span data-stu-id="1f18d-297">In the Models folder create a new class UserManager that extends UserManager&lt;user&gt;</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample5.cs)]
4. <span data-ttu-id="1f18d-298">Kullanıcıların uygulama parolaları şifrelenir ve veritabanında depolanır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-298">The passwords of the users of the application are encrypted and stored in the database.</span></span> <span data-ttu-id="1f18d-299">SQL üyelik kullanılan şifreleme algoritması, yeni kimlik sistemi bir farklıdır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-299">The crypto algorithm used in SQL membership is different from the one in the new Identity system.</span></span> <span data-ttu-id="1f18d-300">Eski parola yeniden kullanmak için yeni kullanıcılar için kimlik şifreleme algoritması kullanırken SQL üyeliklerini algoritması kullanarak eski kullanıcılar oturum açtığında, seçmeli olarak parolaların şifreleri çözülemiyor ihtiyacımız var.</span><span class="sxs-lookup"><span data-stu-id="1f18d-300">To reuse old passwords we need to selectively decrypt passwords when old users log in using the SQL memberships algorithm while using the crypto algorithm in Identity for the new users.</span></span>

    <span data-ttu-id="1f18d-301">UserManager sınıfı bir '' IPasswordHasher' arabirimini uygulayan bir sınıf örneği depolayan PasswordHasher' özelliği var.</span><span class="sxs-lookup"><span data-stu-id="1f18d-301">The UserManager class has a property 'PasswordHasher' which stores an instance of a class that implements the 'IPasswordHasher' interface.</span></span> <span data-ttu-id="1f18d-302">Bu, şifreleme/parolalar kullanıcı kimlik doğrulama işlemleri sırasında şifre çözme için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-302">This is used to encrypt/decrypt passwords during user authentication transactions.</span></span> <span data-ttu-id="1f18d-303">Adım 3'te tanımlanan UserManager sınıfında, yeni bir oluşturma sınıf SQLPasswordHasher ve kopyalama kod aşağıda.</span><span class="sxs-lookup"><span data-stu-id="1f18d-303">In the UserManager class defined in step 3, create a new class SQLPasswordHasher and copy the below code.</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample6.cs)]

    <span data-ttu-id="1f18d-304">System.Text ve System.Security.Cryptography ad alanlarını içeri aktararak derleme hataları giderin.</span><span class="sxs-lookup"><span data-stu-id="1f18d-304">Resolve the compilation errors by importing the System.Text and System.Security.Cryptography namespaces.</span></span>

    <span data-ttu-id="1f18d-305">Varsayılan SQL üyelik şifreleme uygulama göre parola EncodePassword yöntemi şifreler.</span><span class="sxs-lookup"><span data-stu-id="1f18d-305">The EncodePassword method encrypts the password according to the default SQL membership crypto implementation.</span></span> <span data-ttu-id="1f18d-306">Bu System.Web dll dosyasından alınır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-306">This is taken from the System.Web dll.</span></span> <span data-ttu-id="1f18d-307">Yansıtılan eski uygulamayı özel bir uygulama buraya kullandıysanız.</span><span class="sxs-lookup"><span data-stu-id="1f18d-307">If the old app used a custom implementation then it should be reflected here.</span></span> <span data-ttu-id="1f18d-308">İki diğer yöntemleri tanımlamak ihtiyacımız *HashPassword* ve *VerifyHashedPassword* kullanan *EncodePassword* verilen parola karma ya da bir düz metin doğrulamak için yöntemi Parola, bir veritabanında mevcut.</span><span class="sxs-lookup"><span data-stu-id="1f18d-308">We need to define two other methods *HashPassword* and *VerifyHashedPassword* that use the *EncodePassword* method to hash a given password or verify a plain text password with the one existing in the database.</span></span>

    <span data-ttu-id="1f18d-309">SQL üyelik sistemini kaydetme veya parola değiştirmesini kullanıcılar tarafından girilen parolanın karma hale PasswordHash ve PasswordSalt PasswordFormat kullanılır.</span><span class="sxs-lookup"><span data-stu-id="1f18d-309">The SQL membership system used PasswordHash, PasswordSalt and PasswordFormat to hash the password entered by users when they register or change their password.</span></span> <span data-ttu-id="1f18d-310">Geçiş sırasında üç alanın tümü PasswordHash sütun ayrılmış AspNetUser tablosunda depolanır ' |' karakter.</span><span class="sxs-lookup"><span data-stu-id="1f18d-310">During the migration all the three fields are stored in the PasswordHash column in the AspNetUser table separated by the '|' character.</span></span> <span data-ttu-id="1f18d-311">Bir kullanıcının oturum açması ve bu alanlar parola olduğunda SQL üyelik şifreleme parolasını denetlemek için kullanıyoruz; Aksi takdirde kimlik sisteminin varsayılan şifreleme parolayı doğrulamak için kullanırız.</span><span class="sxs-lookup"><span data-stu-id="1f18d-311">When a user logs in and the password has these fields, we use the SQL membership crypto to check the password; otherwise we use the Identity system's default crypto to verify the password.</span></span> <span data-ttu-id="1f18d-312">Bu şekilde eski kullanıcılar uygulamayı geçirildikten sonra parolalarını değiştirmesi girmesi gerekmez.</span><span class="sxs-lookup"><span data-stu-id="1f18d-312">This way old users would not have to change their passwords once the app is migrated.</span></span>
5. <span data-ttu-id="1f18d-313">UserManager sınıf için oluşturucu bildirin ve bu özelliğine oluşturucu içinde SQLPasswordHasher geçirin.</span><span class="sxs-lookup"><span data-stu-id="1f18d-313">Declare the constructor for the UserManager class and pass this as the SQLPasswordHasher to the property in the constructor.</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample7.cs)]

### <a name="create-new-account-management-pages"></a><span data-ttu-id="1f18d-314">Yeni hesap yönetim sayfaları oluşturma</span><span class="sxs-lookup"><span data-stu-id="1f18d-314">Create new account management pages</span></span>

<span data-ttu-id="1f18d-315">Geçişin sonraki adım, bir kullanıcı kayıt ve oturum açma sağlayacaktır hesabı yönetim sayfaları eklemektir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-315">The next step in the migration is to add account management pages that will let a user register and log in.</span></span> <span data-ttu-id="1f18d-316">Eski SQL üyelik hesabı sayfalarından yeni kimlik sistemi ile çalışmayan denetimleri kullanın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-316">The old account pages from SQL membership use controls that don't work with the new Identity system.</span></span> <span data-ttu-id="1f18d-317">Yeni kullanıcı eklemek için yönetim sayfaları öğreticiye bu bağlantıyı izleyin [ https://www.asp.net/identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project ](../getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project.md) 'Web Forms, uygulamanızın kullanıcılara kayıt ekleme' adım'dan başlayan biz zaten proje oluşturuldu ve NuGet eklendi paketler.</span><span class="sxs-lookup"><span data-stu-id="1f18d-317">To add the new user management pages follow the tutorial at this link [https://www.asp.net/identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project](../getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project.md) starting from the step 'Adding Web Forms for registering users to your application' since we have already created the project and added the NuGet packages.</span></span>

<span data-ttu-id="1f18d-318">Biz burada sahibiz projesiyle çalışma üzere bazı değişiklikler yapmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-318">We need to make some changes for the sample to work with the project we have here.</span></span>

- <span data-ttu-id="1f18d-319">Arkasındaki sınıfları kullanın Register.aspx.cs ve Login.aspx.cs kod `UserManager` kimlik paketlerinden bir kullanıcı oluşturun.</span><span class="sxs-lookup"><span data-stu-id="1f18d-319">The Register.aspx.cs and Login.aspx.cs code behind classes use the `UserManager` from the Identity packages to create a User.</span></span> <span data-ttu-id="1f18d-320">Bu örnek için daha önce bahsedilen adımları izleyerek modelleri klasöre eklenen UserManager kullanın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-320">For this example use the UserManager added in the Models folder by following the steps mentioned earlier.</span></span>
- <span data-ttu-id="1f18d-321">Oluşturulan sınıflar arkasındaki Register.aspx.cs ve Login.aspx.cs kodda IdentityUser yerine kullanıcı sınıfı kullanın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-321">Use the User class created instead of the IdentityUser in Register.aspx.cs and Login.aspx.cs code behind classes.</span></span> <span data-ttu-id="1f18d-322">Bu bizim özel kullanıcı sınıfında kimlik sistemine kancaları.</span><span class="sxs-lookup"><span data-stu-id="1f18d-322">This hooks in our custom user class into the Identity system.</span></span>
- <span data-ttu-id="1f18d-323">Veritabanını oluşturmak için bu bölümü atlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="1f18d-323">The part to create the database can be skipped.</span></span>
- <span data-ttu-id="1f18d-324">Geliştirici, geçerli uygulama kimliği eşleştirmek için yeni kullanıcı için ApplicationId ayarlaması gerekiyor</span><span class="sxs-lookup"><span data-stu-id="1f18d-324">The developer needs to set the ApplicationId for the new user to match the current application ID.</span></span> <span data-ttu-id="1f18d-325">Bu bir kullanıcı nesnesi Register.aspx.cs sınıfında oluşturulmadan önce bu uygulama için ApplicationId sorgulama ve kullanıcı oluşturmadan önce ayarı tarafından yapılabilir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-325">This can be done by querying the ApplicationId for this application before a user object is created in the Register.aspx.cs class and setting it before creating user.</span></span>

    <span data-ttu-id="1f18d-326">Örnek:</span><span class="sxs-lookup"><span data-stu-id="1f18d-326">Example:</span></span>

    <span data-ttu-id="1f18d-327">Register.aspx.cs sayfasında aspnet sorgulamak için bir yöntem tanımlayın\_uygulamaları tablo ve uygulama adına göre uygulama kimliği alma</span><span class="sxs-lookup"><span data-stu-id="1f18d-327">Define a method in Register.aspx.cs page to query the aspnet\_Applications table and get the application Id according to application name</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample8.cs)]

    <span data-ttu-id="1f18d-328">Artık bu kullanıcı nesnesinde ayarlanan</span><span class="sxs-lookup"><span data-stu-id="1f18d-328">Now get set this on the user object</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample9.cs)]

<span data-ttu-id="1f18d-329">Mevcut bir kullanıcının oturum açmak için eski kullanıcı adı ve parolayı kullanın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-329">Use the old username and password to login an existing user.</span></span> <span data-ttu-id="1f18d-330">Kayıt sayfasını yeni bir kullanıcı oluşturmak için kullanın.</span><span class="sxs-lookup"><span data-stu-id="1f18d-330">Use the Register page to create a new user.</span></span> <span data-ttu-id="1f18d-331">Ayrıca kullanıcıların rollerini beklendiği gibi olduğundan emin olun.</span><span class="sxs-lookup"><span data-stu-id="1f18d-331">Also verify that the users are in roles as expected.</span></span>

<span data-ttu-id="1f18d-332">Kimlik sistemi için taşıma açık kimlik doğrulaması (OAuth) için uygulama ekleme kullanıcı yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="1f18d-332">Porting to the Identity system helps the user add Open Authentication (OAuth) to the application.</span></span> <span data-ttu-id="1f18d-333">Lütfen örneğe bakın [burada](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SQLMembership-Identity-OWIN/) etkin olduğu.</span><span class="sxs-lookup"><span data-stu-id="1f18d-333">Please refer to the sample [here](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SQLMembership-Identity-OWIN/) which has OAuth enabled.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1f18d-334">Sonraki Adımlar</span><span class="sxs-lookup"><span data-stu-id="1f18d-334">Next Steps</span></span>

<span data-ttu-id="1f18d-335">Bu öğreticide, biz kullanıcıların SQL üyeliğinden ASP.NET ıdentity'ye bağlantı noktasına nasıl oluşturulacağını gösterir, ancak biz profil verilerini bağlantı olmadı.</span><span class="sxs-lookup"><span data-stu-id="1f18d-335">In this tutorial we showed how to port users from SQL membership to ASP.NET Identity, but we didn't port Profile data.</span></span> <span data-ttu-id="1f18d-336">Sonraki öğreticide yeni kimlik sistemi için profil verileri SQL üyeliğinden taşıma içine inceleyeceğiz.</span><span class="sxs-lookup"><span data-stu-id="1f18d-336">In the next tutorial we'll look into porting Profile data from SQL membership to the new Identity system.</span></span>

<span data-ttu-id="1f18d-337">Bu makalenin alt kısmındaki geri bildirim bırakabilir.</span><span class="sxs-lookup"><span data-stu-id="1f18d-337">You can leave feedback at the bottom of this article.</span></span>

<span data-ttu-id="1f18d-338">*Tom Dykstra ve Rick Anderson, makaleyi gözden geçirme için teşekkür ederiz.*</span><span class="sxs-lookup"><span data-stu-id="1f18d-338">*Thanks to Tom Dykstra and Rick Anderson for reviewing the article.*</span></span>
