---
uid: mvc/overview/security/preventing-open-redirection-attacks
title: Açık yeniden yönlendirme saldırılarını önlerC#() | Microsoft Docs
author: jongalloway
description: Bu öğreticide, ASP.NET MVC uygulamalarınızda açık yeniden yönlendirme saldırılarını nasıl engelleyebileceğiniz açıklanır. Bu öğreticide yapılan değişiklikler anlatılmaktadır...
ms.author: riande
ms.date: 02/27/2014
ms.assetid: 69fb02e0-f5b7-4c35-878c-fa87164fc785
msc.legacyurl: /mvc/overview/security/preventing-open-redirection-attacks
msc.type: authoredcontent
ms.openlocfilehash: cfa635d4fd14d031993c5b452325cbe334f82dc2
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78538173"
---
# <a name="preventing-open-redirection-attacks-c"></a><span data-ttu-id="a7892-104">Açık Yeniden Yönlendirme Saldırılarını Önleme (C#)</span><span class="sxs-lookup"><span data-stu-id="a7892-104">Preventing Open Redirection Attacks (C#)</span></span>

<span data-ttu-id="a7892-105">[Jon Galloway](https://github.com/jongalloway) tarafından</span><span class="sxs-lookup"><span data-stu-id="a7892-105">by [Jon Galloway](https://github.com/jongalloway)</span></span>

> <span data-ttu-id="a7892-106">Bu öğreticide, ASP.NET MVC uygulamalarınızda açık yeniden yönlendirme saldırılarını nasıl engelleyebileceğiniz açıklanır.</span><span class="sxs-lookup"><span data-stu-id="a7892-106">This tutorial explains how you can prevent open redirection attacks in your ASP.NET MVC applications.</span></span> <span data-ttu-id="a7892-107">Bu öğreticide, ASP.NET MVC 3 ' teki AccountController 'da yapılmış değişiklikler ele alınmaktadır ve bu değişiklikleri var olan ASP.NET MVC 1,0 ve 2 uygulamalarınıza nasıl uygulayabileceğinizi gösterir.</span><span class="sxs-lookup"><span data-stu-id="a7892-107">This tutorial discusses the changes that have been made in the AccountController in ASP.NET MVC 3 and demonstrates how you can apply these changes in your existing ASP.NET MVC 1.0 and 2 applications.</span></span>

## <a name="what-is-an-open-redirection-attack"></a><span data-ttu-id="a7892-108">Açık yeniden yönlendirme saldırısı nedir?</span><span class="sxs-lookup"><span data-stu-id="a7892-108">What is an Open Redirection Attack?</span></span>

<span data-ttu-id="a7892-109">QueryString veya form verileri gibi istek aracılığıyla belirtilen bir URL 'ye yeniden yönlendiren herhangi bir Web uygulaması, kullanıcıları harici, kötü amaçlı bir URL 'ye yönlendirmek için ile oynanmış olabilir.</span><span class="sxs-lookup"><span data-stu-id="a7892-109">Any web application that redirects to a URL that is specified via the request such as the querystring or form data can potentially be tampered with to redirect users to an external, malicious URL.</span></span> <span data-ttu-id="a7892-110">Bu değişikliklere açık yeniden yönlendirme saldırısı denir.</span><span class="sxs-lookup"><span data-stu-id="a7892-110">This tampering is called an open redirection attack.</span></span>

<span data-ttu-id="a7892-111">Uygulamanızın mantığı belirtilen bir URL 'ye yeniden yönlendirdiğinde, yeniden yönlendirme URL 'sinin değiştirilmediğini doğrulamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="a7892-111">Whenever your application logic redirects to a specified URL, you must verify that the redirection URL hasn't been tampered with.</span></span> <span data-ttu-id="a7892-112">Hem ASP.NET MVC 1,0 hem de ASP.NET MVC 2 için varsayılan AccountController 'da kullanılan oturum açma yeniden yönlendirme saldırılarına karşı savunmasızdır.</span><span class="sxs-lookup"><span data-stu-id="a7892-112">The login used in the default AccountController for both ASP.NET MVC 1.0 and ASP.NET MVC 2 is vulnerable to open redirection attacks.</span></span> <span data-ttu-id="a7892-113">Neyse ki, ASP.NET MVC 3 önizlemesindeki düzeltmeleri kullanmak için mevcut uygulamalarınızı güncelleştirmek kolaydır.</span><span class="sxs-lookup"><span data-stu-id="a7892-113">Fortunately, it is easy to update your existing applications to use the corrections from the ASP.NET MVC 3 Preview.</span></span>

<span data-ttu-id="a7892-114">Güvenlik açığını anlamak için, varsayılan ASP.NET MVC 2 Web uygulaması projesinde oturum açmanın nasıl çalıştığına bakalım.</span><span class="sxs-lookup"><span data-stu-id="a7892-114">To understand the vulnerability, let's look at how the login redirection works in a default ASP.NET MVC 2 Web Application project.</span></span> <span data-ttu-id="a7892-115">Bu uygulamada, [Yetkilendir] özniteliğine sahip bir denetleyici eylemi ziyaret edilmeye çalışılması yetkisiz kullanıcıları/Account/LogOn görünümüne yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="a7892-115">In this application, attempting to visit a controller action that has the [Authorize] attribute will redirect unauthorized users to the /Account/LogOn view.</span></span> <span data-ttu-id="a7892-116">Bu/Account/LogOn öğesine yeniden yönlendirme, kullanıcının başarıyla oturum açtıktan sonra ilk olarak istenen URL 'ye dönebilmesi için bir returnUrl QueryString parametresi içerir.</span><span class="sxs-lookup"><span data-stu-id="a7892-116">This redirect to /Account/LogOn will include a returnUrl querystring parameter so that the user can be returned to the originally requested URL after they have successfully logged in.</span></span>

<span data-ttu-id="a7892-117">Aşağıdaki ekran görüntüsünde, oturum açmamadığında/Account/ChangePassword görünümüne erişme denemesinin,/Account/LogOn ' a yeniden yönlendirmeye neden olduğunu görebiliriz? ReturnUrl =% 2fAccount% 2fChangePassword% 2F.</span><span class="sxs-lookup"><span data-stu-id="a7892-117">In the screenshot below, we can see that an attempt to access the /Account/ChangePassword view when not logged in results in a redirect to /Account/LogOn?ReturnUrl=%2fAccount%2fChangePassword%2f.</span></span>

[![](preventing-open-redirection-attacks/_static/image2.png)](preventing-open-redirection-attacks/_static/image1.png)

<span data-ttu-id="a7892-118">**Şekil 01**: açık bir yeniden yönlendirme ile oturum açma sayfası</span><span class="sxs-lookup"><span data-stu-id="a7892-118">**Figure 01**: Login page with an open redirection</span></span>

<span data-ttu-id="a7892-119">ReturnUrl QueryString parametresi doğrulanmamış olduğundan, bir saldırgan, bir açık yeniden yönlendirme saldırısı gerçekleştirmek üzere parametreye herhangi bir URL adresi eklemek için bunu değiştirebilir.</span><span class="sxs-lookup"><span data-stu-id="a7892-119">Since the ReturnUrl querystring parameter is not validated, an attacker can modify it to inject any URL address into the parameter to conduct an open redirection attack.</span></span> <span data-ttu-id="a7892-120">Bunu göstermek için, ReturnUrl parametresini [http://bing.com](http://bing.com)olarak değiştirebiliriz. bu nedenle, sonuçta elde edilen oturum açma URL 'si/Account/LogOn olacaktır. ReturnUrl =<http://www.bing.com/>.</span><span class="sxs-lookup"><span data-stu-id="a7892-120">To demonstrate this, we can modify the ReturnUrl parameter to [http://bing.com](http://bing.com), so the resulting login URL will be /Account/LogOn?ReturnUrl=<http://www.bing.com/>.</span></span> <span data-ttu-id="a7892-121">Sitede başarıyla oturum açtıktan sonra [http://bing.com](http://bing.com)'a yönlendirilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a7892-121">Upon successfully logging in to the site, we are redirected to [http://bing.com](http://bing.com).</span></span> <span data-ttu-id="a7892-122">Bu yeniden yönlendirme doğrulanmaz, bunun yerine kullanıcıyı ikna eden bir kötü amaçlı siteyi işaret edebilir.</span><span class="sxs-lookup"><span data-stu-id="a7892-122">Since this redirection is not validated, it could instead point to a malicious site that attempts to trick the user.</span></span>

### <a name="a-more-complex-open-redirection-attack"></a><span data-ttu-id="a7892-123">Daha karmaşık bir açık yeniden yönlendirme saldırısı</span><span class="sxs-lookup"><span data-stu-id="a7892-123">A more complex Open Redirection Attack</span></span>

<span data-ttu-id="a7892-124">Açık yeniden yönlendirme saldırıları özellikle tehlikelidir çünkü bir saldırgan, belirli bir Web sitesinde oturum açmaya çalıştığımız bir [kimlik avı saldırısından](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx)etkilenmenizi sağlar.</span><span class="sxs-lookup"><span data-stu-id="a7892-124">Open redirection attacks are especially dangerous because an attacker knows that we're trying to log into a specific website, which makes us vulnerable to a [phishing attack](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span></span> <span data-ttu-id="a7892-125">Örneğin, bir saldırgan, parolalarını yakalama girişiminde Web sitesi kullanıcılarına kötü amaçlı e-postalar gönderebilir.</span><span class="sxs-lookup"><span data-stu-id="a7892-125">For example, an attacker could send malicious emails to website users in an attempt to capture their passwords.</span></span> <span data-ttu-id="a7892-126">Bu, Nerdakşam yemeği sitesinde nasıl çalıştığınızın bir bakalım.</span><span class="sxs-lookup"><span data-stu-id="a7892-126">Let's look at how this would work on the NerdDinner site.</span></span> <span data-ttu-id="a7892-127">(Canlı Nerdakşam yemeği sitesinin açık yeniden yönlendirme saldırılarına karşı koruma için güncelleştirildiğini unutmayın.)</span><span class="sxs-lookup"><span data-stu-id="a7892-127">(Note that the live NerdDinner site has been updated to protect against open redirection attacks.)</span></span>

<span data-ttu-id="a7892-128">İlk olarak bir saldırgan, sahte sayfasına yeniden yönlendirme içeren Nerdakşam yemeği ' de oturum açma sayfasına bir bağlantı gönderir:</span><span class="sxs-lookup"><span data-stu-id="a7892-128">First, an attacker sends us a link to the login page on NerdDinner that includes a redirect to their forged page:</span></span>

[http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn](http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn)

<span data-ttu-id="a7892-129">Dönüş URL 'sinin nerddiner.com 'e işaret ettiğini ve bu akşam yemeği sözcüğünün "n" eksik olduğunu unutmayın.</span><span class="sxs-lookup"><span data-stu-id="a7892-129">Note that the return URL points to nerddiner.com, which is missing an "n" from the word dinner.</span></span> <span data-ttu-id="a7892-130">Bu örnekte, bu, saldırganın denetlediği bir etki alanıdır.</span><span class="sxs-lookup"><span data-stu-id="a7892-130">In this example, this is a domain that the attacker controls.</span></span> <span data-ttu-id="a7892-131">Yukarıdaki bağlantıya erişirken, meşru NerdDinner.com oturum açma sayfasına yönlendirilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a7892-131">When we access the above link, we're taken to the legitimate NerdDinner.com login page.</span></span>

[![](preventing-open-redirection-attacks/_static/image4.png)](preventing-open-redirection-attacks/_static/image3.png)

<span data-ttu-id="a7892-132">**Şekil 02**: açık bir yeniden yönlendirme ile nerdakşam yemeği oturum açma sayfası</span><span class="sxs-lookup"><span data-stu-id="a7892-132">**Figure 02**: NerdDinner login page with an open redirection</span></span>

<span data-ttu-id="a7892-133">Doğru oturum açdığımızda, ASP.NET MVC AccountController 'ın oturum açma eylemi, bizurl QueryString parametresinde belirtilen URL 'ye yeniden yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="a7892-133">When we correctly log in, the ASP.NET MVC AccountController's LogOn action redirects us to the URL specified in the returnUrl querystring parameter.</span></span> <span data-ttu-id="a7892-134">Bu durumda, saldırganın girdiği, [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn)bir URL 'dir.</span><span class="sxs-lookup"><span data-stu-id="a7892-134">In this case, it's the URL that the attacker has entered, which is [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn).</span></span> <span data-ttu-id="a7892-135">Son derece watchful, özellikle de saldırgan, sahte sayfasının meşru oturum açma sayfasına benzer şekilde göründüğünden emin olma konusunda dikkatli oluyoruz.</span><span class="sxs-lookup"><span data-stu-id="a7892-135">Unless we're extremely watchful, it's very likely we won't notice this, especially because the attacker has been careful to make sure that their forged page looks exactly like the legitimate login page.</span></span> <span data-ttu-id="a7892-136">Bu oturum açma sayfası, yeniden oturum açdığımızda bir hata iletisi içerir.</span><span class="sxs-lookup"><span data-stu-id="a7892-136">This login page includes an error message requesting that we login again.</span></span> <span data-ttu-id="a7892-137">Clumsy US, parolamız yanlış olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="a7892-137">Clumsy us, we must have mistyped our password.</span></span>

[![](preventing-open-redirection-attacks/_static/image6.png)](preventing-open-redirection-attacks/_static/image5.png)

<span data-ttu-id="a7892-138">**Şekil 03**: sahte Nerdakşam yemeği oturum açma ekranı</span><span class="sxs-lookup"><span data-stu-id="a7892-138">**Figure 03**: Forged NerdDinner Login screen</span></span>

<span data-ttu-id="a7892-139">Kullanıcı adı ve parolamı yeniden yazdığımızda, sahte oturum açma sayfası bilgileri kaydeder ve bize yasal NerdDinner.com sitesine geri gönderir.</span><span class="sxs-lookup"><span data-stu-id="a7892-139">When we retype our user name and password, the forged login page saves the information and sends us back to the legitimate NerdDinner.com site.</span></span> <span data-ttu-id="a7892-140">Bu noktada, NerdDinner.com sitesinin kimliği zaten doğrulanır, bu nedenle sahte oturum açma sayfası doğrudan bu sayfaya yeniden yönlendirebilir.</span><span class="sxs-lookup"><span data-stu-id="a7892-140">At this point, the NerdDinner.com site has already authenticated us, so the forged login page can redirect directly to that page.</span></span> <span data-ttu-id="a7892-141">Nihai sonuç, saldırganın Kullanıcı adı ve parola sağlamasıdır ve kendisine sağladığımız farkında değildir.</span><span class="sxs-lookup"><span data-stu-id="a7892-141">The end result is that the attacker has our user name and password, and we are unaware that we've provided it to them.</span></span>

## <a name="looking-at-the-vulnerable-code-in-the-accountcontroller-logon-action"></a><span data-ttu-id="a7892-142">AccountController oturum açma eyleminde güvenlik açığı bulunan koda bakıyor</span><span class="sxs-lookup"><span data-stu-id="a7892-142">Looking at the vulnerable code in the AccountController LogOn Action</span></span>

<span data-ttu-id="a7892-143">ASP.NET MVC 2 uygulamasındaki oturum açma eyleminin kodu aşağıda gösterilmiştir.</span><span class="sxs-lookup"><span data-stu-id="a7892-143">The code for the LogOn action in an ASP.NET MVC 2 application is shown below.</span></span> <span data-ttu-id="a7892-144">Başarılı bir oturum açma işlemi sırasında, denetleyicinin returnUrl 'ye bir yeniden yönlendirme döndürdüğünden emin olmanız gerektiğini unutmayın.</span><span class="sxs-lookup"><span data-stu-id="a7892-144">Note that upon a successful login, the controller returns a redirect to the returnUrl.</span></span> <span data-ttu-id="a7892-145">ReturnUrl parametresine karşı hiçbir doğrulamanın gerçekleştirilmediğini görebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a7892-145">You can see that no validation is being performed against the returnUrl parameter.</span></span>

<span data-ttu-id="a7892-146">**Listeleme 1 – ASP.NET MVC 2 oturum açma eylemi `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="a7892-146">**Listing 1 – ASP.NET MVC 2 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample1.cs)]

<span data-ttu-id="a7892-147">Şimdi ASP.NET MVC 3 oturum açma eyleminde yapılan değişikliklere göz atalım.</span><span class="sxs-lookup"><span data-stu-id="a7892-147">Now let's look at the changes to the ASP.NET MVC 3 LogOn action.</span></span> <span data-ttu-id="a7892-148">Bu kod, System. Web. Mvc. URL yardımcı sınıfında `IsLocalUrl()`adlı yeni bir yöntem çağırarak returnUrl parametresini doğrulamak üzere değiştirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="a7892-148">This code has been changed to validate the returnUrl parameter by calling a new method in the System.Web.Mvc.Url helper class named `IsLocalUrl()`.</span></span>

<span data-ttu-id="a7892-149">**Listeleme 2 – ASP.NET MVC 3 oturum açma eylemi `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="a7892-149">**Listing 2 – ASP.NET MVC 3 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample2.cs)]

<span data-ttu-id="a7892-150">Bu, return URL parametresini doğrulamak üzere değiştirilmiştir. Web. Mvc. URL yardımcı sınıfında yeni bir yöntemi çağırarak, `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="a7892-150">This has been changed to validate the return URL parameter by calling a new method in the System.Web.Mvc.Url helper class, `IsLocalUrl()`.</span></span>

## <a name="protecting-your-aspnet-mvc-10-and-mvc-2-applications"></a><span data-ttu-id="a7892-151">ASP.NET MVC 1,0 ve MVC 2 uygulamalarınızı koruma</span><span class="sxs-lookup"><span data-stu-id="a7892-151">Protecting Your ASP.NET MVC 1.0 and MVC 2 Applications</span></span>

<span data-ttu-id="a7892-152">Ilocalurl () yardımcı yöntemini ekleyerek ve returnUrl parametresini doğrulamak üzere oturum açma eylemini güncelleştirerek var olan ASP.NET MVC 1,0 ve 2 uygulamalarımızda ASP.NET MVC 3 değişikliklerinden faydalanabilir.</span><span class="sxs-lookup"><span data-stu-id="a7892-152">We can take advantage of the ASP.NET MVC 3 changes in our existing ASP.NET MVC 1.0 and 2 applications by adding the IsLocalUrl() helper method and updating the LogOn action to validate the returnUrl parameter.</span></span>

<span data-ttu-id="a7892-153">URL Yardımcısı IsLocalUrl () yöntemi aslında yalnızca System. Web. Web sayfalarındaki bir yönteme çağrı yaparak bu doğrulama, ASP.NET Web sayfaları uygulamaları tarafından da kullanılır.</span><span class="sxs-lookup"><span data-stu-id="a7892-153">The UrlHelper IsLocalUrl() method actually just calling into a method in System.Web.WebPages, as this validation is also used by ASP.NET Web Pages applications.</span></span>

<span data-ttu-id="a7892-154">**Listeleme 3 – ASP.NET MVC 3 UrlHelper `class` ıslocalurl () yöntemi**</span><span class="sxs-lookup"><span data-stu-id="a7892-154">**Listing 3 – The IsLocalUrl() method from the ASP.NET MVC 3 UrlHelper `class`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample3.cs)]

<span data-ttu-id="a7892-155">Iurllocaltohost yöntemi, liste 4 ' te gösterildiği gibi gerçek doğrulama mantığını içerir.</span><span class="sxs-lookup"><span data-stu-id="a7892-155">The IsUrlLocalToHost method contains the actual validation logic, as shown in Listing 4.</span></span>

<span data-ttu-id="a7892-156">**System. Web. Web sayfası Requesısesions sınıfından 4 – ısurllocaltohost () yöntemini listeleme**</span><span class="sxs-lookup"><span data-stu-id="a7892-156">**Listing 4 – IsUrlLocalToHost() method from the System.Web.WebPages RequestExtensions class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample4.cs)]

<span data-ttu-id="a7892-157">ASP.NET MVC 1,0 veya 2 uygulamamızda, AccountController 'a bir ılocalurl () yöntemi ekleyeceğiz, ancak mümkünse onu ayrı bir yardımcı sınıfa eklemeniz önerilir.</span><span class="sxs-lookup"><span data-stu-id="a7892-157">In our ASP.NET MVC 1.0 or 2 application, we'll add a IsLocalUrl() method to the AccountController, but you're encouraged to add it to a separate helper class if possible.</span></span> <span data-ttu-id="a7892-158">Ilocalurl () ASP.NET MVC 3 sürümünde AccountController içinde çalışacak şekilde iki küçük değişiklik yapacağız.</span><span class="sxs-lookup"><span data-stu-id="a7892-158">We will make two small changes to the ASP.NET MVC 3 version of IsLocalUrl() so that it will work inside the AccountController.</span></span> <span data-ttu-id="a7892-159">İlk olarak, denetleyicilerde ortak metotların denetleyici eylemleri olarak erişilebilir olduğundan, bunu bir genel yöntemden özel bir yönteme değiştireceksiniz.</span><span class="sxs-lookup"><span data-stu-id="a7892-159">First, we'll change it from a public method to a private method, since public methods in controllers can be accessed as controller actions.</span></span> <span data-ttu-id="a7892-160">İkincisi, URL konağını uygulama konağına göre denetleyen çağrıyı değiştireceksiniz.</span><span class="sxs-lookup"><span data-stu-id="a7892-160">Second, we'll modify the call that checks the URL host against the application host.</span></span> <span data-ttu-id="a7892-161">Bu çağrı UrlHelper sınıfında yerel bir RequestContext alanını kullanır.</span><span class="sxs-lookup"><span data-stu-id="a7892-161">That call makes use of a local RequestContext field in the UrlHelper class.</span></span> <span data-ttu-id="a7892-162">Bunu kullanmak yerine. RequestContext. HttpContext. Request. URL. Host, bunu kullanacağız. İstek. URL. Host.</span><span class="sxs-lookup"><span data-stu-id="a7892-162">Instead of using this.RequestContext.HttpContext.Request.Url.Host, we will use this.Request.Url.Host.</span></span> <span data-ttu-id="a7892-163">Aşağıdaki kod, ASP.NET MVC 1,0 ve 2 uygulamalarında bir Controller sınıfıyla birlikte kullanılacak olan Modified ılocalurl () yöntemini gösterir.</span><span class="sxs-lookup"><span data-stu-id="a7892-163">The following code shows the modified IsLocalUrl() method for use with a controller class in ASP.NET MVC 1.0 and 2 applications.</span></span>

<span data-ttu-id="a7892-164">**Kod 5 – IsLocalUrl () yöntemi, MVC denetleyici sınıfıyla kullanılmak üzere değiştirilmiştir**</span><span class="sxs-lookup"><span data-stu-id="a7892-164">**Listing 5 – IsLocalUrl() method, which is modified for use with an MVC Controller class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample5.cs)]

<span data-ttu-id="a7892-165">Artık ıslocalurl () yöntemi olduğuna göre, aşağıdaki kodda gösterildiği gibi returnUrl parametresini doğrulamak için oturum açma eylemmizden bu işlemi çağırabiliriz.</span><span class="sxs-lookup"><span data-stu-id="a7892-165">Now that the IsLocalUrl() method is in place, we can call it from our LogOn action to validate the returnUrl parameter, as shown in the following code.</span></span>

<span data-ttu-id="a7892-166">**Listeleme 6 – returnUrl parametresini doğrulayan, güncelleştirilmiş oturum açma yöntemi**</span><span class="sxs-lookup"><span data-stu-id="a7892-166">**Listing 6 – Updated LogOn method which validates the returnUrl parameter**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample6.cs)]

<span data-ttu-id="a7892-167">Artık bir dış dönüş URL 'SI kullanarak oturum açmaya çalışırken açık bir yeniden yönlendirme saldırısı test eteceğiz.</span><span class="sxs-lookup"><span data-stu-id="a7892-167">Now we can test an open redirection attack by attempting to log in using an external return URL.</span></span> <span data-ttu-id="a7892-168">/Account/LogOn komutunu kullanalım. ReturnUrl = yeniden<http://www.bing.com/>.</span><span class="sxs-lookup"><span data-stu-id="a7892-168">Let's use /Account/LogOn?ReturnUrl=<http://www.bing.com/> again.</span></span>

[![](preventing-open-redirection-attacks/_static/image8.png)](preventing-open-redirection-attacks/_static/image7.png)

<span data-ttu-id="a7892-169">**Şekil 04**: güncelleştirilmiş oturum açma eylemini test etme</span><span class="sxs-lookup"><span data-stu-id="a7892-169">**Figure 04**: Testing the updated LogOn Action</span></span>

<span data-ttu-id="a7892-170">Başarıyla oturum açtıktan sonra dış URL yerine giriş/Dizin denetleyicisi eylemine yönlendirilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a7892-170">After successfully logging in, we are redirected to the Home/Index Controller action rather than the external URL.</span></span>

[![](preventing-open-redirection-attacks/_static/image10.png)](preventing-open-redirection-attacks/_static/image9.png)

<span data-ttu-id="a7892-171">**Şekil 05**: açık yeniden yönlendirme saldırısı Ertelenen</span><span class="sxs-lookup"><span data-stu-id="a7892-171">**Figure 05**: Open Redirection attack defeated</span></span>

## <a name="summary"></a><span data-ttu-id="a7892-172">Özet</span><span class="sxs-lookup"><span data-stu-id="a7892-172">Summary</span></span>

<span data-ttu-id="a7892-173">Yeniden yönlendirme URL 'Leri bir uygulamanın URL 'sinde parametre olarak geçirildiğinde, açık yeniden yönlendirme saldırıları gerçekleşebilir.</span><span class="sxs-lookup"><span data-stu-id="a7892-173">Open redirection attacks can occur when redirection URLs are passed as parameters in the URL for an application.</span></span> <span data-ttu-id="a7892-174">ASP.NET MVC 3 şablonu, açık yeniden yönlendirme saldırılarına karşı korumaya yönelik kodu içerir.</span><span class="sxs-lookup"><span data-stu-id="a7892-174">The ASP.NET MVC 3 template includes code to protect against open redirection attacks.</span></span> <span data-ttu-id="a7892-175">Bu kodu, ASP.NET MVC 1,0 ve 2 uygulamalarında bazı değişikliklerle ekleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a7892-175">You can add this code with some modification to ASP.NET MVC 1.0 and 2 applications.</span></span> <span data-ttu-id="a7892-176">ASP.NET 1,0 ve 2 uygulamalarında oturum açarken açık yeniden yönlendirme saldırılarına karşı koruma sağlamak için bir IsLocalUrl () yöntemi ekleyin ve oturum açma eyleminde returnUrl parametresini doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="a7892-176">To protect against open redirection attacks when logging into ASP.NET 1.0 and 2 applications, add a IsLocalUrl() method and validate the returnUrl parameter in the LogOn action.</span></span>
