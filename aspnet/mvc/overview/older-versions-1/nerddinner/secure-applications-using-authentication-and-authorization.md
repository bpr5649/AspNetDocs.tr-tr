---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Kimlik doğrulama ve yetkilendirme kullanarak uygulamaları güvenli hale getirme | Microsoft Docs
author: microsoft
description: 9\. adımda, Nerdakşam yemeği uygulamamız için kimlik doğrulaması ve yetkilendirme ekleme ve kullanıcıların oluşturmak için siteye kaydolması ve sitede oturum açması gerekir...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: 8d509c5f15bb4d5014e53b8dc2a736454238e72c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78600984"
---
# <a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="4cbec-103">Kimlik Doğrulama ve Yetkilendirme Kullanarak Uygulamaların Güvenliğini Sağlama</span><span class="sxs-lookup"><span data-stu-id="4cbec-103">Secure Applications Using Authentication and Authorization</span></span>

<span data-ttu-id="4cbec-104">[Microsoft](https://github.com/microsoft) tarafından</span><span class="sxs-lookup"><span data-stu-id="4cbec-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="4cbec-105">PDF 'YI indir</span><span class="sxs-lookup"><span data-stu-id="4cbec-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="4cbec-106">Bu, ASP.NET MVC 1 kullanarak küçük, ancak tam bir Web uygulamasının nasıl oluşturulacağını gösteren ücretsiz bir ["Nerdakşam yemeği" uygulama öğreticisinin](introducing-the-nerddinner-tutorial.md) adım 9 ' u.</span><span class="sxs-lookup"><span data-stu-id="4cbec-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="4cbec-107">9\. adımda, Nerdakşam yemeği uygulamamıza güvenli hale getirmek üzere kimlik doğrulaması ve yetkilendirme ekleme işlemi, kullanıcıların yeni yemek 'ler oluşturmak için siteye kaydolmaları ve oturum açması ve yalnızca bir akşam yemeği 'yi barındıran Kullanıcı tarafından düzenlenebilir olması gerektiğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="4cbec-108">ASP.NET MVC 3 kullanıyorsanız, [MVC 3 Ile çalışmaya başlama](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) veya [MVC müzik mağazası](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) öğreticilerini izlemeniz önerilir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="4cbec-109">Nerdakşam yemeği adım 9: kimlik doğrulama ve yetkilendirme</span><span class="sxs-lookup"><span data-stu-id="4cbec-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="4cbec-110">Şu anda Nerdakşam yemeği uygulamamız, siteyi ziyaret eden kişilerin herhangi bir akşam yemeği için ayrıntıları oluşturma ve düzenleme olanağı veriyor.</span><span class="sxs-lookup"><span data-stu-id="4cbec-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="4cbec-111">Bunu, kullanıcıların yeni dinlayıcıları oluşturmak ve siteye oturum açması ve yalnızca bir akşam yemeği 'yi barındıran kullanıcının düzenleyebilmesini sağlayacak bir kısıtlama eklemesi için bunu değiştirelim.</span><span class="sxs-lookup"><span data-stu-id="4cbec-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="4cbec-112">Bunu etkinleştirmek için, uygulamamızı güvenli hale getirmek üzere kimlik doğrulaması ve yetkilendirme kullanacağız.</span><span class="sxs-lookup"><span data-stu-id="4cbec-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="4cbec-113">Kimlik doğrulama ve yetkilendirmeyi anlama</span><span class="sxs-lookup"><span data-stu-id="4cbec-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="4cbec-114">*Kimlik doğrulaması* , bir uygulamaya erişen istemcinin kimliğini belirleme ve doğrulama işlemidir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="4cbec-115">Daha fazlasını yapın, son kullanıcının bir Web sitesini ziyaret ettiğinde ne zaman olduğunu belirlemek.</span><span class="sxs-lookup"><span data-stu-id="4cbec-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="4cbec-116">ASP.NET, tarayıcı kullanıcılarının kimlik doğrulamasının birden çok yolunu destekler.</span><span class="sxs-lookup"><span data-stu-id="4cbec-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="4cbec-117">Internet Web uygulamaları için kullanılan en yaygın kimlik doğrulama yaklaşımına "form kimlik doğrulaması" adı verilir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="4cbec-118">Forms kimlik doğrulaması, bir geliştiricinin uygulama içinde HTML oturum açma formu yazarışını sağlar ve ardından bir veritabanı veya diğer parola kimlik bilgileri deposuna göre Son Kullanıcı gönderisin Kullanıcı adını/parolasını doğrular.</span><span class="sxs-lookup"><span data-stu-id="4cbec-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="4cbec-119">Kullanıcı adı/parola birleşimi doğru ise, geliştirici daha sonra, ASP.NET sonraki isteklerde kullanıcıyı tanımlamak için şifrelenmiş bir HTTP tanımlama bilgisi vermesini isteyebilir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="4cbec-120">Form kimlik doğrulamasını Nerdakşam yemeği uygulamamız ile kullanacağız.</span><span class="sxs-lookup"><span data-stu-id="4cbec-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="4cbec-121">*Yetkilendirme* , kimliği doğrulanmış bir kullanıcının belırlı bir URL/kaynağa erişme izni olup olmadığını belirleme veya bazı eylemler gerçekleştirme işlemidir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="4cbec-122">Örneğin, Nerdakşam yemeği uygulamamız içinde yalnızca oturum açan kullanıcıların */Dinners/Create* URL 'sine erişip yeni dinetleri oluşturabileceksiniz.</span><span class="sxs-lookup"><span data-stu-id="4cbec-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="4cbec-123">Ayrıca, yalnızca bir akşam yemeği barındıran kullanıcının düzenleyebilmesini ve diğer tüm kullanıcılara düzenleme erişimini reddetmesi için yetkilendirme mantığı eklemek isteyeceksiniz.</span><span class="sxs-lookup"><span data-stu-id="4cbec-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="4cbec-124">Forms kimlik doğrulaması ve AccountController</span><span class="sxs-lookup"><span data-stu-id="4cbec-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="4cbec-125">Yeni ASP.NET MVC uygulamaları oluşturulduğunda ASP.NET MVC için varsayılan Visual Studio proje şablonu otomatik olarak form kimlik doğrulaması etkinleştirilir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="4cbec-126">Ayrıca, projeye önceden oluşturulmuş bir hesap oturum açma sayfası uygulamasını otomatik olarak ekler. Bu, bir site içinde güvenliği tümleştirmeyi gerçekten kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="4cbec-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="4cbec-127">Varsayılan site. Master ana sayfası, erişimi doğrulanmadığı zaman sitenin sağ üst kısmında "oturum aç" bağlantısını görüntüler:</span><span class="sxs-lookup"><span data-stu-id="4cbec-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="4cbec-128">"Oturum aç" bağlantısına tıklanması bir kullanıcıyı */Account/Logon* URL 'sine götürür:</span><span class="sxs-lookup"><span data-stu-id="4cbec-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="4cbec-129">Kaydolmayan ziyaretçiler bunu, */Account/Register* URL 'sine alacak ve hesap ayrıntılarını girmesine izin veren "Register" bağlantısına tıklayarak yapabilir:</span><span class="sxs-lookup"><span data-stu-id="4cbec-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="4cbec-130">"Kaydet" düğmesine tıklamak, ASP.NET üyelik sisteminde yeni bir kullanıcı oluşturur ve Forms kimlik doğrulamasını kullanarak kullanıcının site üzerinde kimliğini doğrular.</span><span class="sxs-lookup"><span data-stu-id="4cbec-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="4cbec-131">Bir Kullanıcı oturum açtığında, site. Master sayfanın sağ üst köşesindeki "hoş geldiniz [Kullanıcı adı]!" çıktısını almak için sayfayı değiştirir</span><span class="sxs-lookup"><span data-stu-id="4cbec-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="4cbec-132">ileti ve bir "oturum aç" bağlantısı yerine "oturum kapatma" bağlantısını işler.</span><span class="sxs-lookup"><span data-stu-id="4cbec-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="4cbec-133">"Oturumu Kapat" bağlantısına tıklanması Kullanıcı oturumunu günlüğe kaydeder:</span><span class="sxs-lookup"><span data-stu-id="4cbec-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="4cbec-134">Yukarıdaki oturum açma, oturum kapatma ve kayıt işlevselliği, projeyi oluştururken Visual Studio tarafından projemizi eklenen AccountController sınıfı içinde uygulanır.</span><span class="sxs-lookup"><span data-stu-id="4cbec-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="4cbec-135">AccountController için Kullanıcı arabirimi, \Views\Account dizinindeki Görünüm şablonları kullanılarak uygulanır:</span><span class="sxs-lookup"><span data-stu-id="4cbec-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="4cbec-136">AccountController sınıfı, şifreli kimlik doğrulama tanımlama bilgileri vermek için ASP.NET Forms kimlik doğrulama sistemini ve Kullanıcı adlarını/parolaları depolamak ve doğrulamak için ASP.NET üyelik API 'sini kullanır.</span><span class="sxs-lookup"><span data-stu-id="4cbec-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="4cbec-137">ASP.NET üyelik API 'SI genişletilebilir ve parola kimlik bilgisi deposunun kullanılmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="4cbec-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="4cbec-138">ASP.NET, bir SQL veritabanı içinde veya Active Directory içinde Kullanıcı adı/parolaları depolayan yerleşik üyelik sağlayıcısı uygulamalarıyla birlikte gelir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="4cbec-139">Nerdakşam yemeği uygulamamız, projenin kökündeki "Web. config" dosyasını açıp bunun içindeki &lt;üyelik&gt; bölümüne bakarak hangi üyelik sağlayıcısını kullanması gerektiğini yapılandırabiliriz.</span><span class="sxs-lookup"><span data-stu-id="4cbec-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="4cbec-140">Proje oluşturulduğunda varsayılan Web. config eklenir ve SQL üyelik sağlayıcısını kaydeder ve veritabanı konumunu belirtmek için bunu "ApplicationServices" adlı bir bağlantı dizesi kullanacak şekilde yapılandırır.</span><span class="sxs-lookup"><span data-stu-id="4cbec-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="4cbec-141">Varsayılan "ApplicationServices" bağlantı dizesi (Web. config dosyasının &lt;connectionStrings&gt; bölümü içinde belirtilen) SQL Express kullanmak üzere yapılandırılmıştır.</span><span class="sxs-lookup"><span data-stu-id="4cbec-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="4cbec-142">"ASPNETDB" adlı bir SQL Express veritabanına işaret eder. MDF "uygulamanın" uygulama\_verileri "dizini.</span><span class="sxs-lookup"><span data-stu-id="4cbec-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="4cbec-143">Bu veritabanı, üyelik API 'SI uygulama içinde ilk kez kullanıldığında, ASP.NET otomatik olarak veritabanını oluşturur ve içinde uygun üyelik veritabanı şemasını sağlayacaktır:</span><span class="sxs-lookup"><span data-stu-id="4cbec-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="4cbec-144">SQL Express kullanmak yerine tam bir SQL Server örneği kullanmak (veya uzak bir veritabanına bağlanmak) istiyoruz, tüm yapmanız gereken, Web. config dosyasındaki "ApplicationServices" bağlantı dizesini güncelleştirmek ve uygun üyelik şemasının olduğundan emin olmak için , işaret ettiği veritabanına eklenmiştir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="4cbec-145">Üyelik ve diğer ASP.NET uygulama hizmetleri için uygun şemayı bir veritabanına eklemek için \Windows\Microsoft.NET\Framework\v2.0.50727\ dizinindeki "ASPNET\_regsql. exe" yardımcı programını çalıştırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="4cbec-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="4cbec-146">[Yetkilendir] filtresi kullanılarak/Dinners/Create URL 'sini yetkilendirme</span><span class="sxs-lookup"><span data-stu-id="4cbec-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="4cbec-147">Nerdakşam yemeği uygulaması için güvenli kimlik doğrulama ve hesap yönetimi uygulamasını etkinleştirmek üzere kod yazmak zorunda yoktu.</span><span class="sxs-lookup"><span data-stu-id="4cbec-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="4cbec-148">Kullanıcılar, uygulamamız ile yeni hesaplar kaydedebilir ve sitenin oturumunu açma/kapatma olabilir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="4cbec-149">Artık uygulamaya yetkilendirme mantığı ekleyebiliriz ve sitede ne yapabileceklerini ve yapabileceklerini denetlemek için ziyaretçilerin kimlik doğrulama durumunu ve Kullanıcı adını kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="4cbec-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="4cbec-150">DinnersController sınıfımız "oluşturma" eylem yöntemlerine yetkilendirme mantığı ekleyerek başlayalım.</span><span class="sxs-lookup"><span data-stu-id="4cbec-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="4cbec-151">Özellikle, */Dinners/Create* URL 'sine erişen kullanıcıların oturum açması gerekir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="4cbec-152">Oturum açmadıysa, oturum açabilmek için bunları oturum açma sayfasına yönlendirirsiniz.</span><span class="sxs-lookup"><span data-stu-id="4cbec-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="4cbec-153">Bu mantığı uygulamak oldukça kolaydır.</span><span class="sxs-lookup"><span data-stu-id="4cbec-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="4cbec-154">Her şey için bir [Yetkilendir] filtre özniteliği eklememiz gerekir, örneğin:</span><span class="sxs-lookup"><span data-stu-id="4cbec-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="4cbec-155">ASP.NET MVC, eylem yöntemlerine bildirimli olarak uygulanabilen, yeniden kullanılabilir mantığı uygulamak için kullanılabilen "eylem filtreleri" oluşturma özelliğini destekler.</span><span class="sxs-lookup"><span data-stu-id="4cbec-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="4cbec-156">[Yetkilendir] filtresi, ASP.NET MVC tarafından sunulan yerleşik eylem filtrelerinden biridir ve bir geliştiricinin eylem yöntemlerine ve denetleyici sınıflarına bildirimli olarak yetkilendirme kuralları uygulamasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="4cbec-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="4cbec-157">Herhangi bir parametre olmadan uygulandığında (yukarıdaki gibi), [Yetkilendir] filtresi, eylem yöntemi isteğini yapan kullanıcının oturum açmış olması gerekir; Aksi takdirde tarayıcı, oturum açma URL 'sine otomatik olarak yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="4cbec-158">Bu yeniden yönlendirmeyi yaparken, ilk istenen URL bir QueryString bağımsız değişkeni olarak geçirilir (örneğin:/Account/LogOn? ReturnUrl =% 2Fınfıanlar% 2fCreate).</span><span class="sxs-lookup"><span data-stu-id="4cbec-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="4cbec-159">AccountController daha sonra yeniden oturum açtıklarında kullanıcıyı istenen URL 'ye yeniden yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="4cbec-160">[Yetkilendir] filtresi, isteğe bağlı olarak, kullanıcının hem oturum açmasını hem de izin verilen bir güvenlik rolünün bir listesini içinde olmasını gerektirmek için kullanılabilecek bir "kullanıcılar" veya "Roller" özelliği belirtme özelliğini destekler.</span><span class="sxs-lookup"><span data-stu-id="4cbec-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="4cbec-161">Örneğin, aşağıdaki kod,/Dinners/Create URL 'sine erişmek için yalnızca "ScottGu" ve "billg" olmak üzere iki özel kullanıcıya izin verir:</span><span class="sxs-lookup"><span data-stu-id="4cbec-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="4cbec-162">Kod içinde belirli kullanıcı adlarının gömülmesi, oldukça mümkün değildir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="4cbec-163">Daha iyi bir yaklaşım, kodun tarafından kontrol edilen daha üst düzey "rolleri" tanımlamak ve ardından bir veritabanı ya da Active Directory sistemi kullanarak (gerçek Kullanıcı eşleme listesini koddan dışarıdan depolanmasını etkinleştirmek) Kullanıcı rolüne eşlemek için daha iyi bir yaklaşımdır.</span><span class="sxs-lookup"><span data-stu-id="4cbec-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="4cbec-164">ASP.NET, yerleşik bir rol yönetim API 'SI ve bu kullanıcı/rol eşlemesini gerçekleştirmeye yardımcı olabilecek yerleşik bir rol sağlayıcıları kümesi (SQL ve Active Directory gibi) içerir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="4cbec-165">Daha sonra kodu yalnızca belirli bir "Yönetici" rolünde bulunan kullanıcıların/Dinners/Create URL 'sine erişmesine izin verecek şekilde güncelleştirebiliriz:</span><span class="sxs-lookup"><span data-stu-id="4cbec-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="4cbec-166">Dinlayıcıları oluştururken User.Identity.Name özelliğini kullanma</span><span class="sxs-lookup"><span data-stu-id="4cbec-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="4cbec-167">Bir isteğin oturum açmış olan kullanıcısının Kullanıcı adını, denetleyici temel sınıfında kullanıma sunulan User.Identity.Name özelliğini kullanarak alabiliriz.</span><span class="sxs-lookup"><span data-stu-id="4cbec-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="4cbec-168">Daha önce, Create () eylem yönteminizin HTTP-POST sürümünü uyguladığımızda, akşam yemeği 'nin "HostedBy" özelliğini statik bir dizeye kodlıyoruz.</span><span class="sxs-lookup"><span data-stu-id="4cbec-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="4cbec-169">Artık bu kodu, User.Identity.Name özelliğini kullanacak şekilde güncelleştirebilir, ayrıca akşam yemeği 'yi oluşturan ana bilgisayar için otomatik olarak bir RSVP ekleyebilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="4cbec-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="4cbec-170">Create () yöntemine bir [Yetkilendir] özniteliği eklediğimiz için, ASP.NET MVC eylem yönteminin yalnızca/Dinners/Create URL 'sini ziyaret eden kullanıcı sitede oturum açtıysa yürütülür olmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="4cbec-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="4cbec-171">Bu nedenle, User.Identity.Name Özellik değeri her zaman geçerli bir Kullanıcı adı içerecektir.</span><span class="sxs-lookup"><span data-stu-id="4cbec-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="4cbec-172">User.Identity.Name özelliğini, Dinlayıcıları düzenlenirken kullanma</span><span class="sxs-lookup"><span data-stu-id="4cbec-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="4cbec-173">Şimdi, kullanıcıları sınırlayan bazı yetkilendirme mantığını ekleyelim, böylece kullanıcılar kendilerini barındırdığı dinyilerin özelliklerini düzenleyebilirler.</span><span class="sxs-lookup"><span data-stu-id="4cbec-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="4cbec-174">Bu konuda yardım almak için önce akşam yemeği nesnemiz için bir "ıhostedby (Kullanıcı adı)" yardımcı yöntemi ekleyeceğiz (daha önce oluşturduğumuz Dinner.cs kısmi sınıfı içinde).</span><span class="sxs-lookup"><span data-stu-id="4cbec-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="4cbec-175">Bu yardımcı yöntem, girilen bir kullanıcı adının akşam yemeği HostedBy özelliği ile eşleşip eşleşmediğini ve bir büyük küçük harfe duyarsız dize karşılaştırması gerçekleştirmek için gereken mantığı Kapsüller doğru veya yanlış döndürür:</span><span class="sxs-lookup"><span data-stu-id="4cbec-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="4cbec-176">Daha sonra DinnersController sınıfımızın içindeki Edit () eylem yöntemlerine bir [Yetkilendir] özniteliği ekleyeceğiz.</span><span class="sxs-lookup"><span data-stu-id="4cbec-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="4cbec-177">Bu, */Dinners/Edit/[ID]* URL 'si istemek için kullanıcıların oturum açmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="4cbec-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="4cbec-178">Daha sonra, oturum açmış kullanıcının akşam yemeği ana bilgisayarıyla eşleştiğini doğrulamak üzere akşam yemeği. ıshostedby (Kullanıcı adı) yardımcı yöntemini kullanan düzenleme yöntemlerimize kod ekleyebiliriz.</span><span class="sxs-lookup"><span data-stu-id="4cbec-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="4cbec-179">Kullanıcı ana bilgisayar değilse, "ınvalidowner" görünümü görüntülenir ve isteği sonlandırır.</span><span class="sxs-lookup"><span data-stu-id="4cbec-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="4cbec-180">Bunu yapmak için kod aşağıdaki gibi görünür:</span><span class="sxs-lookup"><span data-stu-id="4cbec-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="4cbec-181">Daha sonra \Views\dıntik dizinine sağ tıklayıp yeni bir "InvalidOwner" görünümü oluşturmak için Ekle-&gt;görünümü menü komutunu seçebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="4cbec-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="4cbec-182">Aşağıdaki hata iletisiyle dolduracağız:</span><span class="sxs-lookup"><span data-stu-id="4cbec-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="4cbec-183">Artık bir kullanıcı sahip olmadıkları bir akşam yemeği düzenlemeyi denediğinde bir hata mesajı alırlar:</span><span class="sxs-lookup"><span data-stu-id="4cbec-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="4cbec-184">Denetleyicimiz içindeki Delete () eylem yöntemleri için aynı adımları yineleyebiliriz ve ayrıca bir akşam yemeği 'nın yalnızca bir akşam yemeği 'nin silmesine izin vermek için.</span><span class="sxs-lookup"><span data-stu-id="4cbec-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="4cbec-185">Düzenle ve Sil bağlantılarını gösterme/gizleme</span><span class="sxs-lookup"><span data-stu-id="4cbec-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="4cbec-186">Ayrıntılar URL 'imizde DinnersController sınıfımızın düzenleme ve silme eylemine bağlantı veriyoruz:</span><span class="sxs-lookup"><span data-stu-id="4cbec-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="4cbec-187">Şu anda, Ayrıntılar URL 'SI için ziyaretçinin akşam yemeği 'nin ana bilgisayarı olup olmamasına bakılmaksızın düzenleme ve silme eylemi bağlantılarını gösteriyoruz.</span><span class="sxs-lookup"><span data-stu-id="4cbec-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="4cbec-188">Şimdi bağlantıları, ziyaret eden Kullanıcı akşam yemeği 'nin sahibi ise görüntülenmesini sağlayacak şekilde değiştirelim.</span><span class="sxs-lookup"><span data-stu-id="4cbec-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="4cbec-189">DinnersController içindeki details () eylem yöntemi bir akşam yemeği nesnesi alır ve ardından bunu model nesnesi olarak görünüm şablonumuza geçirir:</span><span class="sxs-lookup"><span data-stu-id="4cbec-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="4cbec-190">Aşağıdaki gibi akşam yemeği. ıshostedby () yardımcı yöntemini kullanarak Düzenle ve Sil bağlantılarını koşullu olarak göstermek/gizlemek için görünüm şablonumuzu güncelleştirebiliriz:</span><span class="sxs-lookup"><span data-stu-id="4cbec-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="4cbec-191">Sonraki Adımlar</span><span class="sxs-lookup"><span data-stu-id="4cbec-191">Next Steps</span></span>

<span data-ttu-id="4cbec-192">Artık, kimlik doğrulamalı kullanıcıları AJAX kullanarak dinetleri için RSVP 'e nasıl etkinleştirelim bölümüne bakalım.</span><span class="sxs-lookup"><span data-stu-id="4cbec-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="4cbec-193">[Önceki](implement-efficient-data-paging.md)
> [İleri](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="4cbec-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
