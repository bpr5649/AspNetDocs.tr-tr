---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: İş Kuralı Doğrulamaları ile Model Oluşturma | Microsoft Dokümanlar
author: rick-anderson
description: Adım 3, NerdDinner uygulamamız için veritabanını hem sorgulamak hem de güncelleştirmek için kullanabileceğimiz bir modeli nasıl oluşturabileceğimizi gösterir.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: 1a316e9051cf56cd4f1546336b334ace991c05b3
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/17/2020
ms.locfileid: "81541643"
---
# <a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="5377a-103">İş Kuralı Doğrulamaları ile Model Oluşturma</span><span class="sxs-lookup"><span data-stu-id="5377a-103">Build a Model with Business Rule Validations</span></span>

<span data-ttu-id="5377a-104">[Microsoft](https://github.com/microsoft) tarafından</span><span class="sxs-lookup"><span data-stu-id="5377a-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="5377a-105">PDF’yi İndir</span><span class="sxs-lookup"><span data-stu-id="5377a-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="5377a-106">Bu adım 3 ücretsiz bir ["NerdDinner" uygulama öğretici](introducing-the-nerddinner-tutorial.md) nasıl küçük, ama tam, web uygulaması ASP.NET MVC 1 kullanarak oluşturmak için yürüyüşler olduğunu.</span><span class="sxs-lookup"><span data-stu-id="5377a-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="5377a-107">Adım 3, NerdDinner uygulamamız için veritabanını hem sorgulamak hem de güncelleştirmek için kullanabileceğimiz bir modeli nasıl oluşturabileceğimizi gösterir.</span><span class="sxs-lookup"><span data-stu-id="5377a-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="5377a-108">MVC 3 ASP.NET kullanıyorsanız, [MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) veya [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) eğitimlerini takip edersiniz.</span><span class="sxs-lookup"><span data-stu-id="5377a-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="5377a-109">NerdDinner Adım 3: Model Oluşturma</span><span class="sxs-lookup"><span data-stu-id="5377a-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="5377a-110">Model görünümü denetleyicisi çerçevesinde "model" terimi, uygulamanın verilerini temsil eden nesnelerin yanı sıra doğrulama ve iş kurallarını onunla tümleştiren ilgili etki alanı mantığını ifade eder.</span><span class="sxs-lookup"><span data-stu-id="5377a-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="5377a-111">Model birçok yönden bir MVC tabanlı uygulamanın "kalp" ve daha sonra göreceğiz temelde davranışını sürücüler.</span><span class="sxs-lookup"><span data-stu-id="5377a-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="5377a-112">ASP.NET MVC çerçevesi herhangi bir veri erişim teknolojisini kullanarak destekler ve geliştiriciler çeşitli zengin .NET veri seçenekleri arasından aralarında modellerini uygulayabilirler: LINQ'dan Varlıklara, LINQ'dan SQL'e, NHibernate'den SQL'e, NHibernate'den LLBLGen Pro'ya, SubSonic, WilsonORM veya yalnızca ham ADO.NET DataReaders veya DataSets.</span><span class="sxs-lookup"><span data-stu-id="5377a-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="5377a-113">NerdDinner uygulamamız için, veritabanı tasarımımıza oldukça yakın ve bazı özel doğrulama mantığı ve iş kuralları ekleyen basit bir model oluşturmak için LINQ'dan SQL'e kullanacağız.</span><span class="sxs-lookup"><span data-stu-id="5377a-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="5377a-114">Daha sonra, veri kalıcılığı uygulamasının geri kalanından soyut olarak uzak olmasına yardımcı olan ve bunu kolayca birleştirmemizi sağlayan bir depo sınıfı uygulayacağız.</span><span class="sxs-lookup"><span data-stu-id="5377a-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="5377a-115">LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="5377a-115">LINQ to SQL</span></span>

<span data-ttu-id="5377a-116">LINQ to SQL ,NET 3.5'in bir parçası olarak giden bir ORM 'dur (nesne ilişkisel mapper).</span><span class="sxs-lookup"><span data-stu-id="5377a-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="5377a-117">LINQ'dan SQL'e veritabanı tablolarını karşı kodlayabildiğimiz .NET sınıflarına eşlemenin kolay bir yolu sağlar.</span><span class="sxs-lookup"><span data-stu-id="5377a-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="5377a-118">NerdDinner uygulamamız için veritabanımızdaki Dinners ve RSVP tablolarını Dinner ve RSVP sınıflarına göre haritalamak için kullanacağız.</span><span class="sxs-lookup"><span data-stu-id="5377a-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="5377a-119">Dinners ve RSVP tablolarının sütunları Akşam Yemeği ve RSVP sınıflarında yer alan özelliklere karşılık gelecektir.</span><span class="sxs-lookup"><span data-stu-id="5377a-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="5377a-120">Her Akşam Yemeği ve RSVP nesnesi, veritabanındaki Akşam Yemekleri veya RSVP tabloları içinde ayrı bir satırı temsil eder.</span><span class="sxs-lookup"><span data-stu-id="5377a-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="5377a-121">LINQ'dan SQL'e, Akşam Yemeği ve RSVP nesnelerini veritabanı verileriyle almak ve güncellemek için SQL deyimlerini el ile oluşturmak zorunda kalmamızı sağlar.</span><span class="sxs-lookup"><span data-stu-id="5377a-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="5377a-122">Bunun yerine, Akşam Yemeği ve RSVP sınıflarını, veritabanına nasıl eşlediklerini ve aralarındaki ilişkileri tanımlarız.</span><span class="sxs-lookup"><span data-stu-id="5377a-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="5377a-123">LINQ'dan SQL'e, etkileşimde olduğumuz da ve bunları kullandığımız da çalışma zamanında kullanmak üzere uygun SQL yürütme mantığını oluşturmayı halledecektir.</span><span class="sxs-lookup"><span data-stu-id="5377a-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="5377a-124">VB ve C# içindeki LINQ dil desteğini kullanarak Veritabanından Akşam Yemeği ve RSVP nesnelerini alan anlamlı sorgular yazabiliriz.</span><span class="sxs-lookup"><span data-stu-id="5377a-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="5377a-125">Bu, yazmamız gereken veri kodu miktarını en aza indirir ve gerçekten temiz uygulamalar oluşturmamıza olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="5377a-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="5377a-126">Projemize SQL Sınıflarına LINQ Ekleme</span><span class="sxs-lookup"><span data-stu-id="5377a-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="5377a-127">Projemizdeki "Modeller" klasörüne sağ tıklayarak başlayacağız ve **Ekle-&gt;Yeni Öğe** menüsü komutunu seçeceğiz:</span><span class="sxs-lookup"><span data-stu-id="5377a-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="5377a-128">Bu, "Yeni Öğe Ekle" iletişim kutusunu gündeme getirir.</span><span class="sxs-lookup"><span data-stu-id="5377a-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="5377a-129">"Veri" kategorisine göre filtre uygulayacağız ve içindeki "LINQ to SQL Classes" şablonuna göre seçeceğiz:</span><span class="sxs-lookup"><span data-stu-id="5377a-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="5377a-130">Öğeye "NerdDinner" adını vereceğiz ve "Ekle" düğmesine tıklayacağız.</span><span class="sxs-lookup"><span data-stu-id="5377a-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="5377a-131">Visual Studio bizim \Models dizininin altına bir NerdDinner.dbml dosyası ekler ve sonra LINQ'u SQL nesnesi ilişkisel tasarımcıya açar:</span><span class="sxs-lookup"><span data-stu-id="5377a-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="5377a-132">LINQ ile SQL'e Veri Modeli Sınıfları Oluşturma</span><span class="sxs-lookup"><span data-stu-id="5377a-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="5377a-133">LINQ'dan SQL'e, varolan veritabanı şemasından hızlı bir şekilde veri modeli sınıfları oluşturmamızı sağlar.</span><span class="sxs-lookup"><span data-stu-id="5377a-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="5377a-134">Bunu yapmak için Sunucu Gezgini'nde NerdDinner veritabanını açacağız ve içinde modellemek istediğimiz Tabloları seçeceğiz:</span><span class="sxs-lookup"><span data-stu-id="5377a-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="5377a-135">Daha sonra tabloları LINQ'dan SQL tasarımcı yüzeyine sürükleyebiliriz.</span><span class="sxs-lookup"><span data-stu-id="5377a-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="5377a-136">Bunu yaptığımızda SQL'e LINQ, tabloların şemasını kullanarak (veritabanı tablo sütunlarına eşleyen sınıf özellikleriyle) akşam yemeği ve RSVP sınıflarını otomatik olarak oluşturur:</span><span class="sxs-lookup"><span data-stu-id="5377a-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="5377a-137">Varsayılan olarak, BIR veritabanı şemasına dayalı sınıflar oluşturduğunda LINQ -SQL tasarımcısı otomatik olarak tablo ve sütun adlarını "çoğullaştırır".</span><span class="sxs-lookup"><span data-stu-id="5377a-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="5377a-138">Örneğin: Yukarıdaki örneğimizde yer alan "Akşam Yemekleri" tablosu "Akşam Yemeği" sınıfı ile sonuçlandı.</span><span class="sxs-lookup"><span data-stu-id="5377a-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="5377a-139">Bu sınıf adlandırma bizim modelleri .NET adlandırma kuralları ile tutarlı hale yardımcı olur ve ben genellikle tasarımcı (özellikle tablolar çok eklerken) bu kadar düzeltmek zorunda bulabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5377a-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="5377a-140">Tasarımcının oluşturduğu bir sınıfın veya özelliğin adını beğenmezseniz, her zaman geçersiz kılınabilir ve istediğiniz ada değiştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5377a-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="5377a-141">Bunu, tasarımcı içindeki varlık/özellik adını satır satır düzenleyerek veya özellik ızgarası üzerinden değiştirerek yapabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5377a-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="5377a-142">Varsayılan olarak LINQ'dan SQL tasarımcısına kadar olan temel anahtar/yabancı anahtar ilişkileri de inceler ve bunlara göre oluşturduğu farklı model sınıfları arasında otomatik olarak varsayılan "ilişki ilişkileri" oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="5377a-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="5377a-143">Örneğin, Dinners ve RSVP tablolarını LINQ'dan SQL tasarımcısına sürüklediğimizde, rsvp tablosunun Dinners tablosuna yabancı bir anahtarı olduğu gerçeğine dayanarak ikisi arasındaki bire bir ilişki ilişkisi ilişkisi çıkarılarak çıkarıladüzenlenmiştir (bu, tasarımcıdaki okla gösterilir):</span><span class="sxs-lookup"><span data-stu-id="5377a-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="5377a-144">Yukarıdaki ilişkilendirme, LINQ'un SQL'e geliştiricilerin belirli bir RSVP ile ilişkili Akşam Yemeği'ne erişmek için kullanabilecekleri RSVP sınıfına güçlü bir şekilde yazılan bir "Akşam Yemeği" özelliği eklemesine neden olur.</span><span class="sxs-lookup"><span data-stu-id="5377a-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="5377a-145">Ayrıca, Akşam Yemeği sınıfının geliştiricilerin belirli bir Akşam Yemeği ile ilişkili RSVP nesnelerini almasına ve güncelleştirmesine olanak tanıyan bir "RSVP" toplama özelliğine sahip olmasına neden olur.</span><span class="sxs-lookup"><span data-stu-id="5377a-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="5377a-146">Aşağıda visual studio içinde yeni bir RSVP nesne oluşturmak ve bir Akşam YEMEĞI RSVPs koleksiyonuna eklemek intellisense bir örnek görebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5377a-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="5377a-147">LINQ'dan SQL'e nasıl otomatik olarak "RSVP" koleksiyonu eklendi:</span><span class="sxs-lookup"><span data-stu-id="5377a-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="5377a-148">Dinner'ın RSVPs koleksiyonuna RSVP nesnesini ekleyerek, linq'e SQL'e, Akşam Yemeği ile veritabanımızdaki RSVP satırı arasında yabancı anahtar lı bir ilişkiyi ilişkilendirmelerini söylüyoruz:</span><span class="sxs-lookup"><span data-stu-id="5377a-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="5377a-149">Tasarımcının bir tablo ilişkilendirmesini modelleme veya adlarını beğenmezseniz, bunu geçersiz kılabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5377a-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="5377a-150">Tasarımcının içindeki ilişkilendirme okunu tıklattığınızda özelliklerine yeniden adlandırmak, silmek veya değiştirmek için özellik ızgarası üzerinden erişmeniz yeterlidir.</span><span class="sxs-lookup"><span data-stu-id="5377a-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="5377a-151">NerdDinner uygulamamız için olsa da, varsayılan ilişkilendirme kuralları oluşturmakta olduğumuz veri modeli sınıfları için iyi çalışır ve varsayılan davranışı kullanabiliriz.</span><span class="sxs-lookup"><span data-stu-id="5377a-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="5377a-152">NerdDinnerDataContext Sınıf</span><span class="sxs-lookup"><span data-stu-id="5377a-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="5377a-153">Visual Studio, LINQ'dan SQL tasarımcısına tanımlanan modelleri ve veritabanı ilişkilerini temsil eden .NET sınıflarını otomatik olarak oluşturur.</span><span class="sxs-lookup"><span data-stu-id="5377a-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="5377a-154">Çözüme eklenen her LINQ-SQL tasarımcı dosyası için bir LINQ-SQL DataContext sınıfı da oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="5377a-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="5377a-155">LINQ'mizi SQL sınıf öğesine "NerdDinner" olarak adlandırdığımız için oluşturulan DataContext sınıfı "NerdDinnerDataContext" olarak adlandırılacaktır.</span><span class="sxs-lookup"><span data-stu-id="5377a-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="5377a-156">Bu NerdDinnerDataContext sınıfı, veritabanıyla etkileşim kurmanın birincil yoludur.</span><span class="sxs-lookup"><span data-stu-id="5377a-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="5377a-157">NerdDinnerDataContext sınıfımız veritabanında modellediğimiz iki tabloyu temsil eden "Dinners" ve "RSVR" olmak gibi iki özelliği ortaya çıkarır.</span><span class="sxs-lookup"><span data-stu-id="5377a-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="5377a-158">Akşam Yemeği ve RSVP nesnelerini veritabanından sorgulamak ve almak için bu özelliklere karşı LINQ sorguları yazmak için C# kullanabiliriz.</span><span class="sxs-lookup"><span data-stu-id="5377a-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="5377a-159">Aşağıdaki kod, bir NerdDinnerDataContext nesnesinin anlık olarak nasıl anında gerçekleştirildiğini ve gelecekte gerçekleşecek bir Akşam Yemeği dizisi elde etmek için ona karşı bir LINQ sorgusu nasıl gerçekleştirildiğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="5377a-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="5377a-160">Visual Studio, LINQ sorgusunu yazarken tam bir intellisense sağlar ve ondan döndürülen nesneler güçlü bir şekilde yazılır ve aynı zamanda intellisense'i destekler:</span><span class="sxs-lookup"><span data-stu-id="5377a-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="5377a-161">Bir NerdDinnerDataContext, Akşam Yemeği ve RSVP nesnelerini sorgulamamıza izin vermenin yanı sıra, daha sonra aldığımız Akşam Yemeği ve RSVP nesnelerinde yaptığımız değişiklikleri de otomatik olarak izler.</span><span class="sxs-lookup"><span data-stu-id="5377a-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="5377a-162">Bu işlevi, açık SQL güncelleştirme kodu yazmak zorunda kalmadan değişiklikleri kolayca veritabanına kaydetmek için kullanabiliriz.</span><span class="sxs-lookup"><span data-stu-id="5377a-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="5377a-163">Örneğin, aşağıdaki kod, veritabanından tek bir Akşam Yemeği nesnesini almak, Akşam Yemeği özelliklerinden ikisini güncelleştirmek ve değişiklikleri veritabanına kaydetmek için LINQ sorgusunun nasıl kullanılacağını gösterir:</span><span class="sxs-lookup"><span data-stu-id="5377a-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="5377a-164">Yukarıdaki koddaki NerdDinnerDataContext nesnesi, ondan aldığımız Akşam Yemeği nesnesinde yapılan özellik değişikliklerini otomatik olarak izler.</span><span class="sxs-lookup"><span data-stu-id="5377a-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="5377a-165">"Değişiklikleri Gönder()" yöntemini adlandırdığımızda, güncelleştirilmiş değerleri geri kalıcı hale getirmek için veritabanına uygun bir SQL "UPDATE" deyimi uygular.</span><span class="sxs-lookup"><span data-stu-id="5377a-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="5377a-166">DinnerRepository Class oluşturma</span><span class="sxs-lookup"><span data-stu-id="5377a-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="5377a-167">Küçük uygulamalar için, Denetleyicilerin doğrudan BIR LINQ'dan SQL DataContext sınıfına karşı çalışması ve Denetleyiciler içinde LINQ sorguları gömmesi bazen iyi olabilir.</span><span class="sxs-lookup"><span data-stu-id="5377a-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="5377a-168">Uygulamalar büyüdükçe, ancak, bu yaklaşım korumak ve test etmek hantal olur.</span><span class="sxs-lookup"><span data-stu-id="5377a-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="5377a-169">Aynı zamanda aynı LINQ sorgularını birden çok yerde çoğaltmamıza da yol açabilir.</span><span class="sxs-lookup"><span data-stu-id="5377a-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="5377a-170">Uygulamaların korunmasını ve test edilebilen bir yaklaşım, bir "depo" deseni kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="5377a-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="5377a-171">Depo sınıfı, veri sorgulama ve kalıcılık mantığını kapsüllemesine yardımcı olur ve veri kalıcılığının uygulama ayrıntılarını uygulamadan soyutlar.</span><span class="sxs-lookup"><span data-stu-id="5377a-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="5377a-172">Uygulama kodunu daha temiz hale getirmenin yanı sıra, bir depo deseni kullanmak gelecekte veri depolama uygulamalarını değiştirmeyi kolaylaştırabilir ve gerçek bir veritabanı gerektirmeden birim test ini kolaylaştırabilir.</span><span class="sxs-lookup"><span data-stu-id="5377a-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="5377a-173">NerdDinner uygulamamız için aşağıdaki imzayı içeren bir DinnerRepository sınıfını tanımlayacağız:</span><span class="sxs-lookup"><span data-stu-id="5377a-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="5377a-174">*Not: Bu bölümün ilerleyen bölümlerinde bu sınıftan bir IDinnerRepository arabirimi ayıklayacağız ve denetleyicilerimizde bağımlılık enjeksiyonunu mümkün kılacağız. Başlamak için, olsa da, biz basit başlamak ve sadece doğrudan DinnerRepository sınıf ile çalışmak için gidiyoruz.*</span><span class="sxs-lookup"><span data-stu-id="5377a-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="5377a-175">Bu sınıfı uygulamak için "Modeller" klasörümüze sağ tıklayıp **&gt;Yeni Öğe Ekle** menüsü komutunu seçeceğiz.</span><span class="sxs-lookup"><span data-stu-id="5377a-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="5377a-176">"Yeni Öğe Ekle" iletişim kutusunda "Sınıf" şablonunu seçeceğiz ve dosyaya "DinnerRepository.cs" adını vereceğiz:</span><span class="sxs-lookup"><span data-stu-id="5377a-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="5377a-177">Daha sonra aşağıdaki kodu kullanarak DinnerRepository sınıf uygulayabilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="5377a-177">We can then implement our DinnerRepository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="5377a-178">DinnerRepository sınıfını kullanarak Alma, Güncelleme, Ekleme ve Silme</span><span class="sxs-lookup"><span data-stu-id="5377a-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="5377a-179">Şimdi DinnerRepository sınıfımızı oluşturduğumuza göre, onunla yapabileceğimiz ortak görevleri gösteren birkaç kod örneğine bakalım:</span><span class="sxs-lookup"><span data-stu-id="5377a-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="5377a-180">Örnekleri Sorgulama</span><span class="sxs-lookup"><span data-stu-id="5377a-180">Querying Examples</span></span>

<span data-ttu-id="5377a-181">Aşağıdaki kod, DinnerID değerini kullanarak tek bir Akşam Yemeği alır:</span><span class="sxs-lookup"><span data-stu-id="5377a-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="5377a-182">Aşağıdaki kod, yaklaşan tüm akşam yemeklerini ve döngüleri üzerlerinden alır:</span><span class="sxs-lookup"><span data-stu-id="5377a-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="5377a-183">Örnekler Ekle ve Güncelleştir</span><span class="sxs-lookup"><span data-stu-id="5377a-183">Insert and Update Examples</span></span>

<span data-ttu-id="5377a-184">Aşağıdaki kod iki yeni akşam yemeği eklemeyi göstermektedir.</span><span class="sxs-lookup"><span data-stu-id="5377a-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="5377a-185">Depodaki eklemeler/değişiklikler, "Kaydet()" yöntemi çağrılana kadar veritabanına bağlanmaz.</span><span class="sxs-lookup"><span data-stu-id="5377a-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="5377a-186">LINQ to SQL bir veritabanı işlemindeki tüm değişiklikleri otomatik olarak sarar – böylece depomuz kaydederken tüm değişiklikler olur veya bunların hiçbiri olmaz:</span><span class="sxs-lookup"><span data-stu-id="5377a-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="5377a-187">Aşağıdaki kod varolan bir Akşam Yemeği nesnesini alır ve üzerindeki iki özelliği değiştirir.</span><span class="sxs-lookup"><span data-stu-id="5377a-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="5377a-188">"Kaydet()" yöntemi depomuzda çağrıldığında değişiklikler veritabanına geri kaydedilir:</span><span class="sxs-lookup"><span data-stu-id="5377a-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="5377a-189">Aşağıdaki kod bir akşam yemeği alır ve sonra bir RSVP ekler.</span><span class="sxs-lookup"><span data-stu-id="5377a-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="5377a-190">Bunu, LINQ'dan SQL'in bizim için oluşturduğu Dinner nesnesi üzerindeki RSVP koleksiyonunu kullanarak yapar (çünkü veritabanında ikisi arasında birincil anahtar/yabancı anahtar ilişkisi vardır).</span><span class="sxs-lookup"><span data-stu-id="5377a-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="5377a-191">Bu değişiklik, depoda "Kaydet()" yöntemi çağrıldığında yeni bir RSVP tablosu satırı olarak veritabanına geri kalıcıdır:</span><span class="sxs-lookup"><span data-stu-id="5377a-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="5377a-192">Örneği Sil</span><span class="sxs-lookup"><span data-stu-id="5377a-192">Delete Example</span></span>

<span data-ttu-id="5377a-193">Aşağıdaki kod varolan bir Akşam Yemeği nesnesini alır ve sonra silinecek şekilde işaretler.</span><span class="sxs-lookup"><span data-stu-id="5377a-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="5377a-194">Depoda "Kaydet()" yöntemi çağrıldığında silmeyi veritabanına geri alacaktır:</span><span class="sxs-lookup"><span data-stu-id="5377a-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="5377a-195">Doğrulama ve İş Kuralı Mantığını Model Sınıflarıyla Bütünleştirme</span><span class="sxs-lookup"><span data-stu-id="5377a-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="5377a-196">Doğrulama ve iş kuralı mantığı tümleştirme veri ile çalışan herhangi bir uygulamanın önemli bir parçasıdır.</span><span class="sxs-lookup"><span data-stu-id="5377a-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="5377a-197">Şema Doğrulama</span><span class="sxs-lookup"><span data-stu-id="5377a-197">Schema Validation</span></span>

<span data-ttu-id="5377a-198">Linq'den SQL tasarımcısına göre model sınıfları tanımlandığında, veri modeli sınıflarında bulunan özelliklerin veri türleri veritabanı tablosunun veri tiplerine karşılık gelir.</span><span class="sxs-lookup"><span data-stu-id="5377a-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="5377a-199">Örneğin: Akşam Yemekleri tablosundaki "EventDate" sütunu "datetime" ise, LINQ tarafından SQL'e oluşturulan veri modeli sınıfı "DateTime" (yerleşik bir .NET veri tipi) türünden olacaktır.</span><span class="sxs-lookup"><span data-stu-id="5377a-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="5377a-200">Bu, koddan bir tamsayı veya boolean atamaya çalışırsanız derleme hataları alacağınız ve çalışma zamanında geçersiz bir dize türünü dolaylı olarak dönüştürmeye çalışırsanız otomatik olarak hata çıkaracağı anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="5377a-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="5377a-201">LINQ'dan SQL'e, dizeleri kullanırken sizin için sql değerlerinden kaçan değerleri otomatik olarak işler ve bu da kullanırken SQL enjeksiyon saldırılarına karşı korunmanıza yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="5377a-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="5377a-202">Doğrulama ve İş Kuralı Mantığı</span><span class="sxs-lookup"><span data-stu-id="5377a-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="5377a-203">Şema doğrulama ilk adım olarak yararlıdır, ancak nadiren yeterlidir.</span><span class="sxs-lookup"><span data-stu-id="5377a-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="5377a-204">Çoğu gerçek dünya senaryosu, birden çok özelliği kapsayabilen, kodu yürütebilen ve genellikle bir modelin durumu hakkında farkında olan daha zengin doğrulama mantığı belirtmeyi gerektirir (örneğin: oluşturuluyor/güncelleniyor/silinmiş veya "arşivlenmiş" gibi etki alanına özgü bir durum içinde mi dir).</span><span class="sxs-lookup"><span data-stu-id="5377a-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="5377a-205">Doğrulama kurallarını model sınıflarına tanımlamak ve uygulamak için kullanılabilecek çeşitli desenler ve çerçeveler vardır ve bu sınıfa yardımcı olmak için kullanılabilecek birkaç .NET tabanlı çerçeve vardır.</span><span class="sxs-lookup"><span data-stu-id="5377a-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="5377a-206">ASP.NET MVC uygulamaları içinde hemen hemen herhangi birini kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5377a-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="5377a-207">NerdDinner uygulamamızın amaçları doğrultusunda, Bir IsValid özelliğini ve Dinner model nesnemizde getruleviolations() yöntemini ortaya çıkardığımız nispeten basit ve düz ileri desen kullanacağız.</span><span class="sxs-lookup"><span data-stu-id="5377a-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="5377a-208">Geçerli özellik, doğrulama ve iş kurallarının geçerli olup olmadığına bağlı olarak doğru veya yanlış döndürecektir.</span><span class="sxs-lookup"><span data-stu-id="5377a-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="5377a-209">GetRuleViolations() yöntemi kural hatalarının listesini döndürür.</span><span class="sxs-lookup"><span data-stu-id="5377a-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="5377a-210">Projemize "kısmi sınıf" ekleyerek Akşam Yemeği modelimiz için IsValid ve GetRuleViolations() uygulamasını uygulayacağız.</span><span class="sxs-lookup"><span data-stu-id="5377a-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="5377a-211">Kısmi sınıflar, bir VS tasarımcısı tarafından tutulan sınıflara yöntem/özellik/olay eklemek için kullanılabilir (LINQ'dan SQL tasarımcısına kadar olan Akşam Yemeği sınıfı gibi) ve aracın kodumuzu karıştırmasını önlemeye yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="5377a-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="5377a-212">\Modeller klasörüne sağ tıklayarak projemize yeni bir kısmi sınıf ekleyebilir ve ardından "Yeni Öğe Ekle" menüsü komutunu seçebiliriz.</span><span class="sxs-lookup"><span data-stu-id="5377a-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="5377a-213">Daha sonra "Yeni Öğe Ekle" iletişim kutusundaki "Sınıf" şablonuna yer alabilir ve adını Dinner.cs.</span><span class="sxs-lookup"><span data-stu-id="5377a-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="5377a-214">"Ekle" düğmesine tıkladığınızda projemize bir Dinner.cs dosyası eklenir ve IDE içinde açılır.</span><span class="sxs-lookup"><span data-stu-id="5377a-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="5377a-215">Daha sonra aşağıdaki kodu kullanarak temel bir kural/doğrulama zorlama çerçevesi uygulayabiliriz:</span><span class="sxs-lookup"><span data-stu-id="5377a-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="5377a-216">Yukarıdaki kod hakkında birkaç notlar:</span><span class="sxs-lookup"><span data-stu-id="5377a-216">A few notes about the above code:</span></span>

- <span data-ttu-id="5377a-217">Dinner sınıfı "kısmi" bir anahtar kelimeyle önceden ifade edilir – bu da içerdiği kodun LINQ tarafından SQL tasarımcısına oluşturulan/tutulan sınıfla birleştirilip tek bir sınıfa derleneceği anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="5377a-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="5377a-218">RuleViolation sınıfı, bir kural ihlali hakkında daha fazla ayrıntı sağlamamızı sağlayan projeye ekleyeceğimiz yardımcı sınıftır.</span><span class="sxs-lookup"><span data-stu-id="5377a-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="5377a-219">Dinner.GetRuleViolations() yöntemi doğrulama ve iş kurallarımızın değerlendirilmesine neden olur (bunları kısa süre içinde uygulayacağız).</span><span class="sxs-lookup"><span data-stu-id="5377a-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="5377a-220">Daha sonra, kural hataları hakkında daha fazla ayrıntı sağlayan bir kural ihlali nesnedizisi döndürür.</span><span class="sxs-lookup"><span data-stu-id="5377a-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="5377a-221">Dinner.IsValid özelliği, Akşam Yemeği nesnesinin etkin Kural Ihlalleri olup olmadığını gösteren kullanışlı bir yardımcı özellik sağlar.</span><span class="sxs-lookup"><span data-stu-id="5377a-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="5377a-222">Herhangi bir zamanda Dinner nesnesini kullanan bir geliştirici tarafından proaktif olarak denetlenebilir (ve bir özel durum yükseltmez).</span><span class="sxs-lookup"><span data-stu-id="5377a-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="5377a-223">Dinner.OnValidate() kısmi yöntemi, LINQ'dan SQL'e sağladığı ve Akşam Yemeği nesnesinin veritabanında kalıcı olarak devam etmek üzere olduğu her an bize bildirilmesini sağlayan bir kancadır.</span><span class="sxs-lookup"><span data-stu-id="5377a-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="5377a-224">Yukarıdaki OnValidate() uygulamamız, Akşam Yemeği'nin kaydedilmeden önce Kural Ihlali olmamasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="5377a-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="5377a-225">Geçersiz bir durumdaysa, linq'in SQL'e işlemi iptal etmesini sağlayacak bir özel durum oluşturur.</span><span class="sxs-lookup"><span data-stu-id="5377a-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="5377a-226">Bu yaklaşım, doğrulama ve iş kurallarını entegre edebileceğimiz basit bir çerçeve sağlar.</span><span class="sxs-lookup"><span data-stu-id="5377a-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="5377a-227">Şimdilik GetRuleViolations() yöntemimize aşağıdaki kuralları ekleyelim:</span><span class="sxs-lookup"><span data-stu-id="5377a-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="5377a-228">Herhangi bir Kural Ihlali dizisi döndürmek için C# 'ın "verim getirisi" özelliğini kullanıyoruz.</span><span class="sxs-lookup"><span data-stu-id="5377a-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="5377a-229">Yukarıdaki ilk altı kural denetimleri sadece bizim Akşam Yemeği üzerinde dize özellikleri null veya boş olamaz zorlamak.</span><span class="sxs-lookup"><span data-stu-id="5377a-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="5377a-230">Son kural biraz daha ilginçtir ve ContactPhone numarası biçiminin Akşam Yemeği'nin ülkesiyle eşleştiğini doğrulamak için projemize ekleyebileceğimiz bir PhoneValidator.IsValidNumber() yardımcı yöntemini arar.</span><span class="sxs-lookup"><span data-stu-id="5377a-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="5377a-231">Biz kullanabilirsiniz. NET'in bu telefon doğrulama desteğini uygulamak için düzenli ifade desteği.</span><span class="sxs-lookup"><span data-stu-id="5377a-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="5377a-232">Aşağıda, ülkeye özel Regex desen denetimleri eklememizi sağlayan projemize ekleyebileceğimiz basit bir PhoneValidator uygulaması verilmiştir:</span><span class="sxs-lookup"><span data-stu-id="5377a-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="5377a-233">Kullanım Doğrulama ve İş Mantığı İhlalleri</span><span class="sxs-lookup"><span data-stu-id="5377a-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="5377a-234">Artık yukarıdaki doğrulama ve iş kuralı kodunu eklediğimize göre, bir Akşam Yemeği oluşturmaya veya güncellemeye çalıştığımızda, doğrulama mantığı kurallarımız değerlendirilecek ve uygulanacaktır.</span><span class="sxs-lookup"><span data-stu-id="5377a-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="5377a-235">Geliştiriciler, akşam yemeği nesnesinin geçerli olup olmadığını proaktif olarak belirlemek için aşağıdaki gibi kod yazabilir ve herhangi bir özel durum çıkarmadan tüm ihlallerin listesini alabilir:</span><span class="sxs-lookup"><span data-stu-id="5377a-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="5377a-236">Bir Akşam Yemeği'ni geçersiz bir durumda kaydetmeye çalışırsak, DinnerRepository'de Kaydet() yöntemini aradığımız zaman bir özel durum ortaya çıkacaktır.</span><span class="sxs-lookup"><span data-stu-id="5377a-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="5377a-237">Bunun nedeni, LINQ to SQL'in Dinner.OnValidate() kısmi metodumuzu Akşam Yemeği'nin değişikliklerini kaydetmeden önce otomatik olarak araması ve Akşam Yemeği'nde herhangi bir kural ihlali varsa bir özel durum çıkarmak için Dinner.OnValidate() kodu eklediğimiz için oluşur.</span><span class="sxs-lookup"><span data-stu-id="5377a-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="5377a-238">Bu özel durumu yakalayabilir ve düzeltmek için ihlallerin bir listesini reaktif olarak alabiliriz:</span><span class="sxs-lookup"><span data-stu-id="5377a-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="5377a-239">Doğrulama ve iş kurallarımız Kullanıcı Arabirimi katmanımızda değil, model katmanımızda uygulandığından, uygulamamızdaki tüm senaryolarda uygulanacak ve kullanılacaktır.</span><span class="sxs-lookup"><span data-stu-id="5377a-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="5377a-240">Daha sonra iş kurallarını değiştirebilir veya ekleyebilir ve Dinner nesnelerimizle çalışan tüm kodların onları onurlandırabilir.</span><span class="sxs-lookup"><span data-stu-id="5377a-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="5377a-241">Bu değişikliklerin uygulama ve Kullanıcı Yanı mantığı boyunca dalgalanmayaşamadan, iş kurallarını tek bir yerde değiştirme esnekliğine sahip olmak, iyi yazılmış bir uygulamanın ve MVC çerçevesinin teşvik etmeye yardımcı olduğu bir faydanın işaretidir.</span><span class="sxs-lookup"><span data-stu-id="5377a-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="5377a-242">Sonraki Adım</span><span class="sxs-lookup"><span data-stu-id="5377a-242">Next Step</span></span>

<span data-ttu-id="5377a-243">Artık veritabanımızı hem sorgulamak hem de güncellemek için kullanabileceğimiz bir modelimiz var.</span><span class="sxs-lookup"><span data-stu-id="5377a-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="5377a-244">Şimdi projeye, çevresinde bir HTML UI deneyimi oluşturmak için kullanabileceğimiz bazı denetleyiciler ve görünümler ekleyelim.</span><span class="sxs-lookup"><span data-stu-id="5377a-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5377a-245">[Önceki](create-a-database.md)
> [Sonraki](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="5377a-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
