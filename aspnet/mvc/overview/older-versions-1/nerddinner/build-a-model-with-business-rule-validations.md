---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: İş kuralı doğrulamaları ile Model oluşturma | Microsoft Docs
author: microsoft
description: 3. adım, biz hem sorgulamak için kullanma ve böylelikle veritabanı NerdDinner uygulamamız için güncelleştirme modeli oluşturma işlemi gösterilmektedir.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: f5829aab8cb266a65674d052ab77ab8e10c60670
ms.sourcegitcommit: 289e051cc8a90e8f7127e239fda73047bde4de12
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/25/2019
ms.locfileid: "58422863"
---
<a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="a51c3-103">İş Kuralı Doğrulamaları ile Model Oluşturma</span><span class="sxs-lookup"><span data-stu-id="a51c3-103">Build a Model with Business Rule Validations</span></span>
====================
<span data-ttu-id="a51c3-104">tarafından [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="a51c3-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="a51c3-105">PDF'yi indirin</span><span class="sxs-lookup"><span data-stu-id="a51c3-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="a51c3-106">Adım 3 / ücretsiz budur ["NerdDinner" uygulaması Öğreticisi](introducing-the-nerddinner-tutorial.md) , Yürüyüşü nasıl küçük bir derleme, ancak tamamlandı, ASP.NET MVC 1 kullanarak web uygulaması aracılığıyla.</span><span class="sxs-lookup"><span data-stu-id="a51c3-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="a51c3-107">3. adım, biz hem sorgulamak için kullanma ve böylelikle veritabanı NerdDinner uygulamamız için güncelleştirme modeli oluşturma işlemi gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="a51c3-108">ASP.NET MVC 3 kullanıyorsanız, takip ettiğiniz öneririz [MVC 3 ile çalışmaya başlama](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) veya [MVC müzik Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) öğreticiler.</span><span class="sxs-lookup"><span data-stu-id="a51c3-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="a51c3-109">NerdDinner adım 3: Modeli oluşturma</span><span class="sxs-lookup"><span data-stu-id="a51c3-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="a51c3-110">Bir model-view-controller çerçeve "modeli" terimi, doğrulama ve iş kuralları ile tümleştiren karşılık gelen etki alanı mantığı yanı sıra, uygulama verilerini temsil eden nesneleri anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="a51c3-111">Modeli birçok şekilde MVC tabanlı bir uygulamanın "Kalp" olan ve daha sonra temelde anlatıldığı gibi davranışını sürücüler.</span><span class="sxs-lookup"><span data-stu-id="a51c3-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="a51c3-112">Tüm veri erişim teknolojisi kullanarak ASP.NET MVC çerçevesi destekler ve geliştiricilere çeşitli dahil olmak üzere modellerini uygulamak için zengin .NET veri seçenekleri arasından seçim yapabilirsiniz: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, veya yalnızca ham ADO.NET DataReaders veya veri kümeleri.</span><span class="sxs-lookup"><span data-stu-id="a51c3-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="a51c3-113">NerdDinner uygulamamız için oldukça yakından bizim için veritabanı tasarımı karşılık gelir ve bazı özel doğrulama mantığı ve iş kurallarını ekler ve basit bir model oluşturmak için LINQ to SQL kullanmak için kullanacağız.</span><span class="sxs-lookup"><span data-stu-id="a51c3-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="a51c3-114">Soyut hemen yardımcı olan bir depo sınıfına sonra rest bizim için kolayca birim testi etkinleştirir ve uygulama veri kalıcılığı uygulamasından uygular.</span><span class="sxs-lookup"><span data-stu-id="a51c3-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="a51c3-115">LINQ - SQL</span><span class="sxs-lookup"><span data-stu-id="a51c3-115">LINQ to SQL</span></span>

<span data-ttu-id="a51c3-116">LINQ to SQL .NET 3.5 bir parçası olarak gönderilen bir ORM (nesne ilişkisel eşleyicidir) olur.</span><span class="sxs-lookup"><span data-stu-id="a51c3-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="a51c3-117">LINQ to SQL veritabanı tablolarına karşı kodlayabilirsiniz .NET sınıfları eşlemek için kolay bir yol sağlar.</span><span class="sxs-lookup"><span data-stu-id="a51c3-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="a51c3-118">NerdDinner uygulamamız için veritabanımızdaki Akşam Yemeği ve RSVP sınıflarına içinde azalma ve RSVP tabloları eşleştirmek için kullanacağız.</span><span class="sxs-lookup"><span data-stu-id="a51c3-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="a51c3-119">Azalma ve RSVP tablo sütunlarını Akşam Yemeği ve RSVP sınıflarda özelliklerine karşılık gelir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="a51c3-120">Her Akşam Yemeği ve RSVP nesne veritabanında azalma veya RSVP tabloları içinde ayrı bir satırda temsil eder.</span><span class="sxs-lookup"><span data-stu-id="a51c3-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="a51c3-121">LINQ to SQL aktarımlardaki bize el ile alma ve güncelleştirme Akşam Yemeği ve RSVP SQL deyimlerini oluşturmak zorunda kalmamak veritabanı veri nesneleriyle.</span><span class="sxs-lookup"><span data-stu-id="a51c3-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="a51c3-122">Bunun yerine, Akşam Yemeği ve RSVP sınıfları tanımlarız bunların eşleneceğine nasıl / veritabanı ve aralarındaki ilişkiler.</span><span class="sxs-lookup"><span data-stu-id="a51c3-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="a51c3-123">LINQ to SQL ardından etkileşim ve bunları çalışma zamanında kullanmak için uygun SQL yürütme mantığı oluşturma bakım sürer.</span><span class="sxs-lookup"><span data-stu-id="a51c3-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="a51c3-124">VB ve C# içinde LINQ dil desteği Akşam Yemeği ve RSVP almak ifadesel sorgular yazmak için kullanabiliriz nesnelerini veritabanından.</span><span class="sxs-lookup"><span data-stu-id="a51c3-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="a51c3-125">Bu veri kod yazmak için ihtiyacımız miktarını en aza indirir ve çok temiz uygulamalar oluşturmanıza olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="a51c3-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="a51c3-126">Ekleme LINQ to SQL sınıfları Projemizin için</span><span class="sxs-lookup"><span data-stu-id="a51c3-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="a51c3-127">Biz Projemizin içinde "Modelleri" klasörüne sağ tıklayarak başlayın ve seçin **Add -&gt;yeni öğe** menü komutu:</span><span class="sxs-lookup"><span data-stu-id="a51c3-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="a51c3-128">Bu, "Add New Item" iletişim kutusu getirir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="a51c3-129">Biz "Veri" kategoriye göre filtreleme ve bunun içinde "SQL sınıfları için LINQ" şablonu seçin:</span><span class="sxs-lookup"><span data-stu-id="a51c3-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="a51c3-130">Biz "NerdDinner" öğe adı ve "Ekle" düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="a51c3-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="a51c3-131">Visual Studio bizim \Models dizini altında NerdDinner.dbml dosya ekleyin ve ardından LINQ to SQL Nesne İlişkisel Tasarımcısı açın:</span><span class="sxs-lookup"><span data-stu-id="a51c3-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="a51c3-132">LINQ to SQL ile veri modeli sınıfları oluşturma</span><span class="sxs-lookup"><span data-stu-id="a51c3-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="a51c3-133">LINQ to SQL hızla var olan veritabanı şema veri modeli sınıfları oluşturma sağlıyor.</span><span class="sxs-lookup"><span data-stu-id="a51c3-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="a51c3-134">Yapılacaklar bu biz NerdDinner veritabanı sunucu Gezgini'nde açın ve tabloları seçme içinde model istiyoruz:</span><span class="sxs-lookup"><span data-stu-id="a51c3-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="a51c3-135">Ardından LINQ tabloları SQL Tasarımcı yüzeyine sürükleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a51c3-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="a51c3-136">Bu LINQ SQL zaman yaptığımız Dinner otomatik olarak oluşturur ve RSVP sınıfları (özellikleriyle tablolarını için veritabanı tablo sütunlarından eşleyen sınıfı) şemasını kullanarak:</span><span class="sxs-lookup"><span data-stu-id="a51c3-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="a51c3-137">"Veritabanı şemasını temel alan sınıflar oluşturduğunda varsayılan LINQ to SQL Tasarımcı otomatik olarak tablo ve sütun adları çoğullaştırır".</span><span class="sxs-lookup"><span data-stu-id="a51c3-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="a51c3-138">Örneğin: Yukarıdaki örneğimizde "Azalma" Tablo "Akşam Yemeği" sınıfında sonuçlandı.</span><span class="sxs-lookup"><span data-stu-id="a51c3-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="a51c3-139">Bu sınıf adlandırma bizim modelleri .NET adlandırma kuralları ile tutarlı hale getirir ve genellikle bu Tasarımcı düzeltme bu kullanışlı ayarlama (özellikle de tabloların çok sayıda eklerken) sahip bulabilirim.</span><span class="sxs-lookup"><span data-stu-id="a51c3-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="a51c3-140">Bir sınıf ya da her zaman geçersiz kılmak ve istediğiniz bir adla değiştirin olsa, oluşturduğu Tasarımcı, özellik adını beğenmezseniz.</span><span class="sxs-lookup"><span data-stu-id="a51c3-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="a51c3-141">Varlık/özellik adı satır içini Tasarımcı düzenleyerek veya özellik kılavuzunda değiştirerek bunu yapabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a51c3-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="a51c3-142">LINQ to SQL Tasarımcı ayrıca tabloların birincil anahtarı/yabancı anahtar ilişkileri inceler ve bunları temel alan otomatik olarak varsayılan olarak, varsayılan "ilişkisi ilişkilendirmeleri" arasında farklı model sınıfları oluşturur oluşturur.</span><span class="sxs-lookup"><span data-stu-id="a51c3-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="a51c3-143">Bir yabancı anahtar tablosuna azalma RSVP tablonuz dayanarak gerçeğine Örneğin, ne zaman azalma Sürüklemeyi tercih ve RSVP tabloları LINQ to SQL Tasarımcı üzerine bir-çok ilişkisi ilişkilendirmesi ikisi arasındaki çıkarılan (Bu oku simgesiyle belirtilir Tasarımcı):</span><span class="sxs-lookup"><span data-stu-id="a51c3-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="a51c3-144">Yukarıdaki ilişkilendirme LINQ geliştiriciler ile belirli bir RSVP ilişkili Akşam Yemeği erişmek için kullanabileceğiniz RSVP sınıfı türü kesin belirlenmiş bir "Akşam Yemeği" özelliği eklemek için SQL neden olur.</span><span class="sxs-lookup"><span data-stu-id="a51c3-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="a51c3-145">Ayrıca, geliştiricilerin almak ve belirli bir Akşam Yemeği ile ilişkili RSVP nesnelerini güncelleştirme sağlayan "RSVPs" bir koleksiyon özelliği Dinner sınıfı neden olur.</span><span class="sxs-lookup"><span data-stu-id="a51c3-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="a51c3-146">Aşağıda yeni RSVP nesne oluşturma ve Dinner'ın LCV'ler koleksiyona eklemek IntelliSense Visual Studio içinden bir örneğini görebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a51c3-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="a51c3-147">Nasıl LINQ to SQL otomatik olarak "LCV'ler" koleksiyonu Şimdi Akşam nesnede eklenen dikkat edin:</span><span class="sxs-lookup"><span data-stu-id="a51c3-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="a51c3-148">Akşam Yemeği'nın LCV'ler koleksiyonuna RSVP nesne ekleyerek biz LINQ Akşam Yemeği veritabanımızdaki RSVP satır arasında bir yabancı anahtar ilişkisi ilişkilendirilecek SQL söylemiş olursunuz:</span><span class="sxs-lookup"><span data-stu-id="a51c3-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="a51c3-149">Tasarımcı nasıl veya modellenmiş adlı bir tablo ilişkisi beğenmezseniz geçersiz kılabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a51c3-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="a51c3-150">Yalnızca Tasarımcı içinde ilişkilendirme oku tıklatın ve özelliklerini yeniden adlandırma, silme veya değiştirmek için özellik kılavuzunu aracılığıyla erişin.</span><span class="sxs-lookup"><span data-stu-id="a51c3-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="a51c3-151">NerdDinner uygulamamız için yine de oluşturmakta olduğunuz da veri modeli sınıfları için varsayılan ilişkilendirme kuralları çalışır ve yalnızca varsayılan davranışı kullanabiliriz.</span><span class="sxs-lookup"><span data-stu-id="a51c3-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="a51c3-152">NerdDinnerDataContext Class</span><span class="sxs-lookup"><span data-stu-id="a51c3-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="a51c3-153">Visual Studio, modelleri ve LINQ to SQL Tasarımcı kullanılarak tanımlanan veritabanı ilişkileri temsil eden .NET sınıfları otomatik olarak oluşturur.</span><span class="sxs-lookup"><span data-stu-id="a51c3-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="a51c3-154">Bir LINQ to SQL Datacontext'e sınıf ayrıca her bir LINQ to SQL Tasarımcı dosyası çözüme oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="a51c3-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="a51c3-155">Size sunduğumuz LINQ to SQL sınıf öğesi "NerdDinner" kullandığından, oluşturulan DataContext sınıf "NerdDinnerDataContext" olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="a51c3-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="a51c3-156">Bu NerdDinnerDataContext sınıf biz veritabanıyla etkileşim birincil yoludur.</span><span class="sxs-lookup"><span data-stu-id="a51c3-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="a51c3-157">Bizim NerdDinnerDataContext sınıfı iki özellikleri - biz veritabanı içinde modellenmiş iki tabloları temsil eden "Azalma" ve "RSVPs" - gösterir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="a51c3-158">C# LINQ sorguları bu özellikleri veritabanından sorgu ve alma Akşam Yemeği ve RSVP nesnelerine yazmak için kullanabiliriz.</span><span class="sxs-lookup"><span data-stu-id="a51c3-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="a51c3-159">Aşağıdaki kod bir NerdDinnerDataContext nesnesinin örneğini oluşturma ve bir dizi gelecekte ortaya azalma almak üzere bir LINQ sorgusu gerçekleştirmek nasıl gösterir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="a51c3-160">LINQ Sorgu yazarken, Visual Studio IntelliSense sağlar ve ondan döndürülen nesneleri türü kesin olarak belirtilmiş ve IntelliSense de destekler:</span><span class="sxs-lookup"><span data-stu-id="a51c3-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="a51c3-161">Akşam Yemeği ve RSVP nesneleri sorgulamak bize yayımlamanızı bir NerdDinnerDataContext üzerinden alıyoruz Dinner ve RSVP nesnelere biz sonradan yaptığınız tüm değişiklikler otomatik olarak izler.</span><span class="sxs-lookup"><span data-stu-id="a51c3-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="a51c3-162">Değişiklikleri kolayca kaydetmek veritabanına - açık SQL güncelleştirme kod yazmaya gerek kalmadan bu işlevselliği kullanabiliriz.</span><span class="sxs-lookup"><span data-stu-id="a51c3-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="a51c3-163">Örneğin, aşağıdaki kod bir LINQ Sorgu tek bir Akşam Yemeği nesne veritabanından, iki Dinner özelliklerini güncelleştirin ve değişiklikleri veritabanına geri kaydedin için nasıl kullanılacağını göstermektedir:</span><span class="sxs-lookup"><span data-stu-id="a51c3-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="a51c3-164">NerdDinnerDataContext nesne üzerindeki kodda biz alınan Dinner nesneye özellik değişikliklerinin otomatik olarak izlenir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="a51c3-165">Biz "SubmitChanges()" yöntemi çağrıldığında, "Güncelleştir" uygun SQL deyimi veritabanına güncelleştirilmiş değerleri geri kalıcı hale getirmek için çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="a51c3-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="a51c3-166">DinnerRepository sınıfı oluşturma</span><span class="sxs-lookup"><span data-stu-id="a51c3-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="a51c3-167">Küçük uygulamalar için bazen bir LINQ to SQL Datacontext'e sınıfı karşı doğrudan çalışma ve LINQ sorguları içinde denetleyicileri ekleme denetleyicileri uygundur.</span><span class="sxs-lookup"><span data-stu-id="a51c3-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="a51c3-168">Ancak, uygulamaları daha büyük alma gibi bu yaklaşım sağlamak ve test etmek için zahmetli hale gelir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="a51c3-169">Bize birden çok yerde aynı LINQ sorguları çoğaltma da neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="a51c3-170">Uygulamaları sağlamak ve test etmek daha kolay hale getirebilirsiniz bir yaklaşım, "depo" deseni kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="a51c3-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="a51c3-171">Bir depo sınıfına veri sorgulama ve Kalıcılık mantığı ve hemen özetleri uygulamadan veri kalıcılığı uygulama ayrıntılarını kapsüllemek yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="a51c3-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="a51c3-172">Uygulama kodu temizleme yapmak, ek bir depo deseni kullanarak veri depolama uygulamaları değiştirmeye kolaylaştırabilir ve birim gerçek bir veritabanı gerek kalmadan uygulama testi kolaylaştırmak yardımcı olabilir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="a51c3-173">NerdDinner uygulamamız için biz DinnerRepository sınıfıyla tanımlarsınız imza aşağıda:</span><span class="sxs-lookup"><span data-stu-id="a51c3-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="a51c3-174">*Not: Bu bölümde daha sonra Biz bu sınıftan IDinnerRepository arabirimi ayıklayın ve onunla bağımlılık ekleme bizim denetleyicilerinde etkinleştir. Başlangıç olarak, yine de başlayın ve yalnızca doğrudan DinnerRepository sınıfı ile çalışmak için kullanacağız.*</span><span class="sxs-lookup"><span data-stu-id="a51c3-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="a51c3-175">Biz bizim "Modelleri" klasörü sağ tıklatın ve seçin, bu sınıf uygulamak için **Add -&gt;yeni öğe** menü komutu.</span><span class="sxs-lookup"><span data-stu-id="a51c3-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="a51c3-176">"Yeni Öğe Ekle" iletişim kutusunun içinden biz "Class" şablonu seçin ve "DinnerRepository.cs" dosya adı:</span><span class="sxs-lookup"><span data-stu-id="a51c3-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="a51c3-177">Biz, ardından aşağıdaki kodu kullanarak bizim DinnerRepository sınıfı uygulayabilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="a51c3-177">We can then implement our DinnerRepository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="a51c3-178">Alma, güncelleştirme, ekleme ve silme DinnerRepository sınıfını kullanma</span><span class="sxs-lookup"><span data-stu-id="a51c3-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="a51c3-179">Bizim DinnerRepository sınıfı oluşturduk, ortak görevler ile yapabileceğimiz gösteren birkaç kod örnekleri göz atalım:</span><span class="sxs-lookup"><span data-stu-id="a51c3-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="a51c3-180">Örnekleri sorgulama</span><span class="sxs-lookup"><span data-stu-id="a51c3-180">Querying Examples</span></span>

<span data-ttu-id="a51c3-181">Aşağıdaki kod DinnerID değerini kullanarak tek bir Akşam Yemeği alır:</span><span class="sxs-lookup"><span data-stu-id="a51c3-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>


[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="a51c3-182">Aşağıdaki kod, tüm gelecek azalma ve döngüler üzerlerine alır:</span><span class="sxs-lookup"><span data-stu-id="a51c3-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="a51c3-183">INSERT ve Update örnekleri</span><span class="sxs-lookup"><span data-stu-id="a51c3-183">Insert and Update Examples</span></span>

<span data-ttu-id="a51c3-184">Aşağıdaki kod, iki yeni azalma eklemeyi gösterir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="a51c3-185">"Save()" yöntemi çağrılana kadar depoya ekleme/değişiklik veritabanına taahhüt değildir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="a51c3-186">LINQ to SQL otomatik olarak tüm değişiklikleri bir veritabanı işlemindeki – tüm değişiklikleri ortaya ya da depomuzda kaydettiğinde bunların hiçbiri yapmak sarmalar:</span><span class="sxs-lookup"><span data-stu-id="a51c3-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="a51c3-187">Aşağıdaki kod Şimdi Akşam nesnelerinden alır ve iki özelliklerde değiştirir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="a51c3-188">Depomuzda "Save()" yöntemi çağrıldığında, değişiklikler veritabanına uygulanır:</span><span class="sxs-lookup"><span data-stu-id="a51c3-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="a51c3-189">Aşağıdaki kod, bir Akşam Yemeği alır ve bir RSVP ekler.</span><span class="sxs-lookup"><span data-stu-id="a51c3-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="a51c3-190">(Olmadığı için birincil-anahtar/yabancı anahtar ilişkisi iki veritabanı arasında), LINQ to SQL bizim için oluşturulan Dinner nesnesindeki LCV'ler koleksiyonunu kullanarak bunu yapar.</span><span class="sxs-lookup"><span data-stu-id="a51c3-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="a51c3-191">Havuzda "Save()" yöntem çağrıldığında bu değişiklik yeni RSVP tabloda satır veritabanına geri kalıcı hale getirilir:</span><span class="sxs-lookup"><span data-stu-id="a51c3-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="a51c3-192">Örnek delete</span><span class="sxs-lookup"><span data-stu-id="a51c3-192">Delete Example</span></span>

<span data-ttu-id="a51c3-193">Aşağıdaki kod, Şimdi Akşam nesnelerinden alır ve sonra silinebilir işaretler.</span><span class="sxs-lookup"><span data-stu-id="a51c3-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="a51c3-194">Havuzda "Save()" yöntemi çağrıldığında veritabanına geri silme işlemeniz:</span><span class="sxs-lookup"><span data-stu-id="a51c3-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="a51c3-195">Doğrulama ve iş kuralı mantığı ile Model sınıfları tümleştirme</span><span class="sxs-lookup"><span data-stu-id="a51c3-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="a51c3-196">Doğrulama ve iş kuralı mantığını verileriyle çalışan herhangi bir uygulamanın önemli bir parçasıdır tümleştirme.</span><span class="sxs-lookup"><span data-stu-id="a51c3-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="a51c3-197">Şema doğrulaması</span><span class="sxs-lookup"><span data-stu-id="a51c3-197">Schema Validation</span></span>

<span data-ttu-id="a51c3-198">LINQ to SQL Tasarımcı kullanarak model sınıfları tanımlandığında, veri modeli sınıfları özelliklerin türleri veritabanı tablosu veri türleri için karşılık gelir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="a51c3-199">Örneğin: "EventDate" tablosundaki azalma "tarih" ise, LINQ to SQL tarafından oluşturulan veri modeli sınıfı türü "(yerleşik bir .NET veri türü olan) DateTime" olacaktır.</span><span class="sxs-lookup"><span data-stu-id="a51c3-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="a51c3-200">Başka bir deyişle, bir tamsayı veya boolean koddan atayın dener ve örtük olarak geçerli olmayan bir dize türü için çalışma zamanında dönüştürmeye çalışırsanız, hata otomatik olarak oluşturur, derleme hatası alırsınız.</span><span class="sxs-lookup"><span data-stu-id="a51c3-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="a51c3-201">LINQ to SQL da otomatik olarak işler escaping SQL değerleri sizin için dizeleri - korunmasına yardımcı olan, SQL ekleme saldırılarına karşı kullanırken kullanırken.</span><span class="sxs-lookup"><span data-stu-id="a51c3-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="a51c3-202">Doğrulama ve iş kural mantığı</span><span class="sxs-lookup"><span data-stu-id="a51c3-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="a51c3-203">Şema doğrulaması ilk adım olarak kullanışlıdır ancak nadiren yeterlidir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="a51c3-204">Çoğu gerçek dünya senaryoları birden çok özellik span, kod yürütmek ve genellikle bir modelin durumunun tanıma sahip daha zengin Doğrulama mantığı belirtme olanağı gerektirir (örnek:, / güncelleştirilen/silinen, veya bir etki alanına özel durumu oluşturuluyor "arşivlenen gibi").</span><span class="sxs-lookup"><span data-stu-id="a51c3-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="a51c3-205">Çok sayıda farklı desenleri ve tanımlamak ve model sınıflarına doğrulama kuralları uygulamak için kullanılan çerçeve mevcuttur ve bu konuda yardımcı olmak için kullanılan birkaç temel .NET Framework burada vardır.</span><span class="sxs-lookup"><span data-stu-id="a51c3-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="a51c3-206">Neredeyse herhangi biri ASP.NET MVC uygulamaları içinde kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a51c3-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="a51c3-207">NerdDinner uygulamamızın amacı doğrultusunda, görece basit ve rahatça desen burada IsValid özelliği ve GetRuleViolations() yöntemi bizim Dinner model nesnesi üzerinde kullanıma sunuyoruz kullanacağız.</span><span class="sxs-lookup"><span data-stu-id="a51c3-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="a51c3-208">IsValid özelliği true veya false doğrulama ve iş kuralları geçerli olup olmadığına bağlı olarak döndürür.</span><span class="sxs-lookup"><span data-stu-id="a51c3-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="a51c3-209">GetRuleViolations() yöntemi herhangi bir kural hatalarının listesini döndürür.</span><span class="sxs-lookup"><span data-stu-id="a51c3-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="a51c3-210">Biz IsValid ve GetRuleViolations() Dinner modelimiz bizim projeye "kısmi class" ekleyerek uygulayacaksınız.</span><span class="sxs-lookup"><span data-stu-id="a51c3-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="a51c3-211">Kısmi sınıflar, yöntemler/özellikler/olaylar (örneğin, LINQ to SQL tasarımcı tarafından oluşturulan Dinner sınıfı) bir VS tasarımcısı tarafından tutulan sınıfları eklemek için kullanılabilir ve kodumuzla uðraþmaya gelen araç önlemeye yardımcı olmak.</span><span class="sxs-lookup"><span data-stu-id="a51c3-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="a51c3-212">Biz \Models klasöre sağ tıklayarak yeni bir kısmi sınıf bizim projesine ekleyin ve ardından "Yeni Öğe Ekle" menü komutunu seçin.</span><span class="sxs-lookup"><span data-stu-id="a51c3-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="a51c3-213">Biz daha sonra "Yeni Öğe Ekle" iletişim kutusunda "Sınıfı" şablonunu seçin ve Dinner.cs adlandırın.</span><span class="sxs-lookup"><span data-stu-id="a51c3-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="a51c3-214">"Ekle" düğmesine tıklayarak sunduğumuz projesine Dinner.cs dosyası ekleme ve IDE içinde açın.</span><span class="sxs-lookup"><span data-stu-id="a51c3-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="a51c3-215">Biz bir temel kural/doğrulama zorlama framework kullanarak ardından uygulayabilirsiniz kod aşağıda:</span><span class="sxs-lookup"><span data-stu-id="a51c3-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="a51c3-216">Yukarıdaki kodla ilgili birkaç Not:</span><span class="sxs-lookup"><span data-stu-id="a51c3-216">A few notes about the above code:</span></span>

- <span data-ttu-id="a51c3-217">Akşam Yemeği sınıfı ile içerdiği kod LINQ to SQL tasarımcı tarafından oluşturulan ve tutulan sınıfıyla birleşik ve tek bir sınıfı derlenmiş anlamına gelir. bir "kısmi" anahtar sözcüğünü – başlar.</span><span class="sxs-lookup"><span data-stu-id="a51c3-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="a51c3-218">Yardımcı bir sınıf kurmamızı kuralı ihlali hakkında daha fazla ayrıntı sağlamak proje ekleyeceğiz RuleViolation sınıftır.</span><span class="sxs-lookup"><span data-stu-id="a51c3-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="a51c3-219">Değerlendirilecek bizim doğrulama ve iş kuralları Dinner.GetRuleViolations() yöntemi neden olur (biz bunları kısa bir süre içinde uygulama).</span><span class="sxs-lookup"><span data-stu-id="a51c3-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="a51c3-220">Daha sonra geri kural hatalar hakkında daha fazla ayrıntı sağlayan RuleViolation nesneleri dizisi döndürür.</span><span class="sxs-lookup"><span data-stu-id="a51c3-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="a51c3-221">Dinner.IsValid özelliği Şimdi Akşam nesne herhangi bir etkin RuleViolations olup olmadığını belirten bir kullanışlı yardımcı özelliği sağlar.</span><span class="sxs-lookup"><span data-stu-id="a51c3-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="a51c3-222">Proaktif olarak Şimdi Akşam nesnesi dilediğiniz zaman kullanılarak bir geliştirici tarafından denetlenebilir (ve bir özel durum oluşturmaz).</span><span class="sxs-lookup"><span data-stu-id="a51c3-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="a51c3-223">Veritabanı içinde yaklaşık sürdürülecek Dinner nesnedir herhangi bir zamanda size bildirilmesini sağlar bir LINQ to SQL sağlayan bir kanca Dinner.OnValidate() kısmi yöntem budur.</span><span class="sxs-lookup"><span data-stu-id="a51c3-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="a51c3-224">OnValidate() kararlılığımızın yukarıdaki, kaydedilmeden önce Dinner hiçbir RuleViolations sahip olmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="a51c3-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="a51c3-225">Geçersiz bir durumda ise LINQ SQL işlem iptal için neden olacak bir özel durum oluşturur.</span><span class="sxs-lookup"><span data-stu-id="a51c3-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="a51c3-226">Bu yaklaşım, biz doğrulama ve iş kuralları ile tümleştirebileceğiniz basit bir çerçeve sağlar.</span><span class="sxs-lookup"><span data-stu-id="a51c3-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="a51c3-227">Şimdilik ekleyelim bizim GetRuleViolations() yöntemi kuralları aşağıda:</span><span class="sxs-lookup"><span data-stu-id="a51c3-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="a51c3-228">Tüm RuleViolations bir dizisini döndürmek için C# "yield return" özelliği kullanıyoruz.</span><span class="sxs-lookup"><span data-stu-id="a51c3-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="a51c3-229">Yukarıdaki ilk altı kural denetimleri, yalnızca bizim Dinner dize özellikleri null veya boş olamaz uygular.</span><span class="sxs-lookup"><span data-stu-id="a51c3-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="a51c3-230">Son kural biraz daha ilginçtir ve çağrıları biz doğrulamak için Projemizin ContactPhone ekleyebilirsiniz PhoneValidator.IsValidNumber() yardımcı yöntem sayı biçimi eşleşme Akşam Yemeği'nın ülke.</span><span class="sxs-lookup"><span data-stu-id="a51c3-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="a51c3-231">Kullanabiliriz. Bu telefon doğrulama desteği uygulamak için NET normal ifade desteği.</span><span class="sxs-lookup"><span data-stu-id="a51c3-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="a51c3-232">Ekleyebiliriz basit bir PhoneValidator uygulama aşağıdadır Ülkeye özel normal ifade deseni denetimleri Ekle sağlıyor Projemizin için:</span><span class="sxs-lookup"><span data-stu-id="a51c3-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="a51c3-233">Doğrulama ve iş mantığı ihlalleri işleme</span><span class="sxs-lookup"><span data-stu-id="a51c3-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="a51c3-234">Yukarıdaki doğrulama ve iş kuralı kod, oluşturulacak veya güncelleştirilecek bir Akşam Yemeği Çalıştığımızda dilediğiniz zaman ekledik, bizim Doğrulama mantığı kuralları değerlendirilir ve zorunlu tutulur.</span><span class="sxs-lookup"><span data-stu-id="a51c3-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="a51c3-235">Geliştiriciler gibi aşağıda proaktif olarak Dinner nesne geçerli olup olmadığını belirlemek için kod ve içindeki tüm ihlalleri herhangi bir özel durumlarını oluşturma olmadan listesini almak yazabilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="a51c3-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="a51c3-236">Biz, geçersiz bir durumda bir Akşam Yemeği kaydetmeyi denerse, biz üzerinde DinnerRepository Save() yöntemi çağırdığınızda bir özel durum gerçekleştirilecektir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="a51c3-237">Bu durum, LINQ to SQL otomatik olarak Akşam Yemeği'nın değişiklikleri kaydeder ve Dinner.OnValidate() Akşam Yemeği içinde herhangi bir kural ihlallerini mevcut bir özel durum oluşturmak için kod ekledik önce bizim Dinner.OnValidate() kısmi yöntem çağrıları kaynaklanır.</span><span class="sxs-lookup"><span data-stu-id="a51c3-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="a51c3-238">Bu özel durumu yakalar ve öngörülebiliyorsa ihlallerini düzeltmek için bir listesini alın:</span><span class="sxs-lookup"><span data-stu-id="a51c3-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="a51c3-239">Bizim doğrulama ve iş kuralları UI yerleşiminde içinde değil ve bizim modeli katmanı içinde uygulanan olduğundan, bunlar uygulanan ve uygulamamızı içindeki tüm senaryolarında kullanılan.</span><span class="sxs-lookup"><span data-stu-id="a51c3-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="a51c3-240">Daha sonra değiştirmek veya iş kuralları ekleyebilir ve bizim Dinner nesneleri ile çalışır bunları dikkate tüm koda sahip.</span><span class="sxs-lookup"><span data-stu-id="a51c3-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="a51c3-241">İş kuralları tek bir yerde değiştirme esnekliğine sahip olmak, bu değişiklikler uygulama ve UI mantığı ripple zorunda kalmadan bir iyi yazılmış uygulama ve MVC çerçevesi teşvik yardımcı olur. bir avantajı işaretidir.</span><span class="sxs-lookup"><span data-stu-id="a51c3-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="a51c3-242">Sonraki adım</span><span class="sxs-lookup"><span data-stu-id="a51c3-242">Next Step</span></span>

<span data-ttu-id="a51c3-243">Artık sorgu hem bizim veritabanını güncellemek için kullanabileceğiniz bir model sorunumuz.</span><span class="sxs-lookup"><span data-stu-id="a51c3-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="a51c3-244">Şimdi bazı denetleyicileri ve görünümleri çevresinde bir HTML kullanıcı Arabirimi deneyimi oluşturmak için kullanabiliriz proje ekleyelim.</span><span class="sxs-lookup"><span data-stu-id="a51c3-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a51c3-245">[Önceki](create-a-database.md)
> [İleri](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="a51c3-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
