---
uid: mvc/overview/older-versions/using-oauth-providers-with-mvc
title: MVC 4 ile OAuth sağlayıcılarını kullanma | Microsoft Docs
author: Rick-Anderson
description: Bu öğreticide, kullanıcıların, bir dış sağlayıcıdan gelen kimlik bilgileriyle oturum açmasına olanak tanıyan bir ASP.NET MVC 4 Web uygulamasının nasıl oluşturulacağı gösterilmektedir...
ms.author: riande
ms.date: 06/19/2013
ms.assetid: 7a87f16f-0e19-4f15-a88a-094ae866c4a2
msc.legacyurl: /mvc/overview/older-versions/using-oauth-providers-with-mvc
msc.type: authoredcontent
ms.openlocfilehash: 5dfd1305376a62f4987caea242ca0f6aac1018e9
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78539083"
---
# <a name="using-oauth-providers-with-mvc-4"></a><span data-ttu-id="d9520-103">MVC 4 ile OAuth Sağlayıcıları Kullanma</span><span class="sxs-lookup"><span data-stu-id="d9520-103">Using OAuth Providers with MVC 4</span></span>

<span data-ttu-id="d9520-104">[Tom FitzMacken](https://github.com/tfitzmac) tarafından</span><span class="sxs-lookup"><span data-stu-id="d9520-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="d9520-105">Bu öğreticide, kullanıcıların Facebook, Twitter, Microsoft veya Google gibi bir dış sağlayıcıdan kimlik bilgileriyle oturum açmasını sağlayan bir ASP.NET MVC 4 Web uygulaması oluşturma ve ardından bu sağlayıcılardan bazı işlevleri tümleştirme Web uygulaması.</span><span class="sxs-lookup"><span data-stu-id="d9520-105">This tutorial shows you how to build an ASP.NET MVC 4 web application that enables users to log in with credentials from an external provider, such as Facebook, Twitter, Microsoft, or Google, and then integrate some of the functionality from those providers into your web application.</span></span> <span data-ttu-id="d9520-106">Kolaylık olması için, bu öğretici Facebook kimlik bilgileriyle çalışmaya odaklanır.</span><span class="sxs-lookup"><span data-stu-id="d9520-106">For simplicity, this tutorial focuses on working with credentials from Facebook.</span></span>
> 
> <span data-ttu-id="d9520-107">Dış kimlik bilgilerini bir ASP.NET MVC 5 Web uygulamasında kullanmak için bkz. [Facebook ve Google OAuth2 Ile OpenID oturum açma ile ASP.NET MVC 5 uygulaması oluşturma](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="d9520-107">To use external credentials in an ASP.NET MVC 5 web application, see [Create an ASP.NET MVC 5 App with Facebook and Google OAuth2 and OpenID Sign-on](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
> 
> <span data-ttu-id="d9520-108">Bu kimlik bilgilerini Web sitelerinizde etkinleştirmek, milyonlarca kullanıcının zaten bu dış sağlayıcıları olan hesapları olduğundan önemli bir avantaj sağlar.</span><span class="sxs-lookup"><span data-stu-id="d9520-108">Enabling these credentials in your web sites provides a significant advantage because millions of users already have accounts with these external providers.</span></span> <span data-ttu-id="d9520-109">Bu kullanıcılar yeni bir kimlik bilgileri kümesi oluşturup hatırlamaları zorunda olmadıkları takdirde sitenize kaydolmak için daha fazla işlem yapılabilir.</span><span class="sxs-lookup"><span data-stu-id="d9520-109">These users may be more inclined to sign up for your site if they do not have to create and remember a new set of credentials.</span></span> <span data-ttu-id="d9520-110">Ayrıca, bir Kullanıcı bu sağlayıcılardan biri aracılığıyla oturum açtıktan sonra, sağlayıcıdan sosyal işlemler ekleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-110">Also, after a user has logged in through one of these providers, you can incorporate social operations from the provider.</span></span>

## <a name="what-youll-build"></a><span data-ttu-id="d9520-111">Ne oluşturacağız?</span><span class="sxs-lookup"><span data-stu-id="d9520-111">What you'll build</span></span>

<span data-ttu-id="d9520-112">Bu öğreticide iki ana hedef vardır:</span><span class="sxs-lookup"><span data-stu-id="d9520-112">There are two main goals in this tutorial:</span></span>

1. <span data-ttu-id="d9520-113">Bir kullanıcının OAuth sağlayıcısından kimlik bilgileriyle oturum açmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="d9520-113">Enable a user to log in with credentials from an OAuth provider.</span></span>
2. <span data-ttu-id="d9520-114">Sağlayıcıdan hesap bilgilerini alın ve bu bilgileri sitenizin hesap kaydıyla tümleştirin.</span><span class="sxs-lookup"><span data-stu-id="d9520-114">Retrieve account information from the provider and integrate that information with the account registration for your site.</span></span>

<span data-ttu-id="d9520-115">Bu öğreticideki örneklerde, kimlik doğrulama sağlayıcısı olarak Facebook kullanmaya odaklanmakla birlikte, sağlayıcıyı kullanmak için kodu değiştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-115">Although the examples in this tutorial focus on using Facebook as the authentication provider, you can modify the code to use any of the providers.</span></span> <span data-ttu-id="d9520-116">Herhangi bir sağlayıcıyı uygulama adımları, bu öğreticide göreceğiniz adımlara çok benzer.</span><span class="sxs-lookup"><span data-stu-id="d9520-116">The steps to implement any provider are very similar to the steps you will see in this tutorial.</span></span> <span data-ttu-id="d9520-117">Sağlayıcının API kümesine doğrudan çağrı yaparken yalnızca önemli farklılıklar olduğunu fark edeceksiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-117">You will only notice significant differences when making direct calls to the provider's API set.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="d9520-118">Önkoşullar</span><span class="sxs-lookup"><span data-stu-id="d9520-118">Prerequisites</span></span>

- <span data-ttu-id="d9520-119">Web için [Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) veya [Microsoft Visual Studio Express 2012](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span><span class="sxs-lookup"><span data-stu-id="d9520-119">[Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) or [Microsoft Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span></span>

<span data-ttu-id="d9520-120">Veya</span><span class="sxs-lookup"><span data-stu-id="d9520-120">Or</span></span>

- <span data-ttu-id="d9520-121">Microsoft Visual Studio 2010 SP1 veya [Visual Web Developer Express 2010 SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span><span class="sxs-lookup"><span data-stu-id="d9520-121">Microsoft Visual Studio 2010 SP1 or [Visual Web Developer Express 2010 SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span></span>
- [<span data-ttu-id="d9520-122">ASP.NET MVC 4</span><span class="sxs-lookup"><span data-stu-id="d9520-122">ASP.NET MVC 4</span></span>](https://go.microsoft.com/fwlink/?LinkId=243392)

<span data-ttu-id="d9520-123">Ayrıca, bu konuda ASP.NET MVC ve Visual Studio hakkında temel bilgiye sahip olduğunuz varsayılmaktadır.</span><span class="sxs-lookup"><span data-stu-id="d9520-123">Furthermore, this topic assumes you have basic knowledge about ASP.NET MVC and Visual Studio.</span></span> <span data-ttu-id="d9520-124">ASP.NET MVC 4 ' e giriş yapmanız gerekiyorsa, bkz. [ASP.NET MVC 4 ' e giriş](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span><span class="sxs-lookup"><span data-stu-id="d9520-124">If you need an introduction to ASP.NET MVC 4, see [Intro to ASP.NET MVC 4](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span></span>

## <a name="create-the-project"></a><span data-ttu-id="d9520-125">Projeyi oluşturma</span><span class="sxs-lookup"><span data-stu-id="d9520-125">Create the project</span></span>

<span data-ttu-id="d9520-126">Visual Studio 'da yeni bir ASP.NET MVC 4 Web uygulaması oluşturun ve &quot;OAuthMVC&quot;olarak adlandırın.</span><span class="sxs-lookup"><span data-stu-id="d9520-126">In Visual Studio, create a new ASP.NET MVC 4 Web Application, and name it &quot;OAuthMVC&quot;.</span></span> <span data-ttu-id="d9520-127">.NET Framework 4,5 veya 4 ' ü hedefleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-127">You can target either .NET Framework 4.5 or 4.</span></span>

![proje oluştur](using-oauth-providers-with-mvc/_static/image1.png)

<span data-ttu-id="d9520-129">Yeni ASP.NET MVC 4 proje penceresinde **Internet uygulaması** ' nı seçin ve **Razor** 'yi Görünüm altyapısı olarak bırakın.</span><span class="sxs-lookup"><span data-stu-id="d9520-129">In the New ASP.NET MVC 4 Project window, select **Internet Application** and leave **Razor** as the view engine.</span></span>

![Internet uygulaması Seç](using-oauth-providers-with-mvc/_static/image2.png)

## <a name="enable-a-provider"></a><span data-ttu-id="d9520-131">Sağlayıcıyı etkinleştir</span><span class="sxs-lookup"><span data-stu-id="d9520-131">Enable a provider</span></span>

<span data-ttu-id="d9520-132">Internet uygulama şablonuyla MVC 4 Web uygulaması oluşturduğunuzda, proje, uygulama\_başlangıç klasöründe AuthConfig.cs adlı bir dosya ile oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="d9520-132">When you create an MVC 4 web application with the Internet Application template, the project is created with a file named AuthConfig.cs in the App\_Start folder.</span></span>

![AuthConfig dosyası](using-oauth-providers-with-mvc/_static/image3.png)

<span data-ttu-id="d9520-134">AuthConfig dosyası, dış kimlik doğrulama sağlayıcılarının istemcilerini kaydetmek için kod içerir.</span><span class="sxs-lookup"><span data-stu-id="d9520-134">The AuthConfig file contains code to register clients for external authentication providers.</span></span> <span data-ttu-id="d9520-135">Bu kod, varsayılan olarak açıklama olarak belirlenir, bu nedenle dış sağlayıcıların hiçbiri etkinleştirilmez.</span><span class="sxs-lookup"><span data-stu-id="d9520-135">By default, this code is commented out, so none of the external providers are enabled.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample1.cs)]

<span data-ttu-id="d9520-136">Dış kimlik doğrulama istemcisini kullanmak için bu kodun açıklamasını kaldırmalısınız.</span><span class="sxs-lookup"><span data-stu-id="d9520-136">You must uncomment this code to use the external authentication client.</span></span> <span data-ttu-id="d9520-137">Yalnızca sitenize dahil etmek istediğiniz sağlayıcıların açıklamalarını kaldırın.</span><span class="sxs-lookup"><span data-stu-id="d9520-137">You uncomment only the providers you want to include in your site.</span></span> <span data-ttu-id="d9520-138">Bu öğretici için yalnızca Facebook kimlik bilgilerini etkinleştirecektir.</span><span class="sxs-lookup"><span data-stu-id="d9520-138">For this tutorial, you will only enable the Facebook credentials.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample2.cs)]

<span data-ttu-id="d9520-139">Yukarıdaki örnekte, yönteminin kayıt parametreleri için boş dizeler içerdiğine dikkat edin.</span><span class="sxs-lookup"><span data-stu-id="d9520-139">Notice in the above example that the method includes empty strings for the registration parameters.</span></span> <span data-ttu-id="d9520-140">Uygulamayı şimdi çalıştırmayı denerseniz, parametreler için boş dizelere izin verilmediğinden uygulama bir bağımsız değişken özel durumu oluşturur.</span><span class="sxs-lookup"><span data-stu-id="d9520-140">If you try to run the application now, the application throws an argument exception because empty strings are not allowed for the parameters.</span></span> <span data-ttu-id="d9520-141">Geçerli değerler sağlamak için, sonraki bölümde gösterildiği gibi, Web sitenizi dış sağlayıcılarla kaydetmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="d9520-141">To provide valid values, you must register your web site with the external providers, as shown in the next section.</span></span>

## <a name="registering-with-an-external-provider"></a><span data-ttu-id="d9520-142">Dış sağlayıcıya kaydolma</span><span class="sxs-lookup"><span data-stu-id="d9520-142">Registering with an external provider</span></span>

<span data-ttu-id="d9520-143">Bir dış sağlayıcıdan kimlik bilgileriyle kullanıcıların kimliğini doğrulamak için, Web sitenizi sağlayıcıya kaydetmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="d9520-143">To authenticate users with credentials from an external provider, you must register your web site with the provider.</span></span> <span data-ttu-id="d9520-144">Sitenizi kaydettiğinizde, istemciyi kaydederken dahil edilecek parametreleri (anahtar veya kimlik ve gizli dizi) alacaksınız.</span><span class="sxs-lookup"><span data-stu-id="d9520-144">When you register your site, you will receive the parameters (such as key or id, and secret) to include when registering the client.</span></span> <span data-ttu-id="d9520-145">Kullanmak istediğiniz sağlayıcıları içeren bir hesabınız olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="d9520-145">You must have an account with the providers you wish to use.</span></span>

<span data-ttu-id="d9520-146">Bu öğretici, bu sağlayıcılarla kaydolmak için gerçekleştirmeniz gereken adımların tümünü göstermez.</span><span class="sxs-lookup"><span data-stu-id="d9520-146">This tutorial does not show all of the steps you must perform to register with these providers.</span></span> <span data-ttu-id="d9520-147">Adımlar genellikle zor değildir.</span><span class="sxs-lookup"><span data-stu-id="d9520-147">The steps are typically not difficult.</span></span> <span data-ttu-id="d9520-148">Sitenizi başarıyla kaydetmek için, bu sitelerde belirtilen yönergeleri izleyin.</span><span class="sxs-lookup"><span data-stu-id="d9520-148">To successfully register your site, follow the instructions provided on those sites.</span></span> <span data-ttu-id="d9520-149">Sitenizi kaydetmeye başlamak için geliştirici sitesine bakın:</span><span class="sxs-lookup"><span data-stu-id="d9520-149">To get started with registering your site, see the developer site for:</span></span>

- [<span data-ttu-id="d9520-150">Facebook</span><span class="sxs-lookup"><span data-stu-id="d9520-150">Facebook</span></span>](https://developers.facebook.com/)
- [<span data-ttu-id="d9520-151">Google</span><span class="sxs-lookup"><span data-stu-id="d9520-151">Google</span></span>](https://developers.google.com/)
- [<span data-ttu-id="d9520-152">MICROSOFT</span><span class="sxs-lookup"><span data-stu-id="d9520-152">Microsoft</span></span>](http://manage.dev.live.com/)
- [<span data-ttu-id="d9520-153">Twitter</span><span class="sxs-lookup"><span data-stu-id="d9520-153">Twitter</span></span>](https://dev.twitter.com/)

<span data-ttu-id="d9520-154">Sitenizi Facebook 'a kaydederken, aşağıdaki görüntüde gösterildiği gibi site etki alanı için &quot;localhost&quot; ve URL için `&quot; http://localhost/&quot;` sağlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-154">When registering your site with Facebook, you can provide &quot;localhost&quot; for the site domain and `&quot;http://localhost/&quot;` for the URL, as shown in the image below.</span></span> <span data-ttu-id="d9520-155">Localhost kullanılması çoğu sağlayıcı ile çalışır, ancak şu anda Microsoft sağlayıcısıyla birlikte çalışmaz.</span><span class="sxs-lookup"><span data-stu-id="d9520-155">Using localhost works with most providers, but currently does not work with the Microsoft provider.</span></span> <span data-ttu-id="d9520-156">Microsoft sağlayıcısı için geçerli bir Web sitesi URL 'SI dahil etmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="d9520-156">For the Microsoft provider, you must include a valid web site URL.</span></span>

![Siteyi Kaydet](using-oauth-providers-with-mvc/_static/image4.png)

<span data-ttu-id="d9520-158">Önceki görüntüde, uygulama kimliği, uygulama gizli anahtarı ve iletişim e-postası için değerler kaldırılmıştır.</span><span class="sxs-lookup"><span data-stu-id="d9520-158">In the previous image, the values for the app id, app secret, and contact email have been removed.</span></span> <span data-ttu-id="d9520-159">Sitenizi gerçekten kaydettiğinizde, bu değerler mevcut olacaktır.</span><span class="sxs-lookup"><span data-stu-id="d9520-159">When you actually register your site, those values will be present.</span></span> <span data-ttu-id="d9520-160">Uygulama kimliği ve uygulama gizli anahtarı değerlerini uygulamanıza ekleyecek şekilde aklınızda olmak isteyeceksiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-160">You will want to note the values for app id and app secret because you will add them to your application.</span></span>

## <a name="creating-test-users"></a><span data-ttu-id="d9520-161">Test kullanıcıları oluşturma</span><span class="sxs-lookup"><span data-stu-id="d9520-161">Creating test users</span></span>

<span data-ttu-id="d9520-162">Sitenizi test etmek için mevcut bir Facebook hesabını kullanmıyorsanız, bu bölümü atlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-162">If you do not mind using an existing Facebook account to test your site, you can skip this section.</span></span>

<span data-ttu-id="d9520-163">Facebook uygulama yönetimi sayfasından uygulamanız için test kullanıcılarını kolayca oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-163">You can easily create test users for your application within the Facebook app management page.</span></span> <span data-ttu-id="d9520-164">Bu test hesaplarını, sitenizde oturum açmak için kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-164">You can use these test accounts to log in to your site.</span></span> <span data-ttu-id="d9520-165">Sol gezinti bölmesindeki **Roller** bağlantısına tıklayıp **Oluştur** bağlantısına tıklayarak test kullanıcıları oluşturun.</span><span class="sxs-lookup"><span data-stu-id="d9520-165">You create test users by clicking the **Roles** link in the left navigation pane and the clicking the **Create** link.</span></span>

![Test kullanıcıları oluşturma](using-oauth-providers-with-mvc/_static/image5.png)

<span data-ttu-id="d9520-167">Facebook sitesi, isteğiniz test hesaplarının sayısını otomatik olarak oluşturur.</span><span class="sxs-lookup"><span data-stu-id="d9520-167">The Facebook site automatically creates the number of test accounts that you request.</span></span>

## <a name="adding-application-id-and-secret-from-the-provider"></a><span data-ttu-id="d9520-168">Sağlayıcıdan uygulama kimliği ve gizli dizi ekleme</span><span class="sxs-lookup"><span data-stu-id="d9520-168">Adding application id and secret from the provider</span></span>

<span data-ttu-id="d9520-169">Artık Facebook 'tan kimliği ve gizli dizi aldığınızı öğrenolduğunuza göre, AuthConfig dosyasına geri dönün ve parametre değerleri olarak ekleyin.</span><span class="sxs-lookup"><span data-stu-id="d9520-169">Now that you have received the id and secret from Facebook, go back to the AuthConfig file and add them as the parameter values.</span></span> <span data-ttu-id="d9520-170">Aşağıda gösterilen değerler gerçek değer değildir.</span><span class="sxs-lookup"><span data-stu-id="d9520-170">The values shown below are not real values.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample3.cs)]

## <a name="log-in-with-external-credentials"></a><span data-ttu-id="d9520-171">Dış kimlik bilgileriyle oturum açma</span><span class="sxs-lookup"><span data-stu-id="d9520-171">Log in with external credentials</span></span>

<span data-ttu-id="d9520-172">Sitenizde dış kimlik bilgilerini etkinleştirmek için yapmanız gereken tek şey vardır.</span><span class="sxs-lookup"><span data-stu-id="d9520-172">That is all you have to do to enable external credentials in your site.</span></span> <span data-ttu-id="d9520-173">Uygulamanızı çalıştırın ve sağ üst köşedeki oturum aç bağlantısına tıklayın.</span><span class="sxs-lookup"><span data-stu-id="d9520-173">Run your application and click the login link in the upper right corner.</span></span> <span data-ttu-id="d9520-174">Şablon, Facebook 'a sağlayıcı olarak kaydolduysanız ve sağlayıcı için bir düğme içerdiğine göre otomatik olarak tanır.</span><span class="sxs-lookup"><span data-stu-id="d9520-174">The template automatically recognizes that you have registered Facebook as a provider and includes a button for the provider.</span></span> <span data-ttu-id="d9520-175">Birden çok sağlayıcıyı kaydettiğinizde, her biri için bir düğme otomatik olarak eklenir.</span><span class="sxs-lookup"><span data-stu-id="d9520-175">If you register multiple providers, a button for each one is automatically included.</span></span>

![Dış oturum açma](using-oauth-providers-with-mvc/_static/image6.png)

<span data-ttu-id="d9520-177">Bu öğreticide, dış sağlayıcılar için oturum açma düğmelerinin nasıl özelleştirileceği ele alınmaktadır.</span><span class="sxs-lookup"><span data-stu-id="d9520-177">This tutorial does not cover how to customize the log in buttons for the external providers.</span></span> <span data-ttu-id="d9520-178">Bu bilgi için bkz. [OAuth/OpenID kullanırken oturum açma kullanıcı arabirimini özelleştirme](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span><span class="sxs-lookup"><span data-stu-id="d9520-178">For that information, see [Customizing the login UI when using OAuth/OpenID](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span></span>

<span data-ttu-id="d9520-179">Facebook kimlik bilgileriyle oturum açmak için Facebook düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="d9520-179">Click on the Facebook button to log in with Facebook credentials.</span></span> <span data-ttu-id="d9520-180">Dış sağlayıcılardan birini seçtiğinizde, bu siteye yönlendirilirsiniz ve bu hizmetin oturum açması istenir.</span><span class="sxs-lookup"><span data-stu-id="d9520-180">When you select one of the external providers, you are redirected to that site and prompted by that service to log in.</span></span>

<span data-ttu-id="d9520-181">Aşağıdaki görüntüde Facebook oturum açma ekranı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="d9520-181">The following image shows the login screen for Facebook.</span></span> <span data-ttu-id="d9520-182">Oauthmvcexample adlı bir sitede oturum açmak için Facebook hesabınızı kullandığınızı not edin.</span><span class="sxs-lookup"><span data-stu-id="d9520-182">It notes that you are using your Facebook account to log in to a site named oauthmvcexample.</span></span>

![Facebook kimlik doğrulaması](using-oauth-providers-with-mvc/_static/image7.png)

<span data-ttu-id="d9520-184">Facebook kimlik bilgileriyle oturum açtıktan sonra, bir sayfa kullanıcıya sitenin temel bilgilere erişimi olduğunu bildirir.</span><span class="sxs-lookup"><span data-stu-id="d9520-184">After logging in with Facebook credentials, a page informs the user that the site will have access to basic information.</span></span>

![izin iste](using-oauth-providers-with-mvc/_static/image8.png)

<span data-ttu-id="d9520-186">**Uygulamaya git**' i seçtikten sonra, kullanıcının siteye kaydolması gerekir.</span><span class="sxs-lookup"><span data-stu-id="d9520-186">After selecting **Go to App**, the user must register for the site.</span></span> <span data-ttu-id="d9520-187">Aşağıdaki görüntüde, Kullanıcı Facebook kimlik bilgileriyle oturum açtıktan sonra kayıt sayfası gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="d9520-187">The following image shows the registration page after a user has logged in with Facebook credentials.</span></span> <span data-ttu-id="d9520-188">Kullanıcı adı, genellikle sağlayıcıdan bir ad ile önceden doldurulur.</span><span class="sxs-lookup"><span data-stu-id="d9520-188">The user name is typically pre-filled with a name from the provider.</span></span>

![register](using-oauth-providers-with-mvc/_static/image9.png)

<span data-ttu-id="d9520-190">Kayıt işleminin tamamlanabilmesi için **Kaydol** ' a tıklayın.</span><span class="sxs-lookup"><span data-stu-id="d9520-190">Click **Register** to complete registration.</span></span> <span data-ttu-id="d9520-191">Tarayıcıyı kapatın.</span><span class="sxs-lookup"><span data-stu-id="d9520-191">Close the browser.</span></span>

<span data-ttu-id="d9520-192">Yeni hesabın veritabanınıza eklendiğini görebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-192">You can see that the new account has been added to your database.</span></span> <span data-ttu-id="d9520-193">Sunucu Gezgini, **DefaultConnection** veritabanını açın ve **Tables** klasörünü açın.</span><span class="sxs-lookup"><span data-stu-id="d9520-193">In Server Explorer, open the **DefaultConnection** database and open the **Tables** folder.</span></span>

![veritabanı tabloları](using-oauth-providers-with-mvc/_static/image10.png)

<span data-ttu-id="d9520-195">**USERPROFILE** tablosuna sağ tıklayın ve **tablo verilerini göster**' i seçin.</span><span class="sxs-lookup"><span data-stu-id="d9520-195">Right-click the **UserProfile** table and select **Show Table Data**.</span></span>

![verileri göster](using-oauth-providers-with-mvc/_static/image11.png)

<span data-ttu-id="d9520-197">Eklediğiniz yeni hesap görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="d9520-197">You will see the new account you added.</span></span> <span data-ttu-id="d9520-198">**Web sayfası\_OAuthMembership** tablosundaki verilere bakın.</span><span class="sxs-lookup"><span data-stu-id="d9520-198">Look at the data in **webpage\_OAuthMembership** table.</span></span> <span data-ttu-id="d9520-199">Yeni eklediğiniz hesap için dış sağlayıcıyla ilgili daha fazla veri görürsünüz.</span><span class="sxs-lookup"><span data-stu-id="d9520-199">You will see more data related to the external provider for the account you just added.</span></span>

<span data-ttu-id="d9520-200">Yalnızca dış kimlik doğrulamasını etkinleştirmek istiyorsanız işiniz yapılır.</span><span class="sxs-lookup"><span data-stu-id="d9520-200">If you only want to enable external authentication, you are done.</span></span> <span data-ttu-id="d9520-201">Ancak, aşağıdaki bölümlerde gösterildiği gibi sağlayıcıdan bilgileri yeni kullanıcı kayıt işlemine daha fazla tümleştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-201">However, you can further integrate information from the provider into the new user registration process, as shown in the following sections.</span></span>

## <a name="create-models-for-additional-user-information"></a><span data-ttu-id="d9520-202">Ek Kullanıcı bilgileri için modeller oluşturma</span><span class="sxs-lookup"><span data-stu-id="d9520-202">Create models for additional user information</span></span>

<span data-ttu-id="d9520-203">Önceki bölümlerde fark ettiğiniz gibi, yerleşik hesap kaydının çalışması için ek bilgi almanız gerekmez.</span><span class="sxs-lookup"><span data-stu-id="d9520-203">As you noticed in the previous sections, you do not need to retrieve any additional information for the built-in account registration to work.</span></span> <span data-ttu-id="d9520-204">Ancak, çoğu dış sağlayıcı kullanıcı hakkında ek bilgileri geri iletir.</span><span class="sxs-lookup"><span data-stu-id="d9520-204">However, most external providers pass back additional information about the user.</span></span> <span data-ttu-id="d9520-205">Aşağıdaki bölümlerde bu bilgilerin nasıl saklanacağı ve bir veritabanına nasıl kaydedileceği gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="d9520-205">The following sections show how to retain that information and save it to a database.</span></span> <span data-ttu-id="d9520-206">Özellikle, kullanıcının tam adı, kullanıcının kişisel Web sayfasının URI 'SI ve Facebook 'un hesabı doğruladığını belirten bir değer olacak şekilde değerleri koruyabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-206">Specifically, you will retain values for the user's full name, the URI of the user's personal web page, and a value that indicates whether Facebook has verified the account.</span></span>

<span data-ttu-id="d9520-207">Ek Kullanıcı bilgilerini depolamak için bir tablo eklemek üzere [Code First Migrations](https://msdn.microsoft.com/data/jj591621) kullanacaksınız.</span><span class="sxs-lookup"><span data-stu-id="d9520-207">You will use [Code First Migrations](https://msdn.microsoft.com/data/jj591621) to add a table for storing additional user information.</span></span> <span data-ttu-id="d9520-208">Tabloyu var olan bir veritabanına ekliyoruz, bu nedenle ilk olarak geçerli veritabanının bir anlık görüntüsünü oluşturmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="d9520-208">You are adding the table to an existing database, so you will first need to create a snapshot of the current database.</span></span> <span data-ttu-id="d9520-209">Geçerli veritabanının bir anlık görüntüsünü oluşturarak, daha sonra yalnızca yeni tabloyu içeren bir geçiş oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-209">By creating a snapshot of the current database, you can later create a migration that contains only the new table.</span></span> <span data-ttu-id="d9520-210">Geçerli veritabanının anlık görüntüsünü oluşturmak için:</span><span class="sxs-lookup"><span data-stu-id="d9520-210">To create a snapshot of the current database:</span></span>

1. <span data-ttu-id="d9520-211">**Paket Yöneticisi konsolunu** açın</span><span class="sxs-lookup"><span data-stu-id="d9520-211">Open the **Package Manager Console**</span></span>
2. <span data-ttu-id="d9520-212">**Enable-geçişler** komutunu çalıştırın</span><span class="sxs-lookup"><span data-stu-id="d9520-212">Run the command **enable-migrations**</span></span>
3. <span data-ttu-id="d9520-213">Komut **geçişi ilk-ıgnorechanges** komutunu çalıştırın</span><span class="sxs-lookup"><span data-stu-id="d9520-213">Run the command **add-migration initial –IgnoreChanges**</span></span>
4. <span data-ttu-id="d9520-214">**Update-Database** komutunu çalıştırın</span><span class="sxs-lookup"><span data-stu-id="d9520-214">Run the command **update-database**</span></span>

<span data-ttu-id="d9520-215">Şimdi yeni özellikleri ekleyeceksiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-215">Now, you will add the new properties.</span></span> <span data-ttu-id="d9520-216">Modeller klasöründe, AccountModels.cs dosyasını açın ve RegisterExternalLoginModel sınıfını bulun.</span><span class="sxs-lookup"><span data-stu-id="d9520-216">In the Models folder, open the AccountModels.cs file, and find the RegisterExternalLoginModel class.</span></span> <span data-ttu-id="d9520-217">RegisterExternalLoginModel sınıfı, kimlik doğrulama sağlayıcısından geri gelen değerleri barındırır.</span><span class="sxs-lookup"><span data-stu-id="d9520-217">The RegisterExternalLoginModel class holds values that come back from the authentication provider.</span></span> <span data-ttu-id="d9520-218">Aşağıda vurgulanan şekilde, FullName ve LINK adlı özellikleri ekleyin.</span><span class="sxs-lookup"><span data-stu-id="d9520-218">Add properties named FullName and Link, as highlighted below.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample4.cs?highlight=9-13)]

<span data-ttu-id="d9520-219">Ayrıca, AccountModels.cs içinde, Extrauserınformation adlı yeni bir sınıf ekleyin.</span><span class="sxs-lookup"><span data-stu-id="d9520-219">Also in AccountModels.cs, add a new class called ExtraUserInformation.</span></span> <span data-ttu-id="d9520-220">Bu sınıf, veritabanında oluşturulacak yeni tabloyu temsil eder.</span><span class="sxs-lookup"><span data-stu-id="d9520-220">This class represents the new table which will be created in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample5.cs)]

<span data-ttu-id="d9520-221">UsersContext sınıfında, yeni sınıf için bir DbSet özelliği oluşturmak üzere aşağıdaki vurgulanmış kodu ekleyin.</span><span class="sxs-lookup"><span data-stu-id="d9520-221">In the UsersContext class, add the highlighted code below to create a DbSet property for the new class.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample6.cs?highlight=9)]

<span data-ttu-id="d9520-222">Artık yeni tabloyu oluşturmaya hazırsınız.</span><span class="sxs-lookup"><span data-stu-id="d9520-222">You are now ready to create the new table.</span></span> <span data-ttu-id="d9520-223">Paket Yöneticisi konsolunu yeniden açın ve şu Zamanı:</span><span class="sxs-lookup"><span data-stu-id="d9520-223">Open the Package Manager Console again and this time:</span></span>

1. <span data-ttu-id="d9520-224">**Add-Migration Addextrauserınformation** komutunu çalıştırın</span><span class="sxs-lookup"><span data-stu-id="d9520-224">Run the command **add-migration AddExtraUserInformation**</span></span>
2. <span data-ttu-id="d9520-225">**Update-Database** komutunu çalıştırın</span><span class="sxs-lookup"><span data-stu-id="d9520-225">Run the command **update-database**</span></span>

<span data-ttu-id="d9520-226">Yeni tablo artık veritabanında bulunuyor.</span><span class="sxs-lookup"><span data-stu-id="d9520-226">The new table now exists in the database.</span></span>

## <a name="retrieve-the-additional-data"></a><span data-ttu-id="d9520-227">Ek verileri alma</span><span class="sxs-lookup"><span data-stu-id="d9520-227">Retrieve the additional data</span></span>

<span data-ttu-id="d9520-228">Ek kullanıcı verilerini almanın iki yolu vardır.</span><span class="sxs-lookup"><span data-stu-id="d9520-228">There are two ways to retrieve additional user data.</span></span> <span data-ttu-id="d9520-229">İlk yöntem, kimlik doğrulama isteği sırasında varsayılan olarak geri geçirilen kullanıcı verilerinin saklanması olur.</span><span class="sxs-lookup"><span data-stu-id="d9520-229">The first way is to retain user data that is passed back, by default, during the authentication request.</span></span> <span data-ttu-id="d9520-230">İkinci yöntem, özellikle sağlayıcı API 'sini çağırmak ve daha fazla bilgi isteğidir.</span><span class="sxs-lookup"><span data-stu-id="d9520-230">The second way is to specifically call the provider API and request more information.</span></span> <span data-ttu-id="d9520-231">FullName ve LINK değerleri Facebook tarafından otomatik olarak geri geçirilir.</span><span class="sxs-lookup"><span data-stu-id="d9520-231">Values for FullName and Link are automatically passed back by Facebook.</span></span> <span data-ttu-id="d9520-232">Facebook 'un, Facebook API çağrısı aracılığıyla hesabın alındığını doğruladığını belirten bir değer.</span><span class="sxs-lookup"><span data-stu-id="d9520-232">A value that indicates whether Facebook has verified the account is retrieved through a call to the Facebook API.</span></span> <span data-ttu-id="d9520-233">İlk olarak, FullName ve LINK değerlerini dolduracaksınız ve sonra doğrulanmış değeri alırsınız.</span><span class="sxs-lookup"><span data-stu-id="d9520-233">First, you will populate values for FullName and Link, and then later, you will get the verified value.</span></span>

<span data-ttu-id="d9520-234">Ek kullanıcı verilerini almak için, **accountcontroller.cs** dosyasını **denetleyiciler** klasöründe açın.</span><span class="sxs-lookup"><span data-stu-id="d9520-234">To retrieve the additional user data, open the **AccountController.cs** file in the **Controllers** folder.</span></span>

<span data-ttu-id="d9520-235">Bu dosya, hesapları günlüğe kaydetme, kaydetme ve yönetme mantığını içerir.</span><span class="sxs-lookup"><span data-stu-id="d9520-235">This file contains the logic for logging, registering, and managing accounts.</span></span> <span data-ttu-id="d9520-236">Özellikle, **Externallogincallback** ve **externalloginconfirmation**adlı yöntemlere dikkat edin.</span><span class="sxs-lookup"><span data-stu-id="d9520-236">In particular, notice the methods called **ExternalLoginCallback** and **ExternalLoginConfirmation**.</span></span> <span data-ttu-id="d9520-237">Bu yöntemler içinde, uygulamanız için dış oturum açma işlemlerini özelleştirmek üzere kod ekleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-237">Within these methods, you can add code to customize external login operations for your application.</span></span> <span data-ttu-id="d9520-238">**Externallogincallback** yönteminin ilk satırı şunları içerir:</span><span class="sxs-lookup"><span data-stu-id="d9520-238">The first line of the **ExternalLoginCallback** method contains:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample7.cs)]

<span data-ttu-id="d9520-239">Daha fazla kullanıcı verisi, **doğrulama Yauthentication** yönteminden döndürülen **Authenticationresult** nesnesinin **ExtraData** özelliğine geri geçirilir.</span><span class="sxs-lookup"><span data-stu-id="d9520-239">Additional user data is passed back in the **ExtraData** property of the **AuthenticationResult** object that is returned from the **VerifyAuthentication** method.</span></span> <span data-ttu-id="d9520-240">Facebook istemcisi, **ExtraData** özelliğinde aşağıdaki değerleri içerir:</span><span class="sxs-lookup"><span data-stu-id="d9520-240">The Facebook client contains the following values in the **ExtraData** property:</span></span>

- <span data-ttu-id="d9520-241">kimlik</span><span class="sxs-lookup"><span data-stu-id="d9520-241">id</span></span>
- <span data-ttu-id="d9520-242">name</span><span class="sxs-lookup"><span data-stu-id="d9520-242">name</span></span>
- <span data-ttu-id="d9520-243">bağlantı</span><span class="sxs-lookup"><span data-stu-id="d9520-243">link</span></span>
- <span data-ttu-id="d9520-244">cinsiyet</span><span class="sxs-lookup"><span data-stu-id="d9520-244">gender</span></span>
- <span data-ttu-id="d9520-245">accesstoken</span><span class="sxs-lookup"><span data-stu-id="d9520-245">accesstoken</span></span>

<span data-ttu-id="d9520-246">Diğer sağlayıcılar, ExtraData özelliğinde benzer ancak biraz farklı verilere sahip olacaktır.</span><span class="sxs-lookup"><span data-stu-id="d9520-246">Other providers will have similar but slightly different data in the ExtraData property.</span></span>

<span data-ttu-id="d9520-247">Kullanıcı siteniz için yeni ise, bazı ek verileri alır ve bu verileri onay görünümüne geçitirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-247">If the user is new to your site, you will retrieve some the additional data and pass that data to the confirmation view.</span></span> <span data-ttu-id="d9520-248">Yöntemdeki kodun son bloğu yalnızca Kullanıcı siteniz için yeni ise çalıştırılır.</span><span class="sxs-lookup"><span data-stu-id="d9520-248">The last block of code in the method is run only if the user is new to your site.</span></span> <span data-ttu-id="d9520-249">Aşağıdaki satırı değiştirin:</span><span class="sxs-lookup"><span data-stu-id="d9520-249">Replace the following line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample8.cs)]

<span data-ttu-id="d9520-250">Bu satırla:</span><span class="sxs-lookup"><span data-stu-id="d9520-250">With this line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample9.cs)]

<span data-ttu-id="d9520-251">Bu değişiklik yalnızca FullName ve bağlantı özelliklerine ilişkin değerleri içerir.</span><span class="sxs-lookup"><span data-stu-id="d9520-251">This change merely includes values for the FullName and Link properties.</span></span>

<span data-ttu-id="d9520-252">**Externalloginconfirmation** yönteminde, ek kullanıcı bilgilerini kaydetmek için kodu aşağıda vurgulanan şekilde değiştirin.</span><span class="sxs-lookup"><span data-stu-id="d9520-252">In the **ExternalLoginConfirmation** method, modify the code as highlighted below to save the additional user information.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample10.cs?highlight=4,7-13)]

## <a name="adjusting-the-view"></a><span data-ttu-id="d9520-253">Görünümü ayarlama</span><span class="sxs-lookup"><span data-stu-id="d9520-253">Adjusting the view</span></span>

<span data-ttu-id="d9520-254">Sağlayıcıdan aldığınız ek kullanıcı verileri kayıt sayfasında görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="d9520-254">The additional user data that you retrieve from the provider will be displayed in the registration page.</span></span>

<span data-ttu-id="d9520-255">**Görünümler**/**Hesap** klasöründe **externalloginconfirmation. cshtml**dosyasını açın.</span><span class="sxs-lookup"><span data-stu-id="d9520-255">In the **Views**/**Account** folder, open **ExternalLoginConfirmation.cshtml**.</span></span> <span data-ttu-id="d9520-256">Kullanıcı adı için mevcut alanın altında, FullName, LINK ve PictureLink için alanlar ekleyin.</span><span class="sxs-lookup"><span data-stu-id="d9520-256">Below the existing field for user name, add fields for FullName, Link, and PictureLink.</span></span>

[!code-cshtml[Main](using-oauth-providers-with-mvc/samples/sample11.cshtml)]

<span data-ttu-id="d9520-257">Artık uygulamayı çalıştırmaya neredeyse hazırsınız ve ek bilgiler kaydedilecek şekilde yeni bir Kullanıcı Kaydet.</span><span class="sxs-lookup"><span data-stu-id="d9520-257">You are now almost ready to run the application and register a new user with the additional information saved.</span></span> <span data-ttu-id="d9520-258">Zaten siteye kayıtlı olmayan bir hesabınız olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="d9520-258">You must have an account that is not already registered with the site.</span></span> <span data-ttu-id="d9520-259">Farklı bir test hesabı kullanabilir veya **Kullanıcı profili** ve web sayfaları\_, yeniden kullanmak istediğiniz hesap Için **oauthmembership** tablolarındaki satırları silebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-259">You can either use a different test account, or delete the rows in the **UserProfile** and **webpages\_OAuthMembership** tables for the account you wish to reuse.</span></span> <span data-ttu-id="d9520-260">Bu satırları silerek, hesabın yeniden kaydettirildiğinden emin olursunuz.</span><span class="sxs-lookup"><span data-stu-id="d9520-260">By deleting those rows, you will ensure that the account is registered again.</span></span>

<span data-ttu-id="d9520-261">Uygulamayı çalıştırın ve yeni kullanıcıyı kaydedin.</span><span class="sxs-lookup"><span data-stu-id="d9520-261">Run the application and register the new user.</span></span> <span data-ttu-id="d9520-262">Bu zaman onay sayfasının daha fazla değer içerdiğine dikkat edin.</span><span class="sxs-lookup"><span data-stu-id="d9520-262">Notice that this time the confirmation page contains more values.</span></span>

![register](using-oauth-providers-with-mvc/_static/image12.png)

<span data-ttu-id="d9520-264">Kaydı tamamladıktan sonra tarayıcıyı kapatın.</span><span class="sxs-lookup"><span data-stu-id="d9520-264">After completing registration, close the browser.</span></span> <span data-ttu-id="d9520-265">**Extrauserınformation** tablosundaki yeni değerleri fark etmek için veritabanına bakın.</span><span class="sxs-lookup"><span data-stu-id="d9520-265">Look in the database to notice the new values in the **ExtraUserInformation** table.</span></span>

## <a name="install-nuget-package-for-facebook-api"></a><span data-ttu-id="d9520-266">Facebook API için NuGet paketini yükler</span><span class="sxs-lookup"><span data-stu-id="d9520-266">Install NuGet package for Facebook API</span></span>

<span data-ttu-id="d9520-267">Facebook, işlemleri gerçekleştirmek için çağırabilmeniz gereken bir [API](https://developers.facebook.com/docs/reference/apis/) sağlar.</span><span class="sxs-lookup"><span data-stu-id="d9520-267">Facebook provides an [API](https://developers.facebook.com/docs/reference/apis/) that you can call to perform operations.</span></span> <span data-ttu-id="d9520-268">HTTP istekleri göndererek veya bu istekleri göndermeyi kolaylaştıran bir NuGet paketi yükleme yoluyla Facebook API 'sini çağırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-268">You can call the Facebook API either by directing sending HTTP requests, or by using installing a NuGet package that facilitates sending those requests.</span></span> <span data-ttu-id="d9520-269">Bu öğreticide bir NuGet paketi kullanılması, ancak NuGet paketinin yüklenmesi gerekli değildir.</span><span class="sxs-lookup"><span data-stu-id="d9520-269">Using a NuGet package is shown in this tutorial, but installing NuGet package is not essential.</span></span> <span data-ttu-id="d9520-270">Bu öğreticide, Facebook C# SDK paketinin nasıl kullanılacağı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="d9520-270">This tutorial shows how to use the Facebook C# SDK package.</span></span> <span data-ttu-id="d9520-271">Facebook API 'SI çağırmaya yardımcı olan başka NuGet paketleri de vardır.</span><span class="sxs-lookup"><span data-stu-id="d9520-271">There are other NuGet packages that assist with calling the Facebook API.</span></span>

<span data-ttu-id="d9520-272">**NuGet Paketlerini Yönet** penceresinden Facebook C# SDK paketi ' ni seçin.</span><span class="sxs-lookup"><span data-stu-id="d9520-272">From the **Manage NuGet Packages** windows, select the Facebook C# SDK package.</span></span>

![paketi yükler](using-oauth-providers-with-mvc/_static/image13.png)

<span data-ttu-id="d9520-274">Kullanıcı için erişim belirteci gerektiren C# bir işlemi çağırmak için Facebook SDK 'sını kullanacaksınız.</span><span class="sxs-lookup"><span data-stu-id="d9520-274">You will use the Facebook C# SDK to call an operation that requires the access token for the user.</span></span> <span data-ttu-id="d9520-275">Sonraki bölümde, erişim belirtecinin nasıl alınacağı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="d9520-275">The next section shows how to get the access token.</span></span>

## <a name="retrieve-access-token"></a><span data-ttu-id="d9520-276">Erişim belirtecini al</span><span class="sxs-lookup"><span data-stu-id="d9520-276">Retrieve access token</span></span>

<span data-ttu-id="d9520-277">Çoğu dış sağlayıcı, kullanıcının kimlik bilgileri doğrulandıktan sonra bir erişim belirtecini geri iletir.</span><span class="sxs-lookup"><span data-stu-id="d9520-277">Most external providers pass back an access token after the user's credentials are verified.</span></span> <span data-ttu-id="d9520-278">Yalnızca kimliği doğrulanmış kullanıcılar için kullanılabilir olan işlemleri çağırmanızı sağladığından bu erişim belirteci çok önemlidir.</span><span class="sxs-lookup"><span data-stu-id="d9520-278">This access token is very important because it enables you to call operations that are only available to authenticated users.</span></span> <span data-ttu-id="d9520-279">Bu nedenle, daha fazla işlevsellik sağlamak istediğinizde erişim belirtecinin alınması ve depolanması önemlidir.</span><span class="sxs-lookup"><span data-stu-id="d9520-279">Therefore, retrieving and storing the access token is essential when you want to provide more functionality.</span></span>

<span data-ttu-id="d9520-280">Dış sağlayıcıya bağlı olarak, erişim belirteci yalnızca sınırlı bir süre için geçerli olabilir.</span><span class="sxs-lookup"><span data-stu-id="d9520-280">Depending on the external provider, the access token may be valid for only a limited amount of time.</span></span> <span data-ttu-id="d9520-281">Geçerli bir erişim belirteciniz olduğundan emin olmak için, Kullanıcı oturum açtığında bu dosyayı alacak ve bir veritabanına kaydetmek yerine bir oturum değeri olarak depolayacaksınız.</span><span class="sxs-lookup"><span data-stu-id="d9520-281">To ensure that you have a valid access token, you will retrieve it each time the user logs in, and store it as a session value rather than save it to a database.</span></span>

<span data-ttu-id="d9520-282">**Externallogincallback** yönteminde, erişim belirteci de **Authenticationresult** nesnesinin **ExtraData** özelliğine geçirilir.</span><span class="sxs-lookup"><span data-stu-id="d9520-282">In the **ExternalLoginCallback** method, the access token is also passed back in the **ExtraData** property of the **AuthenticationResult** object.</span></span> <span data-ttu-id="d9520-283">Erişim belirtecini **oturum** nesnesine kaydetmek Için **Externallogincallback** öğesine vurgulanmış kodu ekleyin.</span><span class="sxs-lookup"><span data-stu-id="d9520-283">Add the highlighted code to **ExternalLoginCallback** to save the access token in the **Session** object.</span></span> <span data-ttu-id="d9520-284">Bu kod, Kullanıcı her bir Facebook hesabıyla oturum açtığında çalıştırılır.</span><span class="sxs-lookup"><span data-stu-id="d9520-284">This code is run every time the user logs in with a Facebook account.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample12.cs?highlight=11-14)]

<span data-ttu-id="d9520-285">Bu örnek, Facebook 'tan bir erişim belirteci almasına karşın, erişim belirtecini &quot;accesstoken&quot;adlı aynı anahtar aracılığıyla herhangi bir dış sağlayıcıdan alabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-285">Although this example retrieves an access token from Facebook, you can retrieve the access token from any external provider through the same key named &quot;accesstoken&quot;.</span></span>

## <a name="logging-off"></a><span data-ttu-id="d9520-286">Oturumu kapatma</span><span class="sxs-lookup"><span data-stu-id="d9520-286">Logging off</span></span>

<span data-ttu-id="d9520-287">Varsayılan **oturum kapatma** yöntemi, kullanıcının uygulamanız dışında oturum açmasını, ancak kullanıcının dış sağlayıcıdan dışarıya kaydetmez.</span><span class="sxs-lookup"><span data-stu-id="d9520-287">The default **LogOff** method logs the user out of your application, but does not log the user out of the external provider.</span></span> <span data-ttu-id="d9520-288">Kullanıcıyı Facebook 'Ta günlüğe kaydetmek ve Kullanıcı oturumu kapattıktan sonra belirtecin kalıcı olmasını engellemek için, AccountController 'daki **logoff** yöntemine aşağıdaki vurgulanmış kodu ekleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-288">To log the user out of Facebook, and prevent the token from persisting after the user has logged off, you can add the following highlighted code to the **LogOff** method in the AccountController.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample13.cs?highlight=6-14)]

<span data-ttu-id="d9520-289">`next` parametresinde sağladığınız değer, kullanıcının Facebook oturumu kapatıldıktan sonra kullanılacak URL 'dir.</span><span class="sxs-lookup"><span data-stu-id="d9520-289">The value you provide in the `next` parameter is the URL to use after the user has logged out of Facebook.</span></span> <span data-ttu-id="d9520-290">Yerel bilgisayarınızda test edilirken, yerel siteniz için doğru bağlantı noktası numarasını sağlarsınız.</span><span class="sxs-lookup"><span data-stu-id="d9520-290">When testing on your local computer, you would provide the correct port number for your local site.</span></span> <span data-ttu-id="d9520-291">Üretimde, contoso.com gibi bir varsayılan sayfa sağlarsınız.</span><span class="sxs-lookup"><span data-stu-id="d9520-291">In production, you would provide a default page, such as contoso.com.</span></span>

## <a name="retrieve-user-information-that-requires-the-access-token"></a><span data-ttu-id="d9520-292">Erişim belirteci gerektiren Kullanıcı bilgilerini alma</span><span class="sxs-lookup"><span data-stu-id="d9520-292">Retrieve user information that requires the access token</span></span>

<span data-ttu-id="d9520-293">Erişim belirtecini depoladığınıza ve Facebook C# SDK paketini yükleolduğunuza göre, Facebook 'tan ek kullanıcı bilgileri istemek için bunları birlikte kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-293">Now that you have stored the access token and installed the Facebook C# SDK package, you can use them together to request additional user information from Facebook.</span></span> <span data-ttu-id="d9520-294">**Externalloginconfirmation** yönteminde, erişim belirtecinin değerini geçirerek çok **yönlü istemci** sınıfının bir örneğini oluşturun.</span><span class="sxs-lookup"><span data-stu-id="d9520-294">In the **ExternalLoginConfirmation** method, create an instance of the **FacebookClient** class by passing the value of the access token.</span></span> <span data-ttu-id="d9520-295">Geçerli, kimliği doğrulanmış kullanıcı için **doğrulanmış** özelliğin değerini isteyin.</span><span class="sxs-lookup"><span data-stu-id="d9520-295">Request the value of the **verified** property for the current, authenticated user.</span></span> <span data-ttu-id="d9520-296">**Doğrulanan** özellik, Facebook 'un hesabı bir cep telefonuna ileti gönderme gibi başka yollarla doğruladığını gösterir.</span><span class="sxs-lookup"><span data-stu-id="d9520-296">The **verified** property indicates whether Facebook has validated the account through some other means, such as sending a message to a cell phone.</span></span> <span data-ttu-id="d9520-297">Bu değeri veritabanına kaydedin.</span><span class="sxs-lookup"><span data-stu-id="d9520-297">Save this value in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample14.cs?highlight=7-18,25)]

<span data-ttu-id="d9520-298">Kullanıcı için veritabanındaki kayıtları silmeniz ya da farklı bir Facebook hesabı kullanmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="d9520-298">You will again need to either delete the records in the database for the user, or use a different Facebook account.</span></span>

<span data-ttu-id="d9520-299">Uygulamayı çalıştırın ve yeni kullanıcıyı kaydedin.</span><span class="sxs-lookup"><span data-stu-id="d9520-299">Run the application, and register the new user.</span></span> <span data-ttu-id="d9520-300">Doğrulanan özelliğin değerini görmek için **Extrauserınformation** tablosuna bakın.</span><span class="sxs-lookup"><span data-stu-id="d9520-300">Look at the **ExtraUserInformation** table to see the value for the Verified property.</span></span>

## <a name="conclusion"></a><span data-ttu-id="d9520-301">Sonuç</span><span class="sxs-lookup"><span data-stu-id="d9520-301">Conclusion</span></span>

<span data-ttu-id="d9520-302">Bu öğreticide, Kullanıcı kimlik doğrulaması ve kayıt verileri için Facebook ile tümleştirilmiş bir site oluşturdunuz.</span><span class="sxs-lookup"><span data-stu-id="d9520-302">In this tutorial, you created a site that is integrated with Facebook for user authentication and registration data.</span></span> <span data-ttu-id="d9520-303">MVC 4 Web uygulaması için ayarlanan varsayılan davranış ve bu varsayılan davranışı özelleştirme hakkında bilgi edindiniz.</span><span class="sxs-lookup"><span data-stu-id="d9520-303">You learned about the default behavior that is set up for MVC 4 web application, and how to customize that default behavior.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d9520-304">İlgili konular</span><span class="sxs-lookup"><span data-stu-id="d9520-304">Related topics</span></span>

- [<span data-ttu-id="d9520-305">Auth ve SQL DB ile ASP.NET MVC uygulaması oluşturma ve Azure App Service dağıtma</span><span class="sxs-lookup"><span data-stu-id="d9520-305">Create an ASP.NET MVC app with auth and SQL DB and deploy to Azure App Service</span></span>](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data)
