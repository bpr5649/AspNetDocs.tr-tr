---
uid: mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application
title: Entity Framework bir ASP.NET MVC uygulamasındaki (10 7) ile eşzamanlılığı işleme | Microsoft Docs
author: tdykstra
description: Contoso University örnek web uygulaması Entity Framework 5 Code First ve Visual Studio kullanarak ASP.NET MVC 4 uygulamalarının nasıl oluşturulacağını gösterir...
ms.author: riande
ms.date: 07/30/2013
ms.assetid: b83f47c4-8521-4d0a-8644-e8f77e39733e
msc.legacyurl: /mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: a79cca143df9a10b4255796a6d034688713e4e52
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/17/2019
ms.locfileid: "59379761"
---
# <a name="handling-concurrency-with-the-entity-framework-in-an-aspnet-mvc-application-7-of-10"></a><span data-ttu-id="e4150-103">Entity Framework bir ASP.NET MVC uygulamasındaki (10 7) ile eşzamanlılığı işleme</span><span class="sxs-lookup"><span data-stu-id="e4150-103">Handling Concurrency with the Entity Framework in an ASP.NET MVC Application (7 of 10)</span></span>

<span data-ttu-id="e4150-104">tarafından [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="e4150-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="e4150-105">Projeyi yükle</span><span class="sxs-lookup"><span data-stu-id="e4150-105">Download Completed Project</span></span>](http://code.msdn.microsoft.com/Getting-Started-with-dd0e2ed8)

> <span data-ttu-id="e4150-106">Contoso University örnek web uygulaması Entity Framework 5 Code First ve Visual Studio 2012 kullanarak ASP.NET MVC 4 uygulamalarının nasıl oluşturulacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="e4150-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 4 applications using the Entity Framework 5 Code First and Visual Studio 2012.</span></span> <span data-ttu-id="e4150-107">Öğretici serisinin hakkında daha fazla bilgi için bkz. [serideki ilk öğreticide](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="e4150-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span> <span data-ttu-id="e4150-108">Öğretici serisinin en baştan başlayın veya [Bu bölüm için bir başlangıç projesi indirme](building-the-ef5-mvc4-chapter-downloads.md) ve buradan başlayın.</span><span class="sxs-lookup"><span data-stu-id="e4150-108">You can start the tutorial series from the beginning or [download a starter project for this chapter](building-the-ef5-mvc4-chapter-downloads.md) and start here.</span></span>
> 
> > [!NOTE] 
> > 
> > <span data-ttu-id="e4150-109">Çözümleyemiyor, bir sorunla karşılaştıysanız [tamamlanmış bölüm indirme](building-the-ef5-mvc4-chapter-downloads.md) ve sorununuzu yeniden oluşturmaya çalışın.</span><span class="sxs-lookup"><span data-stu-id="e4150-109">If you run into a problem you can't resolve, [download the completed chapter](building-the-ef5-mvc4-chapter-downloads.md) and try to reproduce your problem.</span></span> <span data-ttu-id="e4150-110">Tamamlanan kodu kodunuza karşılaştırarak, sorunun çözümünü genellikle bulabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="e4150-110">You can generally find the solution to the problem by comparing your code to the completed code.</span></span> <span data-ttu-id="e4150-111">Bazı yaygın hatalar ve bunları çözmek nasıl için bkz: [hatalarını ve geçici çözümleri bulabilirsiniz.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span><span class="sxs-lookup"><span data-stu-id="e4150-111">For some common errors and how to solve them, see [Errors and Workarounds.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span></span>


<span data-ttu-id="e4150-112">Önceki iki öğreticilerde ile ilgili verileri çalışmıştır.</span><span class="sxs-lookup"><span data-stu-id="e4150-112">In the previous two tutorials you worked with related data.</span></span> <span data-ttu-id="e4150-113">Bu öğreticide, eşzamanlılık nasıl ele alınacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="e4150-113">This tutorial shows how to handle concurrency.</span></span> <span data-ttu-id="e4150-114">Web sayfaları ile çalışma oluşturacaksınız `Department` varlık ve düzenleme ve silme sayfaları `Department` varlıkları eşzamanlılık hataları işleyecek.</span><span class="sxs-lookup"><span data-stu-id="e4150-114">You'll create web pages that work with the `Department` entity, and the pages that edit and delete `Department` entities will handle concurrency errors.</span></span> <span data-ttu-id="e4150-115">Aşağıdaki çizimler bir eşzamanlılık çakışması ortaya çıkarsa, gösterilen bazı iletileri de dahil olmak üzere dizin ve silmeyi sayfalar gösterir.</span><span class="sxs-lookup"><span data-stu-id="e4150-115">The following illustrations show the Index and Delete pages, including some messages that are displayed if a concurrency conflict occurs.</span></span>

![Department_Index_page_before_edits](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image1.png)

![Department_Edit_page_2_after_clicking_Save](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image2.png)

## <a name="concurrency-conflicts"></a><span data-ttu-id="e4150-118">Eşzamanlılık çakışmaları</span><span class="sxs-lookup"><span data-stu-id="e4150-118">Concurrency Conflicts</span></span>

<span data-ttu-id="e4150-119">Düzenlemek için bir kullanıcı bir varlığın verilerini görüntüler ve ilk kullanıcının değişiklik veritabanına yazılmadan önce başka bir kullanıcı aynı varlığın veri güncelleştirmeleri bir eşzamanlılık çakışması gerçekleşir.</span><span class="sxs-lookup"><span data-stu-id="e4150-119">A concurrency conflict occurs when one user displays an entity's data in order to edit it, and then another user updates the same entity's data before the first user's change is written to the database.</span></span> <span data-ttu-id="e4150-120">Böyle bir çakışma algılanması etkinleştirmezseniz, kişi veritabanını güncelleştiren son diğer kullanıcının yaptığı değişikliklerin üzerine yazar.</span><span class="sxs-lookup"><span data-stu-id="e4150-120">If you don't enable the detection of such conflicts, whoever updates the database last overwrites the other user's changes.</span></span> <span data-ttu-id="e4150-121">Birçok uygulamada, bu riski kabul edilebilir: Bazı kullanıcılara veya birkaç güncelleştirmeleri varsa veya bazı değişikliklerin üzerine yazılır, programlama için eşzamanlılık maliyeti gereksinimlerine ağır bastığı avantajı gerçekten önemli değildir.</span><span class="sxs-lookup"><span data-stu-id="e4150-121">In many applications, this risk is acceptable: if there are few users, or few updates, or if isn't really critical if some changes are overwritten, the cost of programming for concurrency might outweigh the benefit.</span></span> <span data-ttu-id="e4150-122">Bu durumda, eşzamanlılık çakışmalarını işleme için uygulamayı yapılandırmanız gerekmez.</span><span class="sxs-lookup"><span data-stu-id="e4150-122">In that case, you don't have to configure the application to handle concurrency conflicts.</span></span>

### <a name="pessimistic-concurrency-locking"></a><span data-ttu-id="e4150-123">Kötümser eşzamanlılık (kilitleme)</span><span class="sxs-lookup"><span data-stu-id="e4150-123">Pessimistic Concurrency (Locking)</span></span>

<span data-ttu-id="e4150-124">Uygulamanızı eşzamanlılık senaryolarda yanlışlıkla veri kaybı önleme ihtiyacınız varsa, bunu yapmanın bir yolu veritabanı kilitlerini kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="e4150-124">If your application does need to prevent accidental data loss in concurrency scenarios, one way to do that is to use database locks.</span></span> <span data-ttu-id="e4150-125">Bu adlandırılır *kötümser eşzamanlılık*.</span><span class="sxs-lookup"><span data-stu-id="e4150-125">This is called *pessimistic concurrency*.</span></span> <span data-ttu-id="e4150-126">Örneğin, bir veritabanından satır okumadan önce kilit isteği salt okunur veya güncelleştirme erişim için.</span><span class="sxs-lookup"><span data-stu-id="e4150-126">For example, before you read a row from a database, you request a lock for read-only or for update access.</span></span> <span data-ttu-id="e4150-127">Güncelleştirme erişimi için bir satır kilitlerseniz, başka hiçbir kullanıcı için ya da satırın kilitlemek için izin salt okunur veya değiştirilen sürecinde olan verilerin bir kopyasını elde edecekleri çünkü erişim güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="e4150-127">If you lock a row for update access, no other users are allowed to lock the row either for read-only or update access, because they would get a copy of data that's in the process of being changed.</span></span> <span data-ttu-id="e4150-128">Salt okunur erişim için bir satır kilitlerseniz, diğerleri de salt okunur erişim için kullanılabilir ancak güncelleştirme kilitleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="e4150-128">If you lock a row for read-only access, others can also lock it for read-only access but not for update.</span></span>

<span data-ttu-id="e4150-129">Kilitleri yönetmek dezavantajları vardır.</span><span class="sxs-lookup"><span data-stu-id="e4150-129">Managing locks has disadvantages.</span></span> <span data-ttu-id="e4150-130">Programa karmaşık olabilir.</span><span class="sxs-lookup"><span data-stu-id="e4150-130">It can be complex to program.</span></span> <span data-ttu-id="e4150-131">Önemli bir veritabanı yönetim kaynakları gerektirir ve bu uygulamanın kullanıcı sayısı performans sorunlarına neden olabilir artar (diğer bir deyişle, iyi ölçeklendirme değil).</span><span class="sxs-lookup"><span data-stu-id="e4150-131">It requires significant database management resources, and it can cause performance problems as the number of users of an application increases (that is, it doesn't scale well).</span></span> <span data-ttu-id="e4150-132">Bu nedenle, tüm veritabanı yönetim sistemleri kötümser eşzamanlılık destekler.</span><span class="sxs-lookup"><span data-stu-id="e4150-132">For these reasons, not all database management systems support pessimistic concurrency.</span></span> <span data-ttu-id="e4150-133">Entity Framework yerleşik desteği yok sağlar ve Bu öğreticide nasıl göstermez.</span><span class="sxs-lookup"><span data-stu-id="e4150-133">The Entity Framework provides no built-in support for it, and this tutorial doesn't show you how to implement it.</span></span>

### <a name="optimistic-concurrency"></a><span data-ttu-id="e4150-134">İyimser Eşzamanlılık</span><span class="sxs-lookup"><span data-stu-id="e4150-134">Optimistic Concurrency</span></span>

<span data-ttu-id="e4150-135">Kötümser eşzamanlılık alternatifi *iyimser eşzamanlılık*.</span><span class="sxs-lookup"><span data-stu-id="e4150-135">The alternative to pessimistic concurrency is *optimistic concurrency*.</span></span> <span data-ttu-id="e4150-136">İyimser eşzamanlılık, eşzamanlılık çakışmalarını olmasını sağlar ve eğer uygun şekilde tepki anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="e4150-136">Optimistic concurrency means allowing concurrency conflicts to happen, and then reacting appropriately if they do.</span></span> <span data-ttu-id="e4150-137">Örneğin, John Departmanlar Düzenle sayfasında, değişiklikleri çalışır **bütçe** 350,000.00 $ 0,00 ABD Doları İngilizce departmanına tutar.</span><span class="sxs-lookup"><span data-stu-id="e4150-137">For example, John runs the Departments Edit page, changes the **Budget** amount for the English department from $350,000.00 to $0.00.</span></span>

![Changing_English_dept_budget_to_100000](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image3.png)

<span data-ttu-id="e4150-139">John tıkladığında önce **Kaydet**, Jane çalışan aynı sayfa ve değişiklikleri **başlangıç tarihi** alanı 1/9/2007'den 8/8/2013.</span><span class="sxs-lookup"><span data-stu-id="e4150-139">Before John clicks **Save**, Jane runs the same page and changes the **Start Date** field from 9/1/2007 to 8/8/2013.</span></span>

![Changing_English_dept_start_date_to_1999](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image4.png)

<span data-ttu-id="e4150-141">John tıkladığında **Kaydet** ilk ve tarayıcı dizin sayfasına, sonra Jane döndürdüğünde değişikliğinin tıkladığında görür **Kaydet**.</span><span class="sxs-lookup"><span data-stu-id="e4150-141">John clicks **Save** first and sees his change when the browser returns to the Index page, then Jane clicks **Save**.</span></span> <span data-ttu-id="e4150-142">Sonraki işlemin ne eşzamanlılık çakışmalarını nasıl ele tarafından belirlenir.</span><span class="sxs-lookup"><span data-stu-id="e4150-142">What happens next is determined by how you handle concurrency conflicts.</span></span> <span data-ttu-id="e4150-143">Bazı seçenekleri şunlardır:</span><span class="sxs-lookup"><span data-stu-id="e4150-143">Some of the options include the following:</span></span>

- <span data-ttu-id="e4150-144">Bir kullanıcı değiştirmiş hangi özelliğinin izlemek ve yalnızca ilgili sütunları veritabanında güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="e4150-144">You can keep track of which property a user has modified and update only the corresponding columns in the database.</span></span> <span data-ttu-id="e4150-145">Farklı özellikleri iki kullanıcı tarafından güncelleştirildiği için yer alan örnek senaryoda, veri kaybı, olacaktır.</span><span class="sxs-lookup"><span data-stu-id="e4150-145">In the example scenario, no data would be lost, because different properties were updated by the two users.</span></span> <span data-ttu-id="e4150-146">Sonraki biri İngilizce departmanı gözatar, Can'ın hem Gamze'nin değişiklikleri görürler: 8/8/2013'ün Başlangıç tarihi ve bütçe sıfır dolarlık bir.</span><span class="sxs-lookup"><span data-stu-id="e4150-146">The next time someone browses the English department, they'll see both John's and Jane's changes — a start date of 8/8/2013 and a budget of Zero dollars.</span></span>

    <span data-ttu-id="e4150-147">Bu güncelleştirme yöntemini veri kaybına neden olabilecek çakışmaları sayısını azaltabilir, ancak bir varlığın aynı özelliğe rakip bir değişiklik yaptıysanız, veri kaybını önlemek olamaz.</span><span class="sxs-lookup"><span data-stu-id="e4150-147">This method of updating can reduce the number of conflicts that could result in data loss, but it can't avoid data loss if competing changes are made to the same property of an entity.</span></span> <span data-ttu-id="e4150-148">Varlık Çerçevesi'Bu şekilde çalışıp çalışmadığını güncelleştirme kodunuzu nasıl uygulayacağınıza bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="e4150-148">Whether the Entity Framework works this way depends on how you implement your update code.</span></span> <span data-ttu-id="e4150-149">Bir varlığın özgün tüm özellik değerlerini yanı sıra yeni değerleri izlemek için büyük miktarlarda durumu bakımını gerektirebilir içinde bir web uygulaması pratik değildir, çünkü genellikle.</span><span class="sxs-lookup"><span data-stu-id="e4150-149">It's often not practical in a web application, because it can require that you maintain large amounts of state in order to keep track of all original property values for an entity as well as new values.</span></span> <span data-ttu-id="e4150-150">Sunucu kaynaklarını gerektirir ya da web sayfasında kendisi (örneğin, gizli alanlar) dahil edilmesi için büyük miktarda durum koruma uygulama performansını etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="e4150-150">Maintaining large amounts of state can affect application performance because it either requires server resources or must be included in the web page itself (for example, in hidden fields).</span></span>
- <span data-ttu-id="e4150-151">Gamze'nin değişiklik Can'ın değişiklik üzerine izin verebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="e4150-151">You can let Jane's change overwrite John's change.</span></span> <span data-ttu-id="e4150-152">Sonraki biri İngilizce departmanı gözatar, 8/8/2013 görürler ve geri yüklenen $350,000.00 değeri.</span><span class="sxs-lookup"><span data-stu-id="e4150-152">The next time someone browses the English department, they'll see 8/8/2013 and the restored $350,000.00 value.</span></span> <span data-ttu-id="e4150-153">Bu adlı bir *istemci WINS* veya *WINS'te son* senaryo.</span><span class="sxs-lookup"><span data-stu-id="e4150-153">This is called a *Client Wins* or *Last in Wins* scenario.</span></span> <span data-ttu-id="e4150-154">(İstemcinin değerleri veri deposunda nedir üzerinde önceliklidir.) Bu bölüm için giriş eşzamanlılık işleme için kodlama yapmazsanız belirtildiği gibi bu otomatik olarak gerçekleşir.</span><span class="sxs-lookup"><span data-stu-id="e4150-154">(The client's values take precedence over what's in the data store.) As noted in the introduction to this section, if you don't do any coding for concurrency handling, this will happen automatically.</span></span>
- <span data-ttu-id="e4150-155">Veritabanında güncelleştirilen Gamze'nin değişiklik engelleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="e4150-155">You can prevent Jane's change from being updated in the database.</span></span> <span data-ttu-id="e4150-156">Genellikle, bir hata iletisi görüntüler, her verilerin geçerli durumunu gösterir ve her yine de bunları yapmak istediği değişiklikleri yeniden uygulamak izin.</span><span class="sxs-lookup"><span data-stu-id="e4150-156">Typically, you would display an error message, show her the current state of the data, and allow her to reapply her changes if she still wants to make them.</span></span> <span data-ttu-id="e4150-157">Bu adlı bir *Store WINS* senaryo.</span><span class="sxs-lookup"><span data-stu-id="e4150-157">This is called a *Store Wins* scenario.</span></span> <span data-ttu-id="e4150-158">(Veri deposu değerlerini istemci tarafından gönderilen değerler önceliklidir.) Bu öğreticide Store WINS senaryo uygulayacaksınız.</span><span class="sxs-lookup"><span data-stu-id="e4150-158">(The data-store values take precedence over the values submitted by the client.) You'll implement the Store Wins scenario in this tutorial.</span></span> <span data-ttu-id="e4150-159">Bu yöntem, neler olduğunu için uyarı bir kullanıcı olmaksızın herhangi bir değişiklik kılınmamasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="e4150-159">This method ensures that no changes are overwritten without a user being alerted to what's happening.</span></span>

### <a name="detecting-concurrency-conflicts"></a><span data-ttu-id="e4150-160">Eşzamanlılık çakışmaları algılama</span><span class="sxs-lookup"><span data-stu-id="e4150-160">Detecting Concurrency Conflicts</span></span>

<span data-ttu-id="e4150-161">İşleyerek çakışmalarını çözebilirsiniz [OptimisticConcurrencyException](https://msdn.microsoft.com/library/system.data.optimisticconcurrencyexception.aspx) Entity Framework oluşturduğu özel durumları.</span><span class="sxs-lookup"><span data-stu-id="e4150-161">You can resolve conflicts by handling [OptimisticConcurrencyException](https://msdn.microsoft.com/library/system.data.optimisticconcurrencyexception.aspx) exceptions that the Entity Framework throws.</span></span> <span data-ttu-id="e4150-162">Bu özel durumlar ne zaman öğrenmek için Entity Framework algılayamayabilir çakışmalar olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="e4150-162">In order to know when to throw these exceptions, the Entity Framework must be able to detect conflicts.</span></span> <span data-ttu-id="e4150-163">Bu nedenle, veritabanı ve veri modeline uygun şekilde yapılandırmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="e4150-163">Therefore, you must configure the database and the data model appropriately.</span></span> <span data-ttu-id="e4150-164">Çakışma algılamasını etkinleştirmek için bazı seçenekler şunlardır:</span><span class="sxs-lookup"><span data-stu-id="e4150-164">Some options for enabling conflict detection include the following:</span></span>

- <span data-ttu-id="e4150-165">Veritabanı tablosunda bir satıra değiştirildiğinde belirlemek için kullanılan bir izleme sütunu içerir.</span><span class="sxs-lookup"><span data-stu-id="e4150-165">In the database table, include a tracking column that can be used to determine when a row has been changed.</span></span> <span data-ttu-id="e4150-166">Ardından bu sütunu eklemek için Entity Framework yapılandırabilirsiniz `Where` SQL yan tümcesi `Update` veya `Delete` komutları.</span><span class="sxs-lookup"><span data-stu-id="e4150-166">You can then configure the Entity Framework to include that column in the `Where` clause of SQL `Update` or `Delete` commands.</span></span>

    <span data-ttu-id="e4150-167">İzleme sütunun veri türü genellikle [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx).</span><span class="sxs-lookup"><span data-stu-id="e4150-167">The data type of the tracking column is typically [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx).</span></span> <span data-ttu-id="e4150-168">[Rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) satır güncelleştirilir her zaman artan sıralı bir sayı değeridir.</span><span class="sxs-lookup"><span data-stu-id="e4150-168">The [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) value is a sequential number that's incremented each time the row is updated.</span></span> <span data-ttu-id="e4150-169">İçinde bir `Update` veya `Delete` komutu `Where` yan tümcesi izleme sütunu (özgün satır sürümü) özgün değeri içerir.</span><span class="sxs-lookup"><span data-stu-id="e4150-169">In an `Update` or `Delete` command, the `Where` clause includes the original value of the tracking column (the original row version).</span></span> <span data-ttu-id="e4150-170">Güncelleştirilen satır değeri başka bir kullanıcı tarafından değiştirildiyse `rowversion` sütunudur özgün değerinden farklı şekilde `Update` veya `Delete` bildirimi nedeniyle güncelleştirilecek satırın bulamıyor `Where` yan tümcesi.</span><span class="sxs-lookup"><span data-stu-id="e4150-170">If the row being updated has been changed by another user, the value in the `rowversion` column is different than the original value, so the `Update` or `Delete` statement can't find the row to update because of the `Where` clause.</span></span> <span data-ttu-id="e4150-171">Entity Framework bulduğunda hiçbir satır tarafından güncelleştirildiğini `Update` veya `Delete` komutunu (diğer bir deyişle, etkilenen satır sayısı sıfır olduğunda), bir eşzamanlılık çakışması yorumlar.</span><span class="sxs-lookup"><span data-stu-id="e4150-171">When the Entity Framework finds that no rows have been updated by the `Update` or `Delete` command (that is, when the number of affected rows is zero), it interprets that as a concurrency conflict.</span></span>
- <span data-ttu-id="e4150-172">Tablodaki her sütun öğesinin özgün değerleri eklemek için Entity Framework yapılandırma `Where` yan tümcesi `Update` ve `Delete` komutları.</span><span class="sxs-lookup"><span data-stu-id="e4150-172">Configure the Entity Framework to include the original values of every column in the table in the `Where` clause of `Update` and `Delete` commands.</span></span>

    <span data-ttu-id="e4150-173">İlk seçenek satırın ilk okunuşundan bu yana, sıradaki herhangi bir şey değiştiyse, olduğu gibi `Where` yan tümcesi bir satırı güncelleştirmek için iade kalmaz, Entity Framework bir eşzamanlılık çakışması yorumlar.</span><span class="sxs-lookup"><span data-stu-id="e4150-173">As in the first option, if anything in the row has changed since the row was first read, the `Where` clause won't return a row to update, which the Entity Framework interprets as a concurrency conflict.</span></span> <span data-ttu-id="e4150-174">Birçok sütunları olan veritabanı tabloları için bu yaklaşım, çok büyük sonuçlanabilir `Where` yan tümcesi ve büyük miktarlarda durumu bakımını gerektirebilir.</span><span class="sxs-lookup"><span data-stu-id="e4150-174">For database tables that have many columns, this approach can result in very large `Where` clauses, and can require that you maintain large amounts of state.</span></span> <span data-ttu-id="e4150-175">Sunucu kaynaklarını gerektirir ya da web sayfasının kendisine eklenmesi gerekir çünkü daha önce belirtildiği gibi büyük miktarlarda durum koruma uygulama performansını etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="e4150-175">As noted earlier, maintaining large amounts of state can affect application performance because it either requires server resources or must be included in the web page itself.</span></span> <span data-ttu-id="e4150-176">Bu nedenle bu yaklaşım genellikle önerilmez ve Bu öğreticide kullanılan yöntem değildir.</span><span class="sxs-lookup"><span data-stu-id="e4150-176">Therefore this approach generally not recommended, and it isn't the method used in this tutorial.</span></span>

    <span data-ttu-id="e4150-177">Eşzamanlılık için bu yaklaşımı uygulamak istiyorsanız, tüm birincil anahtar özellikleri ekleyerek eşzamanlılık için izlemek istediğiniz varlık işaretlemek sahip [ConcurrencyCheck](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.concurrencycheckattribute.aspx) öznitelik.</span><span class="sxs-lookup"><span data-stu-id="e4150-177">If you do want to implement this approach to concurrency, you have to mark all non-primary-key properties in the entity you want to track concurrency for by adding the [ConcurrencyCheck](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.concurrencycheckattribute.aspx) attribute to them.</span></span> <span data-ttu-id="e4150-178">Değişiklik SQL tüm sütunları eklemek Entity Framework sağlar `WHERE` yan tümcesi `UPDATE` deyimleri.</span><span class="sxs-lookup"><span data-stu-id="e4150-178">That change enables the Entity Framework to include all columns in the SQL `WHERE` clause of `UPDATE` statements.</span></span>

<span data-ttu-id="e4150-179">Bu öğreticinin geri kalanında, ekleyeceksiniz bir [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) özelliğini izleme `Department` varlık, bir denetleyici ve Görünüm ve her şeyin düzgün çalıştığını doğrulamak için test edin.</span><span class="sxs-lookup"><span data-stu-id="e4150-179">In the remainder of this tutorial you'll add a [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) tracking property to the `Department` entity, create a controller and views, and test to verify that everything works correctly.</span></span>

## <a name="add-an-optimistic-concurrency-property-to-the-department-entity"></a><span data-ttu-id="e4150-180">Departman varlık için bir iyimser eşzamanlılık özelliği Ekle</span><span class="sxs-lookup"><span data-stu-id="e4150-180">Add an Optimistic Concurrency Property to the Department Entity</span></span>

<span data-ttu-id="e4150-181">İçinde *Models\Department.cs*, adlı bir izleme özelliği ekleme `RowVersion`:</span><span class="sxs-lookup"><span data-stu-id="e4150-181">In *Models\Department.cs*, add a tracking property named `RowVersion`:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.cs?highlight=18-19)]

<span data-ttu-id="e4150-182">[Zaman damgası](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.timestampattribute.aspx) özniteliği belirtir, bu sütun eklenecektir `Where` yan tümcesi `Update` ve `Delete` veritabanına gönderilen komutları.</span><span class="sxs-lookup"><span data-stu-id="e4150-182">The [Timestamp](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.timestampattribute.aspx) attribute specifies that this column will be included in the `Where` clause of `Update` and `Delete` commands sent to the database.</span></span> <span data-ttu-id="e4150-183">Adlandırılan öznitelik [zaman damgası](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.timestampattribute.aspx) bir SQL SQL Server'ın önceki sürümlerinde kullanılan çünkü [zaman damgası](https://msdn.microsoft.com/library/ms182776(v=SQL.90).aspx) veri türü SQL önce [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) değiştirildi.</span><span class="sxs-lookup"><span data-stu-id="e4150-183">The attribute is called [Timestamp](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.timestampattribute.aspx) because previous versions of SQL Server used a SQL [timestamp](https://msdn.microsoft.com/library/ms182776(v=SQL.90).aspx) data type before the SQL [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) replaced it.</span></span> <span data-ttu-id="e4150-184">.Net türü `rowversion` bir bayt dizisidir.</span><span class="sxs-lookup"><span data-stu-id="e4150-184">The .Net type for `rowversion` is a byte array.</span></span> <span data-ttu-id="e4150-185">Fluent API'sini kullanmayı tercih ederseniz kullanabilirsiniz [IsConcurrencyToken](https://msdn.microsoft.com/library/gg679501(v=VS.103).aspx) yöntemi izleme özelliği, aşağıdaki örnekte gösterildiği gibi belirtin:</span><span class="sxs-lookup"><span data-stu-id="e4150-185">If you prefer to use the fluent API, you can use the [IsConcurrencyToken](https://msdn.microsoft.com/library/gg679501(v=VS.103).aspx) method to specify the tracking property, as shown in the following example:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.cs)]

<span data-ttu-id="e4150-186">Başka bir geçiş gerçekleştirmeniz gereken şekilde bir özellik ekleyerek veritabanı modeli değişti.</span><span class="sxs-lookup"><span data-stu-id="e4150-186">By adding a property you changed the database model, so you need to do another migration.</span></span> <span data-ttu-id="e4150-187">Paket Yöneticisi Konsolu (PMC'de), aşağıdaki komutları girin:</span><span class="sxs-lookup"><span data-stu-id="e4150-187">In the Package Manager Console (PMC), enter the following commands:</span></span>

[!code-console[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cmd)]

## <a name="create-a-department-controller"></a><span data-ttu-id="e4150-188">Bir bölüm denetleyicisi oluşturun</span><span class="sxs-lookup"><span data-stu-id="e4150-188">Create a Department Controller</span></span>

<span data-ttu-id="e4150-189">Oluşturma bir `Department` denetleyici ve görünüm aşağıdaki ayarları kullanarak diğer denetleyicilerin yaptığınız gibi:</span><span class="sxs-lookup"><span data-stu-id="e4150-189">Create a `Department` controller and views the same way you did the other controllers, using the following settings:</span></span>

![Add_Controller_dialog_box_for_Department_controller](https://asp.net/media/2578041/Windows-Live-Writer_Handling-C.NET-MVC-Application-7-of-10h1_AFDC_Add_Controller_dialog_box_for_Department_controller_d1d9c788-f970-4d6a-9f5a-1eddc84330b7.png)

<span data-ttu-id="e4150-191">İçinde *Controllers\DepartmentController.cs*, ekleme bir `using` deyimi:</span><span class="sxs-lookup"><span data-stu-id="e4150-191">In *Controllers\DepartmentController.cs*, add a `using` statement:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs)]

<span data-ttu-id="e4150-192">Bölüm Yöneticisi açılan listeler, her yerde bu dosyadaki (dört yineleme) "Tam adı" için "LastName" değişiklik Eğitmen tam adı yerine yalnızca son adı içerir.</span><span class="sxs-lookup"><span data-stu-id="e4150-192">Change "LastName" to "FullName" everywhere in this file (four occurrences) so that the department administrator drop-down lists will contain the full name of the instructor rather than just the last name.</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cs?highlight=1)]

<span data-ttu-id="e4150-193">Mevcut kodu değiştirin `HttpPost` `Edit` yöntemini aşağıdaki kod ile:</span><span class="sxs-lookup"><span data-stu-id="e4150-193">Replace the existing code for the `HttpPost` `Edit` method with the following code:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs)]

<span data-ttu-id="e4150-194">Görünümün özgün depolayacak `RowVersion` gizli bir alan değeri.</span><span class="sxs-lookup"><span data-stu-id="e4150-194">The view will store the original `RowVersion` value in a hidden field.</span></span> <span data-ttu-id="e4150-195">Model bağlayıcı oluşturduğunda `department` örneği, o nesnenin orijinal olacaktır `RowVersion` özellik değeri ve Düzenle sayfasında kullanıcı tarafından girildiği gibi diğer özellikleri için yeni değerler.</span><span class="sxs-lookup"><span data-stu-id="e4150-195">When the model binder creates the `department` instance, that object will have the original `RowVersion` property value and the new values for the other properties, as entered by the user on the Edit page.</span></span> <span data-ttu-id="e4150-196">Entity Framework bir SQL zaman oluşturur `UPDATE` komutu komut içerecek bir `WHERE` özgün sahip bir satır için görünen yan tümcesi `RowVersion` değeri.</span><span class="sxs-lookup"><span data-stu-id="e4150-196">Then when the Entity Framework creates a SQL `UPDATE` command, that command will include a `WHERE` clause that looks for a row that has the original `RowVersion` value.</span></span>

<span data-ttu-id="e4150-197">Hiçbir satır etkileniyorsanız `UPDATE` komut (hiçbir satır özgün sahip `RowVersion` değer), Entity Framework oluşturur bir `DbUpdateConcurrencyException` özel durum ve kodda `catch` bloğunu alır etkilenen `Department` özel bir varlıktan nesne.</span><span class="sxs-lookup"><span data-stu-id="e4150-197">If no rows are affected by the `UPDATE` command (no rows have the original `RowVersion` value), the Entity Framework throws a `DbUpdateConcurrencyException` exception, and the code in the `catch` block gets the affected `Department` entity from the exception object.</span></span> <span data-ttu-id="e4150-198">Bu varlığın hem veritabanından okunan değerleri hem de kullanıcı tarafından girilen yeni değerleri vardır:</span><span class="sxs-lookup"><span data-stu-id="e4150-198">This entity has both the values read from the database and the new values entered by the user:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]

<span data-ttu-id="e4150-199">Ardından, kod veritabanı değerlerini hangi kullanıcının düzenleme sayfada girilen öğesinden farklı olan her sütun için bir özel hata iletisi ekler:</span><span class="sxs-lookup"><span data-stu-id="e4150-199">Next, the code adds a custom error message for each column that has database values different from what the user entered on the Edit page:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

<span data-ttu-id="e4150-200">Uzun bir hata iletisi, ne olduğunu ve bunu yapmanız gerekenler açıklanmaktadır:</span><span class="sxs-lookup"><span data-stu-id="e4150-200">A longer error message explains what happened and what to do about it:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample9.cs)]

<span data-ttu-id="e4150-201">Son olarak, kod ayarlar `RowVersion` değerini `Department` yeni değere nesne veritabanından alınır.</span><span class="sxs-lookup"><span data-stu-id="e4150-201">Finally, the code sets the `RowVersion` value of the `Department` object to the new value retrieved from the database.</span></span> <span data-ttu-id="e4150-202">Bu yeni `RowVersion` değeri depolanan gizli alanı sayfasını yeniden düzenleme ve sonraki kullanıcı çalıştırdığında **Kaydet**, yeniden düzenleme sayfası, yakalanan bu yana gerçekleşen eşzamanlılık hataları.</span><span class="sxs-lookup"><span data-stu-id="e4150-202">This new `RowVersion` value will be stored in the hidden field when the Edit page is redisplayed, and the next time the user clicks **Save**, only concurrency errors that happen since the redisplay of the Edit page will be caught.</span></span>

<span data-ttu-id="e4150-203">İçinde *Views\Department\Edit.cshtml*, kaydetmek için gizli bir alan ekleme `RowVersion` özellik değeri, gizli bir alan için takip `DepartmentID` özelliği:</span><span class="sxs-lookup"><span data-stu-id="e4150-203">In *Views\Department\Edit.cshtml*, add a hidden field to save the `RowVersion` property value, immediately following the hidden field for the `DepartmentID` property:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample10.cshtml?highlight=17)]

<span data-ttu-id="e4150-204">İçinde *Views\Department\Index.cshtml*, mevcut kodu satır bağlantıları sola taşı ve görüntülemek için sayfa başlığı ve sütun başlıkları değiştirmek için aşağıdaki kodla değiştirin `FullName` yerine `LastName` içinde**Yönetici** sütun:</span><span class="sxs-lookup"><span data-stu-id="e4150-204">In *Views\Department\Index.cshtml*, replace the existing code with the following code to move row links to the left and change the page title and column headings to display `FullName` instead of `LastName` in the **Administrator** column:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample11.cshtml)]

## <a name="testing-optimistic-concurrency-handling"></a><span data-ttu-id="e4150-205">İyimser eşzamanlılık işleme test etme</span><span class="sxs-lookup"><span data-stu-id="e4150-205">Testing Optimistic Concurrency Handling</span></span>

<span data-ttu-id="e4150-206">Siteyi çalıştırın ve tıklayın **Departmanlar**:</span><span class="sxs-lookup"><span data-stu-id="e4150-206">Run the site and click **Departments**:</span></span>

![Department_Index_page_before_edits](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image5.png)

<span data-ttu-id="e4150-208">Sağ tıklayın **Düzenle** Kim Abercrombie ve seçin için köprü **yeni sekmede aç** ardından **Düzenle** Kim Abercrombie için köprü.</span><span class="sxs-lookup"><span data-stu-id="e4150-208">Right click the **Edit** hyperlink for Kim Abercrombie and select **Open in new tab,** then click the **Edit** hyperlink for Kim Abercrombie.</span></span> <span data-ttu-id="e4150-209">İki windows aynı bilgileri görüntüler.</span><span class="sxs-lookup"><span data-stu-id="e4150-209">The two windows display the same information.</span></span>

![Department_Edit_page_before_changes](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image6.png)

<span data-ttu-id="e4150-211">İlk tarayıcı penceresinde bir alanı değiştirmek ve tıklayın **Kaydet**.</span><span class="sxs-lookup"><span data-stu-id="e4150-211">Change a field in the first browser window and click **Save**.</span></span>

![Department_Edit_page_1_after_change](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image7.png)

<span data-ttu-id="e4150-213">Tarayıcı değişmiş değer ile dizin sayfası gösterilir.</span><span class="sxs-lookup"><span data-stu-id="e4150-213">The browser shows the Index page with the changed value.</span></span>

![Departments_Index_page_after_first_budget_edit](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image8.png)

<span data-ttu-id="e4150-215">İkinci bir tarayıcı penceresi içindeki herhangi bir alan değiştirip'ı **Kaydet**.</span><span class="sxs-lookup"><span data-stu-id="e4150-215">Change the any field in the second browser window and click **Save**.</span></span>

![Department_Edit_page_2_after_change](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image9.png)

<span data-ttu-id="e4150-217">Tıklayın **Kaydet** ikinci bir tarayıcı penceresi içinde.</span><span class="sxs-lookup"><span data-stu-id="e4150-217">Click **Save** in the second browser window.</span></span> <span data-ttu-id="e4150-218">Bir hata iletisi görürsünüz:</span><span class="sxs-lookup"><span data-stu-id="e4150-218">You see an error message:</span></span>

![Department_Edit_page_2_after_clicking_Save](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image10.png)

<span data-ttu-id="e4150-220">Tıklayın **Kaydet** yeniden.</span><span class="sxs-lookup"><span data-stu-id="e4150-220">Click **Save** again.</span></span> <span data-ttu-id="e4150-221">İkinci tarayıcıda girdiğiniz değer, ilk tarayıcıda değiştirme verileri özgün değeri ile birlikte kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="e4150-221">The value you entered in the second browser is saved along with the original value of the data you change in the first browser.</span></span> <span data-ttu-id="e4150-222">Dizin Sayfası göründüğünde, kaydedilen değerler görürsünüz.</span><span class="sxs-lookup"><span data-stu-id="e4150-222">You see the saved values when the Index page appears.</span></span>

![Department_Index_page_with_change_from_second_browser](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image11.png)

## <a name="updating-the-delete-page"></a><span data-ttu-id="e4150-224">Delete sayfa güncelleştiriliyor</span><span class="sxs-lookup"><span data-stu-id="e4150-224">Updating the Delete Page</span></span>

<span data-ttu-id="e4150-225">Silme sayfası için Entity Framework, birisi başka benzer bir şekilde bölüm düzenleme nedeni eşzamanlılık çakışmalarını algılar.</span><span class="sxs-lookup"><span data-stu-id="e4150-225">For the Delete page, the Entity Framework detects concurrency conflicts caused by someone else editing the department in a similar manner.</span></span> <span data-ttu-id="e4150-226">Zaman `HttpGet` `Delete` yöntemi görüntüler onay görünümü, görünümün özgün içerir `RowVersion` gizli bir alan değeri.</span><span class="sxs-lookup"><span data-stu-id="e4150-226">When the `HttpGet` `Delete` method displays the confirmation view, the view includes the original `RowVersion` value in a hidden field.</span></span> <span data-ttu-id="e4150-227">Değer daha sonra kullanılabilir olduğunu `HttpPost` `Delete` kullanıcının silmeyi onaylaması çağrılan yöntem.</span><span class="sxs-lookup"><span data-stu-id="e4150-227">That value is then available to the `HttpPost` `Delete` method that's called when the user confirms the deletion.</span></span> <span data-ttu-id="e4150-228">Entity Framework, SQL oluşturduğunda `DELETE` komutunu içerdiği bir `WHERE` yan tümcesinin orijinal `RowVersion` değeri.</span><span class="sxs-lookup"><span data-stu-id="e4150-228">When the Entity Framework creates the SQL `DELETE` command, it includes a `WHERE` clause with the original `RowVersion` value.</span></span> <span data-ttu-id="e4150-229">Sıfır satır komutu sonuçları (satır silme onayı sayfasında görüntülenen sonra değiştirildiği anlamına gelir) etkileniyorsa, bir eşzamanlılık özel durum oluşturulur ve `HttpGet Delete` ayarlamak bir hata bayrağıyla yöntemi çağrıldığında `true` görüntülemek için bir hata iletisiyle onay sayfası.</span><span class="sxs-lookup"><span data-stu-id="e4150-229">If the command results in zero rows affected (meaning the row was changed after the Delete confirmation page was displayed), a concurrency exception is thrown, and the `HttpGet Delete` method is called with an error flag set to `true` in order to redisplay the confirmation page with an error message.</span></span> <span data-ttu-id="e4150-230">Bu durumda farklı bir hata iletisi görüntülenir, böylece satırın başka bir kullanıcı tarafından silindiğinden sıfır satır etkilenmiştir mümkündür.</span><span class="sxs-lookup"><span data-stu-id="e4150-230">It's also possible that zero rows were affected because the row was deleted by another user, so in that case a different error message is displayed.</span></span>

<span data-ttu-id="e4150-231">İçinde *DepartmentController.cs*, değiştirin `HttpGet` `Delete` yöntemini aşağıdaki kod ile:</span><span class="sxs-lookup"><span data-stu-id="e4150-231">In *DepartmentController.cs*, replace the `HttpGet` `Delete` method with the following code:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample12.cs)]

<span data-ttu-id="e4150-232">Yöntemi, bir eşzamanlılık hatası sonra sayfayı yeniden olup olmadığını belirten isteğe bağlı bir parametre kabul eder.</span><span class="sxs-lookup"><span data-stu-id="e4150-232">The method accepts an optional parameter that indicates whether the page is being redisplayed after a concurrency error.</span></span> <span data-ttu-id="e4150-233">Bu bayrak ise `true`, görünümünü kullanarak bir hata iletisi gönderilen bir `ViewBag` özelliği.</span><span class="sxs-lookup"><span data-stu-id="e4150-233">If this flag is `true`, an error message is sent to the view using a `ViewBag` property.</span></span>

<span data-ttu-id="e4150-234">Değiştirin `HttpPost` `Delete` yöntemi (adlı `DeleteConfirmed`) aşağıdaki kod ile:</span><span class="sxs-lookup"><span data-stu-id="e4150-234">Replace the code in the `HttpPost` `Delete` method (named `DeleteConfirmed`) with the following code:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample13.cs)]

<span data-ttu-id="e4150-235">Yalnızca değiştirilen iskele kurulmuş kod içinde bu yöntem yalnızca bir kayıt kimliği kabul:</span><span class="sxs-lookup"><span data-stu-id="e4150-235">In the scaffolded code that you just replaced, this method accepted only a record ID:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample14.cs)]

<span data-ttu-id="e4150-236">Bu parametre için değiştirdiyseniz bir `Department` model bağlayıcı tarafından oluşturulan varlık örneği.</span><span class="sxs-lookup"><span data-stu-id="e4150-236">You've changed this parameter to a `Department` entity instance created by the model binder.</span></span> <span data-ttu-id="e4150-237">Bu aşağıdakilere erişmenizi sağlar `RowVersion` kayıt anahtarı yanı sıra özellik değeri.</span><span class="sxs-lookup"><span data-stu-id="e4150-237">This gives you access to the `RowVersion` property value in addition to the record key.</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample15.cs)]

<span data-ttu-id="e4150-238">Eylem yöntemi adından de değiştirdiğiniz `DeleteConfirmed` için `Delete`.</span><span class="sxs-lookup"><span data-stu-id="e4150-238">You have also changed the action method name from `DeleteConfirmed` to `Delete`.</span></span> <span data-ttu-id="e4150-239">İskele kurulan kodu adlı `HttpPost` `Delete` yöntemi `DeleteConfirmed` vermek `HttpPost` yöntemi benzersiz bir imza.</span><span class="sxs-lookup"><span data-stu-id="e4150-239">The scaffolded code named the `HttpPost` `Delete` method `DeleteConfirmed` to give the `HttpPost` method a unique signature.</span></span> <span data-ttu-id="e4150-240">(CLR'nin farklı yöntem parametreleri sağlamak için aşırı yüklenmiş yöntemler gerektirir.) İmzaları benzersiz, MVC kuralı ile devam edin ve aynı adı kullanın `HttpPost` ve `HttpGet` yöntemlerini silin.</span><span class="sxs-lookup"><span data-stu-id="e4150-240">(The CLR requires overloaded methods to have different method parameters.) Now that the signatures are unique, you can stick with the MVC convention and use the same name for the `HttpPost` and `HttpGet` delete methods.</span></span>

<span data-ttu-id="e4150-241">Bir eşzamanlılık hatası yakalanmışsa kod silme onayı sayfası görüntüler ve bunu belirten bir bayrak eşzamanlılık hata iletisi görüntülenmelidir sağlar.</span><span class="sxs-lookup"><span data-stu-id="e4150-241">If a concurrency error is caught, the code redisplays the Delete confirmation page and provides a flag that indicates it should display a concurrency error message.</span></span>

<span data-ttu-id="e4150-242">İçinde *Views\Department\Delete.cshtml*, bazı biçimlendirme sağlayan aşağıdaki kod ile iskele kurulan kodu değiştirir ve bir hata iletisi alan ekler değiştirin.</span><span class="sxs-lookup"><span data-stu-id="e4150-242">In *Views\Department\Delete.cshtml*, replace the scaffolded code with the following code that makes some formatting changes and adds an error message field.</span></span> <span data-ttu-id="e4150-243">Değişiklikler vurgulanır.</span><span class="sxs-lookup"><span data-stu-id="e4150-243">The changes are highlighted.</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample16.cshtml?highlight=9,37,40,45-46)]

<span data-ttu-id="e4150-244">Bu kod arasında bir hata iletisi ekler `h2` ve `h3` başlıkları:</span><span class="sxs-lookup"><span data-stu-id="e4150-244">This code adds an error message between the `h2` and `h3` headings:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample17.cshtml)]

<span data-ttu-id="e4150-245">Değiştirir `LastName` ile `FullName` içinde `Administrator` alan:</span><span class="sxs-lookup"><span data-stu-id="e4150-245">It replaces `LastName` with `FullName` in the `Administrator` field:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample18.cshtml)]

<span data-ttu-id="e4150-246">Son olarak, onu gizli alanlar için ekler `DepartmentID` ve `RowVersion` sonra özellikleri `Html.BeginForm` deyimi:</span><span class="sxs-lookup"><span data-stu-id="e4150-246">Finally, it adds hidden fields for the `DepartmentID` and `RowVersion` properties after the `Html.BeginForm` statement:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample19.cshtml)]

<span data-ttu-id="e4150-247">Departmanlar dizin sayfası çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="e4150-247">Run the Departments Index page.</span></span> <span data-ttu-id="e4150-248">Sağ tıklayın **Sil** seçin ve İngilizce departmanı için köprü **yeni pencerede aç** ilk penceresinde ardından **Düzenle** İngilizce için köprü bölüm.</span><span class="sxs-lookup"><span data-stu-id="e4150-248">Right click the **Delete** hyperlink for the English department and select **Open in new window,** then in the first window click the **Edit** hyperlink for the English department.</span></span>

<span data-ttu-id="e4150-249">İlk penceresinde değerlerden birini değiştirin ve tıklayın **Kaydet** :</span><span class="sxs-lookup"><span data-stu-id="e4150-249">In the first window, change one of the values, and click **Save** :</span></span>

![Department_Edit_page_after_change_before_delete](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image12.png)

<span data-ttu-id="e4150-251">Dizin Sayfası değişikliği doğrular.</span><span class="sxs-lookup"><span data-stu-id="e4150-251">The Index page confirms the change.</span></span>

![Departments_Index_page_after_budget_edit_before_delete](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image13.png)

<span data-ttu-id="e4150-253">İkinci pencerede **Sil**.</span><span class="sxs-lookup"><span data-stu-id="e4150-253">In the second window, click **Delete**.</span></span>

![Department_Delete_confirmation_page_before_concurrency_error](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image14.png)

<span data-ttu-id="e4150-255">Eşzamanlılık hata iletisini görüntüleyin ve departman değerlerini şu anda veritabanında nedir ile yenilenir.</span><span class="sxs-lookup"><span data-stu-id="e4150-255">You see the concurrency error message, and the Department values are refreshed with what's currently in the database.</span></span>

![Department_Delete_confirmation_page_with_concurrency_error](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image15.png)

<span data-ttu-id="e4150-257">Tıklarsanız **Sil** yeniden departman silindiğini gösterir dizin sayfasına yönlendirilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="e4150-257">If you click **Delete** again, you're redirected to the Index page, which shows that the department has been deleted.</span></span>

## <a name="summary"></a><span data-ttu-id="e4150-258">Özet</span><span class="sxs-lookup"><span data-stu-id="e4150-258">Summary</span></span>

<span data-ttu-id="e4150-259">Bu, eşzamanlılık çakışmalarını işleme giriş tamamlar.</span><span class="sxs-lookup"><span data-stu-id="e4150-259">This completes the introduction to handling concurrency conflicts.</span></span> <span data-ttu-id="e4150-260">Çeşitli eşzamanlılık senaryoları işlemek için diğer yollar hakkında daha fazla bilgi için bkz: [iyimser eşzamanlılık desenlerinin](https://blogs.msdn.com/b/adonet/archive/2011/02/03/using-dbcontext-in-ef-feature-ctp5-part-9-optimistic-concurrency-patterns.aspx) ve [özellik değerleri ile çalışma](https://blogs.msdn.com/b/adonet/archive/2011/01/30/using-dbcontext-in-ef-feature-ctp5-part-5-working-with-property-values.aspx) Entity Framework ekip blogunda.</span><span class="sxs-lookup"><span data-stu-id="e4150-260">For information about other ways to handle various concurrency scenarios, see [Optimistic Concurrency Patterns](https://blogs.msdn.com/b/adonet/archive/2011/02/03/using-dbcontext-in-ef-feature-ctp5-part-9-optimistic-concurrency-patterns.aspx) and [Working with Property Values](https://blogs.msdn.com/b/adonet/archive/2011/01/30/using-dbcontext-in-ef-feature-ctp5-part-5-working-with-property-values.aspx) on the Entity Framework team blog.</span></span> <span data-ttu-id="e4150-261">Sonraki öğreticide için tablo başına hiyerarşi devralma uygulamak gösterilmektedir `Instructor` ve `Student` varlıklar.</span><span class="sxs-lookup"><span data-stu-id="e4150-261">The next tutorial shows how to implement table-per-hierarchy inheritance for the `Instructor` and `Student` entities.</span></span>

<span data-ttu-id="e4150-262">Entity Framework diğer kaynakların bağlantılarını bulunabilir [ASP.NET Data Access içerik haritası](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="e4150-262">Links to other Entity Framework resources can be found in the [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e4150-263">[Önceki](updating-related-data-with-the-entity-framework-in-an-asp-net-mvc-application.md)
> [İleri](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application.md)</span><span class="sxs-lookup"><span data-stu-id="e4150-263">[Previous](updating-related-data-with-the-entity-framework-in-an-asp-net-mvc-application.md)
[Next](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application.md)</span></span>
