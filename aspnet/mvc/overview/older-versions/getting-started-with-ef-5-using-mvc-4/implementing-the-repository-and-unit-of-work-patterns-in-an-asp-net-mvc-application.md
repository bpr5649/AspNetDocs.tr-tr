---
uid: mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application
title: Bir ASP.NET MVC uygulamasındaki (9, 10) depo ve iş birimi desenleri uygulama | Microsoft Docs
author: tdykstra
description: Contoso University örnek web uygulaması Entity Framework 5 Code First ve Visual Studio kullanarak ASP.NET MVC 4 uygulamalarının nasıl oluşturulacağını gösterir...
ms.author: riande
ms.date: 07/30/2013
ms.assetid: 44761193-04ba-4990-9f90-145d3c10a716
msc.legacyurl: /mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 71ff3c269c5d1ed43a67d19442eda8e9d4728295
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/09/2019
ms.locfileid: "59405709"
---
# <a name="implementing-the-repository-and-unit-of-work-patterns-in-an-aspnet-mvc-application-9-of-10"></a><span data-ttu-id="a2b0c-103">Bir ASP.NET MVC uygulamasındaki (9, 10) depo ve iş birimi desenleri uygulama</span><span class="sxs-lookup"><span data-stu-id="a2b0c-103">Implementing the Repository and Unit of Work Patterns in an ASP.NET MVC Application (9 of 10)</span></span>

<span data-ttu-id="a2b0c-104">tarafından [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="a2b0c-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="a2b0c-105">Projeyi yükle</span><span class="sxs-lookup"><span data-stu-id="a2b0c-105">Download Completed Project</span></span>](http://code.msdn.microsoft.com/Getting-Started-with-dd0e2ed8)

> <span data-ttu-id="a2b0c-106">Contoso University örnek web uygulaması Entity Framework 5 Code First ve Visual Studio 2012 kullanarak ASP.NET MVC 4 uygulamalarının nasıl oluşturulacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 4 applications using the Entity Framework 5 Code First and Visual Studio 2012.</span></span> <span data-ttu-id="a2b0c-107">Öğretici serisinin hakkında daha fazla bilgi için bkz. [serideki ilk öğreticide](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="a2b0c-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span> <span data-ttu-id="a2b0c-108">Öğretici serisinin en baştan başlayın veya [Bu bölüm için bir başlangıç projesi indirme](building-the-ef5-mvc4-chapter-downloads.md) ve buradan başlayın.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-108">You can start the tutorial series from the beginning or [download a starter project for this chapter](building-the-ef5-mvc4-chapter-downloads.md) and start here.</span></span>
> 
> > [!NOTE] 
> > 
> > <span data-ttu-id="a2b0c-109">Çözümleyemiyor, bir sorunla karşılaştıysanız [tamamlanmış bölüm indirme](building-the-ef5-mvc4-chapter-downloads.md) ve sorununuzu yeniden oluşturmaya çalışın.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-109">If you run into a problem you can't resolve, [download the completed chapter](building-the-ef5-mvc4-chapter-downloads.md) and try to reproduce your problem.</span></span> <span data-ttu-id="a2b0c-110">Tamamlanan kodu kodunuza karşılaştırarak, sorunun çözümünü genellikle bulabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-110">You can generally find the solution to the problem by comparing your code to the completed code.</span></span> <span data-ttu-id="a2b0c-111">Bazı yaygın hatalar ve bunları çözmek nasıl için bkz: [hatalarını ve geçici çözümleri bulabilirsiniz.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span><span class="sxs-lookup"><span data-stu-id="a2b0c-111">For some common errors and how to solve them, see [Errors and Workarounds.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span></span>


<span data-ttu-id="a2b0c-112">Önceki öğreticide gereksiz kod içinde azaltmak için devralma kullanılan `Student` ve `Instructor` varlık sınıfları.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-112">In the previous tutorial you used inheritance to reduce redundant code in the `Student` and `Instructor` entity classes.</span></span> <span data-ttu-id="a2b0c-113">Bu öğreticide, CRUD işlemleri için depo ve iş birimi desenleri kullanmak için bazı yollar görürsünüz.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-113">In this tutorial you'll see some ways to use the repository and unit of work patterns for CRUD operations.</span></span> <span data-ttu-id="a2b0c-114">Önceki olduğu gibi bu birinde, kodunuzu, zaten oluşturulan yeni sayfaları oluşturmak yerine sayfalarıyla çalışma biçimini değiştireceğiz.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-114">As in the previous tutorial, in this one you'll change the way your code works with pages you already created rather than creating new pages.</span></span>

## <a name="the-repository-and-unit-of-work-patterns"></a><span data-ttu-id="a2b0c-115">Depo ve iş birimi desenleri</span><span class="sxs-lookup"><span data-stu-id="a2b0c-115">The Repository and Unit of Work Patterns</span></span>

<span data-ttu-id="a2b0c-116">Depo ve iş birimi desenleri, veri erişim katmanı ve bir uygulamanın iş mantığı katmanı arasında bir Soyutlama Katmanı oluşturmak için tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-116">The repository and unit of work patterns are intended to create an abstraction layer between the data access layer and the business logic layer of an application.</span></span> <span data-ttu-id="a2b0c-117">Bu desenleri uygulama veri deposundaki değişiklikleri uygulamanızdan verenlerden yardımcı olabilir ve otomatik birim testi veya test odaklı geliştirme (TDD) kolaylaştırabilir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-117">Implementing these patterns can help insulate your application from changes in the data store and can facilitate automated unit testing or test-driven development (TDD).</span></span>

<span data-ttu-id="a2b0c-118">Bu öğreticide her varlık türü için bir depo sınıfına uygulayacaksınız.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-118">In this tutorial you'll implement a repository class for each entity type.</span></span> <span data-ttu-id="a2b0c-119">İçin `Student` varlık türü bir depo arabirimi ve bir depo sınıfına oluşturacaksınız.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-119">For the `Student` entity type you'll create a repository interface and a repository class.</span></span> <span data-ttu-id="a2b0c-120">Depo içinde denetleyicinizin başlattığınızda, böylece denetleyici depo arabirimi uygulayan herhangi bir nesneye bir başvuru kabul arabirimi kullanacaksınız.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-120">When you instantiate the repository in your controller, you'll use the interface so that the controller will accept a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="a2b0c-121">Denetleyici altında bir web sunucusunda çalıştığında, Entity Framework ile birlikte çalışan bir depoyu alır.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-121">When the controller runs under a web server, it receives a repository that works with the Entity Framework.</span></span> <span data-ttu-id="a2b0c-122">Denetleyici bir birim test sınıfı altında çalıştığında, bir bellek içi koleksiyonu gibi test etmek için kolayca işleyebileceğiniz şekilde depolanan verilerle çalışır bir depoyu alır.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-122">When the controller runs under a unit test class, it receives a repository that works with data stored in a way that you can easily manipulate for testing, such as an in-memory collection.</span></span>

<span data-ttu-id="a2b0c-123">Öğreticide daha sonra birden çok depo ve iş sınıfı için bir birim kullanacaksınız `Course` ve `Department` varlık türleri içinde `Course` denetleyicisi.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-123">Later in the tutorial you'll use multiple repositories and a unit of work class for the `Course` and `Department` entity types in the `Course` controller.</span></span> <span data-ttu-id="a2b0c-124">İş sınıfı birimi tümünün tarafından paylaşılan bir tek veritabanı bağlamı sınıfının oluşturarak birden çok deposu çalışması düzenler.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-124">The unit of work class coordinates the work of multiple repositories by creating a single database context class shared by all of them.</span></span> <span data-ttu-id="a2b0c-125">Otomatik birim testi gerçekleştirmek istiyorsanız, oluşturun ve arabirimler için bu sınıflar için yaptığınız gibi kullanın `Student` depo.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-125">If you wanted to be able to perform automated unit testing, you'd create and use interfaces for these classes in the same way you did for the `Student` repository.</span></span> <span data-ttu-id="a2b0c-126">Ancak, öğreticiyi basit tutmak için oluşturma ve bu sınıfların arabirimlerini kullanın.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-126">However, to keep the tutorial simple, you'll create and use these classes without interfaces.</span></span>

<span data-ttu-id="a2b0c-127">Aşağıdaki çizim, denetleyici ve depoyu veya çalışma deseni birimi hiç kullanılmıyor karşılaştırılan bağlam sınıflar arasındaki ilişkileri kavramsallaştırmanın yollarından biri gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-127">The following illustration shows one way to conceptualize the relationships between the controller and context classes compared to not using the repository or unit of work pattern at all.</span></span>

![Repository_pattern_diagram](https://asp.net/media/2578149/Windows-Live-Writer_8c4963ba1fa3_CE3B_Repository_pattern_diagram_1df790d3-bdf2-4c11-9098-946ddd9cd884.png)

<span data-ttu-id="a2b0c-129">Bu öğretici serisinde birim testleri oluşturmaz.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-129">You won't create unit tests in this tutorial series.</span></span> <span data-ttu-id="a2b0c-130">Depo düzeni kullanan bir MVC uygulaması ile TDD giriş için bkz. [izlenecek yol: ASP.NET MVC ile TDD kullanma](https://msdn.microsoft.com/library/ff847525.aspx).</span><span class="sxs-lookup"><span data-stu-id="a2b0c-130">For an introduction to TDD with an MVC application that uses the repository pattern, see [Walkthrough: Using TDD with ASP.NET MVC](https://msdn.microsoft.com/library/ff847525.aspx).</span></span> <span data-ttu-id="a2b0c-131">Depo düzeni hakkında daha fazla bilgi için aşağıdaki kaynaklara bakın:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-131">For more information about the repository pattern, see the following resources:</span></span>

- <span data-ttu-id="a2b0c-132">[Depo düzeni](https://msdn.microsoft.com/library/ff649690.aspx) MSDN'de.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-132">[The Repository Pattern](https://msdn.microsoft.com/library/ff649690.aspx) on MSDN.</span></span>
- <span data-ttu-id="a2b0c-133">[Entity Framework 4.0 ile depo ve iş birimi düzenleri kullanarak](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) Entity Framework ekip blogunda.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-133">[Using Repository and Unit of Work patterns with Entity Framework 4.0](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) on the Entity Framework team blog.</span></span>
- <span data-ttu-id="a2b0c-134">[Çevik Entity Framework 4 depo](http://thedatafarm.com/blog/data-access/agile-entity-framework-4-repository-part-1-model-and-poco-classes/) Julie Lerman'ın blog gönderilerine dizi.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-134">[Agile Entity Framework 4 Repository](http://thedatafarm.com/blog/data-access/agile-entity-framework-4-repository-part-1-model-and-poco-classes/) series of posts on Julie Lerman's blog.</span></span>
- <span data-ttu-id="a2b0c-135">[Bir bakışta HTML5/jQuery uygulama hesabı oluşturmaya](https://weblogs.asp.net/dwahlin/archive/2011/08/15/building-the-account-at-a-glance-html5-jquery-application.aspx) Dan Wahlin'ın blogunda.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-135">[Building the Account at a Glance HTML5/jQuery Application](https://weblogs.asp.net/dwahlin/archive/2011/08/15/building-the-account-at-a-glance-html5-jquery-application.aspx) on Dan Wahlin's blog.</span></span>

> [!NOTE]
> <span data-ttu-id="a2b0c-136">Depo ve iş birimi desenleri uygulamak için birçok yolu vardır.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-136">There are many ways to implement the repository and unit of work patterns.</span></span> <span data-ttu-id="a2b0c-137">Depo sınıfları ile veya olmadan iş sınıfı birimi kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-137">You can use repository classes with or without a unit of work class.</span></span> <span data-ttu-id="a2b0c-138">Tüm varlık türlerini veya her tür için tek bir depoda uygulayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-138">You can implement a single repository for all entity types, or one for each type.</span></span> <span data-ttu-id="a2b0c-139">Her tür için bir tane uygularsanız, ayrı sınıfları, genel bir temel sınıf ve türetilen sınıflar veya soyut bir temel sınıf ve türetilen sınıflar kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-139">If you implement one for each type, you can use separate classes, a generic base class and derived classes, or an abstract base class and derived classes.</span></span> <span data-ttu-id="a2b0c-140">İş mantığı deponuza dahil edebilir veya veri erişim mantığını kısıtlarız.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-140">You can include business logic in your repository or restrict it to data access logic.</span></span> <span data-ttu-id="a2b0c-141">Kullanarak, veritabanı bağlamı sınıfının bir Soyutlama Katmanı oluşturabilirsiniz [IDbSet](https://msdn.microsoft.com/library/gg679233(v=vs.103).aspx) var. yerine arabirimleri [olan DB](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) varlık kümeleriniz için türleri.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-141">You can also build an abstraction layer into your database context class by using [IDbSet](https://msdn.microsoft.com/library/gg679233(v=vs.103).aspx) interfaces there instead of [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) types for your entity sets.</span></span> <span data-ttu-id="a2b0c-142">Bu öğreticide gösterilen bir Soyutlama Katmanı yaklaşım dikkate almanız için değil tüm senaryolar ve ortamlar için bir öneri bir seçenektir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-142">The approach to implementing an abstraction layer shown in this tutorial is one option for you to consider, not a recommendation for all scenarios and environments.</span></span>


## <a name="creating-the-student-repository-class"></a><span data-ttu-id="a2b0c-143">Öğrenci depo sınıfı oluşturma</span><span class="sxs-lookup"><span data-stu-id="a2b0c-143">Creating the Student Repository Class</span></span>

<span data-ttu-id="a2b0c-144">İçinde *DAL* klasöründe adlı bir sınıf dosyası oluşturma *IStudentRepository.cs* ve varolan kodu aşağıdaki kodla değiştirin:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-144">In the *DAL* folder, create a class file named *IStudentRepository.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample1.cs)]

<span data-ttu-id="a2b0c-145">Bu kod, iki okuma yöntemleri dahil olmak üzere CRUD yöntemleri, normal bir dizi bildirir; tüm döndüren bir `Student` varlıkları ve tek bir bulur bir `Student` varlığı kimliğe göre</span><span class="sxs-lookup"><span data-stu-id="a2b0c-145">This code declares a typical set of CRUD methods, including two read methods — one that returns all `Student` entities, and one that finds a single `Student` entity by ID.</span></span>

<span data-ttu-id="a2b0c-146">İçinde *DAL* klasör adında bir sınıf dosyası oluşturma *StudentRepository.cs* dosya.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-146">In the *DAL* folder, create a class file named *StudentRepository.cs* file.</span></span> <span data-ttu-id="a2b0c-147">Varolan kodu uygulayan aşağıdaki kodla değiştirin `IStudentRepository` arabirimi:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-147">Replace the existing code with the following code, which implements the `IStudentRepository` interface:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample2.cs)]

<span data-ttu-id="a2b0c-148">Veritabanı bağlamı sınıfının değişkeninde tanımlanır ve oluşturucu bağlamının bir örneğine geçirmek için çağrı nesnesi bekliyor:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-148">The database context is defined in a class variable, and the constructor expects the calling object to pass in an instance of the context:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample3.cs)]

<span data-ttu-id="a2b0c-149">Depoya yeni bir bağlamda örneği oluşturulamadı, ancak bir denetleyici birden fazla depoyla kullandıysanız, ardından her bir ayrı bağlamıyla sonunda.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-149">You could instantiate a new context in the repository, but then if you used multiple repositories in one controller, each would end up with a separate context.</span></span> <span data-ttu-id="a2b0c-150">Birden fazla depoyla daha sonra kullanacağınız `Course` denetleyicisi ve göreceksiniz nasıl bir birim iş sınıfın tüm depolar aynı bağlam kullanmasını sağlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-150">Later you'll use multiple repositories in the `Course` controller, and you'll see how a unit of work class can ensure that all repositories use the same context.</span></span>

<span data-ttu-id="a2b0c-151">Depo uygulayan [IDisposable](https://msdn.microsoft.com/library/system.idisposable.aspx) ve veritabanı bağlamı denetleyicisi daha önce gördüğünüz ve CRUD yöntemlerinden daha önce gördüğünüzle aynı şekilde aramalarda veritabanı bağlamını siler.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-151">The repository implements [IDisposable](https://msdn.microsoft.com/library/system.idisposable.aspx) and disposes the database context as you saw earlier in the controller, and its CRUD methods make calls to the database context in the same way that you saw earlier.</span></span>

## <a name="change-the-student-controller-to-use-the-repository"></a><span data-ttu-id="a2b0c-152">Depo kullanmak üzere Öğrenci denetleyicisini değiştirme</span><span class="sxs-lookup"><span data-stu-id="a2b0c-152">Change the Student Controller to Use the Repository</span></span>

<span data-ttu-id="a2b0c-153">İçinde *StudentController.cs*, şu anda sınıfında kodu aşağıdaki kodla değiştirin.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-153">In *StudentController.cs*, replace the code currently in the class with the following code.</span></span> <span data-ttu-id="a2b0c-154">Değişiklikler vurgulanır.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-154">The changes are highlighted.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample4.cs?highlight=13-18,44,75,77,102-103,120,137-138,159,172-174,186)]

<span data-ttu-id="a2b0c-155">Denetleyici artık uygulayan bir nesne için bir sınıf değişken bildirir `IStudentRepository` arabirimi yerine bağlamı sınıfı:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-155">The controller now declares a class variable for an object that implements the `IStudentRepository` interface instead of the context class:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample5.cs)]

<span data-ttu-id="a2b0c-156">Varsayılan (parametresiz) Oluşturucu yeni bir bağlam örneği oluşturur ve çağıran bir bağlam örneğinde geçirmek isteğe bağlı bir oluşturucu sağlar.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-156">The default (parameterless) constructor creates a new context instance, and an optional constructor allows the caller to pass in a context instance.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample6.cs)]

<span data-ttu-id="a2b0c-157">(Kullandıysanız *bağımlılık ekleme*, veya bir DI, mıydı varsayılan oluşturucu doğru depoya nesne her zaman sağlanan DI yazılım olun çünkü.)</span><span class="sxs-lookup"><span data-stu-id="a2b0c-157">(If you were using *dependency injection*, or DI, you wouldn't need the default constructor because the DI software would ensure that the correct repository object would always be provided.)</span></span>

<span data-ttu-id="a2b0c-158">CRUD yöntemlerdeki depo bağlamı yerine artık çağrılır:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-158">In the CRUD methods, the repository is now called instead of the context:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample7.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample8.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample9.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample10.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample11.cs)]

<span data-ttu-id="a2b0c-159">Ve `Dispose` yöntemi artık bağlam yerine depoyu siler:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-159">And the `Dispose` method now disposes the repository instead of the context:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample12.cs)]

<span data-ttu-id="a2b0c-160">Siteyi çalıştırın ve tıklayın **Öğrenciler** sekmesi.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-160">Run the site and click the **Students** tab.</span></span>

![Students_Index_page](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image1.png)

<span data-ttu-id="a2b0c-162">Sayfa görünümünü ve değiştirdiğiniz deposuna kullanmak için kodu ve diğer Öğrenci sayfaları da aynı çalışmadan önce yaptığınız gibi aynı şekilde çalışır.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-162">The page looks and works the same as it did before you changed the code to use the repository, and the other Student pages also work the same.</span></span> <span data-ttu-id="a2b0c-163">Ancak, yolunda önemli bir fark yoktur `Index` denetleyicinin yöntemi, filtreleme ve sıralama yapar.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-163">However, there's an important difference in the way the `Index` method of the controller does filtering and ordering.</span></span> <span data-ttu-id="a2b0c-164">Aşağıdaki kod bu yöntemin özgün sürümle yer:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-164">The original version of this method contained the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample13.cs?highlight=1)]

<span data-ttu-id="a2b0c-165">Güncelleştirilmiş `Index` yöntem aşağıdaki kodu içerir:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-165">The updated `Index` method contains the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample14.cs?highlight=1)]

<span data-ttu-id="a2b0c-166">Yalnızca vurgulanmış kodu değişti.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-166">Only the highlighted code has changed.</span></span>

<span data-ttu-id="a2b0c-167">Kod özgün sürümünde `students` olarak yazılmış bir `IQueryable` nesne.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-167">In the original version of the code, `students` is typed as an `IQueryable` object.</span></span> <span data-ttu-id="a2b0c-168">Gibi bir yöntem kullanılarak bir koleksiyona dönüştürüldü kadar sorgu veritabanına gönderilen değil `ToList`, hangi oluşmaz kadar dizin görünümünün Öğrenci modeli erişir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-168">The query isn't sent to the database until it's converted into a collection using a method such as `ToList`, which doesn't occur until the Index view accesses the student model.</span></span> <span data-ttu-id="a2b0c-169">`Where` Yukarıdaki özgün koda yönteminde olur bir `WHERE` veritabanına gönderilen SQL sorgu yan tümcesi.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-169">The `Where` method in the original code above becomes a `WHERE` clause in the SQL query that is sent to the database.</span></span> <span data-ttu-id="a2b0c-170">Bu sırayla yalnızca seçili varlıklar veritabanı tarafından döndürülür anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-170">That in turn means that only the selected entities are returned by the database.</span></span> <span data-ttu-id="a2b0c-171">Ancak, değiştirilmesi sonucunda `context.Students` için `studentRepository.GetStudents()`, `students` sonra bu ifade bir değişken bir `IEnumerable` veritabanındaki tüm Öğrenciler içeren koleksiyonu.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-171">However, as a result of changing `context.Students` to `studentRepository.GetStudents()`, the `students` variable after this statement is an `IEnumerable` collection that includes all students in the database.</span></span> <span data-ttu-id="a2b0c-172">Son sonucu `Where` yöntemi aynıdır, ancak artık iş bellek web sunucusundaki ve veritabanı tarafından gerçekleştirilir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-172">The end result of applying the `Where` method is the same, but now the work is done in memory on the web server and not by the database.</span></span> <span data-ttu-id="a2b0c-173">Büyük miktarda veriyi döndüren sorgular için bu verimsiz olabilir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-173">For queries that return large volumes of data, this can be inefficient.</span></span>

> [!TIP]
> 
> **<span data-ttu-id="a2b0c-174">Iqueryable vs. IEnumerable</span><span class="sxs-lookup"><span data-stu-id="a2b0c-174">IQueryable vs. IEnumerable</span></span>**
> 
> <span data-ttu-id="a2b0c-175">Bir şey girmiş olsa bile, depo burada gösterildiği gibi uyguladıktan sonra **arama** kutusu SQL sunucusuna gönderilen sorgu ölçütlerinizle içermediği için tüm Öğrenci satırları döndürür:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-175">After you implement the repository as shown here, even if you enter something in the **Search** box the query sent to SQL Server returns all Student rows because it doesn't include your search criteria:</span></span>
> 
> ![](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image2.png)
> 
> [!code-sql[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample15.sql)]
> 
> <span data-ttu-id="a2b0c-176">Arama ölçütleriyle bilmeden depo sorgu çalıştırılmış olduğundan bu sorgu tüm Öğrenci verileri döndürür.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-176">This query returns all of the student data because the repository executed the query without knowing about the search criteria.</span></span> <span data-ttu-id="a2b0c-177">Sıralama, arama ölçütlerini uygulamak ve bellek disk belleği (Bu örnekte yalnızca 3 satır gösteriliyor) yapılır için verilerin bir alt kümesini seçme işleminin sonraki olduğunda `ToPagedList` yöntemi çağrıldığında `IEnumerable` koleksiyonu.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-177">The process of sorting, applying search criteria, and selecting a subset of the data for paging (showing only 3 rows in this case) is done in memory later when the `ToPagedList` method is called on the `IEnumerable` collection.</span></span>
> 
> <span data-ttu-id="a2b0c-178">Arama ölçütleri uyguladıktan sonra kodu (depo uygulanmış önce) önceki sürümünde, sorgu kadar veritabanına gönderilmez olduğunda `ToPagedList` üzerinde çağrılır `IQueryable` nesne.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-178">In the previous version of the code (before you implemented the repository), the query is not sent to the database until after you apply the search criteria, when `ToPagedList` is called on the `IQueryable` object.</span></span>
> 
> ![](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image3.png)
> 
> <span data-ttu-id="a2b0c-179">Ne zaman ToPagedList çağrıldığında bir `IQueryable` nesnesi, hiçbir filtreleme bellekte yapılması gerektiğini SQL sunucusuna gönderilen sorgu, arama dizesi belirtir ve yalnızca arama ölçütleri karşılayan satırların sonuç olarak döndürülür.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-179">When ToPagedList is called on an `IQueryable` object, the query sent to SQL Server specifies the search string, and as a result only rows that meet the search criteria are returned, and no filtering needs to be done in memory.</span></span>
> 
> [!code-sql[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample16.sql)]
> 
> <span data-ttu-id="a2b0c-180">(Şu öğretici SQL sunucusuna gönderilen sorguların açıklanmaktadır.)</span><span class="sxs-lookup"><span data-stu-id="a2b0c-180">(The following tutorial explains how to examine queries sent to SQL Server.)</span></span>


<span data-ttu-id="a2b0c-181">Aşağıdaki bölümde, bu iş veritabanı tarafından yapılması gerektiğini belirtmenize olanak verir depo yöntemleri gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-181">The following section shows how to implement repository methods that enable you to specify that this work should be done by the database.</span></span>

<span data-ttu-id="a2b0c-182">Denetleyici ve Entity Framework veritabanı bağlamı arasında bir Soyutlama Katmanı oluşturdunuz.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-182">You've now created an abstraction layer between the controller and the Entity Framework database context.</span></span> <span data-ttu-id="a2b0c-183">Otomatik birim bu uygulamayla testi gerçekleştirmek için oluşturacağınız, bir alternatif bir depo sınıfına uygulayan bir birim testi projesine oluşturabilirsiniz `IStudentRepository` *.*</span><span class="sxs-lookup"><span data-stu-id="a2b0c-183">If you were going to perform automated unit testing with this application, you could create an alternative repository class in a unit test project that implements `IStudentRepository`*.*</span></span> <span data-ttu-id="a2b0c-184">Veri okuma ve yazma için bağlamı çağırmak yerine bu sahte bir depo sınıfına bellek içi koleksiyonları denetleyicisi işlevlerini test etmek için yönlendirme.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-184">Instead of calling the context to read and write data, this mock repository class could manipulate in-memory collections in order to test controller functions.</span></span>

## <a name="implement-a-generic-repository-and-a-unit-of-work-class"></a><span data-ttu-id="a2b0c-185">Genel depo ve iş sınıfı bir birimi uygulayın</span><span class="sxs-lookup"><span data-stu-id="a2b0c-185">Implement a Generic Repository and a Unit of Work Class</span></span>

<span data-ttu-id="a2b0c-186">Her varlık türü için bir depo sınıfına oluşturma gereksiz kod içinde birçok neden olabilir ve kısmi güncelleştirmeleri neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-186">Creating a repository class for each entity type could result in a lot of redundant code, and it could result in partial updates.</span></span> <span data-ttu-id="a2b0c-187">Örneğin, iki farklı varlık türleri aynı işlemin bir parçası güncelleştirmek olduğunu varsayalım.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-187">For example, suppose you have to update two different entity types as part of the same transaction.</span></span> <span data-ttu-id="a2b0c-188">Her bir ayrı bir veritabanı bağlamını örneği kullanıyorsa, biri başarılı olabilir ve diğer başarısız olabilir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-188">If each uses a separate database context instance, one might succeed and the other might fail.</span></span> <span data-ttu-id="a2b0c-189">Gereksiz kod en aza indirmek için bir yol olan genel bir depo ve emin olmanın bir yolu kullanmak için tüm depolar aynı veritabanı bağlamını kullanır (ve bu nedenle tüm güncelleştirmeleri koordine) iş sınıfı birimi kullanılacak olmasıdır.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-189">One way to minimize redundant code is to use a generic repository, and one way to ensure that all repositories use the same database context (and thus coordinate all updates) is to use a unit of work class.</span></span>

<span data-ttu-id="a2b0c-190">Öğreticinin bu bölümünde, oluşturacağınız bir `GenericRepository` sınıfı ve `UnitOfWork` sınıfı ve bunları kullanmak `Course` hem erişim için denetleyici `Department` ve `Course` varlık kümeleri.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-190">In this section of the tutorial, you'll create a `GenericRepository` class and a `UnitOfWork` class, and use them in the `Course` controller to access both the `Department` and the `Course` entity sets.</span></span> <span data-ttu-id="a2b0c-191">Öğreticinin bu bölümünde basit tutmak için daha önce açıklandığı şekilde, bu sınıflar arabirimleri oluşturma değildir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-191">As explained earlier, to keep this part of the tutorial simple, you aren't creating interfaces for these classes.</span></span> <span data-ttu-id="a2b0c-192">Ancak bunları TDD kolaylaştırmak için kullanmayı düşünüyor, genellikle bunları arabirimleriyle aynı şeklinden uygulamak `Student` depo.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-192">But if you were going to use them to facilitate TDD, you'd typically implement them with interfaces the same way you did the `Student` repository.</span></span>

### <a name="create-a-generic-repository"></a><span data-ttu-id="a2b0c-193">Genel bir depo oluşturun</span><span class="sxs-lookup"><span data-stu-id="a2b0c-193">Create a Generic Repository</span></span>

<span data-ttu-id="a2b0c-194">İçinde *DAL* klasör oluşturma *GenericRepository.cs* ve varolan kodu aşağıdaki kodla değiştirin:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-194">In the *DAL* folder, create *GenericRepository.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample17.cs)]

<span data-ttu-id="a2b0c-195">Sınıf değişkenleri veritabanı bağlamının ve havuz için örneği bir varlık kümesi için belirtilir:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-195">Class variables are declared for the database context and for the entity set that the repository is instantiated for:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample18.cs)]

<span data-ttu-id="a2b0c-196">Oluşturucu, bir veritabanı bağlamını örneği kabul eder ve varlık kümesi değişkeni başlatır:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-196">The constructor accepts a database context instance and initializes the entity set variable:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample19.cs)]

<span data-ttu-id="a2b0c-197">`Get` Yöntemini çağıran kod, bir filtre koşulu ve sonuçları sıralamak için sütun belirtmek izin vermek için lambda ifadeleri kullanır ve istekli yükleme için virgülle ayrılmış bir gezinti özelliklerinin listesini sağlayan arayan bir dize parametresi sağlar:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-197">The `Get` method uses lambda expressions to allow the calling code to specify a filter condition and a column to order the results by, and a string parameter lets the caller provide a comma-delimited list of navigation properties for eager loading:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample20.cs)]

<span data-ttu-id="a2b0c-198">Kod `Expression<Func<TEntity, bool>> filter` çağıran bir lambda ifadesine göre sağlayacaktır anlamına gelir `TEntity` türü ve bu ifade bir Boole değeri döndürür.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-198">The code `Expression<Func<TEntity, bool>> filter` means the caller will provide a lambda expression based on the `TEntity` type, and this expression will return a Boolean value.</span></span> <span data-ttu-id="a2b0c-199">Örneğin, havuz için örneği varsa `Student` yöntemi çağrılırken kodda varlık türü belirtin `student => student.LastName == "Smith` &quot; için `filter` parametresi.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-199">For example, if the repository is instantiated for the `Student` entity type, the code in the calling method might specify `student => student.LastName == "Smith`&quot; for the `filter` parameter.</span></span>

<span data-ttu-id="a2b0c-200">Kod `Func<IQueryable<TEntity>, IOrderedQueryable<TEntity>> orderBy` çağıran bir lambda ifadesi sağlayacağı anlamına da gelir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-200">The code `Func<IQueryable<TEntity>, IOrderedQueryable<TEntity>> orderBy` also means the caller will provide a lambda expression.</span></span> <span data-ttu-id="a2b0c-201">Ancak bu durumda, ifade giriştir bir `IQueryable` nesnesi `TEntity` türü.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-201">But in this case, the input to the expression is an `IQueryable` object for the `TEntity` type.</span></span> <span data-ttu-id="a2b0c-202">İfade, sıralı bir sürümünü döndürür `IQueryable` nesne.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-202">The expression will return an ordered version of that `IQueryable` object.</span></span> <span data-ttu-id="a2b0c-203">Örneğin, havuz için örneği varsa `Student` yöntemi çağrılırken kodda varlık türü belirtin `q => q.OrderBy(s => s.LastName)` için `orderBy` parametresi.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-203">For example, if the repository is instantiated for the `Student` entity type, the code in the calling method might specify `q => q.OrderBy(s => s.LastName)` for the `orderBy` parameter.</span></span>

<span data-ttu-id="a2b0c-204">Kodda `Get` yöntemi oluşturur bir `IQueryable` nesne ve filtre ifadesi varsa uygular:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-204">The code in the `Get` method creates an `IQueryable` object and then applies the filter expression if there is one:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample21.cs)]

<span data-ttu-id="a2b0c-205">Sonraki virgülle ayrılmış Liste Ayrıştırma sonra eager yükleme ifadeleri geçerlidir:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-205">Next it applies the eager-loading expressions after parsing the comma-delimited list:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample22.cs)]

<span data-ttu-id="a2b0c-206">Son olarak, geçerli `orderBy` varsa ifade ve sonuçları; döndürür aksi sırasız sorgunun sonuçlarını döndürür:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-206">Finally, it applies the `orderBy` expression if there is one and returns the results; otherwise it returns the results from the unordered query:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample23.cs)]

<span data-ttu-id="a2b0c-207">Çağırdığınızda `Get` yöntemi yaptığınız filtreleme ve sıralama `IEnumerable` bu işlevler için parametreleri sağlamak yerine yöntemi tarafından döndürülen koleksiyon.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-207">When you call the `Get` method, you could do filtering and sorting on the `IEnumerable` collection returned by the method instead of providing parameters for these functions.</span></span> <span data-ttu-id="a2b0c-208">Ancak, sıralama ve filtreleme iş ardından web sunucusu üzerindeki bellekte uygulanır.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-208">But the sorting and filtering work would then be done in memory on the web server.</span></span> <span data-ttu-id="a2b0c-209">Bu parametreleri kullanarak, web sunucusu yerine veritabanı iş yapıldığından emin olun.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-209">By using these parameters, you ensure that the work is done by the database rather than the web server.</span></span> <span data-ttu-id="a2b0c-210">Belirli bir varlık türleri için türetilen sınıflar oluşturabilir ve özel bir alternatifidir `Get` yöntemleri gibi `GetStudentsInNameOrder` veya `GetStudentsByName`.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-210">An alternative is to create derived classes for specific entity types and add specialized `Get` methods, such as `GetStudentsInNameOrder` or `GetStudentsByName`.</span></span> <span data-ttu-id="a2b0c-211">Ancak, karmaşık bir uygulamada bu çok sayıda gibi türetilmiş sınıflar ve korumak için daha fazla iş olabilecek özel yöntemler sonuçlanabilir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-211">However, in a complex application, this can result in a large number of such derived classes and specialized methods, which could be more work to maintain.</span></span>

<span data-ttu-id="a2b0c-212">Kodda `GetByID`, `Insert`, ve `Update` yöntem genel olmayan depoda gördüğünüz üzerine benzerdir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-212">The code in the `GetByID`, `Insert`, and `Update` methods is similar to what you saw in the non-generic repository.</span></span> <span data-ttu-id="a2b0c-213">(Bir istekli yükleme parametresi sağlayarak olmayan `GetByID` imza ile istekli yükleme yapamazsınız çünkü `Find` yöntemi.)</span><span class="sxs-lookup"><span data-stu-id="a2b0c-213">(You aren't providing an eager loading parameter in the `GetByID` signature, because you can't do eager loading with the `Find` method.)</span></span>

<span data-ttu-id="a2b0c-214">İki aşırı yükleme için sağlanan `Delete` yöntemi:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-214">Two overloads are provided for the `Delete` method:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample24.cs)]

<span data-ttu-id="a2b0c-215">Bu sağlar biri silinecek yalnızca kimliği varlık içinde geçirirsiniz ve bir varlık örneğini alır.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-215">One of these lets you pass in just the ID of the entity to be deleted, and one takes an entity instance.</span></span> <span data-ttu-id="a2b0c-216">Gördüğünüz gibi [eşzamanlılık işleme](../../getting-started/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md) işleme, eşzamanlılık gereksinim için öğretici bir `Delete` varlık örneğini alan yöntemi izleme özelliği özgün değeri içerir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-216">As you saw in the [Handling Concurrency](../../getting-started/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md) tutorial, for concurrency handling you need a `Delete` method that takes an entity instance that includes the original value of a tracking property.</span></span>

<span data-ttu-id="a2b0c-217">Bu genel deponun tipik CRUD gereksinimleri işler.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-217">This generic repository will handle typical CRUD requirements.</span></span> <span data-ttu-id="a2b0c-218">Bir özel varlık türü gibi daha karmaşık filtreleme veya sıralama, özel gereksinimleri varsa, ek yöntemleri türüne sahip türetilmiş bir sınıf oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-218">When a particular entity type has special requirements, such as more complex filtering or ordering, you can create a derived class that has additional methods for that type.</span></span>

## <a name="creating-the-unit-of-work-class"></a><span data-ttu-id="a2b0c-219">İş sınıfı birimini oluşturma</span><span class="sxs-lookup"><span data-stu-id="a2b0c-219">Creating the Unit of Work Class</span></span>

<span data-ttu-id="a2b0c-220">İş sınıfı birimi bir amaca hizmet eder: birden çok deposu kullandığınızda emin olmak için bunlar bir tek veritabanı bağlamını paylaşabilir.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-220">The unit of work class serves one purpose: to make sure that when you use multiple repositories, they share a single database context.</span></span> <span data-ttu-id="a2b0c-221">Böylece, iş birimi tamamlandığında çağırabilirsiniz `SaveChanges` yöntemi örneğine ilişkin bağlam ve tüm ilgili değişiklikler Eşgüdümlü olacaktır garanti.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-221">That way, when a unit of work is complete you can call the `SaveChanges` method on that instance of the context and be assured that all related changes will be coordinated.</span></span> <span data-ttu-id="a2b0c-222">Tüm bu sınıfı gereksinimleri olan bir `Save` yöntemi ve her bir depo bir özellik.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-222">All that the class needs is a `Save` method and a property for each repository.</span></span> <span data-ttu-id="a2b0c-223">Her bir depo özellik bir depo örnekleri olarak aynı veritabanı bağlamı örneği kullanılarak oluşturulmuş bir depo örneği döndürür.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-223">Each repository property returns a repository instance that has been instantiated using the same database context instance as the other repository instances.</span></span>

<span data-ttu-id="a2b0c-224">İçinde *DAL* klasöründe adlı bir sınıf dosyası oluşturma *UnitOfWork.cs* ve şablon kodunu aşağıdaki kodla değiştirin:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-224">In the *DAL* folder, create a class file named *UnitOfWork.cs* and replace the template code with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample25.cs)]

<span data-ttu-id="a2b0c-225">Bu kod, veritabanı bağlamı ve her deponun sınıfı değişkenlerini oluşturur.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-225">The code creates class variables for the database context and each repository.</span></span> <span data-ttu-id="a2b0c-226">İçin `context` yeni bir bağlam değişkeni oluşturulur:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-226">For the `context` variable, a new context is instantiated:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample26.cs)]

<span data-ttu-id="a2b0c-227">Her bir depo özellik deposu zaten var olup olmadığını denetler.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-227">Each repository property checks whether the repository already exists.</span></span> <span data-ttu-id="a2b0c-228">Aksi durumda, bağlam örneğinde geçirerek havuzu oluşturur.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-228">If not, it instantiates the repository, passing in the context instance.</span></span> <span data-ttu-id="a2b0c-229">Sonuç olarak, tüm depolar, aynı bağlam örneğinin paylaşın.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-229">As a result, all repositories share the same context instance.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample27.cs)]

<span data-ttu-id="a2b0c-230">`Save` Yöntem çağrılarını `SaveChanges` üzerinde veritabanı bağlamı.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-230">The `Save` method calls `SaveChanges` on the database context.</span></span>

<span data-ttu-id="a2b0c-231">Gibi bir sınıf değişkeni veritabanı bağlamında başlatan herhangi bir sınıf `UnitOfWork` sınıfının Implements `IDisposable` ve bağlam siler.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-231">Like any class that instantiates a database context in a class variable, the `UnitOfWork` class implements `IDisposable` and disposes the context.</span></span>

### <a name="changing-the-course-controller-to-use-the-unitofwork-class-and-repositories"></a><span data-ttu-id="a2b0c-232">UnitOfWork sınıfı ve depoları kullanılacak kurs denetleyicisini değiştirme</span><span class="sxs-lookup"><span data-stu-id="a2b0c-232">Changing the Course Controller to use the UnitOfWork Class and Repositories</span></span>

<span data-ttu-id="a2b0c-233">Şu anda sahip kodu değiştirin *CourseController.cs* aşağıdaki kod ile:</span><span class="sxs-lookup"><span data-stu-id="a2b0c-233">Replace the code you currently have in *CourseController.cs* with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample28.cs?highlight=15,20,22,31,54-55,70,85-86,101-102,122-124,130)]

<span data-ttu-id="a2b0c-234">Bu kod için bir sınıf değişken ekler `UnitOfWork` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-234">This code adds a class variable for the `UnitOfWork` class.</span></span> <span data-ttu-id="a2b0c-235">(Arabirimler burada kullandıysanız, burada değişkeni başlatmak mıydı; bunun yerine, iki Oluşturucu desenini uygulamak yaptığınız gibi `Student` depo.)</span><span class="sxs-lookup"><span data-stu-id="a2b0c-235">(If you were using interfaces here, you wouldn't initialize the variable here; instead, you'd implement a pattern of two constructors just as you did for the `Student` repository.)</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample29.cs)]

<span data-ttu-id="a2b0c-236">Sınıf kalanında veritabanı bağlamı tüm başvurularını uygun depoyu başvuruları değiştirilir kullanarak `UnitOfWork` depoya erişmek için özelliklere.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-236">In the rest of the class, all references to the database context are replaced by references to the appropriate repository, using `UnitOfWork` properties to access the repository.</span></span> <span data-ttu-id="a2b0c-237">`Dispose` Yöntemi siler `UnitOfWork` örneği.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-237">The `Dispose` method disposes the `UnitOfWork` instance.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample30.cs)]

<span data-ttu-id="a2b0c-238">Siteyi çalıştırın ve tıklayın **kursları** sekmesi.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-238">Run the site and click the **Courses** tab.</span></span>

![Courses_Index_page](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image4.png)

<span data-ttu-id="a2b0c-240">Sayfası görünür ve aynı önce yaptığınız değişiklikleri yaptık ve diğer kurs sayfaları da aynı şekilde işler gibi çalışır.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-240">The page looks and works the same as it did before your changes, and the other Course pages also work the same.</span></span>

## <a name="summary"></a><span data-ttu-id="a2b0c-241">Özet</span><span class="sxs-lookup"><span data-stu-id="a2b0c-241">Summary</span></span>

<span data-ttu-id="a2b0c-242">Şimdi, hem depoya hem de iş birimi desenleri uyguladınız.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-242">You have now implemented both the repository and unit of work patterns.</span></span> <span data-ttu-id="a2b0c-243">Lambda ifadeleri, genel deponun yöntemi parametreler olarak kullandınız.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-243">You have used lambda expressions as method parameters in the generic repository.</span></span> <span data-ttu-id="a2b0c-244">Bu ifadeler ile kullanma hakkında daha fazla bilgi için bir `IQueryable` nesne, bkz: [IQueryable(T) arabirimi (System.Linq)](https://msdn.microsoft.com/library/bb351562.aspx) MSDN Kitaplığı'nda.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-244">For more information about how to use these expressions with an `IQueryable` object, see [IQueryable(T) Interface (System.Linq)](https://msdn.microsoft.com/library/bb351562.aspx) in the MSDN Library.</span></span> <span data-ttu-id="a2b0c-245">Sonraki Gelişmiş senaryoları Öğreticisi bazı nasıl ele alınacağını öğreneceksiniz.</span><span class="sxs-lookup"><span data-stu-id="a2b0c-245">In the next tutorial you'll learn how to handle some advanced scenarios.</span></span>

<span data-ttu-id="a2b0c-246">Entity Framework diğer kaynakların bağlantılarını bulunabilir [ASP.NET Data Access içerik haritası](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="a2b0c-246">Links to other Entity Framework resources can be found in the [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a2b0c-247">[Önceki](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application.md)
> [İleri](advanced-entity-framework-scenarios-for-an-mvc-web-application.md)</span><span class="sxs-lookup"><span data-stu-id="a2b0c-247">[Previous](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application.md)
[Next](advanced-entity-framework-scenarios-for-an-mvc-web-application.md)</span></span>
