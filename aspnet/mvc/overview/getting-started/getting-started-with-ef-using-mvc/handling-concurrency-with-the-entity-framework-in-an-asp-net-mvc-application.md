---
uid: mvc/overview/getting-started/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application
title: 'Öğretici: Bir ASP.NET MVC 5 uygulamasında eşzamanlılık EF ile işleme'
description: Bu öğreticide, iyimser eşzamanlılık birden çok kullanıcı aynı anda aynı varlık güncelleştirme çakışmaları işlemek için nasıl kullanılacağını gösterir.
author: tdykstra
ms.author: riande
ms.topic: tutorial
ms.date: 01/15/2019
ms.assetid: be0c098a-1fb2-457e-b815-ddca601afc65
msc.legacyurl: /mvc/overview/getting-started/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 11b1bc316f730e31b4a01924765db3c982783652
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/17/2019
ms.locfileid: "59383024"
---
# <a name="tutorial-handle-concurrency-with-ef-in-an-aspnet-mvc-5-app"></a><span data-ttu-id="eacf9-103">Öğretici: Bir ASP.NET MVC 5 uygulamasında eşzamanlılık EF ile işleme</span><span class="sxs-lookup"><span data-stu-id="eacf9-103">Tutorial: Handle Concurrency with EF in an ASP.NET MVC 5 app</span></span>

<span data-ttu-id="eacf9-104">Önceki öğreticilerde, verileri güncelleştirmek öğrendiniz.</span><span class="sxs-lookup"><span data-stu-id="eacf9-104">In earlier tutorials you learned how to update data.</span></span> <span data-ttu-id="eacf9-105">Bu öğreticide, iyimser eşzamanlılık birden çok kullanıcı aynı anda aynı varlık güncelleştirme çakışmaları işlemek için nasıl kullanılacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-105">This tutorial shows how to use optimistic concurrency to handle conflicts when multiple users update the same entity at the same time.</span></span> <span data-ttu-id="eacf9-106">Çalışan web sayfalarını değiştirmesine `Department` varlık böylece bunlar eşzamanlılık hata işleme.</span><span class="sxs-lookup"><span data-stu-id="eacf9-106">You change the web pages that work with the `Department` entity so that they handle concurrency errors.</span></span> <span data-ttu-id="eacf9-107">Aşağıdaki çizimler bir eşzamanlılık çakışması ortaya çıkarsa, gösterilen bazı iletileri de dahil olmak üzere düzenleme ve silme sayfalar gösterir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-107">The following illustrations show the Edit and Delete pages, including some messages that are displayed if a concurrency conflict occurs.</span></span>

![Department_Edit_page_2_after_clicking_Save](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image10.png)

![Department_Edit_page_2_after_clicking_Save](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image15.png)

<span data-ttu-id="eacf9-110">Bu öğreticide şunları yaptınız:</span><span class="sxs-lookup"><span data-stu-id="eacf9-110">In this tutorial, you:</span></span>


> [!div class="checklist"]
> * <span data-ttu-id="eacf9-111">Eşzamanlılık çakışmalarını hakkında bilgi edinin</span><span class="sxs-lookup"><span data-stu-id="eacf9-111">Learn about concurrency conflicts</span></span>
> * <span data-ttu-id="eacf9-112">İyimser eşzamanlılık ekleme</span><span class="sxs-lookup"><span data-stu-id="eacf9-112">Add optimistic concurrency</span></span>
> * <span data-ttu-id="eacf9-113">Departman denetleyicisini değiştirmek</span><span class="sxs-lookup"><span data-stu-id="eacf9-113">Modify Department controller</span></span>
> * <span data-ttu-id="eacf9-114">Test eşzamanlılığı işleme</span><span class="sxs-lookup"><span data-stu-id="eacf9-114">Test concurrency handling</span></span>
> * <span data-ttu-id="eacf9-115">Silme sayfası</span><span class="sxs-lookup"><span data-stu-id="eacf9-115">Update the Delete page</span></span>


## <a name="prerequisites"></a><span data-ttu-id="eacf9-116">Önkoşullar</span><span class="sxs-lookup"><span data-stu-id="eacf9-116">Prerequisites</span></span>

* [<span data-ttu-id="eacf9-117">Zaman Uyumsuz ve Saklı Yordamlar</span><span class="sxs-lookup"><span data-stu-id="eacf9-117">Async and Stored Procedures</span></span>](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application.md)

## <a name="concurrency-conflicts"></a><span data-ttu-id="eacf9-118">Eşzamanlılık çakışmaları</span><span class="sxs-lookup"><span data-stu-id="eacf9-118">Concurrency conflicts</span></span>

<span data-ttu-id="eacf9-119">Düzenlemek için bir kullanıcı bir varlığın verilerini görüntüler ve ilk kullanıcının değişiklik veritabanına yazılmadan önce başka bir kullanıcı aynı varlığın veri güncelleştirmeleri bir eşzamanlılık çakışması gerçekleşir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-119">A concurrency conflict occurs when one user displays an entity's data in order to edit it, and then another user updates the same entity's data before the first user's change is written to the database.</span></span> <span data-ttu-id="eacf9-120">Böyle bir çakışma algılanması etkinleştirmezseniz, kişi veritabanını güncelleştiren son diğer kullanıcının yaptığı değişikliklerin üzerine yazar.</span><span class="sxs-lookup"><span data-stu-id="eacf9-120">If you don't enable the detection of such conflicts, whoever updates the database last overwrites the other user's changes.</span></span> <span data-ttu-id="eacf9-121">Birçok uygulamada, bu riski kabul edilebilir: Bazı kullanıcılara veya birkaç güncelleştirmeleri varsa veya bazı değişikliklerin üzerine yazılır, programlama için eşzamanlılık maliyeti gereksinimlerine ağır bastığı avantajı gerçekten önemli değildir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-121">In many applications, this risk is acceptable: if there are few users, or few updates, or if isn't really critical if some changes are overwritten, the cost of programming for concurrency might outweigh the benefit.</span></span> <span data-ttu-id="eacf9-122">Bu durumda, eşzamanlılık çakışmalarını işleme için uygulamayı yapılandırmanız gerekmez.</span><span class="sxs-lookup"><span data-stu-id="eacf9-122">In that case, you don't have to configure the application to handle concurrency conflicts.</span></span>

### <a name="pessimistic-concurrency-locking"></a><span data-ttu-id="eacf9-123">Kötümser eşzamanlılık (kilitleme)</span><span class="sxs-lookup"><span data-stu-id="eacf9-123">Pessimistic Concurrency (Locking)</span></span>

<span data-ttu-id="eacf9-124">Uygulamanızı eşzamanlılık senaryolarda yanlışlıkla veri kaybı önleme ihtiyacınız varsa, bunu yapmanın bir yolu veritabanı kilitlerini kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="eacf9-124">If your application does need to prevent accidental data loss in concurrency scenarios, one way to do that is to use database locks.</span></span> <span data-ttu-id="eacf9-125">Bu adlandırılır *kötümser eşzamanlılık*.</span><span class="sxs-lookup"><span data-stu-id="eacf9-125">This is called *pessimistic concurrency*.</span></span> <span data-ttu-id="eacf9-126">Örneğin, bir veritabanından satır okumadan önce kilit isteği salt okunur veya güncelleştirme erişim için.</span><span class="sxs-lookup"><span data-stu-id="eacf9-126">For example, before you read a row from a database, you request a lock for read-only or for update access.</span></span> <span data-ttu-id="eacf9-127">Güncelleştirme erişimi için bir satır kilitlerseniz, başka hiçbir kullanıcı için ya da satırın kilitlemek için izin salt okunur veya değiştirilen sürecinde olan verilerin bir kopyasını elde edecekleri çünkü erişim güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="eacf9-127">If you lock a row for update access, no other users are allowed to lock the row either for read-only or update access, because they would get a copy of data that's in the process of being changed.</span></span> <span data-ttu-id="eacf9-128">Salt okunur erişim için bir satır kilitlerseniz, diğerleri de salt okunur erişim için kullanılabilir ancak güncelleştirme kilitleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="eacf9-128">If you lock a row for read-only access, others can also lock it for read-only access but not for update.</span></span>

<span data-ttu-id="eacf9-129">Kilitleri yönetmek dezavantajları vardır.</span><span class="sxs-lookup"><span data-stu-id="eacf9-129">Managing locks has disadvantages.</span></span> <span data-ttu-id="eacf9-130">Programa karmaşık olabilir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-130">It can be complex to program.</span></span> <span data-ttu-id="eacf9-131">Önemli bir veritabanı yönetim kaynakları gerektirir ve bu uygulamanın kullanıcı sayısı performans sorunlarına neden olabilir artırır.</span><span class="sxs-lookup"><span data-stu-id="eacf9-131">It requires significant database management resources, and it can cause performance problems as the number of users of an application increases.</span></span> <span data-ttu-id="eacf9-132">Bu nedenle, tüm veritabanı yönetim sistemleri kötümser eşzamanlılık destekler.</span><span class="sxs-lookup"><span data-stu-id="eacf9-132">For these reasons, not all database management systems support pessimistic concurrency.</span></span> <span data-ttu-id="eacf9-133">Entity Framework yerleşik desteği yok sağlar ve Bu öğreticide nasıl göstermez.</span><span class="sxs-lookup"><span data-stu-id="eacf9-133">The Entity Framework provides no built-in support for it, and this tutorial doesn't show you how to implement it.</span></span>

### <a name="optimistic-concurrency"></a><span data-ttu-id="eacf9-134">İyimser Eşzamanlılık</span><span class="sxs-lookup"><span data-stu-id="eacf9-134">Optimistic Concurrency</span></span>

<span data-ttu-id="eacf9-135">Kötümser eşzamanlılık alternatifi *iyimser eşzamanlılık*.</span><span class="sxs-lookup"><span data-stu-id="eacf9-135">The alternative to pessimistic concurrency is *optimistic concurrency*.</span></span> <span data-ttu-id="eacf9-136">İyimser eşzamanlılık, eşzamanlılık çakışmalarını olmasını sağlar ve eğer uygun şekilde tepki anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-136">Optimistic concurrency means allowing concurrency conflicts to happen, and then reacting appropriately if they do.</span></span> <span data-ttu-id="eacf9-137">Örneğin, John Departmanlar Düzenle sayfasında, değişiklikleri çalışır **bütçe** 350,000.00 $ 0,00 ABD Doları İngilizce departmanına tutar.</span><span class="sxs-lookup"><span data-stu-id="eacf9-137">For example, John runs the Departments Edit page, changes the **Budget** amount for the English department from $350,000.00 to $0.00.</span></span>

<span data-ttu-id="eacf9-138">John tıkladığında önce **Kaydet**, Jane çalışan aynı sayfa ve değişiklikleri **başlangıç tarihi** alanı 1/9/2007'den 8/8/2013.</span><span class="sxs-lookup"><span data-stu-id="eacf9-138">Before John clicks **Save**, Jane runs the same page and changes the **Start Date** field from 9/1/2007 to 8/8/2013.</span></span>

<span data-ttu-id="eacf9-139">John tıkladığında **Kaydet** ilk ve tarayıcı dizin sayfasına, sonra Jane döndürdüğünde değişikliğinin tıkladığında görür **Kaydet**.</span><span class="sxs-lookup"><span data-stu-id="eacf9-139">John clicks **Save** first and sees his change when the browser returns to the Index page, then Jane clicks **Save**.</span></span> <span data-ttu-id="eacf9-140">Sonraki işlemin ne eşzamanlılık çakışmalarını nasıl ele tarafından belirlenir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-140">What happens next is determined by how you handle concurrency conflicts.</span></span> <span data-ttu-id="eacf9-141">Bazı seçenekleri şunlardır:</span><span class="sxs-lookup"><span data-stu-id="eacf9-141">Some of the options include the following:</span></span>

- <span data-ttu-id="eacf9-142">Bir kullanıcı değiştirmiş hangi özelliğinin izlemek ve yalnızca ilgili sütunları veritabanında güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="eacf9-142">You can keep track of which property a user has modified and update only the corresponding columns in the database.</span></span> <span data-ttu-id="eacf9-143">Farklı özellikleri iki kullanıcı tarafından güncelleştirildiği için yer alan örnek senaryoda, veri kaybı, olacaktır.</span><span class="sxs-lookup"><span data-stu-id="eacf9-143">In the example scenario, no data would be lost, because different properties were updated by the two users.</span></span> <span data-ttu-id="eacf9-144">Sonraki biri İngilizce departmanı gözatar, Can'ın hem Gamze'nin değişiklikleri görürler: 8/8/2013'ün Başlangıç tarihi ve bütçe sıfır dolarlık bir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-144">The next time someone browses the English department, they'll see both John's and Jane's changes — a start date of 8/8/2013 and a budget of Zero dollars.</span></span>

    <span data-ttu-id="eacf9-145">Bu güncelleştirme yöntemini veri kaybına neden olabilecek çakışmaları sayısını azaltabilir, ancak bir varlığın aynı özelliğe rakip bir değişiklik yaptıysanız, veri kaybını önlemek olamaz.</span><span class="sxs-lookup"><span data-stu-id="eacf9-145">This method of updating can reduce the number of conflicts that could result in data loss, but it can't avoid data loss if competing changes are made to the same property of an entity.</span></span> <span data-ttu-id="eacf9-146">Varlık Çerçevesi'Bu şekilde çalışıp çalışmadığını güncelleştirme kodunuzu nasıl uygulayacağınıza bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="eacf9-146">Whether the Entity Framework works this way depends on how you implement your update code.</span></span> <span data-ttu-id="eacf9-147">Bir varlığın özgün tüm özellik değerlerini yanı sıra yeni değerleri izlemek için büyük miktarlarda durumu bakımını gerektirebilir içinde bir web uygulaması pratik değildir, çünkü genellikle.</span><span class="sxs-lookup"><span data-stu-id="eacf9-147">It's often not practical in a web application, because it can require that you maintain large amounts of state in order to keep track of all original property values for an entity as well as new values.</span></span> <span data-ttu-id="eacf9-148">Koruma durumu büyük miktarlarda uygulama performansı etkileyebilir sunucu kaynaklarını gerektirir ya da web sayfasında kendisi (örneğin, gizli alanlar) dahil edilmesi için veya bir tanımlama bilgisinde.</span><span class="sxs-lookup"><span data-stu-id="eacf9-148">Maintaining large amounts of state can affect application performance because it either requires server resources or must be included in the web page itself (for example, in hidden fields) or in a cookie.</span></span>
- <span data-ttu-id="eacf9-149">Gamze'nin değişiklik Can'ın değişiklik üzerine izin verebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="eacf9-149">You can let Jane's change overwrite John's change.</span></span> <span data-ttu-id="eacf9-150">Sonraki biri İngilizce departmanı gözatar, 8/8/2013 görürler ve geri yüklenen $350,000.00 değeri.</span><span class="sxs-lookup"><span data-stu-id="eacf9-150">The next time someone browses the English department, they'll see 8/8/2013 and the restored $350,000.00 value.</span></span> <span data-ttu-id="eacf9-151">Bu adlı bir *istemci WINS* veya *WINS'te son* senaryo.</span><span class="sxs-lookup"><span data-stu-id="eacf9-151">This is called a *Client Wins* or *Last in Wins* scenario.</span></span> <span data-ttu-id="eacf9-152">(Tüm istemci değerlerinden veri deposunda nedir üzerinde önceliklidir.) Bu bölüm için giriş eşzamanlılık işleme için kodlama yapmazsanız belirtildiği gibi bu otomatik olarak gerçekleşir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-152">(All values from the client take precedence over what's in the data store.) As noted in the introduction to this section, if you don't do any coding for concurrency handling, this will happen automatically.</span></span>
- <span data-ttu-id="eacf9-153">Veritabanında güncelleştirilen Gamze'nin değişiklik engelleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="eacf9-153">You can prevent Jane's change from being updated in the database.</span></span> <span data-ttu-id="eacf9-154">Genellikle, bir hata iletisi görüntüler, her verilerin geçerli durumunu gösterir ve her yine de bunları yapmak istediği değişiklikleri yeniden uygulamak izin.</span><span class="sxs-lookup"><span data-stu-id="eacf9-154">Typically, you would display an error message, show her the current state of the data, and allow her to reapply her changes if she still wants to make them.</span></span> <span data-ttu-id="eacf9-155">Bu adlı bir *Store WINS* senaryo.</span><span class="sxs-lookup"><span data-stu-id="eacf9-155">This is called a *Store Wins* scenario.</span></span> <span data-ttu-id="eacf9-156">(Veri deposu değerlerini istemci tarafından gönderilen değerler önceliklidir.) Bu öğreticide Store WINS senaryo uygulayacaksınız.</span><span class="sxs-lookup"><span data-stu-id="eacf9-156">(The data-store values take precedence over the values submitted by the client.) You'll implement the Store Wins scenario in this tutorial.</span></span> <span data-ttu-id="eacf9-157">Bu yöntem, neler olduğunu için uyarı bir kullanıcı olmaksızın herhangi bir değişiklik kılınmamasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="eacf9-157">This method ensures that no changes are overwritten without a user being alerted to what's happening.</span></span>

### <a name="detecting-concurrency-conflicts"></a><span data-ttu-id="eacf9-158">Eşzamanlılık çakışmaları algılama</span><span class="sxs-lookup"><span data-stu-id="eacf9-158">Detecting Concurrency Conflicts</span></span>

<span data-ttu-id="eacf9-159">İşleyerek çakışmalarını çözebilirsiniz [OptimisticConcurrencyException](https://msdn.microsoft.com/library/system.data.optimisticconcurrencyexception.aspx) Entity Framework oluşturduğu özel durumları.</span><span class="sxs-lookup"><span data-stu-id="eacf9-159">You can resolve conflicts by handling [OptimisticConcurrencyException](https://msdn.microsoft.com/library/system.data.optimisticconcurrencyexception.aspx) exceptions that the Entity Framework throws.</span></span> <span data-ttu-id="eacf9-160">Bu özel durumlar ne zaman öğrenmek için Entity Framework algılayamayabilir çakışmalar olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-160">In order to know when to throw these exceptions, the Entity Framework must be able to detect conflicts.</span></span> <span data-ttu-id="eacf9-161">Bu nedenle, veritabanı ve veri modeline uygun şekilde yapılandırmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-161">Therefore, you must configure the database and the data model appropriately.</span></span> <span data-ttu-id="eacf9-162">Çakışma algılamasını etkinleştirmek için bazı seçenekler şunlardır:</span><span class="sxs-lookup"><span data-stu-id="eacf9-162">Some options for enabling conflict detection include the following:</span></span>

- <span data-ttu-id="eacf9-163">Veritabanı tablosunda bir satıra değiştirildiğinde belirlemek için kullanılan bir izleme sütunu içerir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-163">In the database table, include a tracking column that can be used to determine when a row has been changed.</span></span> <span data-ttu-id="eacf9-164">Ardından bu sütunu eklemek için Entity Framework yapılandırabilirsiniz `Where` SQL yan tümcesi `Update` veya `Delete` komutları.</span><span class="sxs-lookup"><span data-stu-id="eacf9-164">You can then configure the Entity Framework to include that column in the `Where` clause of SQL `Update` or `Delete` commands.</span></span>

    <span data-ttu-id="eacf9-165">İzleme sütunun veri türü genellikle [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx).</span><span class="sxs-lookup"><span data-stu-id="eacf9-165">The data type of the tracking column is typically [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx).</span></span> <span data-ttu-id="eacf9-166">[Rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) satır güncelleştirilir her zaman artan sıralı bir sayı değeridir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-166">The [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) value is a sequential number that's incremented each time the row is updated.</span></span> <span data-ttu-id="eacf9-167">İçinde bir `Update` veya `Delete` komutu `Where` yan tümcesi izleme sütunu (özgün satır sürümü) özgün değeri içerir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-167">In an `Update` or `Delete` command, the `Where` clause includes the original value of the tracking column (the original row version).</span></span> <span data-ttu-id="eacf9-168">Güncelleştirilen satır değeri başka bir kullanıcı tarafından değiştirildiyse `rowversion` sütunudur özgün değerinden farklı şekilde `Update` veya `Delete` bildirimi nedeniyle güncelleştirilecek satırın bulamıyor `Where` yan tümcesi.</span><span class="sxs-lookup"><span data-stu-id="eacf9-168">If the row being updated has been changed by another user, the value in the `rowversion` column is different than the original value, so the `Update` or `Delete` statement can't find the row to update because of the `Where` clause.</span></span> <span data-ttu-id="eacf9-169">Entity Framework bulduğunda hiçbir satır tarafından güncelleştirildiğini `Update` veya `Delete` komutunu (diğer bir deyişle, etkilenen satır sayısı sıfır olduğunda), bir eşzamanlılık çakışması yorumlar.</span><span class="sxs-lookup"><span data-stu-id="eacf9-169">When the Entity Framework finds that no rows have been updated by the `Update` or `Delete` command (that is, when the number of affected rows is zero), it interprets that as a concurrency conflict.</span></span>
- <span data-ttu-id="eacf9-170">Tablodaki her sütun öğesinin özgün değerleri eklemek için Entity Framework yapılandırma `Where` yan tümcesi `Update` ve `Delete` komutları.</span><span class="sxs-lookup"><span data-stu-id="eacf9-170">Configure the Entity Framework to include the original values of every column in the table in the `Where` clause of `Update` and `Delete` commands.</span></span>

    <span data-ttu-id="eacf9-171">İlk seçenek satırın ilk okunuşundan bu yana, sıradaki herhangi bir şey değiştiyse, olduğu gibi `Where` yan tümcesi bir satırı güncelleştirmek için iade kalmaz, Entity Framework bir eşzamanlılık çakışması yorumlar.</span><span class="sxs-lookup"><span data-stu-id="eacf9-171">As in the first option, if anything in the row has changed since the row was first read, the `Where` clause won't return a row to update, which the Entity Framework interprets as a concurrency conflict.</span></span> <span data-ttu-id="eacf9-172">Birçok sütunları olan veritabanı tabloları için bu yaklaşım, çok büyük sonuçlanabilir `Where` yan tümcesi ve büyük miktarlarda durumu bakımını gerektirebilir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-172">For database tables that have many columns, this approach can result in very large `Where` clauses, and can require that you maintain large amounts of state.</span></span> <span data-ttu-id="eacf9-173">Daha önce belirtildiği gibi büyük miktarlarda durumu bakımını yapma, uygulama performansını etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-173">As noted earlier, maintaining large amounts of state can affect application performance.</span></span> <span data-ttu-id="eacf9-174">Bu nedenle bu yaklaşım genellikle önerilmez ve Bu öğreticide kullanılan yöntem değildir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-174">Therefore this approach is generally not recommended, and it isn't the method used in this tutorial.</span></span>

    <span data-ttu-id="eacf9-175">Eşzamanlılık için bu yaklaşımı uygulamak istiyorsanız, tüm birincil anahtar özellikleri ekleyerek eşzamanlılık için izlemek istediğiniz varlık işaretlemek sahip [ConcurrencyCheck](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.concurrencycheckattribute.aspx) öznitelik.</span><span class="sxs-lookup"><span data-stu-id="eacf9-175">If you do want to implement this approach to concurrency, you have to mark all non-primary-key properties in the entity you want to track concurrency for by adding the [ConcurrencyCheck](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.concurrencycheckattribute.aspx) attribute to them.</span></span> <span data-ttu-id="eacf9-176">Değişiklik SQL tüm sütunları eklemek Entity Framework sağlar `WHERE` yan tümcesi `UPDATE` deyimleri.</span><span class="sxs-lookup"><span data-stu-id="eacf9-176">That change enables the Entity Framework to include all columns in the SQL `WHERE` clause of `UPDATE` statements.</span></span>

<span data-ttu-id="eacf9-177">Bu öğreticinin geri kalanında, ekleyeceksiniz bir [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) özelliğini izleme `Department` varlık, bir denetleyici ve Görünüm ve her şeyin düzgün çalıştığını doğrulamak için test edin.</span><span class="sxs-lookup"><span data-stu-id="eacf9-177">In the remainder of this tutorial you'll add a [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) tracking property to the `Department` entity, create a controller and views, and test to verify that everything works correctly.</span></span>

## <a name="add-optimistic-concurrency"></a><span data-ttu-id="eacf9-178">İyimser eşzamanlılık ekleme</span><span class="sxs-lookup"><span data-stu-id="eacf9-178">Add optimistic concurrency</span></span>

<span data-ttu-id="eacf9-179">İçinde *Models\Department.cs*, adlı bir izleme özelliği ekleme `RowVersion`:</span><span class="sxs-lookup"><span data-stu-id="eacf9-179">In *Models\Department.cs*, add a tracking property named `RowVersion`:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.cs?highlight=20-22)]

<span data-ttu-id="eacf9-180">[Zaman damgası](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.timestampattribute.aspx) özniteliği belirtir, bu sütun eklenecektir `Where` yan tümcesi `Update` ve `Delete` veritabanına gönderilen komutları.</span><span class="sxs-lookup"><span data-stu-id="eacf9-180">The [Timestamp](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.timestampattribute.aspx) attribute specifies that this column will be included in the `Where` clause of `Update` and `Delete` commands sent to the database.</span></span> <span data-ttu-id="eacf9-181">Adlandırılan öznitelik [zaman damgası](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.timestampattribute.aspx) bir SQL SQL Server'ın önceki sürümlerinde kullanılan çünkü [zaman damgası](https://msdn.microsoft.com/library/ms182776(v=SQL.90).aspx) veri türü SQL önce [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) değiştirildi.</span><span class="sxs-lookup"><span data-stu-id="eacf9-181">The attribute is called [Timestamp](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.timestampattribute.aspx) because previous versions of SQL Server used a SQL [timestamp](https://msdn.microsoft.com/library/ms182776(v=SQL.90).aspx) data type before the SQL [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) replaced it.</span></span> <span data-ttu-id="eacf9-182">.Net türü [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) bir bayt dizisidir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-182">The .Net type for [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) is a byte array.</span></span>

<span data-ttu-id="eacf9-183">Fluent API'sini kullanmayı tercih ederseniz kullanabilirsiniz [IsConcurrencyToken](https://msdn.microsoft.com/library/gg679501(v=VS.103).aspx) yöntemi izleme özelliği, aşağıdaki örnekte gösterildiği gibi belirtin:</span><span class="sxs-lookup"><span data-stu-id="eacf9-183">If you prefer to use the fluent API, you can use the [IsConcurrencyToken](https://msdn.microsoft.com/library/gg679501(v=VS.103).aspx) method to specify the tracking property, as shown in the following example:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.cs)]

<span data-ttu-id="eacf9-184">Başka bir geçiş gerçekleştirmeniz gereken şekilde bir özellik ekleyerek veritabanı modeli değişti.</span><span class="sxs-lookup"><span data-stu-id="eacf9-184">By adding a property you changed the database model, so you need to do another migration.</span></span> <span data-ttu-id="eacf9-185">Paket Yöneticisi Konsolu (PMC'de), aşağıdaki komutları girin:</span><span class="sxs-lookup"><span data-stu-id="eacf9-185">In the Package Manager Console (PMC), enter the following commands:</span></span>

[!code-console[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cmd)]

## <a name="modify-department-controller"></a><span data-ttu-id="eacf9-186">Departman denetleyicisini değiştirmek</span><span class="sxs-lookup"><span data-stu-id="eacf9-186">Modify Department controller</span></span>

<span data-ttu-id="eacf9-187">İçinde *Controllers\DepartmentController.cs*, ekleme bir `using` deyimi:</span><span class="sxs-lookup"><span data-stu-id="eacf9-187">In *Controllers\DepartmentController.cs*, add a `using` statement:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs)]

<span data-ttu-id="eacf9-188">İçinde *DepartmentController.cs* dosya, departman Yöneticisi açılır listede Eğitmen tam adı yerine yalnızca son adını içerecek şekilde "tam"adı "LastName" dört tüm oluşumlarını değiştirin.</span><span class="sxs-lookup"><span data-stu-id="eacf9-188">In the *DepartmentController.cs* file, change all four occurrences of "LastName" to "FullName" so that the department administrator drop-down lists will contain the full name of the instructor rather than just the last name.</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cs?highlight=1)]

<span data-ttu-id="eacf9-189">Mevcut kodu değiştirin `HttpPost` `Edit` yöntemini aşağıdaki kod ile:</span><span class="sxs-lookup"><span data-stu-id="eacf9-189">Replace the existing code for the `HttpPost` `Edit` method with the following code:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs)]

<span data-ttu-id="eacf9-190">Varsa `FindAsync` yöntemi null değerini döndürür, departman, başka bir kullanıcı tarafından silindi.</span><span class="sxs-lookup"><span data-stu-id="eacf9-190">If the `FindAsync` method returns null, the department was deleted by another user.</span></span> <span data-ttu-id="eacf9-191">Gösterilen kod gönderilen form değerlerini içeren bir hata iletisi düzenleme sayfası yeniden, böylece bir departman varlık oluşturmak için kullanır.</span><span class="sxs-lookup"><span data-stu-id="eacf9-191">The code shown uses the posted form values to create a department entity so that the Edit page can be redisplayed with an error message.</span></span> <span data-ttu-id="eacf9-192">Alternatif olarak, departman alanları yeniden görüntüleme olmadan yalnızca bir hata iletisi görüntüler, departman varlık yeniden oluşturmak zorunda mıydı.</span><span class="sxs-lookup"><span data-stu-id="eacf9-192">As an alternative, you wouldn't have to re-create the department entity if you display only an error message without redisplaying the department fields.</span></span>

<span data-ttu-id="eacf9-193">Görünümün özgün depolar `RowVersion` değerini gizli bir alan ve yöntem içinde alan `rowVersion` parametresi.</span><span class="sxs-lookup"><span data-stu-id="eacf9-193">The view stores the original `RowVersion` value in a hidden field, and the method receives it in the `rowVersion` parameter.</span></span> <span data-ttu-id="eacf9-194">Çağırmadan önce `SaveChanges`, özgün moduna sahip `RowVersion` özellik değeri `OriginalValues` varlık için koleksiyon.</span><span class="sxs-lookup"><span data-stu-id="eacf9-194">Before you call `SaveChanges`, you have to put that original `RowVersion` property value in the `OriginalValues` collection for the entity.</span></span> <span data-ttu-id="eacf9-195">Entity Framework bir SQL zaman oluşturur `UPDATE` komutu komut içerecek bir `WHERE` özgün sahip bir satır için görünen yan tümcesi `RowVersion` değeri.</span><span class="sxs-lookup"><span data-stu-id="eacf9-195">Then when the Entity Framework creates a SQL `UPDATE` command, that command will include a `WHERE` clause that looks for a row that has the original `RowVersion` value.</span></span>

<span data-ttu-id="eacf9-196">Hiçbir satır etkileniyorsanız `UPDATE` komut (hiçbir satır özgün sahip `RowVersion` değer), Entity Framework oluşturur bir `DbUpdateConcurrencyException` özel durum ve kodda `catch` bloğunu alır etkilenen `Department` özel bir varlıktan nesne.</span><span class="sxs-lookup"><span data-stu-id="eacf9-196">If no rows are affected by the `UPDATE` command (no rows have the original `RowVersion` value), the Entity Framework throws a `DbUpdateConcurrencyException` exception, and the code in the `catch` block gets the affected `Department` entity from the exception object.</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]

<span data-ttu-id="eacf9-197">Bu nesne kullanıcı tarafından girilen yeni değerlere sahip kendi `Entity` özelliğini çağırarak veritabanından okunan değerleri alabilirsiniz `GetDatabaseValues` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="eacf9-197">This object has the new values entered by the user in its `Entity` property, and you can get the values read from the database by calling the `GetDatabaseValues` method.</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

<span data-ttu-id="eacf9-198">`GetDatabaseValues` Yöntemi birisi veritabanından satır silinip null değerini döndürür; Aksi takdirde döndürülen nesne türüne sahip `Department` erişmek için sınıf `Department` özellikleri.</span><span class="sxs-lookup"><span data-stu-id="eacf9-198">The `GetDatabaseValues` method returns null if someone has deleted the row from the database; otherwise, you have to cast the returned object to the `Department` class in order to access the `Department` properties.</span></span> <span data-ttu-id="eacf9-199">(Zaten silinmek üzere işaretli olduğundan `databaseEntry` departman sonra silinmişse null olacaktır `FindAsync` yürütür ve önce `SaveChanges` yürütür.)</span><span class="sxs-lookup"><span data-stu-id="eacf9-199">(Because you already checked for deletion, `databaseEntry` would be null only if the department was deleted after `FindAsync` executes and before `SaveChanges` executes.)</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample9.cs)]

<span data-ttu-id="eacf9-200">Ardından, kod veritabanı değerlerini hangi kullanıcının düzenleme sayfada girilen öğesinden farklı olan her sütun için bir özel hata iletisi ekler:</span><span class="sxs-lookup"><span data-stu-id="eacf9-200">Next, the code adds a custom error message for each column that has database values different from what the user entered on the Edit page:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample10.cs)]

<span data-ttu-id="eacf9-201">Uzun bir hata iletisi, ne olduğunu ve bunu yapmanız gerekenler açıklanmaktadır:</span><span class="sxs-lookup"><span data-stu-id="eacf9-201">A longer error message explains what happened and what to do about it:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample11.cs)]

<span data-ttu-id="eacf9-202">Son olarak, kod ayarlar `RowVersion` değerini `Department` yeni değere nesne veritabanından alınır.</span><span class="sxs-lookup"><span data-stu-id="eacf9-202">Finally, the code sets the `RowVersion` value of the `Department` object to the new value retrieved from the database.</span></span> <span data-ttu-id="eacf9-203">Bu yeni `RowVersion` değeri depolanan gizli alanı sayfasını yeniden düzenleme ve sonraki kullanıcı çalıştırdığında **Kaydet**, yeniden düzenleme sayfası, yakalanan bu yana gerçekleşen eşzamanlılık hataları.</span><span class="sxs-lookup"><span data-stu-id="eacf9-203">This new `RowVersion` value will be stored in the hidden field when the Edit page is redisplayed, and the next time the user clicks **Save**, only concurrency errors that happen since the redisplay of the Edit page will be caught.</span></span>

<span data-ttu-id="eacf9-204">İçinde *Views\Department\Edit.cshtml*, kaydetmek için gizli bir alan ekleme `RowVersion` özellik değeri, gizli bir alan için takip `DepartmentID` özelliği:</span><span class="sxs-lookup"><span data-stu-id="eacf9-204">In *Views\Department\Edit.cshtml*, add a hidden field to save the `RowVersion` property value, immediately following the hidden field for the `DepartmentID` property:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample12.cshtml?highlight=18)]

## <a name="test-concurrency-handling"></a><span data-ttu-id="eacf9-205">Test eşzamanlılığı işleme</span><span class="sxs-lookup"><span data-stu-id="eacf9-205">Test concurrency handling</span></span>

<span data-ttu-id="eacf9-206">Siteyi çalıştırın ve tıklayın **Departmanlar**.</span><span class="sxs-lookup"><span data-stu-id="eacf9-206">Run the site and click **Departments**.</span></span>

<span data-ttu-id="eacf9-207">Sağ tıklayın **Düzenle** seçin ve İngilizce departmanı için köprü **yeni sekmede aç** ardından **Düzenle** İngilizce departmanı için köprü.</span><span class="sxs-lookup"><span data-stu-id="eacf9-207">Right click the **Edit** hyperlink for the English department and select **Open in new tab,** then click the **Edit** hyperlink for the English department.</span></span> <span data-ttu-id="eacf9-208">İki sekme aynı bilgileri görüntüler.</span><span class="sxs-lookup"><span data-stu-id="eacf9-208">The two tabs display the same information.</span></span>

<span data-ttu-id="eacf9-209">İlk tarayıcı sekmesine bir alana değiştirin ve tıklatın **Kaydet**.</span><span class="sxs-lookup"><span data-stu-id="eacf9-209">Change a field in the first browser tab and click **Save**.</span></span>

<span data-ttu-id="eacf9-210">Tarayıcı değişmiş değer ile dizin sayfası gösterilir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-210">The browser shows the Index page with the changed value.</span></span>

<span data-ttu-id="eacf9-211">Bir alan ikinci bir tarayıcı sekmesinde değiştirip'ı **Kaydet**.</span><span class="sxs-lookup"><span data-stu-id="eacf9-211">Change a field in the second browser tab and click **Save**.</span></span> <span data-ttu-id="eacf9-212">Bir hata iletisi görürsünüz:</span><span class="sxs-lookup"><span data-stu-id="eacf9-212">You see an error message:</span></span>

![Department_Edit_page_2_after_clicking_Save](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image10.png)

<span data-ttu-id="eacf9-214">Tıklayın **Kaydet** yeniden.</span><span class="sxs-lookup"><span data-stu-id="eacf9-214">Click **Save** again.</span></span> <span data-ttu-id="eacf9-215">İkinci tarayıcı sekmesinde girdiğiniz değer, ilk tarayıcıda değiştirilen verileri özgün değeri ile birlikte kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-215">The value you entered in the second browser tab is saved along with the original value of the data you changed in the first browser.</span></span> <span data-ttu-id="eacf9-216">Dizin Sayfası göründüğünde, kaydedilen değerler görürsünüz.</span><span class="sxs-lookup"><span data-stu-id="eacf9-216">You see the saved values when the Index page appears.</span></span>

## <a name="update-the-delete-page"></a><span data-ttu-id="eacf9-217">Silme sayfası</span><span class="sxs-lookup"><span data-stu-id="eacf9-217">Update the Delete page</span></span>

<span data-ttu-id="eacf9-218">Silme sayfası için Entity Framework, birisi başka benzer bir şekilde bölüm düzenleme nedeni eşzamanlılık çakışmalarını algılar.</span><span class="sxs-lookup"><span data-stu-id="eacf9-218">For the Delete page, the Entity Framework detects concurrency conflicts caused by someone else editing the department in a similar manner.</span></span> <span data-ttu-id="eacf9-219">Zaman `HttpGet` `Delete` yöntemi görüntüler onay görünümü, görünümün özgün içerir `RowVersion` gizli bir alan değeri.</span><span class="sxs-lookup"><span data-stu-id="eacf9-219">When the `HttpGet` `Delete` method displays the confirmation view, the view includes the original `RowVersion` value in a hidden field.</span></span> <span data-ttu-id="eacf9-220">Değer daha sonra kullanılabilir olduğunu `HttpPost` `Delete` kullanıcının silmeyi onaylaması çağrılan yöntem.</span><span class="sxs-lookup"><span data-stu-id="eacf9-220">That value is then available to the `HttpPost` `Delete` method that's called when the user confirms the deletion.</span></span> <span data-ttu-id="eacf9-221">Entity Framework, SQL oluşturduğunda `DELETE` komutunu içerdiği bir `WHERE` yan tümcesinin orijinal `RowVersion` değeri.</span><span class="sxs-lookup"><span data-stu-id="eacf9-221">When the Entity Framework creates the SQL `DELETE` command, it includes a `WHERE` clause with the original `RowVersion` value.</span></span> <span data-ttu-id="eacf9-222">Sıfır satır komutu sonuçları (satır silme onayı sayfasında görüntülenen sonra değiştirildiği anlamına gelir) etkileniyorsa, bir eşzamanlılık özel durum oluşturulur ve `HttpGet Delete` ayarlamak bir hata bayrağıyla yöntemi çağrıldığında `true` görüntülemek için bir hata iletisiyle onay sayfası.</span><span class="sxs-lookup"><span data-stu-id="eacf9-222">If the command results in zero rows affected (meaning the row was changed after the Delete confirmation page was displayed), a concurrency exception is thrown, and the `HttpGet Delete` method is called with an error flag set to `true` in order to redisplay the confirmation page with an error message.</span></span> <span data-ttu-id="eacf9-223">Bu durumda farklı bir hata iletisi görüntülenir, böylece satırın başka bir kullanıcı tarafından silindiğinden sıfır satır etkilenmiştir mümkündür.</span><span class="sxs-lookup"><span data-stu-id="eacf9-223">It's also possible that zero rows were affected because the row was deleted by another user, so in that case a different error message is displayed.</span></span>

<span data-ttu-id="eacf9-224">İçinde *DepartmentController.cs*, değiştirin `HttpGet` `Delete` yöntemini aşağıdaki kod ile:</span><span class="sxs-lookup"><span data-stu-id="eacf9-224">In *DepartmentController.cs*, replace the `HttpGet` `Delete` method with the following code:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample13.cs)]

<span data-ttu-id="eacf9-225">Yöntemi, bir eşzamanlılık hatası sonra sayfayı yeniden olup olmadığını belirten isteğe bağlı bir parametre kabul eder.</span><span class="sxs-lookup"><span data-stu-id="eacf9-225">The method accepts an optional parameter that indicates whether the page is being redisplayed after a concurrency error.</span></span> <span data-ttu-id="eacf9-226">Bu bayrak ise `true`, görünümünü kullanarak bir hata iletisi gönderilen bir `ViewBag` özelliği.</span><span class="sxs-lookup"><span data-stu-id="eacf9-226">If this flag is `true`, an error message is sent to the view using a `ViewBag` property.</span></span>

<span data-ttu-id="eacf9-227">Değiştirin `HttpPost` `Delete` yöntemi (adlı `DeleteConfirmed`) aşağıdaki kod ile:</span><span class="sxs-lookup"><span data-stu-id="eacf9-227">Replace the code in the `HttpPost` `Delete` method (named `DeleteConfirmed`) with the following code:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample14.cs)]

<span data-ttu-id="eacf9-228">Yalnızca değiştirilen iskele kurulmuş kod içinde bu yöntem yalnızca bir kayıt kimliği kabul:</span><span class="sxs-lookup"><span data-stu-id="eacf9-228">In the scaffolded code that you just replaced, this method accepted only a record ID:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample15.cs)]

<span data-ttu-id="eacf9-229">Bu parametre için değiştirdiyseniz bir `Department` model bağlayıcı tarafından oluşturulan varlık örneği.</span><span class="sxs-lookup"><span data-stu-id="eacf9-229">You've changed this parameter to a `Department` entity instance created by the model binder.</span></span> <span data-ttu-id="eacf9-230">Bu aşağıdakilere erişmenizi sağlar `RowVersion` kayıt anahtarı yanı sıra özellik değeri.</span><span class="sxs-lookup"><span data-stu-id="eacf9-230">This gives you access to the `RowVersion` property value in addition to the record key.</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample16.cs)]

<span data-ttu-id="eacf9-231">Eylem yöntemi adından de değiştirdiğiniz `DeleteConfirmed` için `Delete`.</span><span class="sxs-lookup"><span data-stu-id="eacf9-231">You have also changed the action method name from `DeleteConfirmed` to `Delete`.</span></span> <span data-ttu-id="eacf9-232">İskele kurulan kodu adlı `HttpPost` `Delete` yöntemi `DeleteConfirmed` vermek `HttpPost` yöntemi benzersiz bir imza.</span><span class="sxs-lookup"><span data-stu-id="eacf9-232">The scaffolded code named the `HttpPost` `Delete` method `DeleteConfirmed` to give the `HttpPost` method a unique signature.</span></span> <span data-ttu-id="eacf9-233">(CLR'nin farklı yöntem parametreleri sağlamak için aşırı yüklenmiş yöntemler gerektirir.) İmzaları benzersiz, MVC kuralı ile devam edin ve aynı adı kullanın `HttpPost` ve `HttpGet` yöntemlerini silin.</span><span class="sxs-lookup"><span data-stu-id="eacf9-233">( The CLR requires overloaded methods to have different method parameters.) Now that the signatures are unique, you can stick with the MVC convention and use the same name for the `HttpPost` and `HttpGet` delete methods.</span></span>

<span data-ttu-id="eacf9-234">Bir eşzamanlılık hatası yakalanmışsa kod silme onayı sayfası görüntüler ve bunu belirten bir bayrak eşzamanlılık hata iletisi görüntülenmelidir sağlar.</span><span class="sxs-lookup"><span data-stu-id="eacf9-234">If a concurrency error is caught, the code redisplays the Delete confirmation page and provides a flag that indicates it should display a concurrency error message.</span></span>

<span data-ttu-id="eacf9-235">İçinde *Views\Department\Delete.cshtml*, iskele kurulan kodu bir hata iletisi alan ve gizli alanları DepartmentID ve RowVersion özellikleri ekleyen aşağıdaki kodla değiştirin.</span><span class="sxs-lookup"><span data-stu-id="eacf9-235">In *Views\Department\Delete.cshtml*, replace the scaffolded code with the following code that adds an error message field and hidden fields for the DepartmentID and RowVersion properties.</span></span> <span data-ttu-id="eacf9-236">Değişiklikler vurgulanır.</span><span class="sxs-lookup"><span data-stu-id="eacf9-236">The changes are highlighted.</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample17.cshtml?highlight=9-10,21,52-54)]

<span data-ttu-id="eacf9-237">Bu kod arasında bir hata iletisi ekler `h2` ve `h3` başlıkları:</span><span class="sxs-lookup"><span data-stu-id="eacf9-237">This code adds an error message between the `h2` and `h3` headings:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample18.cshtml)]

<span data-ttu-id="eacf9-238">Değiştirir `LastName` ile `FullName` içinde `Administrator` alan:</span><span class="sxs-lookup"><span data-stu-id="eacf9-238">It replaces `LastName` with `FullName` in the `Administrator` field:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample19.cshtml)]

<span data-ttu-id="eacf9-239">Son olarak, onu gizli alanlar için ekler `DepartmentID` ve `RowVersion` sonra özellikleri `Html.BeginForm` deyimi:</span><span class="sxs-lookup"><span data-stu-id="eacf9-239">Finally, it adds hidden fields for the `DepartmentID` and `RowVersion` properties after the `Html.BeginForm` statement:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample20.cshtml)]

<span data-ttu-id="eacf9-240">Departmanlar dizin sayfası çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="eacf9-240">Run the Departments Index page.</span></span> <span data-ttu-id="eacf9-241">Sağ tıklayın **Sil** seçin ve İngilizce departmanı için köprü **yeni sekmede aç** birinci sekmede ardından **Düzenle** İngilizce departmanı için köprü.</span><span class="sxs-lookup"><span data-stu-id="eacf9-241">Right click the **Delete** hyperlink for the English department and select **Open in new tab,** then in the first tab click the **Edit** hyperlink for the English department.</span></span>

<span data-ttu-id="eacf9-242">İlk penceresinde değerlerden birini değiştirin ve tıklayın **Kaydet**.</span><span class="sxs-lookup"><span data-stu-id="eacf9-242">In the first window, change one of the values, and click **Save**.</span></span>

<span data-ttu-id="eacf9-243">Dizin Sayfası değişikliği doğrular.</span><span class="sxs-lookup"><span data-stu-id="eacf9-243">The Index page confirms the change.</span></span>

<span data-ttu-id="eacf9-244">İkinci sekmesini tıklatın **Sil**.</span><span class="sxs-lookup"><span data-stu-id="eacf9-244">In the second tab, click **Delete**.</span></span>

<span data-ttu-id="eacf9-245">Eşzamanlılık hata iletisini görüntüleyin ve departman değerlerini şu anda veritabanında nedir ile yenilenir.</span><span class="sxs-lookup"><span data-stu-id="eacf9-245">You see the concurrency error message, and the Department values are refreshed with what's currently in the database.</span></span>

![Department_Delete_confirmation_page_with_concurrency_error](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image15.png)

<span data-ttu-id="eacf9-247">Tıklarsanız **Sil** yeniden departman silindiğini gösterir dizin sayfasına yönlendirilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="eacf9-247">If you click **Delete** again, you're redirected to the Index page, which shows that the department has been deleted.</span></span>

## <a name="get-the-code"></a><span data-ttu-id="eacf9-248">Kodu alma</span><span class="sxs-lookup"><span data-stu-id="eacf9-248">Get the code</span></span>

[<span data-ttu-id="eacf9-249">Projeyi yükle</span><span class="sxs-lookup"><span data-stu-id="eacf9-249">Download Completed Project</span></span>](https://webpifeed.blob.core.windows.net/webpifeed/Partners/ASP.NET%20MVC%20Application%20Using%20Entity%20Framework%20Code%20First.zip)

## <a name="additional-resources"></a><span data-ttu-id="eacf9-250">Ek kaynaklar</span><span class="sxs-lookup"><span data-stu-id="eacf9-250">Additional resources</span></span>

<span data-ttu-id="eacf9-251">Entity Framework diğer kaynakların bağlantılarını bulunabilir [ASP.NET veri erişimi - önerilen kaynaklar](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="eacf9-251">Links to other Entity Framework resources can be found in the [ASP.NET Data Access - Recommended Resources](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

<span data-ttu-id="eacf9-252">Çeşitli eşzamanlılık senaryoları işlemek için diğer yollar hakkında daha fazla bilgi için bkz: [iyimser eşzamanlılık desenlerinin](https://msdn.microsoft.com/data/jj592904) ve [özellik değerleri ile çalışma](https://msdn.microsoft.com/data/jj592677) MSDN'de.</span><span class="sxs-lookup"><span data-stu-id="eacf9-252">For information about other ways to handle various concurrency scenarios, see [Optimistic Concurrency Patterns](https://msdn.microsoft.com/data/jj592904) and [Working with Property Values](https://msdn.microsoft.com/data/jj592677) on MSDN.</span></span> <span data-ttu-id="eacf9-253">Sonraki öğreticide için tablo başına hiyerarşi devralma uygulamak gösterilmektedir `Instructor` ve `Student` varlıklar.</span><span class="sxs-lookup"><span data-stu-id="eacf9-253">The next tutorial shows how to implement table-per-hierarchy inheritance for the `Instructor` and `Student` entities.</span></span>

## <a name="next-steps"></a><span data-ttu-id="eacf9-254">Sonraki adımlar</span><span class="sxs-lookup"><span data-stu-id="eacf9-254">Next steps</span></span>

<span data-ttu-id="eacf9-255">Bu öğreticide şunları yaptınız:</span><span class="sxs-lookup"><span data-stu-id="eacf9-255">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="eacf9-256">Eşzamanlılık çakışmalarını hakkında bilgi edindiniz</span><span class="sxs-lookup"><span data-stu-id="eacf9-256">Learned about concurrency conflicts</span></span>
> * <span data-ttu-id="eacf9-257">Eklenen iyimser eşzamanlılık</span><span class="sxs-lookup"><span data-stu-id="eacf9-257">Added optimistic concurrency</span></span>
> * <span data-ttu-id="eacf9-258">Değiştirilmiş bölüm denetleyicisi</span><span class="sxs-lookup"><span data-stu-id="eacf9-258">Modified Department controller</span></span>
> * <span data-ttu-id="eacf9-259">Test edilen eşzamanlılık işleme</span><span class="sxs-lookup"><span data-stu-id="eacf9-259">Tested concurrency handling</span></span>
> * <span data-ttu-id="eacf9-260">Silme sayfası güncelleştirildi</span><span class="sxs-lookup"><span data-stu-id="eacf9-260">Updated the Delete page</span></span>

<span data-ttu-id="eacf9-261">Veri modelinde devralma uygulama hakkında bilgi edinmek için sonraki makaleye ilerleyin.</span><span class="sxs-lookup"><span data-stu-id="eacf9-261">Advance to the next article to learn how to implement inheritance in the data model.</span></span>
> [!div class="nextstepaction"]
> [<span data-ttu-id="eacf9-262">Veri modelinde devralma uygulama</span><span class="sxs-lookup"><span data-stu-id="eacf9-262">Implement inheritance in the data model</span></span>](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application.md)
