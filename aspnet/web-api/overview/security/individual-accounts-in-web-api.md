---
uid: web-api/overview/security/individual-accounts-in-web-api
title: Bireysel hesaplar ve ASP.NET Web API 2.2 sürümünde yerel oturum açma ile bir Web API'SİNİN güvenliğini sağlama | Microsoft Docs
author: MikeWasson
description: Bu konu, bir üyelik veritabanında kimlik doğrulaması yapmak için oauth2'yi kullanarak bir web API güvenliğini sağlama işlemini gösterir. Bir öğretici Visual Studio 201 kullanılan yazılım sürümleri...
ms.author: riande
ms.date: 10/15/2014
ms.assetid: 92c84846-f0ea-4b5e-94b6-5004874eb060
msc.legacyurl: /web-api/overview/security/individual-accounts-in-web-api
msc.type: authoredcontent
ms.openlocfilehash: 01d117260ef458453bee79285a37a8977221998c
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57065910"
---
<a name="secure-a-web-api-with-individual-accounts-and-local-login-in-aspnet-web-api-22"></a><span data-ttu-id="a49d0-104">Bireysel hesaplar ve ASP.NET Web API 2.2 sürümünde yerel oturum açma ile bir Web API'SİNİN güvenliğini sağlama</span><span class="sxs-lookup"><span data-stu-id="a49d0-104">Secure a Web API with Individual Accounts and Local Login in ASP.NET Web API 2.2</span></span>
====================
<span data-ttu-id="a49d0-105">tarafından [Mike Wasson](https://github.com/MikeWasson)</span><span class="sxs-lookup"><span data-stu-id="a49d0-105">by [Mike Wasson](https://github.com/MikeWasson)</span></span>

[<span data-ttu-id="a49d0-106">Örnek uygulamasını indirin</span><span class="sxs-lookup"><span data-stu-id="a49d0-106">Download Sample App</span></span>](https://github.com/MikeWasson/LocalAccountsApp)

> <span data-ttu-id="a49d0-107">Bu konu, bir üyelik veritabanında kimlik doğrulaması yapmak için oauth2'yi kullanarak bir web API güvenliğini sağlama işlemini gösterir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-107">This topic shows how to secure a web API using OAuth2 to authenticate against a membership database.</span></span>
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="a49d0-108">Bu öğreticide kullanılan yazılım sürümleri</span><span class="sxs-lookup"><span data-stu-id="a49d0-108">Software versions used in the tutorial</span></span>
> 
> 
> - [<span data-ttu-id="a49d0-109">Visual Studio 2013 Güncelleştirme 3</span><span class="sxs-lookup"><span data-stu-id="a49d0-109">Visual Studio 2013 Update 3</span></span>](https://www.microsoft.com/visualstudio/eng/2013-downloads)
> - [<span data-ttu-id="a49d0-110">Web API 2.2</span><span class="sxs-lookup"><span data-stu-id="a49d0-110">Web API 2.2</span></span>](../releases/whats-new-in-aspnet-web-api-22.md)
> - [<span data-ttu-id="a49d0-111">ASP.NET Identity 2.1</span><span class="sxs-lookup"><span data-stu-id="a49d0-111">ASP.NET Identity 2.1</span></span>](../../../identity/index.md)


<span data-ttu-id="a49d0-112">Visual Studio 2013'te Web API proje şablonunu, kimlik doğrulaması için üç seçeneği sunar:</span><span class="sxs-lookup"><span data-stu-id="a49d0-112">In Visual Studio 2013, the Web API project template gives you three options for authentication:</span></span>

- <span data-ttu-id="a49d0-113">**Bireysel hesaplar.**</span><span class="sxs-lookup"><span data-stu-id="a49d0-113">**Individual accounts.**</span></span> <span data-ttu-id="a49d0-114">Uygulamayı bir üyelik veritabanı kullanır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-114">The app uses a membership database.</span></span>
- <span data-ttu-id="a49d0-115">**Kurumsal hesaplar.**</span><span class="sxs-lookup"><span data-stu-id="a49d0-115">**Organizational accounts.**</span></span> <span data-ttu-id="a49d0-116">Kullanıcılar kendi Azure Active Directory, Office 365 veya şirket içi Active Directory kimlik bilgilerinizle oturum açın.</span><span class="sxs-lookup"><span data-stu-id="a49d0-116">Users sign in with their Azure Active Directory, Office 365, or on-premise Active Directory credentials.</span></span>
- <span data-ttu-id="a49d0-117">**Windows kimlik doğrulaması.**</span><span class="sxs-lookup"><span data-stu-id="a49d0-117">**Windows authentication.**</span></span> <span data-ttu-id="a49d0-118">Bu seçenek, Intranet uygulamaları için tasarlanmıştır ve Windows kimlik doğrulaması IIS Modülü kullanır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-118">This option is intended for Intranet applications, and uses the Windows Authentication IIS module.</span></span>

<span data-ttu-id="a49d0-119">Bu seçenekler hakkında daha fazla ayrıntı için bkz. [Visual Studio 2013'te ASP.NET Web projeleri oluşturma](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth).</span><span class="sxs-lookup"><span data-stu-id="a49d0-119">For more details about these options, see [Creating ASP.NET Web Projects in Visual Studio 2013](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth).</span></span>

<span data-ttu-id="a49d0-120">Bireysel hesaplar oturum açmak bir kullanıcı için iki yol sağlar:</span><span class="sxs-lookup"><span data-stu-id="a49d0-120">Individual accounts provide two ways for a user to log in:</span></span>

- <span data-ttu-id="a49d0-121">**Yerel oturum açma**.</span><span class="sxs-lookup"><span data-stu-id="a49d0-121">**Local login**.</span></span> <span data-ttu-id="a49d0-122">Kullanıcı adı ve parola girme sitede kaydeder.</span><span class="sxs-lookup"><span data-stu-id="a49d0-122">The user registers at the site, entering a username and password.</span></span> <span data-ttu-id="a49d0-123">Uygulama, parola karması üyelik veritabanında depolar.</span><span class="sxs-lookup"><span data-stu-id="a49d0-123">The app stores the password hash in the membership database.</span></span> <span data-ttu-id="a49d0-124">Kullanıcı oturum açtığında, ASP.NET kimlik sistemi parolayı doğrular.</span><span class="sxs-lookup"><span data-stu-id="a49d0-124">When the user logs in, the ASP.NET Identity system verifies the password.</span></span>
- <span data-ttu-id="a49d0-125">**Sosyal oturum açma**.</span><span class="sxs-lookup"><span data-stu-id="a49d0-125">**Social login**.</span></span> <span data-ttu-id="a49d0-126">Kullanıcı, Facebook, Microsoft veya Google gibi bir dış hizmet oturum açar.</span><span class="sxs-lookup"><span data-stu-id="a49d0-126">The user signs in with an external service, such as Facebook, Microsoft, or Google.</span></span> <span data-ttu-id="a49d0-127">Uygulamayı hala üyelik veritabanında kullanıcı için bir giriş oluşturur, ancak herhangi bir kimlik bilgisi depolamaz.</span><span class="sxs-lookup"><span data-stu-id="a49d0-127">The app still creates an entry for the user in the membership database, but does not store any credentials.</span></span> <span data-ttu-id="a49d0-128">Dış hizmetine oturum açarak kullanıcının kimliğini doğrular.</span><span class="sxs-lookup"><span data-stu-id="a49d0-128">The user authenticates by signing into the external service.</span></span>

<span data-ttu-id="a49d0-129">Bu makalede yerel oturum açma senaryo ele alınmaktadır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-129">This article looks at the local login scenario.</span></span> <span data-ttu-id="a49d0-130">Hem yerel hem de sosyal oturum açma isteklerinin kimliğini doğrulamak için OAuth2 Web API'sini kullanır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-130">For both local and social login, Web API uses OAuth2 to authenticate requests.</span></span> <span data-ttu-id="a49d0-131">Ancak, yerel ve sosyal oturum açma için kimlik bilgisi akışlar farklıdır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-131">However, the credential flows are different for local and social login.</span></span>

<span data-ttu-id="a49d0-132">Bu makalede, kullanıcının oturum açın ve bir Web API'sine kimliği doğrulanmış AJAX çağrıları Gönder sağlayan basit bir uygulama miyim kazandırabileceğinizi göstereceğiz.</span><span class="sxs-lookup"><span data-stu-id="a49d0-132">In this article, I'll demonstrate a simple app that lets the user log in and send authenticated AJAX calls to a web API.</span></span> <span data-ttu-id="a49d0-133">Örnek kod indirebileceğiniz [burada](https://github.com/MikeWasson/LocalAccountsApp).</span><span class="sxs-lookup"><span data-stu-id="a49d0-133">You can download the sample code [here](https://github.com/MikeWasson/LocalAccountsApp).</span></span> <span data-ttu-id="a49d0-134">Benioku dosyasını Visual Studio'da sıfırdan örnek oluşturmayı açıklar.</span><span class="sxs-lookup"><span data-stu-id="a49d0-134">The readme describes how to create the sample from scratch in Visual Studio.</span></span>

[![](individual-accounts-in-web-api/_static/image2.png)](individual-accounts-in-web-api/_static/image1.png)

<span data-ttu-id="a49d0-135">Örnek uygulama, veri bağlama ve AJAX isteklerini göndermek için jQuery Knockout.js kullanır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-135">The sample app uses Knockout.js for data-binding and jQuery for sending AJAX requests.</span></span> <span data-ttu-id="a49d0-136">Bu makalede Knockout.js bilmek zorunda kalmazsınız miyim AJAX çağrıları odaklanarak.</span><span class="sxs-lookup"><span data-stu-id="a49d0-136">I'll be focusing on the AJAX calls, so you don't need to know Knockout.js for this article.</span></span>

<span data-ttu-id="a49d0-137">Bu doğrultuda, ı açıklayacağız:</span><span class="sxs-lookup"><span data-stu-id="a49d0-137">Along the way, I'll describe:</span></span>

- <span data-ttu-id="a49d0-138">Hangi uygulama istemci tarafında yapıyor.</span><span class="sxs-lookup"><span data-stu-id="a49d0-138">What the app is doing on the client side.</span></span>
- <span data-ttu-id="a49d0-139">Sunucuda olanlar.</span><span class="sxs-lookup"><span data-stu-id="a49d0-139">What's happening on the server.</span></span>
- <span data-ttu-id="a49d0-140">HTTP trafiğini ortada.</span><span class="sxs-lookup"><span data-stu-id="a49d0-140">The HTTP traffic in the middle.</span></span>

<span data-ttu-id="a49d0-141">İlk olarak biz bazı OAuth2 terminolojisi tanımlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-141">First, we need to define some OAuth2 terminology.</span></span>

- <span data-ttu-id="a49d0-142">*Kaynak*.</span><span class="sxs-lookup"><span data-stu-id="a49d0-142">*Resource*.</span></span> <span data-ttu-id="a49d0-143">Korunabilir veriler parçası.</span><span class="sxs-lookup"><span data-stu-id="a49d0-143">Some piece of data that can be protected.</span></span>
- <span data-ttu-id="a49d0-144">*Kaynak sunucuda*.</span><span class="sxs-lookup"><span data-stu-id="a49d0-144">*Resource server*.</span></span> <span data-ttu-id="a49d0-145">Bir kaynak barındıran sunucu.</span><span class="sxs-lookup"><span data-stu-id="a49d0-145">The server that hosts the resource.</span></span>
- <span data-ttu-id="a49d0-146">*Kaynak sahibi*.</span><span class="sxs-lookup"><span data-stu-id="a49d0-146">*Resource owner*.</span></span> <span data-ttu-id="a49d0-147">Varlık bir kaynağa erişim izni verebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a49d0-147">The entity that can grant permission to access a resource.</span></span> <span data-ttu-id="a49d0-148">(Genellikle kullanıcı.)</span><span class="sxs-lookup"><span data-stu-id="a49d0-148">(Typically the user.)</span></span>
- <span data-ttu-id="a49d0-149">*İstemci*: Kaynağa erişim isteyen uygulama.</span><span class="sxs-lookup"><span data-stu-id="a49d0-149">*Client*: The app that wants access to the resource.</span></span> <span data-ttu-id="a49d0-150">Bu makalede, istemci, bir web tarayıcısıdır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-150">In this article, the client is a web browser.</span></span>
- <span data-ttu-id="a49d0-151">*Erişim belirteci*.</span><span class="sxs-lookup"><span data-stu-id="a49d0-151">*Access token*.</span></span> <span data-ttu-id="a49d0-152">Bir kaynağa erişim izni veren bir belirteç.</span><span class="sxs-lookup"><span data-stu-id="a49d0-152">A token that grants access to a resource.</span></span>
- <span data-ttu-id="a49d0-153">*Taşıyıcı belirteç*.</span><span class="sxs-lookup"><span data-stu-id="a49d0-153">*Bearer token*.</span></span> <span data-ttu-id="a49d0-154">Belirli bir erişim belirteciyle herkes belirteci kullanabilir özellik türü.</span><span class="sxs-lookup"><span data-stu-id="a49d0-154">A particular type of access token, with the property that anyone can use the token.</span></span> <span data-ttu-id="a49d0-155">Diğer bir deyişle, bir şifreleme anahtarı veya diğer gizli bir taşıyıcı belirteç kullanmak için bir istemci gerektirmez.</span><span class="sxs-lookup"><span data-stu-id="a49d0-155">In other words, a client doesn't need a cryptographic key or other secret to use a bearer token.</span></span> <span data-ttu-id="a49d0-156">Bu nedenle, taşıyıcı belirteçleri yalnızca HTTPS üzerinden kullanılmalıdır ve görece kısa bir zaman aşımı süresinin sahip olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-156">For that reason, bearer tokens should only be used over a HTTPS, and should have relatively short expiration times.</span></span>
- <span data-ttu-id="a49d0-157">*Yetkilendirme sunucusu*.</span><span class="sxs-lookup"><span data-stu-id="a49d0-157">*Authorization server*.</span></span> <span data-ttu-id="a49d0-158">Erişim belirteçleri sunan bir sunucu.</span><span class="sxs-lookup"><span data-stu-id="a49d0-158">A server that gives out access tokens.</span></span>

<span data-ttu-id="a49d0-159">Bir uygulama, yetkilendirme sunucusu ve kaynak sunucusu hareket eder.</span><span class="sxs-lookup"><span data-stu-id="a49d0-159">An application can act as both authorization server and resource server.</span></span> <span data-ttu-id="a49d0-160">Web API proje şablonunu bu deseni izler.</span><span class="sxs-lookup"><span data-stu-id="a49d0-160">The Web API project template follows this pattern.</span></span>

## <a name="local-login-credential-flow"></a><span data-ttu-id="a49d0-161">Yerel oturum açma kimlik bilgileri akışı</span><span class="sxs-lookup"><span data-stu-id="a49d0-161">Local Login Credential Flow</span></span>

<span data-ttu-id="a49d0-162">Web API'si yerel oturum açma için kullanılan [kaynak sahibi parola akışı](http://oauthlib.readthedocs.org/en/latest/oauth2/grants/password.html) OAuth2 ' tanımlanan.</span><span class="sxs-lookup"><span data-stu-id="a49d0-162">For local login, Web API uses the [resource owner password flow](http://oauthlib.readthedocs.org/en/latest/oauth2/grants/password.html) defined in OAuth2.</span></span>

1. <span data-ttu-id="a49d0-163">Kullanıcı adı ve parola istemciyi girer.</span><span class="sxs-lookup"><span data-stu-id="a49d0-163">The user enters a name and password into the client.</span></span>
2. <span data-ttu-id="a49d0-164">İstemci, yetkilendirme sunucusu için bu kimlik bilgilerini gönderir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-164">The client sends these credentials to the authorization server.</span></span>
3. <span data-ttu-id="a49d0-165">Yetkilendirme sunucusu kimlik bilgilerini doğrular ve bir erişim belirteci döndürür.</span><span class="sxs-lookup"><span data-stu-id="a49d0-165">The authorization server authenticates the credentials and returns an access token.</span></span>
4. <span data-ttu-id="a49d0-166">Korunan bir kaynağa erişmek için istemci HTTP isteğinin yetkilendirme üst bilgisinde erişim belirteci içerir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-166">To access a protected resource, the client includes the access token in the Authorization header of the HTTP request.</span></span>

![](individual-accounts-in-web-api/_static/image3.png)

<span data-ttu-id="a49d0-167">Seçtiğinizde, **bireysel hesaplar** Web API proje şablonu, proje kullanıcı kimlik bilgilerini doğrular ve belirteçleri yetkilendirme sunucusu içerir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-167">When you select **Individual accounts** in the Web API project template, the project includes an authorization server that validates user credentials and issues tokens.</span></span> <span data-ttu-id="a49d0-168">Web API'si bileşenlerinin açısından aynı kimlik bilgileri akışı aşağıdaki diyagramda gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-168">The following diagram shows the same credential flow in terms of Web API components.</span></span>

![](individual-accounts-in-web-api/_static/image4.png)

<span data-ttu-id="a49d0-169">Bu senaryoda, Web APİ'si denetleyicilerinin kaynak sunucuları gibi davranır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-169">In this scenario, Web API controllers act as resource servers.</span></span> <span data-ttu-id="a49d0-170">Bir kimlik doğrulaması filtresini erişim belirteçlerini doğrular ve **[Authorize]** özniteliği bir kaynağı korumak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-170">An authentication filter validates access tokens, and the **[Authorize]** attribute is used to protect a resource.</span></span> <span data-ttu-id="a49d0-171">Bir denetleyici veya eylem olduğunda **[Authorize]** özniteliği, tüm istekleri söz konusu denetleyici veya eylem kimlik doğrulaması gerekir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-171">When a controller or action has the **[Authorize]** attribute, all requests to that controller or action must be authenticated.</span></span> <span data-ttu-id="a49d0-172">Aksi takdirde, yetkilendirme reddedildi ve Web API 401 (yetkisiz) hatası döndürür.</span><span class="sxs-lookup"><span data-stu-id="a49d0-172">Otherwise, authorization is denied, and Web API returns a 401 (Unauthorized) error.</span></span>

<span data-ttu-id="a49d0-173">Yetkilendirme sunucusu ve her ikisi de çağırabilir kimlik doğrulaması filtresini bir [OWIN ara yazılımı](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md) OAuth2 ayrıntılarını işler bileşeni.</span><span class="sxs-lookup"><span data-stu-id="a49d0-173">The authorization server and the authentication filter both call into an [OWIN middleware](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md) component that handles the details of OAuth2.</span></span> <span data-ttu-id="a49d0-174">Bu öğreticinin ilerleyen bölümlerinde daha ayrıntılı tasarım açıklayan.</span><span class="sxs-lookup"><span data-stu-id="a49d0-174">I'll describe the design in more detail later in this tutorial.</span></span>

## <a name="sending-an-unauthorized-request"></a><span data-ttu-id="a49d0-175">Yetkisiz bir isteği gönderiliyor</span><span class="sxs-lookup"><span data-stu-id="a49d0-175">Sending an Unauthorized Request</span></span>

<span data-ttu-id="a49d0-176">Başlamak için uygulamayı çalıştırın ve **API çağrısı** düğmesi.</span><span class="sxs-lookup"><span data-stu-id="a49d0-176">To get started, run the app and click the **Call API** button.</span></span> <span data-ttu-id="a49d0-177">İsteği tamamlandığında, bir hata iletisi görürsünüz **sonucu** kutusu.</span><span class="sxs-lookup"><span data-stu-id="a49d0-177">When the request completes, you should see an error message in the **Result** box.</span></span> <span data-ttu-id="a49d0-178">İstek yetkisiz isteği, bu nedenle, bir erişim belirteci içermediğinden olmasıdır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-178">That's because the request does not contain an access token, so the request is unauthorized.</span></span>

[![](individual-accounts-in-web-api/_static/image6.png)](individual-accounts-in-web-api/_static/image5.png)

<span data-ttu-id="a49d0-179">**API çağrısı** düğmesi gönderir bir AJAX isteği ~/api/değerleri, bir Web API denetleyici eylemi çağırır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-179">The **Call API** button sends an AJAX request to ~/api/values, which invokes a Web API controller action.</span></span> <span data-ttu-id="a49d0-180">AJAX isteği gönderen JavaScript kod bölümünün aşağıda verilmiştir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-180">Here is the section of JavaScript code that sends the AJAX request.</span></span> <span data-ttu-id="a49d0-181">Örnek uygulamada, tüm JavaScript uygulama kodunun bulunduğu Scripts\app.js dosyasında.</span><span class="sxs-lookup"><span data-stu-id="a49d0-181">In the sample app, all of the JavaScript app code is located in the Scripts\app.js file.</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample1.js)]

<span data-ttu-id="a49d0-182">Kullanıcı oturum açtığında kadar taşıyıcı belirteç yok ve bu nedenle yetkilendirme üst bilgi isteği yok.</span><span class="sxs-lookup"><span data-stu-id="a49d0-182">Until the user logs in, there is no bearer token, and therefore no Authorization header in the request.</span></span> <span data-ttu-id="a49d0-183">Bu istek 401 hatası döndürülecek neden olur.</span><span class="sxs-lookup"><span data-stu-id="a49d0-183">This causes the request to return a 401 error.</span></span>

<span data-ttu-id="a49d0-184">HTTP isteği aşağıda verilmiştir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-184">Here is the HTTP request.</span></span> <span data-ttu-id="a49d0-185">(Kullandım [Fiddler](http://www.telerik.com/fiddler) HTTP trafiği yakalamak için.)</span><span class="sxs-lookup"><span data-stu-id="a49d0-185">(I used [Fiddler](http://www.telerik.com/fiddler) to capture the HTTP traffic.)</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample2.cmd)]

<span data-ttu-id="a49d0-186">HTTP yanıtı:</span><span class="sxs-lookup"><span data-stu-id="a49d0-186">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample3.cmd?highlight=1,4)]

<span data-ttu-id="a49d0-187">Yanıt ayarlamak için taşıyıcı kimlik ile bir Www-Authenticate üstbilgisi içerdiğine dikkat edin.</span><span class="sxs-lookup"><span data-stu-id="a49d0-187">Notice that the response includes a Www-Authenticate header with the challenge set to Bearer.</span></span> <span data-ttu-id="a49d0-188">Bu sunucunun bir taşıyıcı belirteç bekliyor gösterir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-188">That indicates the server expects a bearer token.</span></span>

## <a name="register-a-user"></a><span data-ttu-id="a49d0-189">Bir kullanıcı kaydı</span><span class="sxs-lookup"><span data-stu-id="a49d0-189">Register a User</span></span>

<span data-ttu-id="a49d0-190">İçinde **kaydetme** bölümü, uygulama bir e-posta parolanızı girin ve tıklatın **kaydetme** düğmesi.</span><span class="sxs-lookup"><span data-stu-id="a49d0-190">In the **Register** section of the app, enter an email and password, and click the **Register** button.</span></span>

<span data-ttu-id="a49d0-191">Bu örnek için geçerli bir eposta adresi kullanmanız gerekmez, ancak gerçek bir uygulamada adresini doğrulamak.</span><span class="sxs-lookup"><span data-stu-id="a49d0-191">You don't need to use a valid email address for this sample, but a real app would confirm the address.</span></span> <span data-ttu-id="a49d0-192">(Bkz [oturum açma, e-posta onayı ve parola sıfırlama ile güvenli bir ASP.NET MVC 5 web uygulaması oluşturma](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).) Parola için "Parola1!" gibi bir büyük harf, küçük harf, sayı ve alfasayısal olmayan karakter kullanın.</span><span class="sxs-lookup"><span data-stu-id="a49d0-192">(See [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).) For the password, use something like "Password1!", with an upper case letter, lower case letter, number, and non-alpha-numeric character.</span></span> <span data-ttu-id="a49d0-193">İstemci tarafı doğrulama, anlayabilirim uygulama basit tutmak için böylece parola biçimi ile ilgili bir sorun varsa, 400 (Hatalı istek) hatası alırsınız.</span><span class="sxs-lookup"><span data-stu-id="a49d0-193">To keep the app simple, I left out client-side validation, so if there is a problem with the password format, you'll get a 400 (Bad Request) error.</span></span>

[![](individual-accounts-in-web-api/_static/image8.png)](individual-accounts-in-web-api/_static/image7.png)

<span data-ttu-id="a49d0-194">**Kaydetme** düğmesi için ~/api/Account/Register bir POST isteği gönderir /.</span><span class="sxs-lookup"><span data-stu-id="a49d0-194">The **Register** button sends a POST request to ~/api/Account/Register/.</span></span> <span data-ttu-id="a49d0-195">İstek gövdesi adını ve parolayı tutan bir JSON nesnesidir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-195">The request body is a JSON object that holds the name and password.</span></span> <span data-ttu-id="a49d0-196">İsteği gönderen JavaScript kod aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="a49d0-196">Here is the JavaScript code that sends the request:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample4.js)]

<span data-ttu-id="a49d0-197">HTTP isteği:</span><span class="sxs-lookup"><span data-stu-id="a49d0-197">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample5.cmd?highlight=5,10)]

<span data-ttu-id="a49d0-198">HTTP yanıtı:</span><span class="sxs-lookup"><span data-stu-id="a49d0-198">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample6.cmd)]

<span data-ttu-id="a49d0-199">Bu istek tarafından işlenen `AccountController` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="a49d0-199">This request is handled by the `AccountController` class.</span></span> <span data-ttu-id="a49d0-200">Dahili olarak `AccountController` üyelik veritabanını yönetmek için ASP.NET kimliğini kullanır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-200">Internally, `AccountController` uses ASP.NET Identity to manage the membership database.</span></span>

<span data-ttu-id="a49d0-201">Uygulamayı Visual Studio'dan yerel olarak çalıştırırsanız, kullanıcı hesaplarını AspNetUsers tabloda LocalDB içinde depolanır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-201">If you run the app locally from Visual Studio, user accounts are stored in LocalDB, in the AspNetUsers table.</span></span> <span data-ttu-id="a49d0-202">Visual Studio'da tabloları görüntülemek için tıklayın **görünümü** menüsünde **Sunucu Gezgini**, ardından **veri bağlantıları**.</span><span class="sxs-lookup"><span data-stu-id="a49d0-202">To view the tables in Visual Studio, click the **View** menu, select **Server Explorer**, then expand **Data Connections**.</span></span>

![](individual-accounts-in-web-api/_static/image9.png)

## <a name="get-an-access-token"></a><span data-ttu-id="a49d0-203">Bir erişim belirteci alma</span><span class="sxs-lookup"><span data-stu-id="a49d0-203">Get an Access Token</span></span>

<span data-ttu-id="a49d0-204">Şu ana kadar herhangi bir OAuth tamamlamadıysanız, ancak biz bir erişim belirteci istediğinde artık, uygulamada OAuth yetkilendirme sunucusu görüyoruz.</span><span class="sxs-lookup"><span data-stu-id="a49d0-204">So far we have not done any OAuth, but now we'll see the OAuth authorization server in action, when we request an access token.</span></span> <span data-ttu-id="a49d0-205">İçinde **oturum** alan örnek uygulamanın e-posta ve parola girin ve tıklatın **oturum**.</span><span class="sxs-lookup"><span data-stu-id="a49d0-205">In the **Log In** area of the sample app, enter the email and password and click **Log In**.</span></span>

[![](individual-accounts-in-web-api/_static/image11.png)](individual-accounts-in-web-api/_static/image10.png)

<span data-ttu-id="a49d0-206">**Oturum** düğmesi belirteç uç noktasına bir istek gönderir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-206">The **Log In** button sends a request to the token endpoint.</span></span> <span data-ttu-id="a49d0-207">İstek gövdesi aşağıdaki formu url kodlanmış verileri içerir:</span><span class="sxs-lookup"><span data-stu-id="a49d0-207">The body of the request contains the following form-url-encoded data:</span></span>

- <span data-ttu-id="a49d0-208">verme\_türü: "password"</span><span class="sxs-lookup"><span data-stu-id="a49d0-208">grant\_type: "password"</span></span>
- <span data-ttu-id="a49d0-209">Kullanıcı adı: &lt;kullanıcının e-posta&gt;</span><span class="sxs-lookup"><span data-stu-id="a49d0-209">username: &lt;the user's email&gt;</span></span>
- <span data-ttu-id="a49d0-210">Parola: &lt;parola&gt;</span><span class="sxs-lookup"><span data-stu-id="a49d0-210">password: &lt;password&gt;</span></span>

<span data-ttu-id="a49d0-211">AJAX isteği gönderen JavaScript kod aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="a49d0-211">Here is the JavaScript code that sends the AJAX request:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample7.js?highlight=14)]

<span data-ttu-id="a49d0-212">İstek başarılı olursa yetkilendirme sunucusu bir erişim belirteci yanıt gövdesinde döndürür.</span><span class="sxs-lookup"><span data-stu-id="a49d0-212">If the request succeeds, the authorization server returns an access token in the response body.</span></span> <span data-ttu-id="a49d0-213">Biz oturumu depolama, API için istekleri gönderirken daha sonra kullanmak üzere belirteci depolamak dikkat edin.</span><span class="sxs-lookup"><span data-stu-id="a49d0-213">Notice that we store the token in session storage, to use later when sending requests to the API.</span></span> <span data-ttu-id="a49d0-214">Bazı biçimlerde kimlik doğrulaması (örneğin, kimlik doğrulama tanımlama bilgisi tabanlı), tarayıcı otomatik olarak erişim belirteci sonraki istekler dahil edilmez.</span><span class="sxs-lookup"><span data-stu-id="a49d0-214">Unlike some forms of authentication (such as cookie-based authentication), the browser will not automatically include the access token in subsequent requests.</span></span> <span data-ttu-id="a49d0-215">Uygulamayı açıkça bunu yapmalısınız.</span><span class="sxs-lookup"><span data-stu-id="a49d0-215">The application must do so explicitly.</span></span> <span data-ttu-id="a49d0-216">Olan çok iyi bir şey, sınırladığından [CSRF güvenlik açıklarını](preventing-cross-site-request-forgery-csrf-attacks.md).</span><span class="sxs-lookup"><span data-stu-id="a49d0-216">That's a good thing, because it limits [CSRF vulnerabilities](preventing-cross-site-request-forgery-csrf-attacks.md).</span></span>

<span data-ttu-id="a49d0-217">HTTP isteği:</span><span class="sxs-lookup"><span data-stu-id="a49d0-217">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample8.cmd?highlight=5,10)]

<span data-ttu-id="a49d0-218">İstek kullanıcının kimlik bilgilerini içerdiğini görebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a49d0-218">You can see that the request contains the user's credentials.</span></span> <span data-ttu-id="a49d0-219">*Gerekir* Aktarım Katmanı Güvenliği sağlamak için HTTPS kullanın.</span><span class="sxs-lookup"><span data-stu-id="a49d0-219">You *must* use HTTPS to provide transport layer security.</span></span>

<span data-ttu-id="a49d0-220">HTTP yanıtı:</span><span class="sxs-lookup"><span data-stu-id="a49d0-220">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample9.cmd?highlight=8)]

<span data-ttu-id="a49d0-221">Okunabilirlik için miyim JSON girintili ve oldukça uzun bir erişim belirteci kesildi.</span><span class="sxs-lookup"><span data-stu-id="a49d0-221">For readability, I indented the JSON and truncated the access token, which is a quite long.</span></span>

<span data-ttu-id="a49d0-222">`access_token`, `token_type`, Ve `expires_in` özellikleri, OAuth2 belirtimi tarafından tanımlanır. Diğer özellikleri (`userName`, `.issued`, ve `.expires`) yalnızca bilgilendirici amaçlarla şunlardır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-222">The `access_token`, `token_type`, and `expires_in` properties are defined by the OAuth2 spec. The other properties (`userName`, `.issued`, and `.expires`) are just for informational purposes.</span></span> <span data-ttu-id="a49d0-223">Bu ek özellikleri ekleyen kodu bulabilirsiniz `TokenEndpoint` /Providers/ApplicationOAuthProvider.cs dosyasındaki yöntemi.</span><span class="sxs-lookup"><span data-stu-id="a49d0-223">You can find the code that adds those additional properties in the `TokenEndpoint` method, in the /Providers/ApplicationOAuthProvider.cs file.</span></span>

## <a name="send-an-authenticated-request"></a><span data-ttu-id="a49d0-224">Kimliği doğrulanmış bir isteği gönder</span><span class="sxs-lookup"><span data-stu-id="a49d0-224">Send an Authenticated Request</span></span>

<span data-ttu-id="a49d0-225">Taşıyıcı belirteç sahibiz, API'sine kimliği doğrulanmış bir isteği yapabiliyoruz.</span><span class="sxs-lookup"><span data-stu-id="a49d0-225">Now that we have a bearer token, we can make an authenticated request to the API.</span></span> <span data-ttu-id="a49d0-226">Bu, istekte yetkilendirme üst bilgisi ayarlayarak yapılır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-226">This is done by setting the Authorization header in the request.</span></span> <span data-ttu-id="a49d0-227">Tıklayın **API çağrısı** düğmesine tekrar bakın.</span><span class="sxs-lookup"><span data-stu-id="a49d0-227">Click the **Call API** button again to see this.</span></span>

[![](individual-accounts-in-web-api/_static/image13.png)](individual-accounts-in-web-api/_static/image12.png)

<span data-ttu-id="a49d0-228">HTTP isteği:</span><span class="sxs-lookup"><span data-stu-id="a49d0-228">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample10.cmd?highlight=5)]

<span data-ttu-id="a49d0-229">HTTP yanıtı:</span><span class="sxs-lookup"><span data-stu-id="a49d0-229">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample11.cmd)]

## <a name="log-out"></a><span data-ttu-id="a49d0-230">Oturumu Kapat</span><span class="sxs-lookup"><span data-stu-id="a49d0-230">Log Out</span></span>

<span data-ttu-id="a49d0-231">Tarayıcı kimlik bilgileri veya erişim belirteci önbelleğe almaması nedeniyle oturumu kapatmak, "belirteci oturum depolamadan kaldırarak unutarak" sorunudur:</span><span class="sxs-lookup"><span data-stu-id="a49d0-231">Because the browser does not cache the credentials or the access token, logging out is simply a matter of "forgetting" the token, by removing it from session storage:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample12.js)]

## <a name="understanding-the-individual-accounts-project-template"></a><span data-ttu-id="a49d0-232">Bireysel hesaplar proje şablonu anlama</span><span class="sxs-lookup"><span data-stu-id="a49d0-232">Understanding the Individual Accounts Project Template</span></span>

<span data-ttu-id="a49d0-233">Seçtiğinizde, **bireysel hesaplar** ASP.NET Web uygulaması proje şablonu, projeyi içerir:</span><span class="sxs-lookup"><span data-stu-id="a49d0-233">When you select **Individual Accounts** in the ASP.NET Web Application project template, the project includes:</span></span>

- <span data-ttu-id="a49d0-234">OAuth2 yetkilendirme sunucusu.</span><span class="sxs-lookup"><span data-stu-id="a49d0-234">An OAuth2 authorization server.</span></span>
- <span data-ttu-id="a49d0-235">Kullanıcı hesaplarını yönetmek için bir Web API uç noktası</span><span class="sxs-lookup"><span data-stu-id="a49d0-235">A Web API endpoint for managing user accounts</span></span>
- <span data-ttu-id="a49d0-236">Kullanıcı hesaplarını depolamak için EF modeli.</span><span class="sxs-lookup"><span data-stu-id="a49d0-236">An EF model for storing user accounts.</span></span>

<span data-ttu-id="a49d0-237">Bu özellikleri uygulayan ana uygulama sınıfları şunlardır:</span><span class="sxs-lookup"><span data-stu-id="a49d0-237">Here are the main application classes that implement these features:</span></span>

- <span data-ttu-id="a49d0-238">`AccountController`.</span><span class="sxs-lookup"><span data-stu-id="a49d0-238">`AccountController`.</span></span> <span data-ttu-id="a49d0-239">Kullanıcı hesaplarını yönetmek için bir Web API uç noktası sağlar.</span><span class="sxs-lookup"><span data-stu-id="a49d0-239">Provides a Web API endpoint for managing user accounts.</span></span> <span data-ttu-id="a49d0-240">`Register` Bu öğreticide kullanılan tek bir eylemdir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-240">The `Register` action is the only one that we used in this tutorial.</span></span> <span data-ttu-id="a49d0-241">Parola sıfırlama, sosyal oturum açma bilgileri ve diğer işlevler sınıfında diğer yöntemleri destekler.</span><span class="sxs-lookup"><span data-stu-id="a49d0-241">Other methods on the class support password reset, social logins, and other functionality.</span></span>
- <span data-ttu-id="a49d0-242">`ApplicationUser`, /Models/IdentityModels.cs içinde tanımlanır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-242">`ApplicationUser`, defined in /Models/IdentityModels.cs.</span></span> <span data-ttu-id="a49d0-243">Bu sınıf, üyelik veritabanındaki kullanıcı hesaplarının EF modelidir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-243">This class is the EF model for user accounts in the membership database.</span></span>
- <span data-ttu-id="a49d0-244">`ApplicationUserManager`, /App içinde tanımlanan\_Bu sınıf türetilir Start/IdentityConfig.cs [UserManager](https://msdn.microsoft.com/library/dn613290.aspx) ve kullanıcı hesapları, parolaları ve benzeri, doğrulama, yeni bir kullanıcı oluşturma gibi işlemler yapar ve otomatik olarak sürdürür veritabanında yapılan değişiklikler.</span><span class="sxs-lookup"><span data-stu-id="a49d0-244">`ApplicationUserManager`, defined in /App\_Start/IdentityConfig.cs This class derives from [UserManager](https://msdn.microsoft.com/library/dn613290.aspx) and performs operations on user accounts, such as creating a new user, verifying passwords, and so forth, and automatically persists changes to the database.</span></span>
- <span data-ttu-id="a49d0-245">`ApplicationOAuthProvider`.</span><span class="sxs-lookup"><span data-stu-id="a49d0-245">`ApplicationOAuthProvider`.</span></span> <span data-ttu-id="a49d0-246">Bu nesne OWIN ara yazılımı yararlanmanıza imkan sağlar ve ara yazılımı tarafından başlatılan olayları işler.</span><span class="sxs-lookup"><span data-stu-id="a49d0-246">This object plugs into the OWIN middleware, and processes events raised by the middleware.</span></span> <span data-ttu-id="a49d0-247">Öğesinden türetilen [OAuthAuthorizationServerProvider](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserverprovider.aspx).</span><span class="sxs-lookup"><span data-stu-id="a49d0-247">It derives from [OAuthAuthorizationServerProvider](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserverprovider.aspx).</span></span>

![](individual-accounts-in-web-api/_static/image14.png)

### <a name="configuring-the-authorization-server"></a><span data-ttu-id="a49d0-248">Yetkilendirme sunucusu yapılandırma</span><span class="sxs-lookup"><span data-stu-id="a49d0-248">Configuring the Authorization Server</span></span>

<span data-ttu-id="a49d0-249">StartupAuth.cs aşağıdaki kod, OAuth2 yetkilendirme sunucusu yapılandırır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-249">In StartupAuth.cs, the following code configures the OAuth2 authorization server.</span></span>

[!code-csharp[Main](individual-accounts-in-web-api/samples/sample13.cs)]

<span data-ttu-id="a49d0-250">`TokenEndpointPath` Özelliği yetkilendirme sunucusu uç noktası için URL yoludur.</span><span class="sxs-lookup"><span data-stu-id="a49d0-250">The `TokenEndpointPath` property is the URL path to the authorization server endpoint.</span></span> <span data-ttu-id="a49d0-251">URL olan bu uygulama, taşıyıcı belirteçlerini almak için kullanır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-251">That's the URL that app uses to get the bearer tokens.</span></span>

<span data-ttu-id="a49d0-252">`Provider` OWIN ara yazılımı yararlanmanıza imkan sağlar ve ara yazılım tarafından oluşturulan olayları işleyen bir sağlayıcı özelliği belirtir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-252">The `Provider` property specifies a provider that plugs into the OWIN middleware, and processes events raised by the middleware.</span></span>

<span data-ttu-id="a49d0-253">Uygulama bir belirteç almak istediğinde temel akışı şöyledir:</span><span class="sxs-lookup"><span data-stu-id="a49d0-253">Here is the basic flow when the app wants to get a token:</span></span>

1. <span data-ttu-id="a49d0-254">Uygulama erişim belirteci almak için bir istek gönderir ~ / Token.</span><span class="sxs-lookup"><span data-stu-id="a49d0-254">To get an access token, the app sends a request to ~/Token.</span></span>
2. <span data-ttu-id="a49d0-255">OAuth Ara çağrıları `GrantResourceOwnerCredentials` sağlayıcısı.</span><span class="sxs-lookup"><span data-stu-id="a49d0-255">The OAuth middleware calls `GrantResourceOwnerCredentials` on the provider.</span></span>
3. <span data-ttu-id="a49d0-256">Sağlayıcı çağrıları `ApplicationUserManager` kimlik doğrulamaya ve talep kimliği oluşturmak için.</span><span class="sxs-lookup"><span data-stu-id="a49d0-256">The provider calls the `ApplicationUserManager` to validate the credentials and create a claims identity.</span></span>
4. <span data-ttu-id="a49d0-257">Bu başarılı olursa sağlayıcısı, belirteç oluşturmak için kullanılan bir kimlik doğrulaması bileti oluşturur.</span><span class="sxs-lookup"><span data-stu-id="a49d0-257">If that succeeds, the provider creates an authentication ticket, which is used to generate the token.</span></span>

[![](individual-accounts-in-web-api/_static/image16.png)](individual-accounts-in-web-api/_static/image15.png)

<span data-ttu-id="a49d0-258">OAuth ara yazılım, kullanıcı hesapları hakkında hiçbir şey bilmez.</span><span class="sxs-lookup"><span data-stu-id="a49d0-258">The OAuth middleware doesn't know anything about the user accounts.</span></span> <span data-ttu-id="a49d0-259">Sağlayıcı ara yazılım ve ASP.NET Identity arasında iletişim kurar.</span><span class="sxs-lookup"><span data-stu-id="a49d0-259">The provider communicates between the middleware and ASP.NET Identity.</span></span> <span data-ttu-id="a49d0-260">Yetkilendirme sunucusu uygulama hakkında daha fazla bilgi için bkz. [OWIN OAuth 2.0 yetkilendirme sunucusu](../../../aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server.md).</span><span class="sxs-lookup"><span data-stu-id="a49d0-260">For more information about implementing the authorization server, see [OWIN OAuth 2.0 Authorization Server](../../../aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server.md).</span></span>

### <a name="configuring-web-api-to-use-bearer-tokens"></a><span data-ttu-id="a49d0-261">Web API'si, taşıyıcı belirteçlerini kullanmak üzere yapılandırma</span><span class="sxs-lookup"><span data-stu-id="a49d0-261">Configuring Web API to use Bearer Tokens</span></span>

<span data-ttu-id="a49d0-262">İçinde `WebApiConfig.Register` Web API ardışık düzeni için kimlik doğrulama yöntemi, aşağıdaki kod ayarlar:</span><span class="sxs-lookup"><span data-stu-id="a49d0-262">In the `WebApiConfig.Register` method, the following code sets up authentication for the Web API pipeline:</span></span>

[!code-csharp[Main](individual-accounts-in-web-api/samples/sample14.cs)]

<span data-ttu-id="a49d0-263">**HostAuthenticationFilter** sınıfı, taşıyıcı belirteçlerini kullanarak kimlik doğrulaması sağlar.</span><span class="sxs-lookup"><span data-stu-id="a49d0-263">The **HostAuthenticationFilter** class enables authentication using bearer tokens.</span></span>

<span data-ttu-id="a49d0-264">**SuppressDefaultHostAuthentication** yöntemi Web API'si, Web API ardışık düzeni, IIS veya OWIN ara yazılımı tarafından istek ulaşmadan önce gerçekleşen herhangi bir kimlik doğrulaması yok saymasını söyler.</span><span class="sxs-lookup"><span data-stu-id="a49d0-264">The **SuppressDefaultHostAuthentication** method tells Web API to ignore any authentication that happens before the request reaches the Web API pipeline, either by IIS or by OWIN middleware.</span></span> <span data-ttu-id="a49d0-265">Bu şekilde, biz yalnızca taşıyıcı belirteçlerini kullanarak kimlik doğrulaması yapmak için Web API'si kısıtlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a49d0-265">That way, we can restrict Web API to authenticate only using bearer tokens.</span></span>

> [!NOTE]
> <span data-ttu-id="a49d0-266">Özellikle, MVC bölümüne uygulamanızın kimlik bilgileri bir tanımlama bilgisinde saklar form kimlik doğrulaması kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a49d0-266">In particular, the MVC portion of your app might use forms authentication, which stores credentials in a cookie.</span></span> <span data-ttu-id="a49d0-267">Tanımlama bilgisi tabanlı kimlik doğrulaması, sahteciliğe karşı koruma belirteçleri, CSRF saldırıları önlemek için kullanılmasını gerektirir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-267">Cookie-based authentication requires the use of anti-forgery tokens, to prevent CSRF attacks.</span></span> <span data-ttu-id="a49d0-268">Sahteciliğe karşı koruma belirteci istemciye gönderilecek web API'si için uygun hiçbir yolu olmadığından web API'leri için bir sorun olmasıdır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-268">That's a problem for web APIs, because there is no convenient way for the web API to send the anti-forgery token to the client.</span></span> <span data-ttu-id="a49d0-269">(Bu konu hakkında daha fazla bilgiler için bkz. [CSRF önleme saldırıları Web API'sindeki](preventing-cross-site-request-forgery-csrf-attacks.md).) Çağırma **SuppressDefaultHostAuthentication** Web API CSRF saldırılarına karşı savunmasız tanımlama bilgilerinde depolanan kimlik bilgileri'den değil sağlar.</span><span class="sxs-lookup"><span data-stu-id="a49d0-269">(For more background on this issue, see [Preventing CSRF Attacks in Web API](preventing-cross-site-request-forgery-csrf-attacks.md).) Calling **SuppressDefaultHostAuthentication** ensures that Web API is not vulnerable to CSRF attacks from credentials stored in cookies.</span></span>


<span data-ttu-id="a49d0-270">İstemcinin korumalı bir kaynağın istediğinde, Web API işlem hattında ne şöyledir:</span><span class="sxs-lookup"><span data-stu-id="a49d0-270">When the client requests a protected resource, here is what happens in the Web API pipeline:</span></span>

1. <span data-ttu-id="a49d0-271">**HostAuthentication** filtre belirteci doğrulamak için bir OAuth ara yazılım çağırır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-271">The **HostAuthentication** filter calls the OAuth middleware to validate the token.</span></span>
2. <span data-ttu-id="a49d0-272">Ara yazılım belirteci talep kimliği dönüştürür.</span><span class="sxs-lookup"><span data-stu-id="a49d0-272">The middleware converts the token into a claims identity.</span></span>
3. <span data-ttu-id="a49d0-273">Bu noktada, isteğidir *kimliği doğrulanmış* ama *yetkili*.</span><span class="sxs-lookup"><span data-stu-id="a49d0-273">At this point, the request is *authenticated* but not *authorized*.</span></span>
4. <span data-ttu-id="a49d0-274">Yetkilendirme filtresini talep kimliğini inceler.</span><span class="sxs-lookup"><span data-stu-id="a49d0-274">The authorization filter examines the claims identity.</span></span> <span data-ttu-id="a49d0-275">Bu kaynak için kullanıcı talepleri yetkilendirmek, istek yetkili.</span><span class="sxs-lookup"><span data-stu-id="a49d0-275">If the claims authorize the user for that resource, the request is authorized.</span></span> <span data-ttu-id="a49d0-276">Varsayılan olarak, **[Authorize]** öznitelik kimliği doğrulanan herhangi bir istek yetki.</span><span class="sxs-lookup"><span data-stu-id="a49d0-276">By default, the **[Authorize]** attribute will authorize any request that is authenticated.</span></span> <span data-ttu-id="a49d0-277">Ancak, rolü veya diğer talepler yetki verebilir.</span><span class="sxs-lookup"><span data-stu-id="a49d0-277">However, you can authorize by role or by other claims.</span></span> <span data-ttu-id="a49d0-278">Daha fazla bilgi için [kimlik doğrulama ve yetkilendirme Web API'sindeki](authentication-and-authorization-in-aspnet-web-api.md).</span><span class="sxs-lookup"><span data-stu-id="a49d0-278">For more information, see [Authentication and Authorization in Web API](authentication-and-authorization-in-aspnet-web-api.md).</span></span>
5. <span data-ttu-id="a49d0-279">Önceki adımları başarılı olursa, denetleyici korumalı kaynağa döndürür.</span><span class="sxs-lookup"><span data-stu-id="a49d0-279">If the previous steps are successful, the controller returns the protected resource.</span></span> <span data-ttu-id="a49d0-280">Aksi takdirde istemci 401 (yetkisiz) hatası alır.</span><span class="sxs-lookup"><span data-stu-id="a49d0-280">Otherwise, the client receives a 401 (Unauthorized) error.</span></span>

[![](individual-accounts-in-web-api/_static/image18.png)](individual-accounts-in-web-api/_static/image17.png)

## <a name="additional-resources"></a><span data-ttu-id="a49d0-281">Ek Kaynaklar</span><span class="sxs-lookup"><span data-stu-id="a49d0-281">Additional Resources</span></span>

- [<span data-ttu-id="a49d0-282">ASP.NET kimlik</span><span class="sxs-lookup"><span data-stu-id="a49d0-282">ASP.NET Identity</span></span>](../../../identity/index.md)
- <span data-ttu-id="a49d0-283">[VS2013 RC için güvenlik özellikleri SPA şablondaki anlama](https://blogs.msdn.com/b/webdev/archive/2013/09/20/understanding-security-features-in-spa-template.aspx).</span><span class="sxs-lookup"><span data-stu-id="a49d0-283">[Understanding Security Features in the SPA Template for VS2013 RC](https://blogs.msdn.com/b/webdev/archive/2013/09/20/understanding-security-features-in-spa-template.aspx).</span></span> <span data-ttu-id="a49d0-284">MSDN blog post by Hongye Sun.</span><span class="sxs-lookup"><span data-stu-id="a49d0-284">MSDN blog post by Hongye Sun.</span></span>
- <span data-ttu-id="a49d0-285">[Web API'si tek tek hesapları şablon – bölüm 2 ayrıntıları: Yerel hesaplar](http://leastprivilege.com/2013/11/26/dissecting-the-web-api-individual-accounts-templatepart-2-local-accounts/).</span><span class="sxs-lookup"><span data-stu-id="a49d0-285">[Dissecting the Web API Individual Accounts Template–Part 2: Local Accounts](http://leastprivilege.com/2013/11/26/dissecting-the-web-api-individual-accounts-templatepart-2-local-accounts/).</span></span> <span data-ttu-id="a49d0-286">Blog gönderisi Dominick Baier tarafından.</span><span class="sxs-lookup"><span data-stu-id="a49d0-286">Blog post by Dominick Baier.</span></span>
- <span data-ttu-id="a49d0-287">[Konak kimlik doğrulaması ve Web API ile OWIN](http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/).</span><span class="sxs-lookup"><span data-stu-id="a49d0-287">[Host authentication and Web API with OWIN](http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/).</span></span> <span data-ttu-id="a49d0-288">İyi bir açıklama `SuppressDefaultHostAuthentication` ve `HostAuthenticationFilter` Brock Allen tarafından.</span><span class="sxs-lookup"><span data-stu-id="a49d0-288">A good explanation of `SuppressDefaultHostAuthentication` and `HostAuthenticationFilter` by Brock Allen.</span></span>
- <span data-ttu-id="a49d0-289">[VS 2013 şablonlarındaki ASP.NET ıdentity'de profil bilgilerini özelleştirme](https://blogs.msdn.com/b/webdev/archive/2013/10/16/customizing-profile-information-in-asp-net-identity-in-vs-2013-templates.aspx).</span><span class="sxs-lookup"><span data-stu-id="a49d0-289">[Customizing profile information in ASP.NET Identity in VS 2013 templates](https://blogs.msdn.com/b/webdev/archive/2013/10/16/customizing-profile-information-in-asp-net-identity-in-vs-2013-templates.aspx).</span></span> <span data-ttu-id="a49d0-290">MSDN blog gönderisi Pranav rastogi'nin.</span><span class="sxs-lookup"><span data-stu-id="a49d0-290">MSDN blog post by Pranav Rastogi.</span></span>
- <span data-ttu-id="a49d0-291">[Ömür yönetimini UserManager ASP.NET Identity sınıfında istek başına](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span><span class="sxs-lookup"><span data-stu-id="a49d0-291">[Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span> <span data-ttu-id="a49d0-292">İyi bir açıklama ile MSDN blog gönderisine Suhas Joshi tarafından `UserManager` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="a49d0-292">MSDN blog post by Suhas Joshi, with a good explanation of the `UserManager` class.</span></span>
