---
uid: web-api/overview/error-handling/web-api-global-error-handling
title: ASP.NET Web API 2'de Genel Hata İşleme - 4ASP.NET
author: davidmatson
description: ASP.NET 4.x için ASP.NET Web API 2'deki genel hata işleme genel bakışı.
ms.author: riande
ms.date: 02/03/2014
ms.custom: seoapril2019
ms.assetid: bffd7863-f63b-4b23-a13c-372b5492e9fb
msc.legacyurl: /web-api/overview/error-handling/web-api-global-error-handling
msc.type: authoredcontent
ms.openlocfilehash: 5ff54d2e4ed881ce927d0a401fb79d9b8bc5b8a1
ms.sourcegitcommit: ce28244209db8615bc9bdd576a2e2c88174d318d
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/06/2020
ms.locfileid: "80675424"
---
# <a name="global-error-handling-in-aspnet-web-api-2"></a><span data-ttu-id="eb54c-103">ASP.NET Web API 2'de Genel Hata İşleme</span><span class="sxs-lookup"><span data-stu-id="eb54c-103">Global Error Handling in ASP.NET Web API 2</span></span>

<span data-ttu-id="eb54c-104">David [Matson](https://github.com/davidmatson)tarafından , [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="eb54c-104">by [David Matson](https://github.com/davidmatson), [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="eb54c-105">Bu konu, ASP.NET 4.x için ASP.NET Web API 2'deki genel hata işleme genel görünümünü sağlar.</span><span class="sxs-lookup"><span data-stu-id="eb54c-105">This topic provides an overview of global error handling in ASP.NET Web API 2 for ASP.NET 4.x.</span></span> <span data-ttu-id="eb54c-106">Bugün Web API'sinde hataları genel olarak günlüğe kaydetmenin veya işlemenin kolay bir yolu yoktur.</span><span class="sxs-lookup"><span data-stu-id="eb54c-106">Today there's no easy way in Web API to log or handle errors globally.</span></span> <span data-ttu-id="eb54c-107">Bazı işlenmemiş özel durumlar [özel durum filtreleri](exception-handling.md)aracılığıyla işlenebilir, ancak özel durum filtrelerinin işleyebileceği birkaç özel durum vardır.</span><span class="sxs-lookup"><span data-stu-id="eb54c-107">Some unhandled exceptions can be processed via [exception filters](exception-handling.md), but there are a number of cases that exception filters can't handle.</span></span> <span data-ttu-id="eb54c-108">Örneğin:</span><span class="sxs-lookup"><span data-stu-id="eb54c-108">For example:</span></span>

1. <span data-ttu-id="eb54c-109">Denetleyici oluşturuculardan atılan özel durumlar.</span><span class="sxs-lookup"><span data-stu-id="eb54c-109">Exceptions thrown from controller constructors.</span></span>
2. <span data-ttu-id="eb54c-110">İleti işleyicilerinden atılan özel durumlar.</span><span class="sxs-lookup"><span data-stu-id="eb54c-110">Exceptions thrown from message handlers.</span></span>
3. <span data-ttu-id="eb54c-111">Yönlendirme sırasında atılan özel durumlar.</span><span class="sxs-lookup"><span data-stu-id="eb54c-111">Exceptions thrown during routing.</span></span>
4. <span data-ttu-id="eb54c-112">Yanıt içeriği serileştirme sırasında atılan özel durumlar.</span><span class="sxs-lookup"><span data-stu-id="eb54c-112">Exceptions thrown during response content serialization.</span></span>

<span data-ttu-id="eb54c-113">Bu özel durumları (mümkünse) günlüğe kaydetmek ve işlemek için basit ve tutarlı bir yol sağlamak istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="eb54c-113">We want to provide a simple, consistent way to log and handle (where possible) these exceptions.</span></span> 

<span data-ttu-id="eb54c-114">Özel durumları işlemek için iki önemli durum vardır, hata yanıtı gönderebildiğimiz ve tek yapabildiğimiz özel durumu günlüğe kaydetmek tir.</span><span class="sxs-lookup"><span data-stu-id="eb54c-114">There are two major cases for handling exceptions, the case where we are able to send an error response and the case where all we can do is log the exception.</span></span> <span data-ttu-id="eb54c-115">İkinci durum için bir örnek, bir özel durum akış yanıt içeriğinin ortasına atıldığında; bu durumda durum kodu, üstbilgi ve kısmi içerik zaten tel üzerinden gitti, bu yüzden sadece bağlantı iptal beri yeni bir yanıt iletisi göndermek için çok geç.</span><span class="sxs-lookup"><span data-stu-id="eb54c-115">An example for the latter case is when an exception is thrown in the middle of streaming response content; in that case it is too late to send a new response message since the status code, headers, and partial content have already gone across the wire, so we simply abort the connection.</span></span> <span data-ttu-id="eb54c-116">Özel durum yeni bir yanıt iletisi oluşturmak için ele alınamasa da, özel durumu günlüğe kaydetmeyi yine de destekliyoruz.</span><span class="sxs-lookup"><span data-stu-id="eb54c-116">Even though the exception can't be handled to produce a new response message, we still support logging the exception.</span></span> <span data-ttu-id="eb54c-117">Bir hata algılayabildiğimiz durumlarda, aşağıdakilerde gösterildiği gibi uygun bir hata yanıtı döndürebiliriz:</span><span class="sxs-lookup"><span data-stu-id="eb54c-117">In cases where we can detect an error, we can return an appropriate error response as shown in the following:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample1.cs?highlight=6)]

### <a name="existing-options"></a><span data-ttu-id="eb54c-118">Varolan Seçenekler</span><span class="sxs-lookup"><span data-stu-id="eb54c-118">Existing Options</span></span>

<span data-ttu-id="eb54c-119">[Özel durum filtrelerine](exception-handling.md)ek olarak, [ileti işleyicileri](../advanced/http-message-handlers.md) bugün 500 düzeyli yanıtların tümlerini gözlemlemek için kullanılabilir, ancak özgün hatayla ilgili bağlamları olmadığı için bu yanıtlara göre hareket etmek zordur.</span><span class="sxs-lookup"><span data-stu-id="eb54c-119">In addition to [exception filters](exception-handling.md), [message handlers](../advanced/http-message-handlers.md) can be used today to observe all 500-level responses, but acting on those responses is difficult, as they lack context about the original error.</span></span> <span data-ttu-id="eb54c-120">İleti işleyicileri de işleyebilir servis talepleri ile ilgili özel durum filtreleri olarak aynı sınırlamalar bazı vardır.</span><span class="sxs-lookup"><span data-stu-id="eb54c-120">Message handlers also have some of the same limitations as exception filters regarding the cases they can handle.</span></span> <span data-ttu-id="eb54c-121">Web API'de hata koşullarını yakalayan izleme altyapısı olsa da, izleme altyapısı tanılama amacıyladır ve üretim ortamlarında çalıştırmak için tasarlanmamıştır veya uygun değildir.</span><span class="sxs-lookup"><span data-stu-id="eb54c-121">While Web API does have tracing infrastructure that captures error conditions the tracing infrastructure is for diagnostics purposes and is not designed or suited for running in production environments.</span></span> <span data-ttu-id="eb54c-122">Genel özel durum işleme ve günlüğe kaydetme, üretim sırasında çalıştırılabilen ve varolan izleme çözümlerine bağlanabilen hizmetler olmalıdır (örneğin, [ELMAH).](https://code.google.com/p/elmah/)</span><span class="sxs-lookup"><span data-stu-id="eb54c-122">Global exception handling and logging should be services that can run during production and be plugged into existing monitoring solutions (for example, [ELMAH](https://code.google.com/p/elmah/)).</span></span>

### <a name="solution-overview"></a><span data-ttu-id="eb54c-123">Çözüme Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="eb54c-123">Solution Overview</span></span>

 <span data-ttu-id="eb54c-124">İşlenmemiş özel durumları günlüğe kaydetmek ve işlemek için iki yeni kullanıcı değiştirilebilir hizmet , [IExceptionLogger](../releases/whats-new-in-aspnet-web-api-21.md) ve IExceptionHandler saiyoruz.</span><span class="sxs-lookup"><span data-stu-id="eb54c-124">We provide two new user-replaceable services, [IExceptionLogger](../releases/whats-new-in-aspnet-web-api-21.md) and IExceptionHandler, to log and handle unhandled exceptions.</span></span> <span data-ttu-id="eb54c-125">Hizmetler çok benzer, iki ana farklılıklar ile:</span><span class="sxs-lookup"><span data-stu-id="eb54c-125">The services are very similar, with two main differences:</span></span>

1. <span data-ttu-id="eb54c-126">Birden çok özel durum kaydedicisi, ancak yalnızca tek bir özel durum işleyicisi kaydetmeyi destekliyoruz.</span><span class="sxs-lookup"><span data-stu-id="eb54c-126">We support registering multiple exception loggers but only a single exception handler.</span></span>
2. <span data-ttu-id="eb54c-127">İstisna kaydediciler her zaman çağrılır, bağlantıyı iptal etmek üzere olsak bile.</span><span class="sxs-lookup"><span data-stu-id="eb54c-127">Exception loggers always get called, even if we're about to abort the connection.</span></span> <span data-ttu-id="eb54c-128">Özel durum işleyicileri yalnızca hangi yanıt iletisini göndereceğimizi hala seçebildiğimizde çağrılır.</span><span class="sxs-lookup"><span data-stu-id="eb54c-128">Exception handlers only get called when we're still able to choose which response message to send.</span></span>

<span data-ttu-id="eb54c-129">Her iki hizmet de, özel durum algılandığı noktadan ilgili bilgileri içeren bir özel durum bağlamına, özellikle [HttpRequestMessage,](https://msdn.microsoft.com/library/system.net.http.httprequestmessage(v=vs.110).aspx) [HttpRequestContext,](https://msdn.microsoft.com/library/system.web.http.controllers.httprequestcontext(v=vs.118).aspx)atılan özel durum ve özel durum kaynağına (aşağıdaki ayrıntılar) erişim sağlar.</span><span class="sxs-lookup"><span data-stu-id="eb54c-129">Both services provide access to an exception context containing relevant information from the point where the exception was detected, particularly the [HttpRequestMessage](https://msdn.microsoft.com/library/system.net.http.httprequestmessage(v=vs.110).aspx), the [HttpRequestContext](https://msdn.microsoft.com/library/system.web.http.controllers.httprequestcontext(v=vs.118).aspx), the thrown exception and the exception source (details below).</span></span>

### <a name="design-principles"></a><span data-ttu-id="eb54c-130">Tasarım İlkeleri</span><span class="sxs-lookup"><span data-stu-id="eb54c-130">Design Principles</span></span>

1. <span data-ttu-id="eb54c-131">**Son dakika değişikliği yok** Bu işlevsellik küçük bir sürümde eklendiğiniz için, çözümü etkileyen önemli bir kısıtlama, sözleşme yazmak veya davranış için herhangi bir kırılma değişiklik olmamasıdır.</span><span class="sxs-lookup"><span data-stu-id="eb54c-131">**No breaking changes** Because this functionality is being added in a minor release, one important constraint impacting the solution is that there be no breaking changes, either to type contracts or to behavior.</span></span> <span data-ttu-id="eb54c-132">Bu kısıtlama, özel durumları 500 yanıta dönüştüren varolan catch blokları açısından yapmak istediğimiz bazı temizlemeleri ekarte etti.</span><span class="sxs-lookup"><span data-stu-id="eb54c-132">This constraint ruled out some cleanup we would like to have done in terms of existing catch blocks turning exceptions into 500 responses.</span></span> <span data-ttu-id="eb54c-133">Bu ek temizleme biz bir sonraki büyük sürümü için düşünebilirsiniz bir şeydir.</span><span class="sxs-lookup"><span data-stu-id="eb54c-133">This additional cleanup is something we might consider for a subsequent major release.</span></span> <span data-ttu-id="eb54c-134">Bu sizin için önemli yse, lütfen [ASP.NET Web API kullanıcı sesi](http://aspnet.uservoice.com/forums/147201-asp-net-web-api/suggestions/5451321-add-flag-to-enable-iexceptionlogger-and-iexception)nde oy verin.</span><span class="sxs-lookup"><span data-stu-id="eb54c-134">If this is important to you please vote on it at [ASP.NET Web API user voice](http://aspnet.uservoice.com/forums/147201-asp-net-web-api/suggestions/5451321-add-flag-to-enable-iexceptionlogger-and-iexception).</span></span>
2. <span data-ttu-id="eb54c-135">**Web API yapıları ile tutarlılık sağlama** Web API'nin filtre boru hattı, eyleme özel, denetleyiciye özgü veya küresel kapsamda mantığı uygulama esnekliğiyle çapraz kesme yle başa çıkmanın harika bir yoludur.</span><span class="sxs-lookup"><span data-stu-id="eb54c-135">**Maintaining consistency with Web API constructs** Web API's filter pipeline is a great way to handle cross-cutting concerns with the flexibility of applying the logic at an action-specific, controller-specific or global scope.</span></span> <span data-ttu-id="eb54c-136">Özel durum filtreleri de dahil olmak üzere filtreler, genel kapsamda kaydedilmiş olsa lar bile her zaman eylem ve denetleyici bağlamlarına sahiptir.</span><span class="sxs-lookup"><span data-stu-id="eb54c-136">Filters, including exception filters, always have action and controller contexts, even when registered at the global scope.</span></span> <span data-ttu-id="eb54c-137">Bu sözleşme filtreler için anlamlıdır, ancak özel durum filtreleri, hatta genel olarak kapsamlı olanlar, hiçbir eylem veya denetleyici bağlam var ileti işleyicileri, özel durumlar gibi bazı özel durum işleme durumlarda için iyi bir uyum olmadığı anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="eb54c-137">That contract makes sense for filters, but it means that exception filters, even globally scoped ones, aren't a good fit for some exception handling cases, such as exceptions from message handlers, where no action or controller context exists.</span></span> <span data-ttu-id="eb54c-138">Özel durum işleme için filtreler tarafından sağlanan esnek kapsam landırmayı kullanmak istiyorsak, yine de özel durum filtrelerine ihtiyacımız vardır.</span><span class="sxs-lookup"><span data-stu-id="eb54c-138">If we want to use the flexible scoping afforded by filters for exception handling, we still need exception filters.</span></span> <span data-ttu-id="eb54c-139">Ancak, denetleyici bağlamı dışında özel durumu ele almamız gerekirse, tam genel hata işleme için ayrı bir yapıya da ihtiyacımız vardır (denetleyici bağlamı ve eylem bağlamı kısıtlamaları olmayan bir şey).</span><span class="sxs-lookup"><span data-stu-id="eb54c-139">But if we need to handle exception outside of a controller context, we also need a separate construct for full global error handling (something without the controller context and action context constraints).</span></span>

### <a name="when-to-use"></a><span data-ttu-id="eb54c-140">Ne Zaman Kullanılır</span><span class="sxs-lookup"><span data-stu-id="eb54c-140">When to Use</span></span>

- <span data-ttu-id="eb54c-141">Özel durum kaydediciler, Web API tarafından yakalanan tüm işlenmemiş özel durum ları görmenin çözümüdür.</span><span class="sxs-lookup"><span data-stu-id="eb54c-141">Exception loggers are the solution to seeing all unhandled exception caught by Web API.</span></span>
- <span data-ttu-id="eb54c-142">Özel durum işleyicileri, Web API tarafından yakalanan işlenmemiş özel durumlara olası tüm yanıtları özelleştirmek için çözümdür.</span><span class="sxs-lookup"><span data-stu-id="eb54c-142">Exception handlers are the solution for customizing all possible responses to unhandled exceptions caught by Web API.</span></span>
- <span data-ttu-id="eb54c-143">Özel durum filtreleri, belirli bir eylem veya denetleyiciyle ilgili işlenmemiş özel durumları işlemek için en kolay çözümdür.</span><span class="sxs-lookup"><span data-stu-id="eb54c-143">Exception filters are the easiest solution for processing the subset unhandled exceptions related to a specific action or controller.</span></span>

### <a name="service-details"></a><span data-ttu-id="eb54c-144">Servis Detayları</span><span class="sxs-lookup"><span data-stu-id="eb54c-144">Service Details</span></span>

 <span data-ttu-id="eb54c-145">Özel durum kaydedici ve işleyici hizmet arabirimleri, ilgili bağlamları alarak basit async yöntemleridir:</span><span class="sxs-lookup"><span data-stu-id="eb54c-145">The exception logger and handler service interfaces are simple async methods taking the respective contexts:</span></span> 

[!code-csharp[Main](web-api-global-error-handling/samples/sample2.cs)]

 <span data-ttu-id="eb54c-146">Ayrıca, bu arabirimlerin her ikisi için de temel sınıflar salıyoruz.</span><span class="sxs-lookup"><span data-stu-id="eb54c-146">We also provide base classes for both of these interfaces.</span></span> <span data-ttu-id="eb54c-147">Çekirdek (eşitleme veya eşitleme) yöntemlerini geçersiz kılmak, önerilen zamanlarda günlüğe kaydetmek veya işlemek için gereken tek şeydir.</span><span class="sxs-lookup"><span data-stu-id="eb54c-147">Overriding the core (sync or async) methods is all that is required to log or handle at the recommended times.</span></span> <span data-ttu-id="eb54c-148">Günlüğe kaydetme `ExceptionLogger` için, temel sınıf çekirdek günlüğe kaydetme yönteminin her özel durum için yalnızca bir kez çağrılmasını sağlar (daha sonra çağrı yığınını daha da yukarı yaysa ve tekrar yakalanırsa bile).</span><span class="sxs-lookup"><span data-stu-id="eb54c-148">For logging, the `ExceptionLogger` base class will ensure that the core logging method is only called once for each exception (even if it later propagates further up the call stack and is caught again).</span></span> <span data-ttu-id="eb54c-149">`ExceptionHandler` Taban sınıf, eski iç içe geçme bloklarını yoksayarak yalnızca çağrı yığınının üst kısmındaki özel durumlar için çekirdek işleme yöntemini çağırır.</span><span class="sxs-lookup"><span data-stu-id="eb54c-149">The `ExceptionHandler` base class will call the core handling method only for exceptions at the top of the call stack, ignoring legacy nested catch blocks.</span></span> <span data-ttu-id="eb54c-150">(Bu temel sınıfların basitleştirilmiş sürümleri aşağıdaki ekte yer almaktadır.) Her `IExceptionLogger` `IExceptionHandler` ikisi de ve bir `ExceptionContext`üzerinden özel durum hakkında bilgi almak.</span><span class="sxs-lookup"><span data-stu-id="eb54c-150">(Simplified versions of these base classes are in the appendix below.) Both `IExceptionLogger` and `IExceptionHandler` receive information about the exception via an `ExceptionContext`.</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample3.cs)]

<span data-ttu-id="eb54c-151">Çerçeve bir özel durum kaydedici veya özel durum işleyicisi çağırır, her zaman bir `Exception` ve bir `Request`.</span><span class="sxs-lookup"><span data-stu-id="eb54c-151">When the framework calls an exception logger or an exception handler, it will always provide an `Exception` and a `Request`.</span></span> <span data-ttu-id="eb54c-152">Birim testi dışında, aynı zamanda `RequestContext`her zaman bir sağlayacaktır .</span><span class="sxs-lookup"><span data-stu-id="eb54c-152">Except for unit testing, it will also always provide a `RequestContext`.</span></span> <span data-ttu-id="eb54c-153">Nadiren bir `ControllerContext` ve `ActionContext` (yalnızca özel durum filtreleri için catch bloğundan ararken) sağlar.</span><span class="sxs-lookup"><span data-stu-id="eb54c-153">It will rarely provide a `ControllerContext` and `ActionContext` (only when calling from the catch block for exception filters).</span></span> <span data-ttu-id="eb54c-154">Çok nadiren bir `Response`(sadece bazı IIS durumlarda zaman yanıt yazmaya çalışırken ortasında) sağlayacaktır.</span><span class="sxs-lookup"><span data-stu-id="eb54c-154">It will very rarely provide a `Response`(only in certain IIS cases when in the middle of trying to write the response).</span></span> <span data-ttu-id="eb54c-155">Bu özelliklerden bazıları olabileceğinden, `null` özel durum sınıfının `null` üyelerine erişmeden önce denetlemenin tüketiciye bağlı olduğunu unutmayın.`CatchBlock`</span><span class="sxs-lookup"><span data-stu-id="eb54c-155">Note that because some of these properties may be `null` it is up to the consumer to check for `null` before accessing members of the exception class.`CatchBlock`</span></span> <span data-ttu-id="eb54c-156">catch bloğunun özel durumu gördüğünü belirten bir dizedir.</span><span class="sxs-lookup"><span data-stu-id="eb54c-156">is a string indicating which catch block saw the exception.</span></span> <span data-ttu-id="eb54c-157">Catch block dizeleri aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="eb54c-157">The catch block strings are as follows:</span></span>

- <span data-ttu-id="eb54c-158">HttpServer (SendAsync yöntemi)</span><span class="sxs-lookup"><span data-stu-id="eb54c-158">HttpServer (SendAsync method)</span></span>
- <span data-ttu-id="eb54c-159">HttpControllerDispatcher (SendAsync yöntemi)</span><span class="sxs-lookup"><span data-stu-id="eb54c-159">HttpControllerDispatcher (SendAsync method)</span></span>
- <span data-ttu-id="eb54c-160">HttpBatchHandler (SendAsync yöntemi)</span><span class="sxs-lookup"><span data-stu-id="eb54c-160">HttpBatchHandler (SendAsync method)</span></span>
- <span data-ttu-id="eb54c-161">IExceptionFilter (ApiController'ın ExecuteAsync'deki özel durum filtresi denetim hattını işlemesi)</span><span class="sxs-lookup"><span data-stu-id="eb54c-161">IExceptionFilter (ApiController's processing of the exception filter pipeline in ExecuteAsync)</span></span>
- <span data-ttu-id="eb54c-162">OWIN ev sahibi:</span><span class="sxs-lookup"><span data-stu-id="eb54c-162">OWIN host:</span></span>

    - <span data-ttu-id="eb54c-163">HttpMessageHandlerAdapter.BufferResponseContentAsync (çıktı arabelleğe alma için)</span><span class="sxs-lookup"><span data-stu-id="eb54c-163">HttpMessageHandlerAdapter.BufferResponseContentAsync (for buffering output)</span></span>
    - <span data-ttu-id="eb54c-164">HttpMessageHandlerAdapter.CopyResponseContentAsync (akış çıktısı için)</span><span class="sxs-lookup"><span data-stu-id="eb54c-164">HttpMessageHandlerAdapter.CopyResponseContentAsync (for streaming output)</span></span>
- <span data-ttu-id="eb54c-165">Web barındırma:</span><span class="sxs-lookup"><span data-stu-id="eb54c-165">Web host:</span></span>

    - <span data-ttu-id="eb54c-166">httpControllerHandler.WriteBufferedResponseContentAsync (çıktı arabelleğe alma için)</span><span class="sxs-lookup"><span data-stu-id="eb54c-166">HttpControllerHandler.WriteBufferedResponseContentAsync (for buffering output)</span></span>
    - <span data-ttu-id="eb54c-167">httpControllerHandler.WriteStreamedResponseContentAsync (akış çıktısı için)</span><span class="sxs-lookup"><span data-stu-id="eb54c-167">HttpControllerHandler.WriteStreamedResponseContentAsync (for streaming output)</span></span>
    - <span data-ttu-id="eb54c-168">httpControllerHandler.WriteErrorResponseContentAsync (arabelleğe alma modu altında hata kurtarma hataları için)</span><span class="sxs-lookup"><span data-stu-id="eb54c-168">HttpControllerHandler.WriteErrorResponseContentAsync (for failures in error recovery under buffered output mode)</span></span>

<span data-ttu-id="eb54c-169">Catch block dizeleri listesi statik salt özellikleri ile de kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="eb54c-169">The list of catch block strings is also available via static readonly properties.</span></span> <span data-ttu-id="eb54c-170">(Çekirdek catch blok dizesi statik ExceptionCatchBlocks üzerindedir; geri kalanı OWIN ve web ana bilgisayar için her biri statik bir sınıfta görünür).`IsTopLevelCatchBlock`</span><span class="sxs-lookup"><span data-stu-id="eb54c-170">(The core catch block string are on the static ExceptionCatchBlocks; the remainder appear on one static class each for OWIN and web host).`IsTopLevelCatchBlock`</span></span> <span data-ttu-id="eb54c-171">yalnızca çağrı yığınının üst kısmında ki özel durumları işleme nin önerilen deseni takip etmek için yararlıdır.</span><span class="sxs-lookup"><span data-stu-id="eb54c-171">is helpful for following the recommended pattern of handling exceptions only at the top of the call stack.</span></span> <span data-ttu-id="eb54c-172">İç içe geçme bloğu oluştuğu her yerde özel durumları 500 yanıta dönüştürmek yerine, özel durum işleyicisi, ana bilgisayar tarafından görülmek üzere olana kadar özel durumların yayılmasına izin verebilir.</span><span class="sxs-lookup"><span data-stu-id="eb54c-172">Rather than turning exceptions into 500 responses anywhere a nested catch block occurs, an exception handler can let exceptions propagate until they are about to be seen by the host.</span></span>

<span data-ttu-id="eb54c-173">Ek `ExceptionContext`olarak, bir logger tam `ExceptionLoggerContext`üzerinden bilgi bir parça daha alır:</span><span class="sxs-lookup"><span data-stu-id="eb54c-173">In addition to the `ExceptionContext`, a logger gets one more piece of information via the full `ExceptionLoggerContext`:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample4.cs)]

<span data-ttu-id="eb54c-174">İkinci özellik, `CanBeHandled`bir logger işlenemez bir özel durum tanımlamak için izin verir.</span><span class="sxs-lookup"><span data-stu-id="eb54c-174">The second property, `CanBeHandled`, allows a logger to identify an exception that cannot be handled.</span></span> <span data-ttu-id="eb54c-175">Bağlantı iptal etmek üzereyken ve yeni yanıt iletisi gönderilemiyorsa, kaydediciler çağrılacak, ancak işleyici ***çağrılmaz*** ve günbazı bu senaryoyu bu özellikten tanımlayabilir.</span><span class="sxs-lookup"><span data-stu-id="eb54c-175">When the connection is about to be aborted and no new response message can be sent, the loggers will be called but the handler will ***not*** be called, and the loggers can identify this scenario from this property.</span></span>

<span data-ttu-id="eb54c-176">Ek `ExceptionContext`olarak, bir işleyici özel durum işlemek için `ExceptionHandlerContext` tam ayarlayabilirsiniz bir özellik daha alır:</span><span class="sxs-lookup"><span data-stu-id="eb54c-176">In additional to the `ExceptionContext`, a handler gets one more property it can set on the full `ExceptionHandlerContext` to handle the exception:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample5.cs)]

<span data-ttu-id="eb54c-177">Bir özel durum işleyicisi, `Result` özelliği bir eylem sonucuna ayarlayarak bir özel durum işlettiğini gösterir (örneğin, bir Özel Durum [Sonucu](https://msdn.microsoft.com/library/system.web.http.results.exceptionresult(v=vs.118).aspx), [InternalServerErrorResult](https://msdn.microsoft.com/library/system.web.http.results.internalservererrorresult(v=vs.118).aspx), [StatusCodeResult](https://msdn.microsoft.com/library/system.web.http.results.statuscoderesult(v=vs.118).aspx), veya özel bir sonuç).</span><span class="sxs-lookup"><span data-stu-id="eb54c-177">An exception handler indicates that it has handled an exception by setting the `Result` property to an action result (for example, an [ExceptionResult](https://msdn.microsoft.com/library/system.web.http.results.exceptionresult(v=vs.118).aspx), [InternalServerErrorResult](https://msdn.microsoft.com/library/system.web.http.results.internalservererrorresult(v=vs.118).aspx), [StatusCodeResult](https://msdn.microsoft.com/library/system.web.http.results.statuscoderesult(v=vs.118).aspx), or a custom result).</span></span> <span data-ttu-id="eb54c-178">`Result` Özellik null ise, özel durum işlenir ve özgün özel durum yeniden atılır.</span><span class="sxs-lookup"><span data-stu-id="eb54c-178">If the `Result` property is null, the exception is unhandled and the original exception will be re-thrown.</span></span>

<span data-ttu-id="eb54c-179">Arama yığınının üst kısmındaki istisnalar için, yanıtın API arayanlar için uygun olduğundan emin olmak için fazladan bir adım attık.</span><span class="sxs-lookup"><span data-stu-id="eb54c-179">For exceptions at the top of the call stack, we took an extra step to ensure the response is appropriate for API callers.</span></span> <span data-ttu-id="eb54c-180">Özel durum ana bilgisayara yayılırsa, arayan normal bir şekilde HTML olan ve genellikle uygun bir API hata yanıtı olmayan yanıt veren sarı ölüm ekranını veya başka bir ana bilgisayarı görür.</span><span class="sxs-lookup"><span data-stu-id="eb54c-180">If the exception propagates up to the host, the caller would see the yellow screen of death or some other host provided response which is typically HTML and not usually an appropriate API error response.</span></span> <span data-ttu-id="eb54c-181">Bu gibi durumlarda, Sonuç null olmayan başlar ve yalnızca özel bir özel durum `null` işleyicisi açıkça geri ayarlar (işlenmemiş) özel durum ana bilgisayara yayılır.</span><span class="sxs-lookup"><span data-stu-id="eb54c-181">In these cases, the Result starts out non-null, and only if a custom exception handler explicitly sets it back to `null` (unhandled) will the exception propagate to the host.</span></span> <span data-ttu-id="eb54c-182">Bu gibi durumlarda ayar `Result` iki senaryo için yararlı olabilir: `null`</span><span class="sxs-lookup"><span data-stu-id="eb54c-182">Setting `Result` to `null` in such cases can be useful for two scenarios:</span></span>

1. <span data-ttu-id="eb54c-183">OWIN, Web API'sinden önce/dışında kayıtlı ara yazılımları işleyen özel istisnalarla Birlikte Web API'yi barındırıdadır.</span><span class="sxs-lookup"><span data-stu-id="eb54c-183">OWIN hosted Web API with custom exception handling middleware registered before/outside Web API.</span></span>
2. <span data-ttu-id="eb54c-184">Ölümün sarı ekranının aslında işlenmemiş bir özel durum için yararlı bir yanıt olduğu bir tarayıcı üzerinden yerel hata ayıklama.</span><span class="sxs-lookup"><span data-stu-id="eb54c-184">Local debugging via a browser, where the yellow screen of death is actually a helpful response for an unhandled exception.</span></span>

<span data-ttu-id="eb54c-185">Hem özel durum kaydediciler hem de özel durum işleyicileri için, logger veya işleyicinin kendisi bir özel durum atarsa kurtarmak için hiçbir şey yapmayız.</span><span class="sxs-lookup"><span data-stu-id="eb54c-185">For both exception loggers and exception handlers, we don't do anything to recover if the logger or handler itself throws an exception.</span></span> <span data-ttu-id="eb54c-186">(İstisnanın yayılmasına izin vermek dışında, daha iyi bir yaklaşımınız varsa bu sayfanın alt kısmında geri bildirim bırakın.) İstisna kaydediciler ve işleyicileri için sözleşme, istisnalar arayanlar kadar yaymak izin vermemek gerektiğini; aksi takdirde, özel durum genellikle bir HTML hatası (ASP gibi) sonuçlanan ana bilgisayara tüm yol, yayılır. NET'in sarı ekranı) istemciye geri gönderiliyor (genellikle JSON veya XML bekleyen API arayanlar için tercih edilen seçenek değildir).</span><span class="sxs-lookup"><span data-stu-id="eb54c-186">(Other than letting the exception propagate, leave feedback at the bottom of this page if you have a better approach.) The contract for exception loggers and handlers is that they should not let exceptions propagate up to their callers; otherwise, the exception will just propagate, often all the way to the host resulting in an HTML error (like ASP.NET's yellow screen) being sent back to the client (which usually isn't the preferred option for API callers that expect JSON or XML).</span></span>

## <a name="examples"></a><span data-ttu-id="eb54c-187">Örnekler</span><span class="sxs-lookup"><span data-stu-id="eb54c-187">Examples</span></span>

### <a name="tracing-exception-logger"></a><span data-ttu-id="eb54c-188">Özel Durum Kaydedici'nin İzini İzleme</span><span class="sxs-lookup"><span data-stu-id="eb54c-188">Tracing Exception Logger</span></span>

<span data-ttu-id="eb54c-189">Aşağıdaki özel durum kaydedicisi, yapılandırılmış İzleme kaynaklarına (Visual Studio'daki Hata Ayıklama çıkış penceresi dahil) özel durum verilerini gönderir.</span><span class="sxs-lookup"><span data-stu-id="eb54c-189">The exception logger below sends exception data to configured Trace sources (including the Debug output window in Visual Studio).</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample6.cs)]

### <a name="custom-error-message-exception-handler"></a><span data-ttu-id="eb54c-190">Özel Hata İletiSi Özel Durum Işleyicisi</span><span class="sxs-lookup"><span data-stu-id="eb54c-190">Custom Error Message Exception Handler</span></span>

<span data-ttu-id="eb54c-191">Aşağıdaki özel durum işleyicisi, desteğe başvurmak için bir e-posta adresi de dahil olmak üzere istemcilere özel bir hata yanıtı üretir.</span><span class="sxs-lookup"><span data-stu-id="eb54c-191">The exception handler below produces a custom error response to clients, including an email address for contacting support.</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample7.cs)]

## <a name="registering-exception-filters"></a><span data-ttu-id="eb54c-192">Özel Durum Filtrelerini Kaydetme</span><span class="sxs-lookup"><span data-stu-id="eb54c-192">Registering Exception Filters</span></span>

<span data-ttu-id="eb54c-193">Projenizi oluşturmak için "ASP.NET MVC 4 Web Uygulaması" proje şablonunu kullanıyorsanız, `WebApiConfig` Web API yapılandırma kodunuzu sınıfın içine, *App_Start* klasörüne koyun:</span><span class="sxs-lookup"><span data-stu-id="eb54c-193">If you use the "ASP.NET MVC 4 Web Application" project template to create your project, put your Web API configuration code inside the `WebApiConfig` class, in the *App_Start* folder:</span></span>

[!code-csharp[Main](exception-handling/samples/sample7.cs?highlight=5)]

## <a name="appendix-base-class-details"></a><span data-ttu-id="eb54c-194">Ek: Taban Sınıf Bilgileri</span><span class="sxs-lookup"><span data-stu-id="eb54c-194">Appendix: Base Class Details</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample8.cs)]
