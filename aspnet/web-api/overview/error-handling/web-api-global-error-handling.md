---
uid: web-api/overview/error-handling/web-api-global-error-handling
title: ASP.NET Web API 2-ASP.NET 4. x içinde genel hata Işleme
author: davidmatson
description: ASP.NET 4. x için ASP.NET Web API 2 ' deki genel hata işlemeye genel bakış.
ms.author: riande
ms.date: 02/03/2014
ms.custom: seoapril2019
ms.assetid: bffd7863-f63b-4b23-a13c-372b5492e9fb
msc.legacyurl: /web-api/overview/error-handling/web-api-global-error-handling
msc.type: authoredcontent
ms.openlocfilehash: 94f2d6d31d0b37f9bb0077e6258c70a2dfb1918d
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78557283"
---
# <a name="global-error-handling-in-aspnet-web-api-2"></a><span data-ttu-id="796b9-103">ASP.NET Web API 2 ' de genel hata Işleme</span><span class="sxs-lookup"><span data-stu-id="796b9-103">Global Error Handling in ASP.NET Web API 2</span></span>

<span data-ttu-id="796b9-104">, [David Matson](https://github.com/davidmatson), [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="796b9-104">by [David Matson](https://github.com/davidmatson), [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="796b9-105">Bu konu, ASP.NET 4. x için ASP.NET Web API 2 ' deki genel hata işlemeye genel bir bakış sağlar.</span><span class="sxs-lookup"><span data-stu-id="796b9-105">This topic provides an overview of global error handling in ASP.NET Web API 2 for ASP.NET 4.x.</span></span> <span data-ttu-id="796b9-106">Günümüzde, Web API 'sinde hataları küresel olarak günlüğe kaydetmek veya işlemek için kolay bir yol yoktur.</span><span class="sxs-lookup"><span data-stu-id="796b9-106">Today there's no easy way in Web API to log or handle errors globally.</span></span> <span data-ttu-id="796b9-107">İşlenmeyen bazı özel durumlar [özel durum filtreleri](exception-handling.md)aracılığıyla işlenebilir, ancak özel durum filtrelerinin işleyemediği bazı durumlar vardır.</span><span class="sxs-lookup"><span data-stu-id="796b9-107">Some unhandled exceptions can be processed via [exception filters](exception-handling.md), but there are a number of cases that exception filters can't handle.</span></span> <span data-ttu-id="796b9-108">Örneğin:</span><span class="sxs-lookup"><span data-stu-id="796b9-108">For example:</span></span>

1. <span data-ttu-id="796b9-109">Denetleyici oluşturucularından oluşturulan özel durumlar.</span><span class="sxs-lookup"><span data-stu-id="796b9-109">Exceptions thrown from controller constructors.</span></span>
2. <span data-ttu-id="796b9-110">İleti işleyicilerinden oluşturulan özel durumlar.</span><span class="sxs-lookup"><span data-stu-id="796b9-110">Exceptions thrown from message handlers.</span></span>
3. <span data-ttu-id="796b9-111">Yönlendirme sırasında oluşturulan özel durumlar.</span><span class="sxs-lookup"><span data-stu-id="796b9-111">Exceptions thrown during routing.</span></span>
4. <span data-ttu-id="796b9-112">Yanıt içeriği serileştirme sırasında oluşturulan özel durumlar.</span><span class="sxs-lookup"><span data-stu-id="796b9-112">Exceptions thrown during response content serialization .</span></span>

<span data-ttu-id="796b9-113">Bu özel durumları günlüğe kaydetmek ve işlemek için basit ve tutarlı bir yol sağlamak istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="796b9-113">We want to provide a simple, consistent way to log and handle (where possible) these exceptions.</span></span> 

<span data-ttu-id="796b9-114">Özel durumları işlemek için kullanabileceğiniz iki büyük durum vardır. bir hata yanıtı gönderebiliyoruz ve tüm yaptığımız durum, özel durumun günlüğe kaydedileceği durumdur.</span><span class="sxs-lookup"><span data-stu-id="796b9-114">There are two major cases for handling exceptions, the case where we are able to send an error response and the case where all we can do is log the exception.</span></span> <span data-ttu-id="796b9-115">İkinci durum için bir örnek, akış yanıtı içeriğinin ortasında bir özel durum oluşturulduğunda oluşur; Bu durumda durum kodu, üst bilgiler ve kısmi içerik zaten kablo genelinde olduğundan yeni bir yanıt iletisi gönderilmesi çok geç olduğundan bağlantıyı durdurduk.</span><span class="sxs-lookup"><span data-stu-id="796b9-115">An example for the latter case is when an exception is thrown in the middle of streaming response content; in that case it is too late to send a new response message since the status code, headers, and partial content have already gone across the wire, so we simply abort the connection.</span></span> <span data-ttu-id="796b9-116">Özel durum yeni bir yanıt iletisi oluşturmak için işlenemese de, özel durumu günlüğe kaydetmeyi destekliyoruz.</span><span class="sxs-lookup"><span data-stu-id="796b9-116">Even though the exception can't be handled to produce a new response message, we still support logging the exception.</span></span> <span data-ttu-id="796b9-117">Hata tespit ettiğimiz durumlarda, aşağıda gösterildiği gibi uygun bir hata yanıtı döndürebiliriz:</span><span class="sxs-lookup"><span data-stu-id="796b9-117">In cases where we can detect an error, we can return an appropriate error response as shown in the following:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample1.cs?highlight=6)]

### <a name="existing-options"></a><span data-ttu-id="796b9-118">Mevcut seçenekler</span><span class="sxs-lookup"><span data-stu-id="796b9-118">Existing Options</span></span>

<span data-ttu-id="796b9-119">[Özel durum filtrelerine](exception-handling.md)ek olarak, [ileti işleyicileri](../advanced/http-message-handlers.md) tüm 500 düzeyinde yanıtları gözlemlemek için bugün kullanılabilir, ancak bu yanıtlara işlem yapılması, özgün hata hakkında bağlam olmadığından zor olabilir.</span><span class="sxs-lookup"><span data-stu-id="796b9-119">In addition to [exception filters](exception-handling.md), [message handlers](../advanced/http-message-handlers.md) can be used today to observe all 500-level responses, but acting on those responses is difficult, as they lack context about the original error.</span></span> <span data-ttu-id="796b9-120">İleti işleyicileri Ayrıca, işleyebilecekleri servis talepleriyle ilgili özel durum filtreleriyle aynı sınırlamalara sahip olmalıdır. Web API 'sinin hata koşullarını yakalayan izleme altyapısı olsa da, izleme altyapısı tanılama amaçlıdır ve üretim ortamlarında çalışmak üzere tasarlanmamıştır veya uygun değildir.</span><span class="sxs-lookup"><span data-stu-id="796b9-120">Message handlers also have some of the same limitations as exception filters regarding the cases they can handle.While Web API does have tracing infrastructure that captures error conditions the tracing infrastructure is for diagnostics purposes and is not designed or suited for running in production environments.</span></span> <span data-ttu-id="796b9-121">Genel özel durum işleme ve günlük kaydı, üretim sırasında çalışabilecek ve var olan izleme çözümlerine takılmış olan hizmetler olmalıdır (örneğin, [ELMAH](https://code.google.com/p/elmah/) ).</span><span class="sxs-lookup"><span data-stu-id="796b9-121">Global exception handling and logging should be services that can run during production and be plugged into existing monitoring solutions (for example, [ELMAH](https://code.google.com/p/elmah/) ).</span></span>

### <a name="solution-overview"></a><span data-ttu-id="796b9-122">Çözüme genel bakış</span><span class="sxs-lookup"><span data-stu-id="796b9-122">Solution Overview</span></span>

 <span data-ttu-id="796b9-123">İşlenmemiş özel durumları günlüğe kaydetmek ve işlemek için iki yeni kullanıcı tarafından değiştirilebilen hizmet, [ıexceptiongünlükçü](../releases/whats-new-in-aspnet-web-api-21.md) ve ıexceptionhandler sağlıyoruz.</span><span class="sxs-lookup"><span data-stu-id="796b9-123">We provide two new user-replaceable services, [IExceptionLogger](../releases/whats-new-in-aspnet-web-api-21.md) and IExceptionHandler, to log and handle unhandled exceptions.</span></span> <span data-ttu-id="796b9-124">Hizmetler, iki temel fark ile çok benzerdir:</span><span class="sxs-lookup"><span data-stu-id="796b9-124">The services are very similar, with two main differences:</span></span>

1. <span data-ttu-id="796b9-125">Birden çok özel durum Logger kaydını ancak yalnızca tek bir özel durum işleyicisini kaydetmeyi destekliyoruz.</span><span class="sxs-lookup"><span data-stu-id="796b9-125">We support registering multiple exception loggers but only a single exception handler.</span></span>
2. <span data-ttu-id="796b9-126">Bağlantıyı durdurmak üzere yaptığımız halde, her zaman özel durum Günlükçüler çağırılır.</span><span class="sxs-lookup"><span data-stu-id="796b9-126">Exception loggers always get called, even if we're about to abort the connection.</span></span> <span data-ttu-id="796b9-127">Özel durum işleyicileri yalnızca hangi yanıt iletisini gönderileceğini seçebildiğimiz zaman çağrılabilir.</span><span class="sxs-lookup"><span data-stu-id="796b9-127">Exception handlers only get called when we're still able to choose which response message to send.</span></span>

<span data-ttu-id="796b9-128">Her iki hizmet de özel durumun algılandığı noktadan ilgili bilgileri içeren bir özel durum bağlamına erişim sağlar, özellikle [HttpRequestMessage](https://msdn.microsoft.com/library/system.net.http.httprequestmessage(v=vs.110).aspx), [httprequestcontext](https://msdn.microsoft.com/library/system.web.http.controllers.httprequestcontext(v=vs.118).aspx), oluşturulan özel durum ve özel durum kaynağıdır (Ayrıntılar aşağıda verilmiştir).</span><span class="sxs-lookup"><span data-stu-id="796b9-128">Both services provide access to an exception context containing relevant information from the point where the exception was detected, particularly the [HttpRequestMessage](https://msdn.microsoft.com/library/system.net.http.httprequestmessage(v=vs.110).aspx), the [HttpRequestContext](https://msdn.microsoft.com/library/system.web.http.controllers.httprequestcontext(v=vs.118).aspx), the thrown exception and the exception source (details below).</span></span>

### <a name="design-principles"></a><span data-ttu-id="796b9-129">Tasarım İlkeleri</span><span class="sxs-lookup"><span data-stu-id="796b9-129">Design Principles</span></span>

1. <span data-ttu-id="796b9-130">**Son değişiklik yok** Bu işlevsellik küçük bir yayına eklendiğinden, çözümü etkileyen önemli bir kısıtlama, sözleşmelerin veya davranışın tür olarak hiçbir değişiklik oluşturmamasından kaynaklanır.</span><span class="sxs-lookup"><span data-stu-id="796b9-130">**No breaking changes** Because this functionality is being added in a minor release, one important constraint impacting the solution is that there be no breaking changes, either to type contracts or to behavior.</span></span> <span data-ttu-id="796b9-131">Bu kısıtlama, özel durumları 500 yanıtlarına dönüştürmek üzere mevcut catch blokları açısından yapmak istediğimiz bazı temizleme işlemleri için yok.</span><span class="sxs-lookup"><span data-stu-id="796b9-131">This constraint ruled out some cleanup we would like to have done in terms of existing catch blocks turning exceptions into 500 responses.</span></span> <span data-ttu-id="796b9-132">Bu ek temizlik, sonraki büyük bir sürüm için düşünebileceğiniz bir şeydir.</span><span class="sxs-lookup"><span data-stu-id="796b9-132">This additional cleanup is something we might consider for a subsequent major release.</span></span> <span data-ttu-id="796b9-133">Bu sizin için önemliyse lütfen [ASP.NET Web API Kullanıcı sessiyle](http://aspnet.uservoice.com/forums/147201-asp-net-web-api/suggestions/5451321-add-flag-to-enable-iexceptionlogger-and-iexception)oylayın.</span><span class="sxs-lookup"><span data-stu-id="796b9-133">If this is important to you please vote on it at [ASP.NET Web API user voice](http://aspnet.uservoice.com/forums/147201-asp-net-web-api/suggestions/5451321-add-flag-to-enable-iexceptionlogger-and-iexception).</span></span>
2. <span data-ttu-id="796b9-134">**Web API yapıları ile tutarlılığı sağlama** Web API 'sinin filtre işlem hattı, bir eyleme özgü, denetleyiciye özgü veya genel kapsamda mantığı uygulama esnekliğiyle birlikte çapraz kesme sorunlarını işlemenin harika bir yoludur.</span><span class="sxs-lookup"><span data-stu-id="796b9-134">**Maintaining consistency with Web API constructs** Web API's filter pipeline is a great way to handle cross-cutting concerns with the flexibility of applying the logic at an action-specific, controller-specific or global scope.</span></span> <span data-ttu-id="796b9-135">Özel durum filtreleri dahil olmak üzere filtreler, genel kapsamda kayıtlı olduğunda bile her zaman eylem ve denetleyici bağlamlarına sahiptir.</span><span class="sxs-lookup"><span data-stu-id="796b9-135">Filters, including exception filters, always have action and controller contexts, even when registered at the global scope.</span></span> <span data-ttu-id="796b9-136">Bu sözleşme, filtreler için anlamlı hale getirir, ancak genel kapsamlı bir şekilde özel durum filtrelerinin, hiçbir eylem veya denetleyici bağlamı mevcut olmayan ileti işleyicilerinden özel durumlar gibi bazı özel durum işleme durumlarında iyi bir uyum olmayacağı anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="796b9-136">That contract makes sense for filters, but it means that exception filters, even globally scoped ones, aren't a good fit for some exception handling cases, such as exceptions from message handlers, where no action or controller context exists.</span></span> <span data-ttu-id="796b9-137">Özel durum işleme için filtreler tarafından sağlanan esnek kapsamları kullanmak istiyoruz, hala özel durum filtreleri gerekir.</span><span class="sxs-lookup"><span data-stu-id="796b9-137">If we want to use the flexible scoping afforded by filters for exception handling, we still need exception filters.</span></span> <span data-ttu-id="796b9-138">Ancak, bir denetleyici bağlamı dışında özel durum işlememiz gerekiyorsa, tam genel hata işleme (denetleyici bağlamı ve eylem bağlamı kısıtlamaları olmadan bir şey) için ayrı bir yapı da gerekir.</span><span class="sxs-lookup"><span data-stu-id="796b9-138">But if we need to handle exception outside of a controller context, we also need a separate construct for full global error handling (something without the controller context and action context constraints).</span></span>

### <a name="when-to-use"></a><span data-ttu-id="796b9-139">Ne zaman kullanılır?</span><span class="sxs-lookup"><span data-stu-id="796b9-139">When to Use</span></span>

- <span data-ttu-id="796b9-140">Özel durum Günlükçüler, Web API 'SI tarafından yakalanan işlenmemiş özel durumu görmek için çözümdür.</span><span class="sxs-lookup"><span data-stu-id="796b9-140">Exception loggers are the solution to seeing all unhandled exception caught by Web API.</span></span>
- <span data-ttu-id="796b9-141">Özel durum işleyicileri, Web API tarafından yakalanan işlenmemiş özel durumlara yönelik tüm olası yanıtları özelleştirmeye yönelik çözümdür.</span><span class="sxs-lookup"><span data-stu-id="796b9-141">Exception handlers are the solution for customizing all possible responses to unhandled exceptions caught by Web API.</span></span>
- <span data-ttu-id="796b9-142">Özel durum filtreleri, belirli bir eylem veya denetleyiciyle ilgili alt küme işlenmemiş özel durumları işlemeye yönelik en kolay çözümdür.</span><span class="sxs-lookup"><span data-stu-id="796b9-142">Exception filters are the easiest solution for processing the subset unhandled exceptions related to a specific action or controller.</span></span>

### <a name="service-details"></a><span data-ttu-id="796b9-143">Hizmet Ayrıntıları</span><span class="sxs-lookup"><span data-stu-id="796b9-143">Service Details</span></span>

 <span data-ttu-id="796b9-144">Özel durum günlükçüsü ve işleyici hizmeti arabirimleri, ilgili bağlamlara sahip basit zaman uyumsuz yöntemlerdir:</span><span class="sxs-lookup"><span data-stu-id="796b9-144">The exception logger and handler service interfaces are simple async methods taking the respective contexts:</span></span> 

[!code-csharp[Main](web-api-global-error-handling/samples/sample2.cs)]

 <span data-ttu-id="796b9-145">Ayrıca, bu arabirimlerin her ikisi için de temel sınıflar sunuyoruz.</span><span class="sxs-lookup"><span data-stu-id="796b9-145">We also provide base classes for both of these interfaces.</span></span> <span data-ttu-id="796b9-146">Çekirdek (eşitleme veya zaman uyumsuz) yöntemlerinin geçersiz kılınması önerilen zamanlarda günlüğe kaydetmek veya işlemek için gereklidir.</span><span class="sxs-lookup"><span data-stu-id="796b9-146">Overriding the core (sync or async) methods is all that is required to log or handle at the recommended times.</span></span> <span data-ttu-id="796b9-147">Günlük kaydı için `ExceptionLogger` temel sınıfı, çekirdek günlük yönteminin her bir özel durum için yalnızca bir kez çağrıldığından emin olur (daha sonra çağrı yığınını yayıp yeniden yakalansa bile).</span><span class="sxs-lookup"><span data-stu-id="796b9-147">For logging, the `ExceptionLogger` base class will ensure that the core logging method is only called once for each exception (even if it later propagates further up the call stack and is caught again).</span></span> <span data-ttu-id="796b9-148">`ExceptionHandler` temel sınıfı, yalnızca çağrı yığınının en üstündeki özel durumlar için, eski iç içe geçmiş catch bloklarını yoksayarak çekirdek işleme yöntemini çağırır.</span><span class="sxs-lookup"><span data-stu-id="796b9-148">The `ExceptionHandler` base class will call the core handling method only for exceptions at the top of the call stack, ignoring legacy nested catch blocks.</span></span> <span data-ttu-id="796b9-149">(Bu temel sınıfların Basitleştirilmiş sürümleri aşağıdaki ekte bulunur.) Hem `IExceptionLogger` hem de `IExceptionHandler`, bir `ExceptionContext`aracılığıyla özel durum hakkında bilgi alır.</span><span class="sxs-lookup"><span data-stu-id="796b9-149">(Simplified versions of these base classes are in the appendix below.) Both `IExceptionLogger` and `IExceptionHandler` receive information about the exception via an `ExceptionContext`.</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample3.cs)]

<span data-ttu-id="796b9-150">Çerçeve bir özel durum günlükçüsü veya bir özel durum işleyicisi çağırdığında, her zaman bir `Exception` ve `Request`sağlar.</span><span class="sxs-lookup"><span data-stu-id="796b9-150">When the framework calls an exception logger or an exception handler, it will always provide an `Exception` and a `Request`.</span></span> <span data-ttu-id="796b9-151">Birim testi haricinde, her zaman `RequestContext`de sağlar.</span><span class="sxs-lookup"><span data-stu-id="796b9-151">Except for unit testing, it will also always provide a `RequestContext`.</span></span> <span data-ttu-id="796b9-152">Nadiren `ControllerContext` ve `ActionContext` (yalnızca özel durum filtreleri için catch bloğundan çağrılırken) sağlar.</span><span class="sxs-lookup"><span data-stu-id="796b9-152">It will rarely provide a `ControllerContext` and `ActionContext` (only when calling from the catch block for exception filters).</span></span> <span data-ttu-id="796b9-153">Daha seyrek bir `Response`(yalnızca yanıtı yazmaya çalışırken bazı IIS durumlarında) sağlar.</span><span class="sxs-lookup"><span data-stu-id="796b9-153">It will very rarely provide a `Response`(only in certain IIS cases when in the middle of trying to write the response).</span></span> <span data-ttu-id="796b9-154">Bu özelliklerden bazıları `null`, özel durum sınıfının üyelerine erişmeden önce `null` denetlemek için tüketiciye ait olduğunu unutmayın.`CatchBlock`</span><span class="sxs-lookup"><span data-stu-id="796b9-154">Note that because some of these properties may be `null` it is up to the consumer to check for `null` before accessing members of the exception class.`CatchBlock`</span></span> <span data-ttu-id="796b9-155">, özel durumu hangi catch bloğunun gördüğünüzü belirten bir dizedir.</span><span class="sxs-lookup"><span data-stu-id="796b9-155">is a string indicating which catch block saw the exception.</span></span> <span data-ttu-id="796b9-156">Catch bloğu dizeleri aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="796b9-156">The catch block strings are as follows:</span></span>

- <span data-ttu-id="796b9-157">HttpServer (Sendadsync yöntemi)</span><span class="sxs-lookup"><span data-stu-id="796b9-157">HttpServer (SendAsync method)</span></span>
- <span data-ttu-id="796b9-158">HttpControllerDispatcher (Sendadsync yöntemi)</span><span class="sxs-lookup"><span data-stu-id="796b9-158">HttpControllerDispatcher (SendAsync method)</span></span>
- <span data-ttu-id="796b9-159">HttpBatchHandler (Sendadsync yöntemi)</span><span class="sxs-lookup"><span data-stu-id="796b9-159">HttpBatchHandler (SendAsync method)</span></span>
- <span data-ttu-id="796b9-160">IExceptionFilter (ApiController 'in ExecuteAsync içindeki özel durum filtresi işlem hattının işlenmesi)</span><span class="sxs-lookup"><span data-stu-id="796b9-160">IExceptionFilter (ApiController's processing of the exception filter pipeline in ExecuteAsync)</span></span>
- <span data-ttu-id="796b9-161">OWıN Konağı:</span><span class="sxs-lookup"><span data-stu-id="796b9-161">OWIN host:</span></span>

    - <span data-ttu-id="796b9-162">HttpMessageHandlerAdapter. BufferResponseContentAsync (Çıktıyı arabelleğe almak için)</span><span class="sxs-lookup"><span data-stu-id="796b9-162">HttpMessageHandlerAdapter.BufferResponseContentAsync (for buffering output)</span></span>
    - <span data-ttu-id="796b9-163">HttpMessageHandlerAdapter. CopyResponseContentAsync (akış çıktısı için)</span><span class="sxs-lookup"><span data-stu-id="796b9-163">HttpMessageHandlerAdapter.CopyResponseContentAsync (for streaming output)</span></span>
- <span data-ttu-id="796b9-164">Web ana bilgisayarı:</span><span class="sxs-lookup"><span data-stu-id="796b9-164">Web host:</span></span>

    - <span data-ttu-id="796b9-165">HttpControllerHandler.WriteBufferedResponseContentAsync (for buffering output)</span><span class="sxs-lookup"><span data-stu-id="796b9-165">HttpControllerHandler.WriteBufferedResponseContentAsync (for buffering output)</span></span>
    - <span data-ttu-id="796b9-166">HttpControllerHandler. WriteStreamedResponseContentAsync (akış çıktısı için)</span><span class="sxs-lookup"><span data-stu-id="796b9-166">HttpControllerHandler.WriteStreamedResponseContentAsync (for streaming output)</span></span>
    - <span data-ttu-id="796b9-167">HttpControllerHandler. WriteErrorResponseContentAsync (arabelleğe alınan çıkış modu altında hata kurtarmasında hatalar için)</span><span class="sxs-lookup"><span data-stu-id="796b9-167">HttpControllerHandler.WriteErrorResponseContentAsync (for failures in error recovery under buffered output mode)</span></span>

<span data-ttu-id="796b9-168">Catch bloğu dizelerinin listesi statik salt okunur özellikler aracılığıyla da kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="796b9-168">The list of catch block strings is also available via static readonly properties.</span></span> <span data-ttu-id="796b9-169">(Temel catch blok dizesi, statik Exceptioncatchblokları üzerinde yer alır; kalanı OWıN ve Web ana makinesi için bir statik sınıfta görünür.`IsTopLevelCatchBlock`</span><span class="sxs-lookup"><span data-stu-id="796b9-169">(The core catch block string are on the static ExceptionCatchBlocks; the remainder appear on one static class each for OWIN and web host).`IsTopLevelCatchBlock`</span></span> <span data-ttu-id="796b9-170">Yalnızca çağrı yığınının en üstünde özel durumları işlemek için önerilen kalıbı takip etmek için yararlıdır.</span><span class="sxs-lookup"><span data-stu-id="796b9-170">is helpful for following the recommended pattern of handling exceptions only at the top of the call stack.</span></span> <span data-ttu-id="796b9-171">İç içe geçmiş bir catch bloğunun gerçekleştiği her yerde özel durumları 500 yanıtlara dönüştürmek yerine, bir özel durum işleyicisi, ana bilgisayar tarafından görülene kadar özel durumların yayılmasına izin verebilir.</span><span class="sxs-lookup"><span data-stu-id="796b9-171">Rather than turning exceptions into 500 responses anywhere a nested catch block occurs, an exception handler can let exceptions propagate until they are about to be seen by the host.</span></span>

<span data-ttu-id="796b9-172">`ExceptionContext`ek olarak, bir günlükçü tam `ExceptionLoggerContext`bir bilgi parçasını alır:</span><span class="sxs-lookup"><span data-stu-id="796b9-172">In addition to the `ExceptionContext`, a logger gets one more piece of information via the full `ExceptionLoggerContext`:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample4.cs)]

<span data-ttu-id="796b9-173">`CanBeHandled`ikinci özelliği, bir günlükçü 'nin işlenmemiş bir özel durumu belirlemesine izin verir.</span><span class="sxs-lookup"><span data-stu-id="796b9-173">The second property, `CanBeHandled`, allows a logger to identify an exception that cannot be handled.</span></span> <span data-ttu-id="796b9-174">Bağlantı durdurulmak üzereyken ve yeni yanıt iletisi ***gönderilemezse,*** Günlükçüler çağrılır, ancak işleyici çağrılmaz ve Günlükçüler bu senaryoyu bu özellikten tanımlayabilir.</span><span class="sxs-lookup"><span data-stu-id="796b9-174">When the connection is about to be aborted and no new response message can be sent, the loggers will be called but the handler will ***not*** be called, and the loggers can identify this scenario from this property.</span></span>

<span data-ttu-id="796b9-175">`ExceptionContext`ek olarak, işleyici özel durumu işlemek için tam `ExceptionHandlerContext` ayarlayabileceği bir daha fazla özellik alır:</span><span class="sxs-lookup"><span data-stu-id="796b9-175">In additional to the `ExceptionContext`, a handler gets one more property it can set on the full `ExceptionHandlerContext` to handle the exception:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample5.cs)]

<span data-ttu-id="796b9-176">Bir özel durum işleyicisi, `Result` özelliğini bir eylem sonucuna (örneğin, bir [Exceptionresult](https://msdn.microsoft.com/library/system.web.http.results.exceptionresult(v=vs.118).aspx), [ınternalservererrorresult](https://msdn.microsoft.com/library/system.web.http.results.internalservererrorresult(v=vs.118).aspx), [statuscoderesult](https://msdn.microsoft.com/library/system.web.http.results.statuscoderesult(v=vs.118).aspx)veya özel bir sonuç) ayarlayarak bir özel durum işlediğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="796b9-176">An exception handler indicates that it has handled an exception by setting the `Result` property to an action result (for example, an [ExceptionResult](https://msdn.microsoft.com/library/system.web.http.results.exceptionresult(v=vs.118).aspx), [InternalServerErrorResult](https://msdn.microsoft.com/library/system.web.http.results.internalservererrorresult(v=vs.118).aspx), [StatusCodeResult](https://msdn.microsoft.com/library/system.web.http.results.statuscoderesult(v=vs.118).aspx), or a custom result).</span></span> <span data-ttu-id="796b9-177">`Result` özelliği null ise, özel durum işlenmeyecektir ve özgün özel durum yeniden oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="796b9-177">If the `Result` property is null, the exception is unhandled and the original exception will be re-thrown.</span></span>

<span data-ttu-id="796b9-178">Çağrı yığınının en üstündeki özel durumlar için, yanıtın API çağıranları için uygun olduğundan emin olmak için ek bir adım sunuyoruz.</span><span class="sxs-lookup"><span data-stu-id="796b9-178">For exceptions at the top of the call stack, we took an extra step to ensure the response is appropriate for API callers.</span></span> <span data-ttu-id="796b9-179">Özel durum konağa yayırsa, çağıran, genellikle uygun bir API hata yanıtı değil, genellikle HTML olan veya başka bir ana bilgisayar tarafından sunulan yanıtın sarı ekranını görür.</span><span class="sxs-lookup"><span data-stu-id="796b9-179">If the exception propagates up to the host, the caller would see the yellow screen of death or some other host provided response which is typically HTML and not usually an appropriate API error response.</span></span> <span data-ttu-id="796b9-180">Bu durumlarda, sonuç null olmayan bir şekilde başlar ve yalnızca özel bir özel durum işleyicisi `null` (işlenmemiş) olarak geri ayarlanırsa özel durum konağa yayılır.</span><span class="sxs-lookup"><span data-stu-id="796b9-180">In these cases, the Result starts out non-null, and only if a custom exception handler explicitly sets it back to `null` (unhandled) will the exception propagate to the host.</span></span> <span data-ttu-id="796b9-181">Bu tür durumlarda `null` için `Result` ayarlama iki senaryo için yararlı olabilir:</span><span class="sxs-lookup"><span data-stu-id="796b9-181">Setting `Result` to `null` in such cases can be useful for two scenarios:</span></span>

1. <span data-ttu-id="796b9-182">Web API 'SI öncesinde/dışında kaydedilmiş özel durum işleme ara yazılımı ile OWıN barındırılan Web API 'SI.</span><span class="sxs-lookup"><span data-stu-id="796b9-182">OWIN hosted Web API with custom exception handling middleware registered before/outside Web API.</span></span>
2. <span data-ttu-id="796b9-183">Bir tarayıcı aracılığıyla yerel hata ayıklama, sarı ekranın, işlenmemiş bir özel durum için yararlı bir yanıt olması durumunda.</span><span class="sxs-lookup"><span data-stu-id="796b9-183">Local debugging via a browser, where the yellow screen of death is actually a helpful response for an unhandled exception.</span></span>

<span data-ttu-id="796b9-184">Hem özel durum Günlükçüler hem de özel durum işleyicileri için, günlükçü veya işleyicinin kendisi bir özel durum oluşturursa kurtarılacak hiçbir şey yapmayız.</span><span class="sxs-lookup"><span data-stu-id="796b9-184">For both exception loggers and exception handlers, we don't do anything to recover if the logger or handler itself throws an exception.</span></span> <span data-ttu-id="796b9-185">(Özel durum yaymaya izin verme dışında, daha iyi bir yaklaşım varsa, bu sayfanın en altında geri bildirim bırakın.) Özel durum Günlükçüler ve işleyiciler için sözleşme, özel durumların arayanlara yaymasına izin vermemelidir; Aksi takdirde, özel durum, genellikle ana bilgisayar için bir HTML hatasına (ASP gibi) neden olacak şekilde yayılır. NET 'in sarı ekran) istemciye geri gönderilmekte (genellikle JSON veya XML bekleniyor API çağıranları için tercih edilen seçenek değildir).</span><span class="sxs-lookup"><span data-stu-id="796b9-185">(Other than letting the exception propagate, leave feedback at the bottom of this page if you have a better approach.) The contract for exception loggers and handlers is that they should not let exceptions propagate up to their callers; otherwise, the exception will just propagate, often all the way to the host resulting in an HTML error (like the ASP.NET's yellow screen) being sent back to the client (which usually isn't the preferred option for API callers that expect JSON or XML).</span></span>

## <a name="examples"></a><span data-ttu-id="796b9-186">Örnekler</span><span class="sxs-lookup"><span data-stu-id="796b9-186">Examples</span></span>

### <a name="tracing-exception-logger"></a><span data-ttu-id="796b9-187">İzleme özel durum günlükçüsü</span><span class="sxs-lookup"><span data-stu-id="796b9-187">Tracing Exception Logger</span></span>

<span data-ttu-id="796b9-188">Aşağıdaki özel durum günlükçüsü, yapılandırılmış Izleme kaynaklarına özel durum verileri gönderir (Visual Studio 'daki hata ayıklama çıktısı penceresi dahil).</span><span class="sxs-lookup"><span data-stu-id="796b9-188">The exception logger below send exception data to configured Trace sources (including the Debug output window in Visual Studio).</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample6.cs)]

### <a name="custom-error-message-exception-handler"></a><span data-ttu-id="796b9-189">Özel hata Iletisi özel durum Işleyicisi</span><span class="sxs-lookup"><span data-stu-id="796b9-189">Custom Error Message Exception Handler</span></span>

<span data-ttu-id="796b9-190">Aşağıda, desteğe bağlanmaya yönelik bir e-posta adresi de dahil olmak üzere istemcilere özel bir hata yanıtı verilmiştir.</span><span class="sxs-lookup"><span data-stu-id="796b9-190">The following below produces a custom error response to clients, including an email address for contacting support.</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample7.cs)]

## <a name="registering-exception-filters"></a><span data-ttu-id="796b9-191">Özel durum filtrelerini kaydetme</span><span class="sxs-lookup"><span data-stu-id="796b9-191">Registering Exception Filters</span></span>

<span data-ttu-id="796b9-192">Projenizi oluşturmak için "ASP.NET MVC 4 Web uygulaması" proje şablonunu kullanırsanız, Web API yapılandırma kodunuzu *uygulama/_Start* klasörüne `WebApiConfig` sınıfına koyun:</span><span class="sxs-lookup"><span data-stu-id="796b9-192">If you use the "ASP.NET MVC 4 Web Application" project template to create your project, put your Web API configuration code inside the `WebApiConfig` class, in the *App/_Start* folder:</span></span>

[!code-csharp[Main](exception-handling/samples/sample7.cs?highlight=5)]

## <a name="appendix-base-class-details"></a><span data-ttu-id="796b9-193">Ek: temel sınıf ayrıntıları</span><span class="sxs-lookup"><span data-stu-id="796b9-193">Appendix: Base Class Details</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample8.cs)]
