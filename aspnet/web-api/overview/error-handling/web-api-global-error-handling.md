---
uid: web-api/overview/error-handling/web-api-global-error-handling
title: Genel hata işleme ASP.NET Web API 2 - ASP.NET 4.x
author: davidmatson
description: Genel hata ASP.NET Web API 2'de ASP.NET için işleme genel bir bakış 4.x.
ms.author: riande
ms.date: 02/03/2014
ms.custom: seoapril2019
ms.assetid: bffd7863-f63b-4b23-a13c-372b5492e9fb
msc.legacyurl: /web-api/overview/error-handling/web-api-global-error-handling
msc.type: authoredcontent
ms.openlocfilehash: 7d9f4fb9909671d7c4c8ee2aa9285b0186c4b125
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/09/2019
ms.locfileid: "59414380"
---
# <a name="global-error-handling-in-aspnet-web-api-2"></a><span data-ttu-id="7b4a1-103">ASP.NET Web API 2 genel hata işleme</span><span class="sxs-lookup"><span data-stu-id="7b4a1-103">Global Error Handling in ASP.NET Web API 2</span></span>

<span data-ttu-id="7b4a1-104">tarafından [David Matson](https://github.com/davidmatson), [Rick Anderson]((https://twitter.com/RickAndMSFT))</span><span class="sxs-lookup"><span data-stu-id="7b4a1-104">by [David Matson](https://github.com/davidmatson), [Rick Anderson]((https://twitter.com/RickAndMSFT))</span></span>

<span data-ttu-id="7b4a1-105">Bu konu, genel hata ASP.NET Web API 2'de ASP.NET için işleme genel bir bakış sağlar. 4.x.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-105">This topic provides an overview of global error handling in ASP.NET Web API 2 for ASP.NET 4.x.</span></span> <span data-ttu-id="7b4a1-106">Bugün oturum veya genel olarak, hataları işlemek için Web API'SİNDE kolay bir yolu yoktur.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-106">Today there's no easy way in Web API to log or handle errors globally.</span></span> <span data-ttu-id="7b4a1-107">Bazı işlenmeyen özel durumlar aracılığıyla işlenen [özel durum filtreleri](exception-handling.md), vardır, ancak bir özel durum filtreleri işleyemiyor çalışması sayısı.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-107">Some unhandled exceptions can be processed via [exception filters](exception-handling.md), but there are a number of cases that exception filters can't handle.</span></span> <span data-ttu-id="7b4a1-108">Örneğin:</span><span class="sxs-lookup"><span data-stu-id="7b4a1-108">For example:</span></span>

1. <span data-ttu-id="7b4a1-109">Denetleyici oluşturucular oluşturulan bir özel durumlar.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-109">Exceptions thrown from controller constructors.</span></span>
2. <span data-ttu-id="7b4a1-110">İleti işleyicilerini oluşturulan bir özel durumlar.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-110">Exceptions thrown from message handlers.</span></span>
3. <span data-ttu-id="7b4a1-111">Yönlendirme sırasında oluşturulan özel durumlar.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-111">Exceptions thrown during routing.</span></span>
4. <span data-ttu-id="7b4a1-112">Yanıt içeriği seri hale getirme sırasında oluşturulan bir özel durumlar.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-112">Exceptions thrown during response content serialization .</span></span>

<span data-ttu-id="7b4a1-113">Oturum ve (mümkünse) işlemek için basit ve tutarlı bir yol sağlamak üzere istiyoruz bu özel durumlar.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-113">We want to provide a simple, consistent way to log and handle (where possible) these exceptions.</span></span> 

<span data-ttu-id="7b4a1-114">Özel durumları, burada bir hata yanıtı gönderebilmesi için duyuyoruz ve burada tüm yapabiliriz çalışması günlük özel durum işleme için iki ana durumlar vardır.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-114">There are two major cases for handling exceptions, the case where we are able to send an error response and the case where all we can do is log the exception.</span></span> <span data-ttu-id="7b4a1-115">İkinci durumda örneğin yanıt içeriği akış ortasında bir özel durum olduğunda; Bu durumda bu çok geç biz yalnızca bağlantı durdurmak için durum kodu, üst bilgiler ve kısmi içerik zaten kablo sahiplikten bu yana yeni bir yanıt iletisi göndermektir.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-115">An example for the latter case is when an exception is thrown in the middle of streaming response content; in that case it is too late to send a new response message since the status code, headers, and partial content have already gone across the wire, so we simply abort the connection.</span></span> <span data-ttu-id="7b4a1-116">Özel durum, yeni bir yanıt iletisi oluşturmak üzere işlenemez olsa da, özel durum günlüğe kaydetme yine de destekliyoruz.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-116">Even though the exception can't be handled to produce a new response message, we still support logging the exception.</span></span> <span data-ttu-id="7b4a1-117">Burada bir hata saptanabilir durumlarda, aşağıda gösterildiği gibi biz bir uygun hata yanıtı döndürebilir:</span><span class="sxs-lookup"><span data-stu-id="7b4a1-117">In cases where we can detect an error, we can return an appropriate error response as shown in the following:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample1.cs?highlight=6)]

### <a name="existing-options"></a><span data-ttu-id="7b4a1-118">Mevcut seçenekleri</span><span class="sxs-lookup"><span data-stu-id="7b4a1-118">Existing Options</span></span>

<span data-ttu-id="7b4a1-119">Ek olarak [özel durum filtreleri](exception-handling.md), [ileti işleyicileri](../advanced/http-message-handlers.md) tüm 500 düzeyi yanıtları gözlemlemek için hemen kullanılabilir ancak bunlar bu orjinal hatayı hakkında bağlam bulunmadığından bu yanıtları almalarını zor.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-119">In addition to [exception filters](exception-handling.md), [message handlers](../advanced/http-message-handlers.md) can be used today to observe all 500-level responses, but acting on those responses is difficult, as they lack context about the original error.</span></span> <span data-ttu-id="7b4a1-120">İleti işleyicileri bazı başa çıkabilir durumları ile ilgili özel durum filtreleri onunla aynı sınırlamalara sahiptir. Web API hata koşulları yakalar izleme altyapısına çalışırken izleme altyapısına tanılama amaçları içindir ve değil tasarlanmış veya üretim ortamlarında çalışan için uygun.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-120">Message handlers also have some of the same limitations as exception filters regarding the cases they can handle.While Web API does have tracing infrastructure that captures error conditions the tracing infrastructure is for diagnostics purposes and is not designed or suited for running in production environments.</span></span> <span data-ttu-id="7b4a1-121">Genel özel durum işleme ve günlüğe kaydetme, üretim sırasında çalıştırabilir ve var olan izleme çözümleriyle takılı Hizmetleri olmalıdır (örneğin, [ELMAH](https://code.google.com/p/elmah/) ).</span><span class="sxs-lookup"><span data-stu-id="7b4a1-121">Global exception handling and logging should be services that can run during production and be plugged into existing monitoring solutions (for example, [ELMAH](https://code.google.com/p/elmah/) ).</span></span>

### <a name="solution-overview"></a><span data-ttu-id="7b4a1-122">Çözüme genel bakış</span><span class="sxs-lookup"><span data-stu-id="7b4a1-122">Solution Overview</span></span>

 <span data-ttu-id="7b4a1-123">Kullanıcı tarafından değiştirilebilen bir iki yeni hizmet, sağladığımız [IExceptionLogger](../releases/whats-new-in-aspnet-web-api-21.md) ve IExceptionHandler, oturum ve işlenmeyen özel durumları işlemek için.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-123">We provide two new user-replaceable services, [IExceptionLogger](../releases/whats-new-in-aspnet-web-api-21.md) and IExceptionHandler, to log and handle unhandled exceptions.</span></span> <span data-ttu-id="7b4a1-124">Hizmetleri iki temel farklar ile çok benzer:</span><span class="sxs-lookup"><span data-stu-id="7b4a1-124">The services are very similar, with two main differences:</span></span>

1. <span data-ttu-id="7b4a1-125">Birden çok özel durum günlükçüleri ancak yalnızca bir tek özel durum işleyicisi kaydediliyor destekliyoruz.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-125">We support registering multiple exception loggers but only a single exception handler.</span></span>
2. <span data-ttu-id="7b4a1-126">İlgili bağlantıyı durdurma duyuyoruz bile özel durum günlükçüleri her zaman çağrılmadığı.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-126">Exception loggers always get called, even if we're about to abort the connection.</span></span> <span data-ttu-id="7b4a1-127">Size hangi yanıt iletisi göndermek için yine de seçebilir, özel durum işleyicileri yalnızca çağrılmadığı.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-127">Exception handlers only get called when we're still able to choose which response message to send.</span></span>

<span data-ttu-id="7b4a1-128">Her iki hizmet noktasından burada özel durum algılandı, ilgili bilgileri içeren bir özel durum bağlamı erişmeyi özellikle [HttpRequestMessage](https://msdn.microsoft.com/library/system.net.http.httprequestmessage(v=vs.110).aspx), [HttpRequestContext](https://msdn.microsoft.com/library/system.web.http.controllers.httprequestcontext(v=vs.118).aspx), özel durum ve özel durum kaynağı (Ayrıntılar aşağıda) oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-128">Both services provide access to an exception context containing relevant information from the point where the exception was detected, particularly the [HttpRequestMessage](https://msdn.microsoft.com/library/system.net.http.httprequestmessage(v=vs.110).aspx), the [HttpRequestContext](https://msdn.microsoft.com/library/system.web.http.controllers.httprequestcontext(v=vs.118).aspx), the thrown exception and the exception source (details below).</span></span>

### <a name="design-principles"></a><span data-ttu-id="7b4a1-129">Tasarım ilkeleri</span><span class="sxs-lookup"><span data-stu-id="7b4a1-129">Design Principles</span></span>

1. <span data-ttu-id="7b4a1-130">**Bozucu değişiklik** bu işlev bir alt yayın, bir çözüm etkileyen önemli kısıtlaması bozucu değişiklik, ya da sözleşme türü olması veya davranış eklendiğinden.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-130">**No breaking changes** Because this functionality is being added in a minor release, one important constraint impacting the solution is that there be no breaking changes, either to type contracts or to behavior.</span></span> <span data-ttu-id="7b4a1-131">Bu kısıtlama, 500 yanıt özel durumları kapatma mevcut catch blokları açısından yaptıktan istiyoruz biraz temizlik kullanıma çizgili.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-131">This constraint ruled out some cleanup we would like to have done in terms of existing catch blocks turning exceptions into 500 responses.</span></span> <span data-ttu-id="7b4a1-132">Bu ek temizleme biz için bir sonraki ana sürümüne ait düşünebilirsiniz şeydir.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-132">This additional cleanup is something we might consider for a subsequent major release.</span></span> <span data-ttu-id="7b4a1-133">Bu önemli ise, lütfen adresinden oylamak [ASP.NET Web API uservoice](http://aspnet.uservoice.com/forums/147201-asp-net-web-api/suggestions/5451321-add-flag-to-enable-iexceptionlogger-and-iexception).</span><span class="sxs-lookup"><span data-stu-id="7b4a1-133">If this is important to you please vote on it at [ASP.NET Web API user voice](http://aspnet.uservoice.com/forums/147201-asp-net-web-api/suggestions/5451321-add-flag-to-enable-iexceptionlogger-and-iexception).</span></span>
2. <span data-ttu-id="7b4a1-134">**Web API'si ile tutarlılığı sürdürmeye yapıları** Web API'SİNİN filtre ardışık düzen, uygulama mantığı bir özel eylem, denetleyici özel veya genel kapsamda esnekliğiyle geniş kapsamlı kritik konular işlemek için harika bir yoludur.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-134">**Maintaining consistency with Web API constructs** Web API's filter pipeline is a great way to handle cross-cutting concerns with the flexibility of applying the logic at an action-specific, controller-specific or global scope.</span></span> <span data-ttu-id="7b4a1-135">Özel durum filtreleri de dahil olmak üzere filtreleri, eylem ve denetleyici bağlamı, genel kapsamda kaydettiğinizde bile her zaman vardır.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-135">Filters, including exception filters, always have action and controller contexts, even when registered at the global scope.</span></span> <span data-ttu-id="7b4a1-136">Sözleşme filtreleri için anlamlıdır, ancak özel durum filtreleri, hatta kapsamı olanları bazı özel durumlarda, ileti işleyicileri, özel durumlar gibi hiçbir eylem veya denetleyici bağlamı nerede işleme uygun olmayan geldiğini var.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-136">That contract makes sense for filters, but it means that exception filters, even globally scoped ones, aren't a good fit for some exception handling cases, such as exceptions from message handlers, where no action or controller context exists.</span></span> <span data-ttu-id="7b4a1-137">Biz yine de biz özel durum işleme için filtreler tarafından gösterilen esnek kapsamı kullanmak istiyorsanız, özel durum filtreleri gerekir.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-137">If we want to use the flexible scoping afforded by filters for exception handling, we still need exception filters.</span></span> <span data-ttu-id="7b4a1-138">Ancak bir denetleyici bağlamı dışında özel durumu işlemek ihtiyacımız olursa da ayrı bir yapısı (bir şey denetleyici bağlamını ve eylem bağlamını kısıtlamaları olmadan) tam genel hata işleme için gerekiyor.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-138">But if we need to handle exception outside of a controller context, we also need a separate construct for full global error handling (something without the controller context and action context constraints).</span></span>

### <a name="when-to-use"></a><span data-ttu-id="7b4a1-139">Ne zaman kullanılır?</span><span class="sxs-lookup"><span data-stu-id="7b4a1-139">When to Use</span></span>

- <span data-ttu-id="7b4a1-140">Özel durum günlükçüleri, tüm işlenmemiş özel durum yakalandı Web API'si tarafından görmeye çözümdür.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-140">Exception loggers are the solution to seeing all unhandled exception caught by Web API.</span></span>
- <span data-ttu-id="7b4a1-141">Özel durum işleyicileri, Web API'si tarafından yakalanan işlenmemiş özel durumların tüm olası yanıtlarını özelleştirmek için bir çözüm sağlar.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-141">Exception handlers are the solution for customizing all possible responses to unhandled exceptions caught by Web API.</span></span>
- <span data-ttu-id="7b4a1-142">Özel durum filtreleri, belirli bir eylem veya Denetleyici ile ilişkili alt işlenmeyen özel durumları işleme için en kolay çözümdür.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-142">Exception filters are the easiest solution for processing the subset unhandled exceptions related to a specific action or controller.</span></span>

### <a name="service-details"></a><span data-ttu-id="7b4a1-143">Hizmet Ayrıntıları</span><span class="sxs-lookup"><span data-stu-id="7b4a1-143">Service Details</span></span>

 <span data-ttu-id="7b4a1-144">Özel durum günlükçüsü ve işleyici Hizmet Arabirimleri, ilgili içerikler alma basit bir zaman uyumsuz yöntemler şunlardır:</span><span class="sxs-lookup"><span data-stu-id="7b4a1-144">The exception logger and handler service interfaces are simple async methods taking the respective contexts:</span></span> 

[!code-csharp[Main](web-api-global-error-handling/samples/sample2.cs)]

 <span data-ttu-id="7b4a1-145">Ayrıca temel sınıflar hem de bu arabirimler sunuyoruz.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-145">We also provide base classes for both of these interfaces.</span></span> <span data-ttu-id="7b4a1-146">Çekirdek (eşitleme veya zaman uyumsuz) yöntemleri geçersiz kılarak, olduğundan oturum veya önerilen işlemek için gereken tüm saatler.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-146">Overriding the core (sync or async) methods is all that is required to log or handle at the recommended times.</span></span> <span data-ttu-id="7b4a1-147">Günlük kaydı için `ExceptionLogger` temel sınıf çekirdek günlük yöntemi yalnızca bir kez için her bir özel durum çağrıldığını sağlayabilirsiniz (daha sonra yayar bile daha fazla çağrı yığınında yukarı ve yeniden yakalanan).</span><span class="sxs-lookup"><span data-stu-id="7b4a1-147">For logging, the `ExceptionLogger` base class will ensure that the core logging method is only called once for each exception (even if it later propagates further up the call stack and is caught again).</span></span> <span data-ttu-id="7b4a1-148">`ExceptionHandler` Temel sınıf yöntemi yalnızca özel durumlar iç içe geçmiş eski yoksayılıyor çağrı yığını üst kısmındaki catch blokları için işleme çekirdek çağıracaktır.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-148">The `ExceptionHandler` base class will call the core handling method only for exceptions at the top of the call stack, ignoring legacy nested catch blocks.</span></span> <span data-ttu-id="7b4a1-149">(Bu temel sınıfların Basitleştirilmiş sürümleri ekte içindir.) Her ikisi de `IExceptionLogger` ve `IExceptionHandler` özel durum hakkında bilgi alabileceği bir `ExceptionContext`.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-149">(Simplified versions of these base classes are in the appendix below.) Both `IExceptionLogger` and `IExceptionHandler` receive information about the exception via an `ExceptionContext`.</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample3.cs)]

<span data-ttu-id="7b4a1-150">Framework, bir özel durum günlükçüsü veya bir özel durum işleyicisi çağırdığında, her zaman sağlayacak bir `Exception` ve `Request`.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-150">When the framework calls an exception logger or an exception handler, it will always provide an `Exception` and a `Request`.</span></span> <span data-ttu-id="7b4a1-151">Birim testi dışında bu da her zaman sağlayacak bir `RequestContext`.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-151">Except for unit testing, it will also always provide a `RequestContext`.</span></span> <span data-ttu-id="7b4a1-152">Nadiren sağlayacak bir `ControllerContext` ve `ActionContext` (yalnızca catch bloğundan için özel durum filtreleri çağırırken).</span><span class="sxs-lookup"><span data-stu-id="7b4a1-152">It will rarely provide a `ControllerContext` and `ActionContext` (only when calling from the catch block for exception filters).</span></span> <span data-ttu-id="7b4a1-153">Nadiren sağlayacak bir `Response`(bazı özel durumlarda yanıt yapılandırılmaya çalışılırken zaman ortasında yalnızca IIS).</span><span class="sxs-lookup"><span data-stu-id="7b4a1-153">It will very rarely provide a `Response`(only in certain IIS cases when in the middle of trying to write the response).</span></span> <span data-ttu-id="7b4a1-154">Bu özelliklerin bazıları olabileceğinden unutmayın `null` denetlemek için tüketici kadar olan `null` özel durum sınıfı üyeleri erişmeden önce.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-154">Note that because some of these properties may be `null` it is up to the consumer to check for `null` before accessing members of the exception class.</span></span>`CatchBlock` <span data-ttu-id="7b4a1-155">hangi yakalama bloğu özel durumu gördüğünüz gösteren bir dize.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-155">is a string indicating which catch block saw the exception.</span></span> <span data-ttu-id="7b4a1-156">Catch bloğu dizeleri aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="7b4a1-156">The catch block strings are as follows:</span></span>

- <span data-ttu-id="7b4a1-157">HttpServer (SendAsync yöntemi)</span><span class="sxs-lookup"><span data-stu-id="7b4a1-157">HttpServer (SendAsync method)</span></span>
- <span data-ttu-id="7b4a1-158">HttpControllerDispatcher (SendAsync yöntemi)</span><span class="sxs-lookup"><span data-stu-id="7b4a1-158">HttpControllerDispatcher (SendAsync method)</span></span>
- <span data-ttu-id="7b4a1-159">HttpBatchHandler (SendAsync yöntemi)</span><span class="sxs-lookup"><span data-stu-id="7b4a1-159">HttpBatchHandler (SendAsync method)</span></span>
- <span data-ttu-id="7b4a1-160">IExceptionFilter (özel durum filtre ardışık ExecuteAsync işlenmesini ApiController'ın)</span><span class="sxs-lookup"><span data-stu-id="7b4a1-160">IExceptionFilter (ApiController's processing of the exception filter pipeline in ExecuteAsync)</span></span>
- <span data-ttu-id="7b4a1-161">OWIN ana bilgisayarı:</span><span class="sxs-lookup"><span data-stu-id="7b4a1-161">OWIN host:</span></span>

    - <span data-ttu-id="7b4a1-162">(Çıkış arabelleği için) HttpMessageHandlerAdapter.BufferResponseContentAsync</span><span class="sxs-lookup"><span data-stu-id="7b4a1-162">HttpMessageHandlerAdapter.BufferResponseContentAsync (for buffering output)</span></span>
    - <span data-ttu-id="7b4a1-163">HttpMessageHandlerAdapter.CopyResponseContentAsync (için çıktı akışı)</span><span class="sxs-lookup"><span data-stu-id="7b4a1-163">HttpMessageHandlerAdapter.CopyResponseContentAsync (for streaming output)</span></span>
- <span data-ttu-id="7b4a1-164">Web ana bilgisayarı:</span><span class="sxs-lookup"><span data-stu-id="7b4a1-164">Web host:</span></span>

    - <span data-ttu-id="7b4a1-165">HttpControllerHandler.WriteBufferedResponseContentAsync (for buffering output)</span><span class="sxs-lookup"><span data-stu-id="7b4a1-165">HttpControllerHandler.WriteBufferedResponseContentAsync (for buffering output)</span></span>
    - <span data-ttu-id="7b4a1-166">HttpControllerHandler.WriteStreamedResponseContentAsync (için çıktı akışı)</span><span class="sxs-lookup"><span data-stu-id="7b4a1-166">HttpControllerHandler.WriteStreamedResponseContentAsync (for streaming output)</span></span>
    - <span data-ttu-id="7b4a1-167">HttpControllerHandler.WriteErrorResponseContentAsync (için arabelleğe alınan çıkış modu altında hata kurtarma hata)</span><span class="sxs-lookup"><span data-stu-id="7b4a1-167">HttpControllerHandler.WriteErrorResponseContentAsync (for failures in error recovery under buffered output mode)</span></span>

<span data-ttu-id="7b4a1-168">Catch bloğu dize listesi statik salt okunur özellikler de kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-168">The list of catch block strings is also available via static readonly properties.</span></span> <span data-ttu-id="7b4a1-169">(Çekirdek catch bloğu dize üzerinde statik ExceptionCatchBlocks; bir statik sınıftaki her OWIN ve web ana bilgisayar için kalan görünür).</span><span class="sxs-lookup"><span data-stu-id="7b4a1-169">(The core catch block string are on the static ExceptionCatchBlocks; the remainder appear on one static class each for OWIN and web host).</span></span>`IsTopLevelCatchBlock` <span data-ttu-id="7b4a1-170">yalnızca en üst çağrı yığınının özel durumları işlemenin önerilen Düzen izlemek için yararlıdır.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-170">is helpful for following the recommended pattern of handling exceptions only at the top of the call stack.</span></span> <span data-ttu-id="7b4a1-171">500 yanıt herhangi bir iç içe geçmiş catch bloğu gerçekleşir özel durumları açma yerine bir özel durum işleyicisi özel durumlar hakkında ana bilgisayar tarafından görülebilmesi için bunlar kabul edilene kadar yaymak izin verebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-171">Rather than turning exceptions into 500 responses anywhere a nested catch block occurs, an exception handler can let exceptions propagate until they are about to be seen by the host.</span></span>

<span data-ttu-id="7b4a1-172">Ek olarak `ExceptionContext`, tam bilgisini bir daha fazla parça günlükçüsü `ExceptionLoggerContext`:</span><span class="sxs-lookup"><span data-stu-id="7b4a1-172">In addition to the `ExceptionContext`, a logger gets one more piece of information via the full `ExceptionLoggerContext`:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample4.cs)]

<span data-ttu-id="7b4a1-173">İkinci özelliği `CanBeHandled`, işlenmeyen bir özel durum tanımlamak bir Günlükçü sağlar.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-173">The second property, `CanBeHandled`, allows a logger to identify an exception that cannot be handled.</span></span> <span data-ttu-id="7b4a1-174">Ne zaman durdurulmak bağlantı olduğu ve yeni yanıt iletisi gönderilebilir, günlükçüler çağrılır ancak işleyici olur ***değil*** çağrıldığında, ve bu özellik bu senaryoda günlükçüler tanımlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-174">When the connection is about to be aborted and no new response message can be sent, the loggers will be called but the handler will ***not*** be called, and the loggers can identify this scenario from this property.</span></span>

<span data-ttu-id="7b4a1-175">İçinde ek `ExceptionContext`, daha fazla özelliği tam üzerinde ayarlanmış bir işleyici alır `ExceptionHandlerContext` özel durumu işlemek için:</span><span class="sxs-lookup"><span data-stu-id="7b4a1-175">In additional to the `ExceptionContext`, a handler gets one more property it can set on the full `ExceptionHandlerContext` to handle the exception:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample5.cs)]

<span data-ttu-id="7b4a1-176">Özel durum işleyicisi, ayarlayarak bir özel durum işlediği gösterir `Result` eylem sonucunu özelliğini (örneğin, bir [ExceptionResult](https://msdn.microsoft.com/library/system.web.http.results.exceptionresult(v=vs.118).aspx), [InternalServerErrorResult](https://msdn.microsoft.com/library/system.web.http.results.internalservererrorresult(v=vs.118).aspx), [ StatusCodeResult](https://msdn.microsoft.com/library/system.web.http.results.statuscoderesult(v=vs.118).aspx), ya da özel bir sonuç).</span><span class="sxs-lookup"><span data-stu-id="7b4a1-176">An exception handler indicates that it has handled an exception by setting the `Result` property to an action result (for example, an [ExceptionResult](https://msdn.microsoft.com/library/system.web.http.results.exceptionresult(v=vs.118).aspx), [InternalServerErrorResult](https://msdn.microsoft.com/library/system.web.http.results.internalservererrorresult(v=vs.118).aspx), [StatusCodeResult](https://msdn.microsoft.com/library/system.web.http.results.statuscoderesult(v=vs.118).aspx), or a custom result).</span></span> <span data-ttu-id="7b4a1-177">Varsa `Result` özelliği null, özel durum işlenmemiş ve özgün özel durum yeniden oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-177">If the `Result` property is null, the exception is unhandled and the original exception will be re-thrown.</span></span>

<span data-ttu-id="7b4a1-178">Çağrı yığınının üst özel durumlar için yanıt API arayanlar için uygun olduğundan emin olmak için fazladan bir adım attık.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-178">For exceptions at the top of the call stack, we took an extra step to ensure the response is appropriate for API callers.</span></span> <span data-ttu-id="7b4a1-179">Özel durum barındırabilirsiniz yayılırsa çağıran Ölüm sarı ekran görür veya başka bir konak HTML genellikle olan yanıt ve genellikle uygun bir API hata yanıtı sağlanan.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-179">If the exception propagates up to the host, the caller would see the yellow screen of death or some other host provided response which is typically HTML and not usually an appropriate API error response.</span></span> <span data-ttu-id="7b4a1-180">Bu gibi durumlarda sonuç başlatır null olmayan ve yalnızca bir özel durum işleyicisi açıkça ayarlar tekrar `null` (işlenmemiş) özel durum ana bilgisayara yayılır.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-180">In these cases, the Result starts out non-null, and only if a custom exception handler explicitly sets it back to `null` (unhandled) will the exception propagate to the host.</span></span> <span data-ttu-id="7b4a1-181">Ayarı `Result` için `null` bu gibi durumlarda, iki senaryo için yararlı olabilir:</span><span class="sxs-lookup"><span data-stu-id="7b4a1-181">Setting `Result` to `null` in such cases can be useful for two scenarios:</span></span>

1. <span data-ttu-id="7b4a1-182">OWIN ara yazılımını Web API önce/dışında kayıtlı işleme özel durum ile Web API barındırılan.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-182">OWIN hosted Web API with custom exception handling middleware registered before/outside Web API.</span></span>
2. <span data-ttu-id="7b4a1-183">Yerel bir tarayıcı üzerinden hata ayıklama, burada sarı ölüm gerçekten işlenmeyen bir özel durum için yararlı bir yanıt ekrandır.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-183">Local debugging via a browser, where the yellow screen of death is actually a helpful response for an unhandled exception.</span></span>

<span data-ttu-id="7b4a1-184">Özel durum günlükçüleri ve özel durum işleyicileri için biz Günlükçü veya işleyicisi bir özel durum oluşturursa, kurtarılır hiçbir şey yapmaz.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-184">For both exception loggers and exception handlers, we don't do anything to recover if the logger or handler itself throws an exception.</span></span> <span data-ttu-id="7b4a1-185">(Yayar, bu sayfanın sonundaki geri tutulacaksa özel durum dışında daha iyi bir yaklaşım vardır.) Bunlar özel durumlar kadar Arayanların yayılmasına izin vermemeniz gerekir, özel durum günlükçüleri ve işleyici sözleşmesini olur; Aksi takdirde, özel durum yalnızca, genellikle tüm HTML hata (örneğin, ASP. Bunun sonucunda konağa yayılır NET sarı ekran) (Bu genellikle JSON veya XML API arayanlar için tercih edilen seçeneği değil) istemciye gönderilen.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-185">(Other than letting the exception propagate, leave feedback at the bottom of this page if you have a better approach.) The contract for exception loggers and handlers is that they should not let exceptions propagate up to their callers; otherwise, the exception will just propagate, often all the way to the host resulting in an HTML error (like the ASP.NET's yellow screen) being sent back to the client (which usually isn't the preferred option for API callers that expect JSON or XML).</span></span>

## <a name="examples"></a><span data-ttu-id="7b4a1-186">Örnekler</span><span class="sxs-lookup"><span data-stu-id="7b4a1-186">Examples</span></span>

### <a name="tracing-exception-logger"></a><span data-ttu-id="7b4a1-187">Özel durum günlükçüsü izleme</span><span class="sxs-lookup"><span data-stu-id="7b4a1-187">Tracing Exception Logger</span></span>

<span data-ttu-id="7b4a1-188">Aşağıdaki özel durum günlükçüsü (Visual Studio'da hata ayıklama çıktı penceresine dahil), yapılandırılmış izleme kaynakları için özel durum verileri gönderin.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-188">The exception logger below send exception data to configured Trace sources (including the Debug output window in Visual Studio).</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample6.cs)]

### <a name="custom-error-message-exception-handler"></a><span data-ttu-id="7b4a1-189">Özel hata iletisi özel durum işleyicisi</span><span class="sxs-lookup"><span data-stu-id="7b4a1-189">Custom Error Message Exception Handler</span></span>

<span data-ttu-id="7b4a1-190">Aşağıdaki istemciler için destek ile iletişim kurarak bir e-posta adresi de dahil olmak üzere, bir özel hata yanıtı oluşturur.</span><span class="sxs-lookup"><span data-stu-id="7b4a1-190">The following below produces a custom error response to clients, including an email address for contacting support.</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample7.cs)]

## <a name="registering-exception-filters"></a><span data-ttu-id="7b4a1-191">Özel durum filtreleri kaydediliyor</span><span class="sxs-lookup"><span data-stu-id="7b4a1-191">Registering Exception Filters</span></span>

<span data-ttu-id="7b4a1-192">Projenizi oluşturmak için "ASP.NET MVC 4 Web uygulaması" proje şablonunu kullanıyorsanız, Web API configuration kodunuzda gezebilirsiniz put `WebApiConfig` içinde sınıf *uygulama/_başlatmayı* klasörü:</span><span class="sxs-lookup"><span data-stu-id="7b4a1-192">If you use the "ASP.NET MVC 4 Web Application" project template to create your project, put your Web API configuration code inside the `WebApiConfig` class, in the *App/_Start* folder:</span></span>

[!code-csharp[Main](exception-handling/samples/sample7.cs?highlight=5)]

## <a name="appendix-base-class-details"></a><span data-ttu-id="7b4a1-193">Ek: Temel sınıf ayrıntıları</span><span class="sxs-lookup"><span data-stu-id="7b4a1-193">Appendix: Base Class Details</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample8.cs)]
