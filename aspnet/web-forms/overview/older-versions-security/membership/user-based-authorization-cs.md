---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-cs
title: Kullanıcı tabanlı yetkilendirme (C#) | Microsoft Docs
author: rick-anderson
description: Bu öğreticide, sayfaların erişimini sınırlandırma ve çeşitli teknikler aracılığıyla sayfa düzeyindeki işlevleri kısıtlama bölümüne bakacağız.
ms.author: riande
ms.date: 01/18/2008
ms.assetid: 3c815a9e-2296-4b9b-b945-776d54989daa
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-cs
msc.type: authoredcontent
ms.openlocfilehash: 059dbf42956268884dcfdade696491ac39e32da9
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78574342"
---
# <a name="user-based-authorization-c"></a><span data-ttu-id="acf66-103">Kullanıcı Tabanlı Yetkilendirme (C#)</span><span class="sxs-lookup"><span data-stu-id="acf66-103">User-Based Authorization (C#)</span></span>

<span data-ttu-id="acf66-104">[Scott Mitchell](https://twitter.com/ScottOnWriting) tarafından</span><span class="sxs-lookup"><span data-stu-id="acf66-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="acf66-105">[Kodu indirin](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_CS.zip) veya [PDF 'yi indirin](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="acf66-105">[Download Code](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_CS.zip) or [Download PDF](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_cs.pdf)</span></span>

> <span data-ttu-id="acf66-106">Bu öğreticide, sayfaların erişimini sınırlandırma ve çeşitli teknikler aracılığıyla sayfa düzeyindeki işlevleri kısıtlama bölümüne bakacağız.</span><span class="sxs-lookup"><span data-stu-id="acf66-106">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span>

## <a name="introduction"></a><span data-ttu-id="acf66-107">Giriş</span><span class="sxs-lookup"><span data-stu-id="acf66-107">Introduction</span></span>

<span data-ttu-id="acf66-108">Kullanıcı hesapları sunan çoğu Web uygulaması, bazı ziyaretçilerin site içindeki belirli sayfalara erişmesini kısıtlamak için bu bölümü bir parçası olarak sunar.</span><span class="sxs-lookup"><span data-stu-id="acf66-108">Most web applications that offer user accounts do so in part to restrict certain visitors from accessing certain pages within the site.</span></span> <span data-ttu-id="acf66-109">Çoğu çevrimiçi messageboard sitesinde, örneğin, anonim ve kimliği doğrulanmış tüm kullanıcılar, messagepanonun gönderilerini görüntüleyebilir, ancak yalnızca kimliği doğrulanmış kullanıcılar Web sayfasını ziyaret ederek yeni bir gönderi oluşturabilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-109">In most online messageboard sites, for example, all users - anonymous and authenticated - are able to view the messageboard's posts, but only authenticated users can visit the web page to create a new post.</span></span> <span data-ttu-id="acf66-110">Ve yalnızca belirli bir Kullanıcı (veya belirli bir kullanıcı kümesi) için erişilebilir olan Yönetim sayfaları olabilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-110">And there may be administrative pages that are only accessible to a particular user (or a particular set of users).</span></span> <span data-ttu-id="acf66-111">Üstelik, sayfa düzeyi işlevsellik Kullanıcı tarafından Kullanıcı bazında farklılık gösterebilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-111">Moreover, page-level functionality can differ on a user-by-user basis.</span></span> <span data-ttu-id="acf66-112">Bir gönderi listesi görüntülerken, kimliği doğrulanmış kullanıcılar her gönderiyi derecelendirirken bir arabirim gösterilir, ancak bu arabirim anonim ziyaretçilere uygun değildir.</span><span class="sxs-lookup"><span data-stu-id="acf66-112">When viewing a list of posts, authenticated users are shown an interface for rating each post, whereas this interface is not available to anonymous visitors.</span></span>

<span data-ttu-id="acf66-113">ASP.NET, Kullanıcı tabanlı yetkilendirme kurallarını tanımlamanızı kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="acf66-113">ASP.NET makes it easy to define user-based authorization rules.</span></span> <span data-ttu-id="acf66-114">Yalnızca `Web.config`bir bit biçimlendirme sayesinde belirli Web sayfaları veya tüm dizinler, yalnızca belirtilen kullanıcı alt kümesiyle erişilebilmesi için kilitlenir.</span><span class="sxs-lookup"><span data-stu-id="acf66-114">With just a bit of markup in `Web.config`, specific web pages or entire directories can be locked down so that they are only accessible to a specified subset of users.</span></span> <span data-ttu-id="acf66-115">Sayfa düzeyi işlevsellik, şu anda oturum açmış olan kullanıcıya programlı ve bildirim temelli yollarla açılabilir veya kapatılabilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-115">Page-level functionality can be turned on or off based on the currently logged in user through programmatic and declarative means.</span></span>

<span data-ttu-id="acf66-116">Bu öğreticide, sayfaların erişimini sınırlandırma ve çeşitli teknikler aracılığıyla sayfa düzeyindeki işlevleri kısıtlama bölümüne bakacağız.</span><span class="sxs-lookup"><span data-stu-id="acf66-116">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span> <span data-ttu-id="acf66-117">Haydi başlayın!</span><span class="sxs-lookup"><span data-stu-id="acf66-117">Let's get started!</span></span>

## <a name="a-look-at-the-url-authorization-workflow"></a><span data-ttu-id="acf66-118">URL yetkilendirmesi Iş akışına bakış</span><span class="sxs-lookup"><span data-stu-id="acf66-118">A Look at the URL Authorization Workflow</span></span>

<span data-ttu-id="acf66-119">[*Form kimlik doğrulaması öğreticisine genel bakış*](../introduction/an-overview-of-forms-authentication-cs.md) bölümünde açıklandığı gibi, ASP.NET çalışma zamanı bir ASP.NET kaynağı için bir isteği işlediğinde, istek yaşam döngüsü boyunca birkaç olay oluşturur.</span><span class="sxs-lookup"><span data-stu-id="acf66-119">As discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, when the ASP.NET runtime processes a request for an ASP.NET resource the request raises a number of events during its lifecycle.</span></span> <span data-ttu-id="acf66-120">*Http modülleri* , kodu istek yaşam döngüsünde belirli bir olaya yanıt olarak yürütülen yönetilen sınıflardır.</span><span class="sxs-lookup"><span data-stu-id="acf66-120">*HTTP Modules* are managed classes whose code is executed in response to a particular event in the request lifecycle.</span></span> <span data-ttu-id="acf66-121">ASP.NET, arka planda önemli görevleri gerçekleştiren bir dizi HTTP modülleriyle birlikte gelir.</span><span class="sxs-lookup"><span data-stu-id="acf66-121">ASP.NET ships with a number of HTTP Modules that perform essential tasks behind the scenes.</span></span>

<span data-ttu-id="acf66-122">Bu tür bir HTTP modülü [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span><span class="sxs-lookup"><span data-stu-id="acf66-122">One such HTTP Module is [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span></span> <span data-ttu-id="acf66-123">Önceki öğreticilerde anlatıldığı gibi, `FormsAuthenticationModule` birincil işlevi geçerli isteğin kimliğini belirlemektir.</span><span class="sxs-lookup"><span data-stu-id="acf66-123">As discussed in previous tutorials, the primary function of the `FormsAuthenticationModule` is to determine the identity of the current request.</span></span> <span data-ttu-id="acf66-124">Bu, bir tanımlama bilgisinde bulunan ya da URL içine katıştırılmış olan Forms kimlik doğrulama bileti incelenerek gerçekleştirilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-124">This is accomplished by inspecting the forms authentication ticket, which is either located in a cookie or embedded within the URL.</span></span> <span data-ttu-id="acf66-125">Bu kimlik [`AuthenticateRequest` olay](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx)sırasında gerçekleşir.</span><span class="sxs-lookup"><span data-stu-id="acf66-125">This identification takes place during the [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span></span>

<span data-ttu-id="acf66-126">Başka bir önemli HTTP modülü, [`AuthorizeRequest` olayına](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) yanıt olarak oluşturulan [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)(`AuthenticateRequest` olayından sonra olur).</span><span class="sxs-lookup"><span data-stu-id="acf66-126">Another important HTTP Module is the [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), which is raised in response to the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (which happens after the `AuthenticateRequest` event).</span></span> <span data-ttu-id="acf66-127">`UrlAuthorizationModule`, geçerli kimliğin belirtilen sayfayı ziyaret etme yetkisine sahip olup olmadığını belirlemede `Web.config` yapılandırma işaretlemesini inceler.</span><span class="sxs-lookup"><span data-stu-id="acf66-127">The `UrlAuthorizationModule` examines configuration markup in `Web.config` to determine whether the current identity has authority to visit the specified page.</span></span> <span data-ttu-id="acf66-128">Bu işleme *URL yetkilendirmesi*denir.</span><span class="sxs-lookup"><span data-stu-id="acf66-128">This process is referred to as *URL authorization*.</span></span>

<span data-ttu-id="acf66-129">Adım 1 ' de URL Yetkilendirme kuralları için sözdizimi inceleyeceğiz, ancak ilk olarak isteğin yetkili olup olmadığına bağlı olarak `UrlAuthorizationModule` bakalım.</span><span class="sxs-lookup"><span data-stu-id="acf66-129">We'll examine the syntax for the URL authorization rules in Step 1, but first let's look at what the `UrlAuthorizationModule` does depending on whether the request is authorized or not.</span></span> <span data-ttu-id="acf66-130">`UrlAuthorizationModule` isteğin yetkilendirildiğini belirlerse, hiçbir şey yapmaz ve istek yaşam döngüsü boyunca devam eder.</span><span class="sxs-lookup"><span data-stu-id="acf66-130">If the `UrlAuthorizationModule` determines that the request is authorized, then it does nothing, and the request continues through its lifecycle.</span></span> <span data-ttu-id="acf66-131">Ancak, istek *yetkilendirilmezse* `UrlAuthorizationModule` yaşam döngüsünü durdurur ve `Response` nesnesine [http 401 Yetkisiz](http://www.checkupdown.com/status/E401.html) durumunu döndürmesini söyler.</span><span class="sxs-lookup"><span data-stu-id="acf66-131">However, if the request is *not* authorized, then the `UrlAuthorizationModule` aborts the lifecycle and instructs the `Response` object to return an [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) status.</span></span> <span data-ttu-id="acf66-132">Form kimlik doğrulaması kullanılırken bu HTTP 401 durumu hiçbir zaman istemciye döndürülmez çünkü `FormsAuthenticationModule` bir HTTP 401 durumu algılarsa, oturum açma sayfasına bir [http 302 yeniden yönlendirmesine](http://www.checkupdown.com/status/E302.html) değiştirir.</span><span class="sxs-lookup"><span data-stu-id="acf66-132">When using forms authentication this HTTP 401 status is never returned to the client because if the `FormsAuthenticationModule` detects an HTTP 401 status is modifies it to an [HTTP 302 Redirect](http://www.checkupdown.com/status/E302.html) to the login page.</span></span>

<span data-ttu-id="acf66-133">Şekil 1 ' de, yetkisiz bir istek geldiğinde ASP.NET işlem hattının, `FormsAuthenticationModule`ve `UrlAuthorizationModule` iş akışı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="acf66-133">Figure 1 illustrates the workflow of the ASP.NET pipeline, the `FormsAuthenticationModule`, and the `UrlAuthorizationModule` when an unauthorized request arrives.</span></span> <span data-ttu-id="acf66-134">Özellikle Şekil 1, anonim kullanıcılara erişimi engelleyen bir sayfa olan `ProtectedPage.aspx`için anonim bir ziyaretçi tarafından bir istek gösterir.</span><span class="sxs-lookup"><span data-stu-id="acf66-134">In particular, Figure 1 shows a request by an anonymous visitor for `ProtectedPage.aspx`, which is a page that denies access to anonymous users.</span></span> <span data-ttu-id="acf66-135">Ziyaretçi anonim olduğundan, `UrlAuthorizationModule` isteği iptal eder ve HTTP 401 Yetkisiz durumunu döndürür.</span><span class="sxs-lookup"><span data-stu-id="acf66-135">Since the visitor is anonymous, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="acf66-136">`FormsAuthenticationModule` sonra 401 durumunu 302 bir yeniden yönlendirme sayfasına dönüştürür.</span><span class="sxs-lookup"><span data-stu-id="acf66-136">The `FormsAuthenticationModule` then converts the 401 status into a 302 Redirect to login page.</span></span> <span data-ttu-id="acf66-137">Kullanıcının kimliği, oturum açma sayfası aracılığıyla doğrulandıktan sonra, `ProtectedPage.aspx`yeniden yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-137">After the user is authenticated via the login page, he is redirected to `ProtectedPage.aspx`.</span></span> <span data-ttu-id="acf66-138">Bu kez `FormsAuthenticationModule`, kimlik doğrulama biletini temel alarak kullanıcıyı tanımlar.</span><span class="sxs-lookup"><span data-stu-id="acf66-138">This time the `FormsAuthenticationModule` identifies the user based on his authentication ticket.</span></span> <span data-ttu-id="acf66-139">Artık ziyaretçi kimliğinin doğrulandığına göre `UrlAuthorizationModule` sayfaya erişime izin verir.</span><span class="sxs-lookup"><span data-stu-id="acf66-139">Now that the visitor is authenticated, the `UrlAuthorizationModule` permits access to the page.</span></span>

<span data-ttu-id="acf66-140">[Forms kimlik doğrulaması ve URL yetkilendirmesi Iş akışını ![](user-based-authorization-cs/_static/image2.png)](user-based-authorization-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-140">[![The Forms Authentication and URL Authorization Workflow](user-based-authorization-cs/_static/image2.png)](user-based-authorization-cs/_static/image1.png)</span></span>

<span data-ttu-id="acf66-141">**Şekil 1**: form kimlik doğrulaması ve URL yetkilendirmesi iş akışı ([tam boyutlu görüntüyü görüntülemek için tıklayın](user-based-authorization-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-141">**Figure 1**: The Forms Authentication and URL Authorization Workflow  ([Click to view full-size image](user-based-authorization-cs/_static/image3.png))</span></span>

<span data-ttu-id="acf66-142">Şekil 1 anonim bir ziyaretçi anonim kullanıcılar tarafından kullanılamayan bir kaynağa erişmeyi denediğinde gerçekleşen etkileşimi gösterir.</span><span class="sxs-lookup"><span data-stu-id="acf66-142">Figure 1 depicts the interaction that occurs when an anonymous visitor attempts to access a resource that is not available to anonymous users.</span></span> <span data-ttu-id="acf66-143">Böyle bir durumda anonim ziyaretçi, oturum açma sayfasına, QueryString öğesinde belirtilen ziyaret etmeyi deneyen bir sayfayla yeniden yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-143">In such a case, the anonymous visitor is redirected to the login page with the page she attempted to visit specified in the querystring.</span></span> <span data-ttu-id="acf66-144">Kullanıcı başarıyla oturum açtıktan sonra, başlangıçta görüntülemeye çalışan kaynağa otomatik olarak yeniden yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-144">Once the user has successfully logged on, she will be automatically redirected back to the resource she was initially attempting to view.</span></span>

<span data-ttu-id="acf66-145">Yetkisiz istek anonim bir kullanıcı tarafından yapıldığında, bu iş akışı basittir ve ziyaretçilerin ne olduğunu ve neden olduğunu anlamak kolaydır.</span><span class="sxs-lookup"><span data-stu-id="acf66-145">When the unauthorized request is made by an anonymous user, this workflow is straightforward and is easy for the visitor to understand what has happened and why.</span></span> <span data-ttu-id="acf66-146">Ancak, isteğin kimliği doğrulanmış bir kullanıcı tarafından yapılmış olsa bile, `FormsAuthenticationModule` *Tüm* yetkisiz kullanıcıları oturum açma sayfasına yönlendirdiğini aklınızda bulundurun.</span><span class="sxs-lookup"><span data-stu-id="acf66-146">But keep in mind that the `FormsAuthenticationModule` will redirect *any* unauthorized user to the login page, even if the request is made by an authenticated user.</span></span> <span data-ttu-id="acf66-147">Kimliği doğrulanmış bir Kullanıcı, yetkisi olmayan bir sayfayı ziyaret etmeyi denerse bu, kafa karıştırıcı bir kullanıcı deneyimine neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-147">This can result in a confusing user experience if an authenticated user attempts to visit a page for which she lacks authority.</span></span>

<span data-ttu-id="acf66-148">Web sitemizin URL yetkilendirme kurallarının ASP.NET sayfa `OnlyTito.aspx`, yalnızca Tito ile erişilebilir olması gibi yapılandırıldığını düşünün.</span><span class="sxs-lookup"><span data-stu-id="acf66-148">Imagine that our website had its URL authorization rules configured such that the ASP.NET page `OnlyTito.aspx` was accessibly only to Tito.</span></span> <span data-ttu-id="acf66-149">Şimdi, Sam 'ın siteyi ziyaret ettiği, oturum açtığı ve `OnlyTito.aspx`ziyaret etmeyi denediği hakkında düşünün.</span><span class="sxs-lookup"><span data-stu-id="acf66-149">Now, imagine that Sam visits the site, logs on, and then attempts to visit `OnlyTito.aspx`.</span></span> <span data-ttu-id="acf66-150">`UrlAuthorizationModule`, istek yaşam döngüsünü durdurur ve bir HTTP 401 Yetkisiz durumu döndürür ve bu `FormsAuthenticationModule`, Sam 'ı oturum açma sayfasına yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="acf66-150">The `UrlAuthorizationModule` will halt the request lifecycle and return an HTTP 401 Unauthorized status, which the `FormsAuthenticationModule` will detect and then redirect Sam to the login page.</span></span> <span data-ttu-id="acf66-151">Sam zaten oturum açtığından, bu nedenle oturum açma sayfasına geri gönderilmesini merak edebilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-151">Since Sam has already logged in, though, she may wonder why she has been sent back to the login page.</span></span> <span data-ttu-id="acf66-152">Oturum açma kimlik bilgilerinin bir şekilde kaybolması veya geçersiz kimlik bilgileri girmiş olması neden olabilirler.</span><span class="sxs-lookup"><span data-stu-id="acf66-152">She might reason that her login credentials were lost somehow, or that she entered invalid credentials.</span></span> <span data-ttu-id="acf66-153">Sam oturum açma sayfasından kimlik bilgilerini yeniden girerse, oturum açılır (yeniden) ve `OnlyTito.aspx`yeniden yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-153">If Sam reenters her credentials from the login page she will be logged on (again) and redirected to `OnlyTito.aspx`.</span></span> <span data-ttu-id="acf66-154">`UrlAuthorizationModule`, Sam 'nin bu sayfayı ziyaret edemeyeceğini algılar ve oturum açma sayfasına geri dönecektir.</span><span class="sxs-lookup"><span data-stu-id="acf66-154">The `UrlAuthorizationModule` will detect that Sam cannot visit this page and she will be returned to the login page.</span></span>

<span data-ttu-id="acf66-155">Şekil 2 Bu kafa karıştırıcı iş akışını gösterir.</span><span class="sxs-lookup"><span data-stu-id="acf66-155">Figure 2 depicts this confusing workflow.</span></span>

<span data-ttu-id="acf66-156">[![varsayılan Iş akışı kafa karıştırıcı bir döngüye neden olabilir](user-based-authorization-cs/_static/image5.png)](user-based-authorization-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-156">[![The Default Workflow Can Lead to a Confusing Cycle](user-based-authorization-cs/_static/image5.png)](user-based-authorization-cs/_static/image4.png)</span></span>

<span data-ttu-id="acf66-157">**Şekil 2**: varsayılan Iş akışı kafa karıştırıcı bir döngüye neden olabilir ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-157">**Figure 2**: The Default Workflow Can Lead to a Confusing Cycle  ([Click to view full-size image](user-based-authorization-cs/_static/image6.png))</span></span>

<span data-ttu-id="acf66-158">Şekil 2 ' de gösterilen iş akışı, en çok bilgisayar bilgili ziyaretçisinden bile hızlı bir şekilde hızla olabilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-158">The workflow illustrated in Figure 2 can quickly befuddle even the most computer savvy visitor.</span></span> <span data-ttu-id="acf66-159">2\. adımda bu kafa karıştırıcı döngüsünü önlemenin yollarını inceleyeceğiz.</span><span class="sxs-lookup"><span data-stu-id="acf66-159">We will look at ways to prevent this confusing cycle in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="acf66-160">ASP.NET, geçerli kullanıcının belirli bir Web sayfasına erişip erişemeyeceğini anlamak için iki mekanizma kullanır: URL yetkilendirmesi ve dosya yetkilendirmesi.</span><span class="sxs-lookup"><span data-stu-id="acf66-160">ASP.NET uses two mechanisms to determine whether the current user can access a particular web page: URL authorization and file authorization.</span></span> <span data-ttu-id="acf66-161">Dosya yetkilendirmesi, istenen dosya (ler) ACL 'Lerine danışarak yetkiyi belirleyen [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx)tarafından uygulanır.</span><span class="sxs-lookup"><span data-stu-id="acf66-161">File authorization is implemented by the [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), which determines authority by consulting the requested file(s) ACLs.</span></span> <span data-ttu-id="acf66-162">ACL 'Ler Windows hesapları için uygulanan izinler olduğundan, dosya yetkilendirmesi en yaygın olarak Windows kimlik doğrulama ile kullanılır.</span><span class="sxs-lookup"><span data-stu-id="acf66-162">File authorization is most commonly used with Windows authentication because ACLs are permissions that apply to Windows accounts.</span></span> <span data-ttu-id="acf66-163">Form kimlik doğrulaması kullanılırken, siteyi ziyaret eden Kullanıcı ne olursa olsun, tüm işletim sistemi ve dosya sistemi düzeyi istekleri aynı Windows hesabı tarafından yürütülür.</span><span class="sxs-lookup"><span data-stu-id="acf66-163">When using forms authentication, all operating system- and file system-level requests are executed by the same Windows account, regardless of the user visiting the site.</span></span> <span data-ttu-id="acf66-164">Bu öğretici serisi form kimlik doğrulamasına odaklandığından, dosya yetkilendirmesini ele vermeyecektir.</span><span class="sxs-lookup"><span data-stu-id="acf66-164">Since this tutorial series focuses on forms authentication, we will not be discussing file authorization.</span></span>

### <a name="the-scope-of-url-authorization"></a><span data-ttu-id="acf66-165">URL yetkilendirmesi kapsamı</span><span class="sxs-lookup"><span data-stu-id="acf66-165">The Scope of URL Authorization</span></span>

<span data-ttu-id="acf66-166">`UrlAuthorizationModule`, ASP.NET çalışma zamanının bir parçası olan yönetilen koddur.</span><span class="sxs-lookup"><span data-stu-id="acf66-166">The `UrlAuthorizationModule` is managed code that is part of the ASP.NET runtime.</span></span> <span data-ttu-id="acf66-167">Microsoft 'un [Internet Information Services (IIS)](https://www.iis.net/) Web sunucusu sürüm 7 ' den önce, IIS 'nin http işlem hattı ve ASP.NET çalışma zamanının işlem hattı arasında ayrı bir engel vardı.</span><span class="sxs-lookup"><span data-stu-id="acf66-167">Prior to version 7 of Microsoft's [Internet Information Services (IIS)](https://www.iis.net/) web server, there was a distinct barrier between IIS's HTTP pipeline and the ASP.NET runtime's pipeline.</span></span> <span data-ttu-id="acf66-168">Kısaca, IIS 6 ve önceki sürümlerde ASP. NET `UrlAuthorizationModule` yalnızca, IIS 'den ASP.NET çalışma zamanına bir istek atandığında yürütülür.</span><span class="sxs-lookup"><span data-stu-id="acf66-168">In short, in IIS 6 and earlier, ASP.NET's `UrlAuthorizationModule` only executes when a request is delegated from IIS to the ASP.NET runtime.</span></span> <span data-ttu-id="acf66-169">Varsayılan olarak IIS, statik içeriğin kendisini, HTML sayfaları ve CSS, JavaScript ve resim dosyaları gibi işler ve yalnızca `.aspx`, `.asmx`veya `.ashx` uzantılı bir sayfa istendiğinde ASP.NET çalışma zamanına yönelik istekleri devre dışı bırakır.</span><span class="sxs-lookup"><span data-stu-id="acf66-169">By default, IIS processes static content itself - like HTML pages and CSS, JavaScript, and image files - and only hands off requests to the ASP.NET runtime when a page with an extension of `.aspx`, `.asmx`, or `.ashx` is requested.</span></span>

<span data-ttu-id="acf66-170">Ancak IIS 7, tümleşik IIS ve ASP.NET işlem hatları sağlar.</span><span class="sxs-lookup"><span data-stu-id="acf66-170">IIS 7, however, allows for integrated IIS and ASP.NET pipelines.</span></span> <span data-ttu-id="acf66-171">Birkaç yapılandırma ayarı sayesinde, IIS 7 ' yi *Tüm* istekler için `UrlAuthorizationModule` çağırmak üzere ayarlayabilirsiniz. Bu, URL yetkilendirme kurallarının herhangi bir türdeki dosyalar için tanımlanması anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="acf66-171">With a few configuration settings you can setup IIS 7 to invoke the `UrlAuthorizationModule` for *all* requests, meaning that URL authorization rules can be defined for files of any type.</span></span> <span data-ttu-id="acf66-172">Ayrıca, IIS 7 kendi URL yetkilendirme altyapısını içerir.</span><span class="sxs-lookup"><span data-stu-id="acf66-172">Additionally, IIS 7 includes its own URL authorization engine.</span></span> <span data-ttu-id="acf66-173">ASP.NET Integration ve IIS 7 ' nin yerel URL yetkilendirme işlevselliği hakkında daha fazla bilgi için bkz. [ııS7 URL yetkilendirmesini anlama](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span><span class="sxs-lookup"><span data-stu-id="acf66-173">For more information on ASP.NET integration and IIS 7's native URL authorization functionality, see [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span></span> <span data-ttu-id="acf66-174">ASP.NET ve IIS 7 tümleştirmesinde daha ayrıntılı bir bakış için, shahram Khoskıı 'nin kitabı, *profesyonel IIS 7 ve ASP.NET tümleşik programlama* (ısbn: 978-0470152539) bir kopyasını seçin.</span><span class="sxs-lookup"><span data-stu-id="acf66-174">For a more in-depth look at ASP.NET and IIS 7 integration, pick up a copy of Shahram Khosravi's book, *Professional IIS 7 and ASP.NET Integrated Programming* (ISBN: 978-0470152539).</span></span>

<span data-ttu-id="acf66-175">IIS 7 ' den önceki sürümlerde, bir Nutshell 'de, URL Yetkilendirme kuralları yalnızca ASP.NET çalışma zamanı tarafından işlenen kaynaklara uygulanır.</span><span class="sxs-lookup"><span data-stu-id="acf66-175">In a nutshell, in versions prior to IIS 7, URL authorization rules are only applied to resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="acf66-176">Ancak IIS 7 ile IIS 'nin yerel URL yetkilendirme özelliğini kullanmak veya ASP 'yi bütünleştirmek mümkündür. NET ' in IIS 'in HTTP işlem hattına `UrlAuthorizationModule`, dolayısıyla bu işlevselliği tüm isteklere genişlettin.</span><span class="sxs-lookup"><span data-stu-id="acf66-176">But with IIS 7 it is possible to use IIS's native URL authorization feature or to integrate ASP.NET's `UrlAuthorizationModule` into IIS's HTTP pipeline, thereby extending this functionality to all requests.</span></span>

> [!NOTE]
> <span data-ttu-id="acf66-177">ASP. adımda bazı hafif bazı önemli farklılıklar vardır. NET ' in `UrlAuthorizationModule` ve IIS 7 ' nin URL yetkilendirmesi özelliği yetkilendirme kurallarını işler.</span><span class="sxs-lookup"><span data-stu-id="acf66-177">There are some subtle yet important differences in how ASP.NET's `UrlAuthorizationModule` and IIS 7's URL authorization feature process the authorization rules.</span></span> <span data-ttu-id="acf66-178">Bu öğretici, IIS 7 ' nin URL yetkilendirme işlevini veya `UrlAuthorizationModule`kıyasla yetkilendirme kurallarını ayrıştırmayla farklarını etkilemez.</span><span class="sxs-lookup"><span data-stu-id="acf66-178">This tutorial does not examine IIS 7's URL authorization functionality or the differences in how it parses authorization rules compared to the `UrlAuthorizationModule`.</span></span> <span data-ttu-id="acf66-179">Bu konular hakkında daha fazla bilgi için MSDN 'de veya [www.iis.net](https://www.iis.net/)adresindeki IIS 7 belgelerine bakın.</span><span class="sxs-lookup"><span data-stu-id="acf66-179">For more information on these topics, refer to the IIS 7 documentation on MSDN or at [www.iis.net](https://www.iis.net/).</span></span>

## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a><span data-ttu-id="acf66-180">1\. Adım: URL yetkilendirme kurallarını`Web.config` tanımlama</span><span class="sxs-lookup"><span data-stu-id="acf66-180">Step 1: Defining URL Authorization Rules in`Web.config`</span></span>

<span data-ttu-id="acf66-181">`UrlAuthorizationModule`, uygulamanın yapılandırmasında tanımlanan URL yetkilendirme kurallarına dayalı olarak belirli bir kimlik için istenen kaynağa erişim izni verip vermemeyi belirler.</span><span class="sxs-lookup"><span data-stu-id="acf66-181">The `UrlAuthorizationModule` determines whether to grant or deny access to a requested resource for a particular identity based on the URL authorization rules defined in the application's configuration.</span></span> <span data-ttu-id="acf66-182">Yetkilendirme kuralları, `<allow>` ve `<deny>` alt öğeleri biçimindeki [`<authorization>` öğesinde](https://msdn.microsoft.com/library/8d82143t.aspx) yazılır.</span><span class="sxs-lookup"><span data-stu-id="acf66-182">The authorization rules are spelled out in the [`<authorization>` element](https://msdn.microsoft.com/library/8d82143t.aspx) in the form of `<allow>` and `<deny>` child elements.</span></span> <span data-ttu-id="acf66-183">Her `<allow>` ve `<deny>` alt öğesi şunları belirtebilir:</span><span class="sxs-lookup"><span data-stu-id="acf66-183">Each `<allow>` and `<deny>` child element can specify:</span></span>

- <span data-ttu-id="acf66-184">Belirli bir Kullanıcı</span><span class="sxs-lookup"><span data-stu-id="acf66-184">A particular user</span></span>
- <span data-ttu-id="acf66-185">Virgülle ayrılmış kullanıcı listesi</span><span class="sxs-lookup"><span data-stu-id="acf66-185">A comma-delimited list of users</span></span>
- <span data-ttu-id="acf66-186">Soru işareti (?) ile belirtilen tüm anonim kullanıcılar</span><span class="sxs-lookup"><span data-stu-id="acf66-186">All anonymous users, denoted by a question mark (?)</span></span>
- <span data-ttu-id="acf66-187">Yıldız işaretiyle (\*) belirtilen tüm kullanıcılar</span><span class="sxs-lookup"><span data-stu-id="acf66-187">All users, denoted by an asterisk (\*)</span></span>

<span data-ttu-id="acf66-188">Aşağıdaki biçimlendirme, kullanıcıların Tito ve Scott 'a ve diğerlerini reddetmeye izin vermek için URL yetkilendirme kurallarının nasıl kullanılacağını göstermektedir:</span><span class="sxs-lookup"><span data-stu-id="acf66-188">The following markup illustrates how to use the URL authorization rules to allow users Tito and Scott and deny all others:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample1.xml)]

<span data-ttu-id="acf66-189">`<allow>` öğesi, kullanıcıların hangi kullanıcılara izin verileceğini tanımlar, ancak `<deny>` öğesi *Tüm* kullanıcıların reddedildiğini bildirir.</span><span class="sxs-lookup"><span data-stu-id="acf66-189">The `<allow>` element defines what users are permitted - Tito and Scott - while the `<deny>` element instructs that *all* users are denied.</span></span>

> [!NOTE]
> <span data-ttu-id="acf66-190">`<allow>` ve `<deny>` öğeleri, roller için yetkilendirme kuralları da belirtebilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-190">The `<allow>` and `<deny>` elements can also specify authorization rules for roles.</span></span> <span data-ttu-id="acf66-191">Daha sonraki bir öğreticide rol tabanlı yetkilendirmeyi inceleyeceğiz.</span><span class="sxs-lookup"><span data-stu-id="acf66-191">We will examine role-based authorization in a future tutorial.</span></span>

<span data-ttu-id="acf66-192">Aşağıdaki ayar Sam dışındaki herkese (anonim ziyaretçiler dahil) erişim izni verir:</span><span class="sxs-lookup"><span data-stu-id="acf66-192">The following setting grants access to anyone other than Sam (including anonymous visitors):</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample2.xml)]

<span data-ttu-id="acf66-193">Yalnızca kimliği doğrulanmış kullanıcılara izin vermek için, tüm anonim kullanıcılara erişimi engelleyen aşağıdaki yapılandırmayı kullanın:</span><span class="sxs-lookup"><span data-stu-id="acf66-193">To allow only authenticated users, use the following configuration, which denies access to all anonymous users:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample3.xml)]

<span data-ttu-id="acf66-194">Yetkilendirme kuralları, `Web.config` `<system.web>` öğesi içinde tanımlanır ve Web uygulamasındaki tüm ASP.NET kaynaklarına uygulanır.</span><span class="sxs-lookup"><span data-stu-id="acf66-194">The authorization rules are defined within the `<system.web>` element in `Web.config` and apply to all of the ASP.NET resources in the web application.</span></span> <span data-ttu-id="acf66-195">Oftentimes, bir uygulamanın farklı bölümler için farklı yetkilendirme kuralları vardır.</span><span class="sxs-lookup"><span data-stu-id="acf66-195">Oftentimes, an application has different authorization rules for different sections.</span></span> <span data-ttu-id="acf66-196">Örneğin, bir eCommerce sitesinde, tüm ziyaretçiler ürünleri kullanabilir, ürün incelemeleri görebilir, katalogda arama yapın ve bu şekilde devam edebilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-196">For example, at an eCommerce site, all visitors may peruse the products, see product reviews, search the catalog, and so on.</span></span> <span data-ttu-id="acf66-197">Ancak, yalnızca kimliği doğrulanmış kullanıcılar, tek bir sevkiyat geçmişini yönetmek için kullanıma alma veya sayfalara ulaşabilirler.</span><span class="sxs-lookup"><span data-stu-id="acf66-197">However, only authenticated users may reach the checkout or the pages to manage one's shipping history.</span></span> <span data-ttu-id="acf66-198">Ayrıca, site yöneticileri gibi yalnızca seçim yapan kullanıcılar tarafından erişilebilen bir bölümü olabilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-198">Moreover, there may be portions of the site that are only accessible by select users, such as site administrators.</span></span>

<span data-ttu-id="acf66-199">ASP.NET, sitedeki farklı dosya ve klasörler için farklı yetkilendirme kuralları tanımlamanızı kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="acf66-199">ASP.NET makes it easy to define different authorization rules for different files and folders in the site.</span></span> <span data-ttu-id="acf66-200">Kök klasörün `Web.config` dosyasında belirtilen yetkilendirme kuralları, sitedeki tüm ASP.NET kaynakları için geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="acf66-200">The authorization rules specified in the root folder's `Web.config` file apply to all ASP.NET resources in the site.</span></span> <span data-ttu-id="acf66-201">Ancak, bu varsayılan yetkilendirme ayarları, bir `Web.config` `<authorization>` bölümü ekleyerek belirli bir klasör için geçersiz kılınabilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-201">However, these default authorization settings can be overridden for a particular folder by adding a `Web.config` with an `<authorization>` section.</span></span>

<span data-ttu-id="acf66-202">Yalnızca kimliği doğrulanmış kullanıcıların `Membership` klasöründeki ASP.NET sayfalarını ziyaret edebilmesi için Web sitemizi güncelleştirelim.</span><span class="sxs-lookup"><span data-stu-id="acf66-202">Let's update our website so that only authenticated users can visit the ASP.NET pages in the `Membership` folder.</span></span> <span data-ttu-id="acf66-203">Bunu gerçekleştirmek için, `Membership` klasöre bir `Web.config` dosyası eklemesi ve yetkilendirme ayarlarını anonim kullanıcıları reddedecek şekilde ayarlaması gerekir.</span><span class="sxs-lookup"><span data-stu-id="acf66-203">To accomplish this we need to add a `Web.config` file to the `Membership` folder and set its authorization settings to deny anonymous users.</span></span> <span data-ttu-id="acf66-204">Çözüm Gezgini `Membership` klasöre sağ tıklayın, bağlam menüsünden Yeni öğe Ekle menüsünü seçin ve `Web.config`adlı yeni bir Web yapılandırma dosyası ekleyin.</span><span class="sxs-lookup"><span data-stu-id="acf66-204">Right-click the `Membership` folder in the Solution Explorer, choose the Add New Item menu from the context menu, and add a new Web Configuration File named `Web.config`.</span></span>

<span data-ttu-id="acf66-205">[Üyelik klasörüne Web. config dosyası eklemek ![](user-based-authorization-cs/_static/image8.png)](user-based-authorization-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-205">[![Add a Web.config File to the Membership Folder](user-based-authorization-cs/_static/image8.png)](user-based-authorization-cs/_static/image7.png)</span></span>

<span data-ttu-id="acf66-206">**Şekil 3**: `Membership` klasörüne bir `Web.config` dosyası ekleyin ([tam boyutlu görüntüyü görüntülemek için tıklayın](user-based-authorization-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-206">**Figure 3**: Add a `Web.config` File to the `Membership` Folder  ([Click to view full-size image](user-based-authorization-cs/_static/image9.png))</span></span>

<span data-ttu-id="acf66-207">Bu noktada, projeniz iki `Web.config` dosya içermelidir: biri kök dizinde ve diğeri `Membership` klasöründedir.</span><span class="sxs-lookup"><span data-stu-id="acf66-207">At this point your project should contain two `Web.config` files: one in the root directory and one in the `Membership` folder.</span></span>

<span data-ttu-id="acf66-208">[![uygulamanızın Şu anda Iki Web. config dosyası Içermesi gerekir](user-based-authorization-cs/_static/image11.png)](user-based-authorization-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-208">[![Your Application Should Now Contain Two Web.config Files](user-based-authorization-cs/_static/image11.png)](user-based-authorization-cs/_static/image10.png)</span></span>

<span data-ttu-id="acf66-209">**Şekil 4**: uygulamanız artık Iki `Web.config` dosya içermeli ([tam boyutlu görüntüyü görüntülemek için tıklayın](user-based-authorization-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-209">**Figure 4**: Your Application Should Now Contain Two `Web.config` Files  ([Click to view full-size image](user-based-authorization-cs/_static/image12.png))</span></span>

<span data-ttu-id="acf66-210">`Membership` klasördeki yapılandırma dosyasını, anonim kullanıcılara erişimi yasakladığından güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="acf66-210">Update the configuration file in the `Membership` folder so that it prohibits access to anonymous users.</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample4.xml)]

<span data-ttu-id="acf66-211">İşte bu kadar kolay!</span><span class="sxs-lookup"><span data-stu-id="acf66-211">That's all there is to it!</span></span>

<span data-ttu-id="acf66-212">Bu değişikliği test etmek için tarayıcıda giriş sayfasını ziyaret edin ve oturum açtığınızdan emin olun. Bir ASP.NET uygulamasının varsayılan davranışı tüm ziyaretçilere izin vermedikten ve kök dizinin `Web.config` dosyasında herhangi bir yetkilendirme değişikliği yapamadığımızdan, kök dizindeki dosyaları anonim bir ziyaretçi olarak ziyaret edebiliyoruz.</span><span class="sxs-lookup"><span data-stu-id="acf66-212">To test out this change, visit the homepage in a browser and make sure you are logged out. Since the default behavior of an ASP.NET application is to allow all visitors, and since we didn't make any authorization modifications to the root directory's `Web.config` file, we are able to visit the files in the root directory as an anonymous visitor.</span></span>

<span data-ttu-id="acf66-213">Sol sütunda bulunan Kullanıcı hesapları oluşturma bağlantısına tıklayın.</span><span class="sxs-lookup"><span data-stu-id="acf66-213">Click on the Creating User Accounts link found in the left column.</span></span> <span data-ttu-id="acf66-214">Bu işlem sizi `~/Membership/CreatingUserAccounts.aspx`götürür.</span><span class="sxs-lookup"><span data-stu-id="acf66-214">This will take you to the `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="acf66-215">`Membership` klasöründeki `Web.config` dosyası anonim erişimi engelleyecek yetkilendirme kurallarını tanımladığından, `UrlAuthorizationModule` isteği iptal eder ve HTTP 401 Yetkisiz durumunu döndürür.</span><span class="sxs-lookup"><span data-stu-id="acf66-215">Since the `Web.config` file in the `Membership` folder defines authorization rules to prohibit anonymous access, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="acf66-216">`FormsAuthenticationModule` bunu, oturum açma sayfasına gönderdiğiniz bir 302 yeniden yönlendirme durumunda değiştirir.</span><span class="sxs-lookup"><span data-stu-id="acf66-216">The `FormsAuthenticationModule` modifies this to a 302 Redirect status, sending us to the login page.</span></span> <span data-ttu-id="acf66-217">Erişmeye çalıştığınız sayfanın (`CreatingUserAccounts.aspx`) `ReturnUrl` QueryString parametresi aracılığıyla oturum açma sayfasına geçtiğini unutmayın.</span><span class="sxs-lookup"><span data-stu-id="acf66-217">Note that the page we were attempting to access (`CreatingUserAccounts.aspx`) is passed to the login page via the `ReturnUrl` querystring parameter.</span></span>

<span data-ttu-id="acf66-218">[URL Yetkilendirme kuralları anonim erişimi yasakladığından ![, oturum açma sayfasına yönlendirilirsiniz](user-based-authorization-cs/_static/image14.png)](user-based-authorization-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-218">[![Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page](user-based-authorization-cs/_static/image14.png)](user-based-authorization-cs/_static/image13.png)</span></span>

<span data-ttu-id="acf66-219">**Şekil 5**: URL Yetkilendirme kuralları anonim erişimi yasakladığından, oturum açma sayfasına yönlendirilirsiniz ([tam boyutlu görüntüyü görüntülemek için tıklayın](user-based-authorization-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-219">**Figure 5**: Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page  ([Click to view full-size image](user-based-authorization-cs/_static/image15.png))</span></span>

<span data-ttu-id="acf66-220">Başarıyla oturum açtıktan sonra `CreatingUserAccounts.aspx` sayfasına yönlendirilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="acf66-220">Upon successfully logging in, we are redirected to the `CreatingUserAccounts.aspx` page.</span></span> <span data-ttu-id="acf66-221">Bu kez `UrlAuthorizationModule` artık anonim olmadığınızdan sayfaya erişime izin verir.</span><span class="sxs-lookup"><span data-stu-id="acf66-221">This time the `UrlAuthorizationModule` permits access to the page because we are no longer anonymous.</span></span>

### <a name="applying-url-authorization-rules-to-a-specific-location"></a><span data-ttu-id="acf66-222">URL Yetkilendirme kuralları belirli bir konuma uygulanıyor</span><span class="sxs-lookup"><span data-stu-id="acf66-222">Applying URL Authorization Rules to a Specific Location</span></span>

<span data-ttu-id="acf66-223">`Web.config` `<system.web>` bölümünde tanımlanan yetkilendirme ayarları, bu dizin ve alt dizinlerindeki tüm ASP.NET kaynakları için geçerlidir (başka bir `Web.config` dosyası tarafından aksi belirtilmedikçe).</span><span class="sxs-lookup"><span data-stu-id="acf66-223">The authorization settings defined in the `<system.web>` section of `Web.config` apply to all of the ASP.NET resources in that directory and its subdirectories (until otherwise overridden by another `Web.config` file).</span></span> <span data-ttu-id="acf66-224">Bazı durumlarda, belirli bir dizindeki tüm ASP.NET kaynaklarının belirli bir veya iki sayfa hariç belirli bir yetkilendirme yapılandırmasına sahip olmasını isteyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="acf66-224">In some cases, though, we may want all ASP.NET resources in a given directory to have a particular authorization configuration except for one or two specific pages.</span></span> <span data-ttu-id="acf66-225">Bu, `Web.config``<location>` öğesi eklenerek, yetkilendirme kuralları farklı olan dosyaya işaret ederek ve içindeki benzersiz yetkilendirme kurallarını tanımlayarak elde edilebilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-225">This can be achieved by adding a `<location>` element in `Web.config`, pointing it to the file whose authorization rules differ, and defining its unique authorization rules therein.</span></span>

<span data-ttu-id="acf66-226">Belirli bir kaynak için yapılandırma ayarlarını geçersiz kılmak üzere `<location>` öğesini kullanmayı görmek için, yetkilendirme ayarlarını yalnızca Tito tarafından `CreatingUserAccounts.aspx`ziyaret edilebilir olacak şekilde özelleştirelim.</span><span class="sxs-lookup"><span data-stu-id="acf66-226">To illustrate using the `<location>` element to override the configuration settings for a specific resource, let's customize the authorization settings so that only Tito can visit `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="acf66-227">Bunu gerçekleştirmek için, `Membership` klasörünün `Web.config` dosyasına bir `<location>` öğesi ekleyin ve biçimlendirmesini aşağıdaki gibi görünecek şekilde güncelleştirin:</span><span class="sxs-lookup"><span data-stu-id="acf66-227">To accomplish this, add a `<location>` element to the `Membership` folder's `Web.config` file and update its markup so that it looks like the following:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample5.xml)]

<span data-ttu-id="acf66-228">`<system.web>` `<authorization>` öğesi, `Membership` klasöründe ve alt klasörlerinde ASP.NET kaynakları için varsayılan URL yetkilendirme kurallarını tanımlar.</span><span class="sxs-lookup"><span data-stu-id="acf66-228">The `<authorization>` element in `<system.web>` defines the default URL authorization rules for ASP.NET resources in the `Membership` folder and its subfolders.</span></span> <span data-ttu-id="acf66-229">`<location>` öğesi belirli bir kaynak için bu kuralları geçersiz kılmamızı sağlar.</span><span class="sxs-lookup"><span data-stu-id="acf66-229">The `<location>` element allows us to override these rules for a particular resource.</span></span> <span data-ttu-id="acf66-230">Yukarıdaki İşaretlemede `<location>` öğesi `CreatingUserAccounts.aspx` sayfasına başvurur ve Tito 'ya izin vermek, ancak diğer herkesin erişimini engellemek gibi yetkilendirme kurallarını belirtir.</span><span class="sxs-lookup"><span data-stu-id="acf66-230">In the above markup the `<location>` element references the `CreatingUserAccounts.aspx` page and specifies its authorization rules such as to allow Tito, but deny everyone else.</span></span>

<span data-ttu-id="acf66-231">Bu yetkilendirme değişikliğini test etmek için, Web sitesini anonim kullanıcı olarak ziyaret ederek başlayın.</span><span class="sxs-lookup"><span data-stu-id="acf66-231">To test out this authorization change, start by visiting the website as an anonymous user.</span></span> <span data-ttu-id="acf66-232">`UserBasedAuthorization.aspx`gibi `Membership` klasördeki herhangi bir sayfayı ziyaret etmeye çalışırsanız `UrlAuthorizationModule` isteği reddeder ve oturum açma sayfasına yönlendirilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="acf66-232">If you attempt to visit any page in the `Membership` folder, such as `UserBasedAuthorization.aspx`, the `UrlAuthorizationModule` will deny the request and you will be redirected to the login page.</span></span> <span data-ttu-id="acf66-233">Olarak oturum açtıktan sonra Scott, `CreatingUserAccounts.aspx`*hariç* `Membership` klasördeki herhangi bir sayfayı ziyaret edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="acf66-233">After logging in as, say, Scott, you can visit any page in the `Membership` folder *except* for `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="acf66-234">Herkes oturum açma sayfasına geri yönlendirilmeye izin vermek için, bir kişi olarak oturum açmış `CreatingUserAccounts.aspx` ziyaret edilmeye çalışıldı.</span><span class="sxs-lookup"><span data-stu-id="acf66-234">Attempting to visit `CreatingUserAccounts.aspx` logged on as anyone but Tito will result in an unauthorized access attempt, redirecting you back to the login page.</span></span>

> [!NOTE]
> <span data-ttu-id="acf66-235">`<location>` öğesi yapılandırmanın `<system.web>` öğesinin dışında görünmelidir.</span><span class="sxs-lookup"><span data-stu-id="acf66-235">The `<location>` element must appear outside of the configuration's `<system.web>` element.</span></span> <span data-ttu-id="acf66-236">Yetkilendirme ayarlarını geçersiz kılmak istediğiniz her kaynak için ayrı bir `<location>` öğesi kullanmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="acf66-236">You need to use a separate `<location>` element for each resource whose authorization settings you want to override.</span></span>

### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a><span data-ttu-id="acf66-237">`UrlAuthorizationModule`erişim vermek veya reddetmek için yetkilendirme kurallarını nasıl kullandığını gösteren bir bakış</span><span class="sxs-lookup"><span data-stu-id="acf66-237">A Look at How the`UrlAuthorizationModule`Uses the Authorization Rules to Grant or Deny Access</span></span>

<span data-ttu-id="acf66-238">`UrlAuthorizationModule`, URL yetkilendirme kurallarını her seferinde bir kez analiz ederek belirli bir URL için belirli bir kimliğin yetkilendirilip yetkilendirilmeyeceğini belirler.</span><span class="sxs-lookup"><span data-stu-id="acf66-238">The `UrlAuthorizationModule` determines whether to authorize a particular identity for a particular URL by analyzing the URL authorization rules one at a time, starting from the first one and working its way down.</span></span> <span data-ttu-id="acf66-239">Eşleşme bulunduğunda, eşleşme bir `<allow>` veya `<deny>` öğesinde bulunmuna bağlı olarak, Kullanıcı erişim izni verilir veya reddedilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-239">As soon as a match is found, the user is granted or denied access, depending on if the match was found in an `<allow>` or `<deny>` element.</span></span> <span data-ttu-id="acf66-240"><strong>Hiçbir eşleşme bulunmazsa, kullanıcıya erişim verilir.</strong></span><span class="sxs-lookup"><span data-stu-id="acf66-240"><strong>If no match is found, the user is granted access.</strong></span></span> <span data-ttu-id="acf66-241">Sonuç olarak, erişimi kısıtlamak isterseniz, URL yetkilendirme yapılandırmasındaki son öğe olarak bir `<deny>` öğesi kullanmanız zorunludur.</span><span class="sxs-lookup"><span data-stu-id="acf66-241">Consequently, if you want to restrict access, it is imperative that you use a `<deny>` element as the last element in the URL authorization configuration.</span></span> <span data-ttu-id="acf66-242"><strong>Bir</strong> <strong>`<deny>`</strong> <strong>öğesini atlarsanız, tüm kullanıcılara erişim izni verilir.</strong></span><span class="sxs-lookup"><span data-stu-id="acf66-242"><strong>If you omit a</strong><strong>`<deny>`</strong><strong>element, all users will be granted access.</strong></span></span>

<span data-ttu-id="acf66-243">`UrlAuthorizationModule` tarafından yetkilendirmeyi öğrenmek için kullanılan işlemi daha iyi anlamak için, bu adımda daha önce bakdığımız örnek URL yetkilendirme kurallarını göz önünde bulundurun.</span><span class="sxs-lookup"><span data-stu-id="acf66-243">To better understand the process used by the `UrlAuthorizationModule` to determine authority, consider the example URL authorization rules we looked at earlier in this step.</span></span> <span data-ttu-id="acf66-244">İlk kural, Tito ve Scott 'a erişim sağlayan bir `<allow>` öğesidir.</span><span class="sxs-lookup"><span data-stu-id="acf66-244">The first rule is an `<allow>` element that allows access to Tito and Scott.</span></span> <span data-ttu-id="acf66-245">İkinci kurallar herkese erişimi engelleyen bir `<deny>` öğesidir.</span><span class="sxs-lookup"><span data-stu-id="acf66-245">The second rules is a `<deny>` element that denies access to everyone.</span></span> <span data-ttu-id="acf66-246">Anonim bir kullanıcı ziyaret ederse `UrlAuthorizationModule`, Scott ya da Tito anonimdir.</span><span class="sxs-lookup"><span data-stu-id="acf66-246">If an anonymous user visits, the `UrlAuthorizationModule` starts by asking, Is anonymous either Scott or Tito?</span></span> <span data-ttu-id="acf66-247">Yanıt, açıkça Hayır, bu yüzden ikinci kurala devam eder.</span><span class="sxs-lookup"><span data-stu-id="acf66-247">The answer, obviously, is No, so it proceeds to the second rule.</span></span> <span data-ttu-id="acf66-248">Herkes bir herkes kümesinde mi anonimdir?</span><span class="sxs-lookup"><span data-stu-id="acf66-248">Is anonymous in the set of everybody?</span></span> <span data-ttu-id="acf66-249">Buradaki yanıt Evet olduğundan, `<deny>` kuralı devreye konur ve ziyaretçi oturum açma sayfasına yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-249">Since the answer here is Yes, the `<deny>` rule is put in effect and the visitor is redirected to the login page.</span></span> <span data-ttu-id="acf66-250">Benzer şekilde, Jisun ziyaret etirse `UrlAuthorizationModule`, ister Jisun Scott ya da Tito?</span><span class="sxs-lookup"><span data-stu-id="acf66-250">Similarly, if Jisun is visiting, the `UrlAuthorizationModule` starts by asking, Is Jisun either Scott or Tito?</span></span> <span data-ttu-id="acf66-251">BT olmadığından `UrlAuthorizationModule` ikinci soruya devam ediyor, her biri bir herkes kümesi değil mi?</span><span class="sxs-lookup"><span data-stu-id="acf66-251">Since she is not, the `UrlAuthorizationModule` proceeds to the second question, Is Jisun in the set of everybody?</span></span> <span data-ttu-id="acf66-252">Yani, çok, erişimi engellenmiş.</span><span class="sxs-lookup"><span data-stu-id="acf66-252">She is, so she, too, is denied access.</span></span> <span data-ttu-id="acf66-253">Son olarak, Eğer ziyaret edirse, `UrlAuthorizationModule` ortaya etkilenen ilk soru, bu nedenle erişim izni verilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-253">Finally, if Tito visits, the first question posed by the `UrlAuthorizationModule` is an affirmative answer, so Tito is granted access.</span></span>

<span data-ttu-id="acf66-254">`UrlAuthorizationModule`, kimlik doğrulama kurallarını yukarıdan aşağı doğru işlediği ve herhangi bir eşleşmede durduğundan, daha belirli kuralların daha az spesifik olanlardan önce gelmesi önemlidir.</span><span class="sxs-lookup"><span data-stu-id="acf66-254">Since the `UrlAuthorizationModule` processes the authorization rules from the top down, stopping at any match, it is important to have the more specific rules come before the less specific ones.</span></span> <span data-ttu-id="acf66-255">Diğer bir deyişle, Jisun ve anonim kullanıcıları teklif eden, ancak diğer tüm kimliği doğrulanmış tüm kullanıcılara izin veren yetkilendirme kurallarını tanımlamak için en belirli kuralla başlayacaksınız; Jisun 'yi etkileyen ve daha az özel kurallara devam eden kimliği doğrulanmış kullanıcılar, ancak tüm anonim kullanıcılar reddediliyor.</span><span class="sxs-lookup"><span data-stu-id="acf66-255">That is, to define authorization rules that forbid Jisun and anonymous users, but allow all other authenticated users, you would start with the most specific rule - the one impacting Jisun - and then proceed to the less specific rules - those allowing all other authenticated users, but denying all anonymous users.</span></span> <span data-ttu-id="acf66-256">Aşağıdaki URL Yetkilendirme kuralları, önce Jisun ' ı reddettikten sonra anonim kullanıcıları reddettikten sonra bu ilkeyi uygular.</span><span class="sxs-lookup"><span data-stu-id="acf66-256">The following URL authorization rules implements this policy by first denying Jisun, and then denying any anonymous user.</span></span> <span data-ttu-id="acf66-257">Bu `<deny>` deyimlerinin hiçbiri eşleşmediğinden, Jisun dışında kimliği doğrulanmış bir kullanıcıya erişim izni verilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-257">Any authenticated user other than Jisun will be granted access because neither of these `<deny>` statements will match.</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a><span data-ttu-id="acf66-258">2\. Adım: yetkisiz, kimliği doğrulanmış kullanıcılar için Iş akışını düzeltme</span><span class="sxs-lookup"><span data-stu-id="acf66-258">Step 2: Fixing the Workflow for Unauthorized, Authenticated Users</span></span>

<span data-ttu-id="acf66-259">Bu öğreticide daha önce açıklanan URL yetkilendirmesi Iş akışı bölümünde, yetkisiz bir istek transpires, `UrlAuthorizationModule` isteği durdurur ve HTTP 401 Yetkisiz durumunu döndürür.</span><span class="sxs-lookup"><span data-stu-id="acf66-259">As we discussed earlier in this tutorial in the A Look at the URL Authorization Workflow section, anytime an unauthorized request transpires, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="acf66-260">Bu 401 durumu, Kullanıcı oturum açma sayfasına gönderen bir 302 yeniden yönlendirme durumuna `FormsAuthenticationModule` tarafından değiştirilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-260">This 401 status is modified by the `FormsAuthenticationModule` into a 302 Redirect status that sends the user to the login page.</span></span> <span data-ttu-id="acf66-261">Bu iş akışı, kullanıcının kimliği doğrulansa bile, tüm yetkisiz istekler üzerinde gerçekleşir.</span><span class="sxs-lookup"><span data-stu-id="acf66-261">This workflow occurs on any unauthorized request, even if the user is authenticated.</span></span>

<span data-ttu-id="acf66-262">Kimliği doğrulanmış bir kullanıcının oturum açma sayfasına döndürülmesi, sistemde zaten oturum açtığından bu yana şaşırmaları olasıdır.</span><span class="sxs-lookup"><span data-stu-id="acf66-262">Returning an authenticated user to the login page is likely to confuse them since they have already logged into the system.</span></span> <span data-ttu-id="acf66-263">Çok az iş sayesinde bu iş akışını, kısıtlı bir sayfaya erişmeye çalıştıolduklarını açıklayan, kimliği doğrulanmış kullanıcıları bir sayfaya yönlendirerek iyileştirebiliriz.</span><span class="sxs-lookup"><span data-stu-id="acf66-263">With a little bit of work we can improve this workflow by redirecting authenticated users who make unauthorized requests to a page that explains that they have attempted to access a restricted page.</span></span>

<span data-ttu-id="acf66-264">Web uygulamasının `UnauthorizedAccess.aspx`adlı kök klasörde yeni bir ASP.NET sayfası oluşturarak başlayın. Bu sayfayı `Site.master` ana sayfasıyla ilişkilendirmeyi unutmayın.</span><span class="sxs-lookup"><span data-stu-id="acf66-264">Start by creating a new ASP.NET page in the web application's root folder named `UnauthorizedAccess.aspx`; don't forget to associate this page with the `Site.master` master page.</span></span> <span data-ttu-id="acf66-265">Bu sayfayı oluşturduktan sonra ana sayfanın varsayılan içeriğinin görüntülenmesi için `LoginContent` ContentPlaceHolder öğesine başvuran Içerik denetimini kaldırın.</span><span class="sxs-lookup"><span data-stu-id="acf66-265">After creating this page, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the master page's default content will be displayed.</span></span> <span data-ttu-id="acf66-266">Ardından, durumu açıklayan bir ileti ekleyin, yani kullanıcı korumalı bir kaynağa erişmeyi denedi.</span><span class="sxs-lookup"><span data-stu-id="acf66-266">Next, add a message that explains the situation, namely that the user attempted to access a protected resource.</span></span> <span data-ttu-id="acf66-267">Böyle bir ileti eklendikten sonra, `UnauthorizedAccess.aspx` sayfanın bildirim temelli işaretleme aşağıdakine benzer şekilde görünmelidir:</span><span class="sxs-lookup"><span data-stu-id="acf66-267">After adding such a message, the `UnauthorizedAccess.aspx` page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample7.aspx)]

<span data-ttu-id="acf66-268">Artık, yetkisiz bir istek kimliği doğrulanmış bir kullanıcı tarafından, oturum açma sayfası yerine `UnauthorizedAccess.aspx` sayfasına gönderiliyorsa, iş akışını değiştirmemiz gerekiyor.</span><span class="sxs-lookup"><span data-stu-id="acf66-268">We now need to alter the workflow so that if an unauthorized request is performed by an authenticated user they are sent to the `UnauthorizedAccess.aspx` page instead of the login page.</span></span> <span data-ttu-id="acf66-269">Yetkisiz istekleri oturum açma sayfasına yönlendiren mantık `FormsAuthenticationModule` sınıfının özel bir yöntemi içine eklenir, bu nedenle bu davranışı özelleştiremezsiniz.</span><span class="sxs-lookup"><span data-stu-id="acf66-269">The logic that redirects unauthorized requests to the login page is buried within a private method of the `FormsAuthenticationModule` class, so we cannot customize this behavior.</span></span> <span data-ttu-id="acf66-270">Ancak, bunu yapabiliriz, oturum açma sayfasına, gerekirse kullanıcıyı `UnauthorizedAccess.aspx`yeniden yönlendiren kendi mantığımızı ekliyoruz.</span><span class="sxs-lookup"><span data-stu-id="acf66-270">What we can do, however, is add our own logic to the login page that redirects the user to `UnauthorizedAccess.aspx`, if needed.</span></span>

<span data-ttu-id="acf66-271">`FormsAuthenticationModule` yetkisiz bir ziyaretçiye oturum açma sayfasına yönlendirirse, istenen, yetkisiz URL 'yi QueryString öğesine `ReturnUrl`adı ile ekler.</span><span class="sxs-lookup"><span data-stu-id="acf66-271">When the `FormsAuthenticationModule` redirects an unauthorized visitor to the login page it appends the requested, unauthorized URL to the querystring with the name `ReturnUrl`.</span></span> <span data-ttu-id="acf66-272">Örneğin, yetkisiz bir Kullanıcı `OnlyTito.aspx`ziyaret etmeyi denediğinde `FormsAuthenticationModule` `Login.aspx?ReturnUrl=OnlyTito.aspx`yeniden yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="acf66-272">For example, if an unauthorized user attempted to visit `OnlyTito.aspx`, the `FormsAuthenticationModule` would redirect them to `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span></span> <span data-ttu-id="acf66-273">Bu nedenle, oturum açma sayfasına `ReturnUrl` parametresi içeren bir QueryString ile kimliği doğrulanmış bir kullanıcı tarafından ulaşılırsa, bu kimliği doğrulanmamış kullanıcının görüntüleme yetkisine sahip olmayan bir sayfayı ziyaret etmeyi denediğini biliyoruz.</span><span class="sxs-lookup"><span data-stu-id="acf66-273">Therefore, if the login page is reached by an authenticated user with a querystring that includes the `ReturnUrl` parameter, then we know that this unauthenticated user just attempted to visit a page she is not authorized to view.</span></span> <span data-ttu-id="acf66-274">Böyle bir durumda, `UnauthorizedAccess.aspx`' a yönlendirmek istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="acf66-274">In such a case, we want to redirect her to `UnauthorizedAccess.aspx`.</span></span>

<span data-ttu-id="acf66-275">Bunu gerçekleştirmek için, oturum açma sayfasının `Page_Load` olay işleyicisine aşağıdaki kodu ekleyin:</span><span class="sxs-lookup"><span data-stu-id="acf66-275">To accomplish this, add the following code to the login page's `Page_Load` event handler:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample8.cs)]

<span data-ttu-id="acf66-276">Yukarıdaki kod kimliği doğrulanmış, yetkisiz kullanıcıları `UnauthorizedAccess.aspx` sayfasına yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="acf66-276">The above code redirects authenticated, unauthorized users to the `UnauthorizedAccess.aspx` page.</span></span> <span data-ttu-id="acf66-277">Bu mantığı çalışırken görmek için, siteyi anonim bir ziyaretçi olarak ziyaret edin ve sol sütundaki Kullanıcı hesapları oluşturma bağlantısına tıklayın.</span><span class="sxs-lookup"><span data-stu-id="acf66-277">To see this logic in action, visit the site as an anonymous visitor and click on the Creating User Accounts link in the left column.</span></span> <span data-ttu-id="acf66-278">Bu işlem sizi, 1. adımda yalnızca Tito 'a erişime izin verecek şekilde yapılandırdığımız `~/Membership/CreatingUserAccounts.aspx` sayfasına götürür.</span><span class="sxs-lookup"><span data-stu-id="acf66-278">This will take you to the `~/Membership/CreatingUserAccounts.aspx` page, which in Step 1 we configured to only permit access to Tito.</span></span> <span data-ttu-id="acf66-279">Anonim kullanıcılar yasaklanmış olduğundan `FormsAuthenticationModule`, bize oturum açma sayfasına yeniden yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="acf66-279">Since anonymous users are prohibited, the `FormsAuthenticationModule` redirects us back to the login page.</span></span>

<span data-ttu-id="acf66-280">Bu noktada anonim olarak `Request.IsAuthenticated` `false` `UnauthorizedAccess.aspx`geri yönlendirilmedik.</span><span class="sxs-lookup"><span data-stu-id="acf66-280">At this point we are anonymous, so `Request.IsAuthenticated` returns `false` and we are not redirected to `UnauthorizedAccess.aspx`.</span></span> <span data-ttu-id="acf66-281">Bunun yerine, oturum açma sayfası görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="acf66-281">Instead, the login page is displayed.</span></span> <span data-ttu-id="acf66-282">Deneme sürümünden farklı bir kullanıcı olarak oturum açın.</span><span class="sxs-lookup"><span data-stu-id="acf66-282">Log in as a user other than Tito, such as Bruce.</span></span> <span data-ttu-id="acf66-283">Uygun kimlik bilgilerini girdikten sonra, oturum açma sayfası bize yeniden `~/Membership/CreatingUserAccounts.aspx`yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="acf66-283">After entering the appropriate credentials, the login page redirects us back to `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="acf66-284">Ancak, bu sayfaya yalnızca Tito tarafından erişilebileceğinden, görüntüleme yetkisi veriyoruz ve oturum açma sayfasına hemen geri döndürülüyor.</span><span class="sxs-lookup"><span data-stu-id="acf66-284">However, since this page is only accessible to Tito, we are unauthorized to view it and are promptly returned to the login page.</span></span> <span data-ttu-id="acf66-285">Ancak, `Request.IsAuthenticated` `true` döndürür (ve `ReturnUrl` QueryString parametresi bulunur), bu nedenle `UnauthorizedAccess.aspx` sayfasına yönlendirilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="acf66-285">This time, however, `Request.IsAuthenticated` returns `true` (and the `ReturnUrl` querystring parameter exists), so we are redirected to the `UnauthorizedAccess.aspx` page.</span></span>

<span data-ttu-id="acf66-286">[![kimliği doğrulanmış, yetkisiz kullanıcılar UnauthorizedAccess. aspx 'e yeniden yönlendirildi](user-based-authorization-cs/_static/image17.png)](user-based-authorization-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-286">[![Authenticated, Unauthorized Users are Redirected to UnauthorizedAccess.aspx](user-based-authorization-cs/_static/image17.png)](user-based-authorization-cs/_static/image16.png)</span></span>

<span data-ttu-id="acf66-287">**Şekil 6**: kimliği doğrulanmış, yetkisiz kullanıcılar `UnauthorizedAccess.aspx` yönlendirilir ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-287">**Figure 6**: Authenticated, Unauthorized Users are Redirected to `UnauthorizedAccess.aspx` ([Click to view full-size image](user-based-authorization-cs/_static/image18.png))</span></span>

<span data-ttu-id="acf66-288">Bu özelleştirilmiş iş akışı, Şekil 2 ' de gösterilen döngüyü kısa bir süre sonra çok daha kolay ve kolay bir şekilde bir kullanıcı deneyimi sunar.</span><span class="sxs-lookup"><span data-stu-id="acf66-288">This customized workflow presents a more sensible and straightforward user experience by short circuiting the cycle depicted in Figure 2.</span></span>

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a><span data-ttu-id="acf66-289">3\. Adım: Şu anda oturum açmış olan kullanıcıya göre Işlevselliği sınırlandırma</span><span class="sxs-lookup"><span data-stu-id="acf66-289">Step 3: Limiting Functionality Based on the Currently Logged In User</span></span>

<span data-ttu-id="acf66-290">URL yetkilendirmesi, kaba yetkilendirme kuralları belirtmeyi kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="acf66-290">URL authorization makes it easy to specify coarse authorization rules.</span></span> <span data-ttu-id="acf66-291">Adım 1 ' de gördüğünüz gibi, URL yetkilendirmesi ile, hangi kimliklerin izin verileceğini ve hangilerinin belirli bir sayfayı veya bir klasördeki tüm sayfaları görüntülemesi reddedildiğini succinctly olabilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-291">As we saw in Step 1, with URL authorization we can succinctly state what identities are permitted and which ones are denied from viewing a particular page or all pages in a folder.</span></span> <span data-ttu-id="acf66-292">Ancak, bazı senaryolarda, tüm kullanıcıların bir sayfayı ziyaret etmesini sağlamak isteyebilir, ancak sayfayı ziyaret eden kullanıcıya göre sayfanın işlevlerini sınırlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="acf66-292">In certain scenarios, however, we may want to allow all users to visit a page, but limit the page's functionality based on the user visiting it.</span></span>

<span data-ttu-id="acf66-293">Kimliği doğrulanmış ziyaretçilerin ürünlerini gözden geçirmesine izin veren bir eCommerce Web sitesinin durumunu göz önünde bulundurun.</span><span class="sxs-lookup"><span data-stu-id="acf66-293">Consider the case of an eCommerce website that allows authenticated visitors to review their products.</span></span> <span data-ttu-id="acf66-294">Anonim Kullanıcı bir ürünün sayfasını ziyaret ettiğinde yalnızca ürün bilgilerini görürler ve bir gözden geçirme bırakma fırsatı verilmeyebilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-294">When an anonymous user visits a product's page, they would see just the product information and would not be given the opportunity to leave a review.</span></span> <span data-ttu-id="acf66-295">Ancak, aynı sayfayı ziyaret eden kimliği doğrulanmış bir Kullanıcı İnceleme arabirimini görür.</span><span class="sxs-lookup"><span data-stu-id="acf66-295">However, an authenticated user visiting the same page would see the reviewing interface.</span></span> <span data-ttu-id="acf66-296">Kimliği doğrulanmış kullanıcı henüz bu ürünü gözden geçirmediyse, arabirim bunları bir gözden geçirme göndermelerini sağlar; Aksi takdirde, önceden gönderilen gözden geçirmeyi gösterir.</span><span class="sxs-lookup"><span data-stu-id="acf66-296">If the authenticated user had not yet reviewed this product, the interface would enable them to submit a review; otherwise it would show them their previously-submitted review.</span></span> <span data-ttu-id="acf66-297">Bu senaryoyu daha ayrıntılı bir şekilde gerçekleştirmek için, ürün sayfasında, e-ticaret şirketi için çalışan kullanıcılar için ek bilgiler gösterilebilir ve genişletilmiş özellikler sunabilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-297">To take this scenario a step further, the product page might show additional information and offer extended features for those users that work for the eCommerce company.</span></span> <span data-ttu-id="acf66-298">Örneğin, ürün sayfası envanterdeki stoku listeleyebilir ve bir çalışan tarafından ziyaret edildiğinde ürünün fiyatını ve açıklamasını düzenleme seçeneklerini içerir.</span><span class="sxs-lookup"><span data-stu-id="acf66-298">For example, the product page might list the inventory in stock and include options to edit the product's price and description when visited by an employee.</span></span>

<span data-ttu-id="acf66-299">Bu tür ince yetkilendirme kuralları, bildirimli veya programlı olarak (ya da ikisinin bir birleşimi aracılığıyla) uygulanabilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-299">Such fine grain authorization rules can be implemented either declaratively or programmatically (or through some combination of the two).</span></span> <span data-ttu-id="acf66-300">Sonraki bölümde, LoginView denetimi aracılığıyla ince bir yetkilendirmeyi nasıl uygulayacağınızı öğreneceksiniz.</span><span class="sxs-lookup"><span data-stu-id="acf66-300">In the next section we will see how to implement fine grain authorization via the LoginView control.</span></span> <span data-ttu-id="acf66-301">Bundan sonra, programlama tekniklerini keşfedecektir.</span><span class="sxs-lookup"><span data-stu-id="acf66-301">Following that, we will explore programmatic techniques.</span></span> <span data-ttu-id="acf66-302">Ancak, ince gretik yetkilendirme kuralları uygulamaya bakmadan önce, işlevselliği ziyaret eden kullanıcıya bağlı olan bir sayfa oluşturmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="acf66-302">Before we can look at applying fine grain authorization rules, however, we first need to create a page whose functionality depends on the user visiting it.</span></span>

<span data-ttu-id="acf66-303">GridView içindeki belirli bir dizindeki dosyaları listeleyen bir sayfa oluşturalım.</span><span class="sxs-lookup"><span data-stu-id="acf66-303">Let's create a page that lists the files in a particular directory within a GridView.</span></span> <span data-ttu-id="acf66-304">Her bir dosyanın adını, boyutunu ve diğer bilgilerini listelemesi ile GridView, LinkButtons 'ın iki sütununu içerir: One başlıklı görünüm ve bir DELETE.</span><span class="sxs-lookup"><span data-stu-id="acf66-304">Along with listing each file's name, size, and other information, the GridView will include two columns of LinkButtons: one titled View and one titled Delete.</span></span> <span data-ttu-id="acf66-305">Bağlantı görüntüle düğmesine tıklandıysanız, seçili dosyanın içeriği görüntülenir; Bağlantı Sil düğmesine tıklandıysanız dosya silinir.</span><span class="sxs-lookup"><span data-stu-id="acf66-305">If the View LinkButton is clicked, the contents of the selected file will be displayed; if the Delete LinkButton is clicked, the file will be deleted.</span></span> <span data-ttu-id="acf66-306">İlk olarak bu sayfayı, görüntüleme ve silme işlevinin tüm kullanıcılar tarafından kullanılabilmesini sağlayan şekilde oluşturalım.</span><span class="sxs-lookup"><span data-stu-id="acf66-306">Let's initially create this page such that its view and delete functionality is available to all users.</span></span> <span data-ttu-id="acf66-307">LoginView denetimini kullanarak ve Işlev bölümlerini programlı olarak sınırlayarak, sayfayı ziyaret eden kullanıcıya göre bu özelliklerin nasıl etkinleştirileceğini veya devre dışı bırakılacağını öğreneceğiz.</span><span class="sxs-lookup"><span data-stu-id="acf66-307">In the Using the LoginView Control and Programmatically Limiting Functionality sections we will see how to enable or disable these features based on the user visiting the page.</span></span>

> [!NOTE]
> <span data-ttu-id="acf66-308">Derlemek üzere yaptığımız ASP.NET sayfası, bir dosya listesini göstermek için bir GridView denetimi kullanır.</span><span class="sxs-lookup"><span data-stu-id="acf66-308">The ASP.NET page we are about to build uses a GridView control to display a list of files.</span></span> <span data-ttu-id="acf66-309">Bu öğretici serisi form kimlik doğrulaması, yetkilendirme, Kullanıcı hesapları ve rollere odaklandığından, GridView denetiminin iç çalışmalarını ele almak çok fazla zaman harcamayı istemiyorum.</span><span class="sxs-lookup"><span data-stu-id="acf66-309">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, I do not want to spend too much time discussing the inner workings of the GridView control.</span></span> <span data-ttu-id="acf66-310">Bu öğretici, bu sayfayı ayarlamaya yönelik belirli adım adım yönergeler sağlarken, belirli seçimlerin neden yapıldığına ilişkin ayrıntıları veya işlenen çıktıda belirli özellikler hangi etkilerle olduğunu anlamaz.</span><span class="sxs-lookup"><span data-stu-id="acf66-310">While this tutorial provides specific step-by-step instructions for setting up this page, it does not delve into the details of why certain choices were made, or what effect particular properties have on the rendered output.</span></span> <span data-ttu-id="acf66-311">GridView denetimini kapsamlı bir şekilde incelemek için ASP.NET 2,0 öğretici serisinde *[verilerle çalışmama](../../data-access/index.md)* bakın.</span><span class="sxs-lookup"><span data-stu-id="acf66-311">For a thorough examination of the GridView control, consult my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="acf66-312">`UserBasedAuthorization.aspx` dosyasını `Membership` klasöründe açıp `FilesGrid`adlı sayfaya bir GridView denetimi ekleyerek başlayın.</span><span class="sxs-lookup"><span data-stu-id="acf66-312">Start by opening the `UserBasedAuthorization.aspx` file in the `Membership` folder and adding a GridView control to the page named `FilesGrid`.</span></span> <span data-ttu-id="acf66-313">GridView 'un akıllı etiketinde alanları Düzenle bağlantısına tıklayarak alanları başlatın iletişim kutusunu seçin.</span><span class="sxs-lookup"><span data-stu-id="acf66-313">From the GridView's Smart Tag, click the Edit Columns link to launch the Fields dialog box.</span></span> <span data-ttu-id="acf66-314">Buradan sol alt köşedeki alanları otomatik oluştur onay kutusunun işaretini kaldırın.</span><span class="sxs-lookup"><span data-stu-id="acf66-314">From here, uncheck the Auto-generate fields checkbox in the lower left corner.</span></span> <span data-ttu-id="acf66-315">Ardından, sol üst köşeden bir SELECT düğmesi, Delete düğmesi ve iki BoundFields ekleyin (Select ve DELETE düğmeleri CommandField türü altında bulunabilir).</span><span class="sxs-lookup"><span data-stu-id="acf66-315">Next, add a Select button, a Delete button, and two BoundFields from the upper left corner (the Select and Delete buttons can be found under the CommandField type).</span></span> <span data-ttu-id="acf66-316">Select düğmesinin `SelectText` özelliğini View ve ilk BoundField 'ın `HeaderText` ve `DataField` özelliklerini olacak şekilde ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="acf66-316">Set the Select button's `SelectText` property to View and the first BoundField's `HeaderText` and `DataField` properties to Name.</span></span> <span data-ttu-id="acf66-317">İkinci BoundField 'ın `HeaderText` özelliğini bayt cinsinden, `DataField` özelliğinin uzunluğu, `DataFormatString` özelliğini {0:N0} ve `HtmlEncode` özelliğini false olarak ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="acf66-317">Set the second BoundField's `HeaderText` property to Size in Bytes, its `DataField` property to Length, its `DataFormatString` property to {0:N0} and its `HtmlEncode` property to False.</span></span>

<span data-ttu-id="acf66-318">GridView 'un sütunlarını yapılandırdıktan sonra, alanlar iletişim kutusunu kapatmak için Tamam ' ı tıklatın.</span><span class="sxs-lookup"><span data-stu-id="acf66-318">After configuring the GridView's columns, click OK to close the Fields dialog box.</span></span> <span data-ttu-id="acf66-319">Özellikler penceresi, GridView 'un `DataKeyNames` özelliğini `FullName`olarak ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="acf66-319">From the Properties window, set the GridView's `DataKeyNames` property to `FullName`.</span></span> <span data-ttu-id="acf66-320">Bu noktada, GridView 'un bildirim temelli işaretleme aşağıdaki gibi görünmelidir:</span><span class="sxs-lookup"><span data-stu-id="acf66-320">At this point the GridView's declarative markup should look like the following:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample9.aspx)]

<span data-ttu-id="acf66-321">GridView 'un biçimlendirmesi oluşturulduktan sonra, belirli bir dizindeki dosyaları alacak ve GridView 'a bağlayacağınız kodu yazmaya hazırız.</span><span class="sxs-lookup"><span data-stu-id="acf66-321">With the GridView's markup created, we're ready to write the code that will retrieve the files in a particular directory and bind them to the GridView.</span></span> <span data-ttu-id="acf66-322">Aşağıdaki kodu sayfanın `Page_Load` olay işleyicisine ekleyin:</span><span class="sxs-lookup"><span data-stu-id="acf66-322">Add the following code to the page's `Page_Load` event handler:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample10.cs)]

<span data-ttu-id="acf66-323">Yukarıdaki kod, uygulamanın kök klasöründeki dosyaların listesini almak için [`DirectoryInfo` sınıfını](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) kullanır.</span><span class="sxs-lookup"><span data-stu-id="acf66-323">The above code uses the [`DirectoryInfo` class](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) to obtain a list of the files in the application's root folder.</span></span> <span data-ttu-id="acf66-324">[`GetFiles()` yöntemi](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) , dizindeki tüm dosyaları bir [`FileInfo` nesneleri](https://msdn.microsoft.com/library/system.io.fileinfo.aspx)dizisi olarak döndürür ve daha sonra GridView 'a bağlanır.</span><span class="sxs-lookup"><span data-stu-id="acf66-324">The [`GetFiles()` method](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) returns all of the files in the directory as an array of [`FileInfo` objects](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), which is then bound to the GridView.</span></span> <span data-ttu-id="acf66-325">`FileInfo` nesnesi, diğerleri arasında `Name`, `Length`ve `IsReadOnly`gibi bir özellikler sınıfmıştır.</span><span class="sxs-lookup"><span data-stu-id="acf66-325">The `FileInfo` object has an assortment of properties, such as `Name`, `Length`, and `IsReadOnly`, among others.</span></span> <span data-ttu-id="acf66-326">Bildirim temelli işaretlerinden görebileceğiniz gibi, GridView yalnızca `Name` ve `Length` özelliklerini görüntüler.</span><span class="sxs-lookup"><span data-stu-id="acf66-326">As you can see from its declarative markup, the GridView displays just the `Name` and `Length` properties.</span></span>

> [!NOTE]
> <span data-ttu-id="acf66-327">`DirectoryInfo` ve `FileInfo` sınıfları [`System.IO` ad alanında](https://msdn.microsoft.com/library/system.io.aspx)bulunur.</span><span class="sxs-lookup"><span data-stu-id="acf66-327">The `DirectoryInfo` and `FileInfo` classes are found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="acf66-328">Bu nedenle, bu sınıf adlarını ad alanı adlarıyla önceden hissetmek ya da ad alanını sınıf dosyasına (`using System.IO`aracılığıyla) içeri aktarmış olmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="acf66-328">Therefore, you will either need to preface these class names with their namespace names or have the namespace imported into the class file (via `using System.IO`).</span></span>

<span data-ttu-id="acf66-329">Bir tarayıcı aracılığıyla bu sayfayı ziyaret etmek için bir dakikanızı ayırın.</span><span class="sxs-lookup"><span data-stu-id="acf66-329">Take a moment to visit this page through a browser.</span></span> <span data-ttu-id="acf66-330">Uygulamanın kök dizininde bulunan dosyaların listesini görüntüler.</span><span class="sxs-lookup"><span data-stu-id="acf66-330">It will display the list of files residing in the application's root directory.</span></span> <span data-ttu-id="acf66-331">Görünüm veya silme bağlantı düğmelerinden herhangi birine tıklamak geri göndermeye neden olur, ancak henüz gerekli olay işleyicilerini oluşturduğumuz için hiçbir işlem gerçekleşmez.</span><span class="sxs-lookup"><span data-stu-id="acf66-331">Clicking any of the View or Delete LinkButtons will cause a postback, but no action will occur because we've yet to create the necessary event handlers.</span></span>

<span data-ttu-id="acf66-332">[GridView ![Web uygulamasının kök dizinindeki dosyaları listeler](user-based-authorization-cs/_static/image20.png)](user-based-authorization-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-332">[![The GridView Lists the Files in the Web Application's Root Directory](user-based-authorization-cs/_static/image20.png)](user-based-authorization-cs/_static/image19.png)</span></span>

<span data-ttu-id="acf66-333">**Şekil 7**: GridView, Web uygulamasının kök dizinindeki dosyaları listeler ([tam boyutlu görüntüyü görüntülemek için tıklayın](user-based-authorization-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-333">**Figure 7**: The GridView Lists the Files in the Web Application's Root Directory  ([Click to view full-size image](user-based-authorization-cs/_static/image21.png))</span></span>

<span data-ttu-id="acf66-334">Seçili dosyanın içeriğini göstermek için bir yol gerekir.</span><span class="sxs-lookup"><span data-stu-id="acf66-334">We need a means to display the contents of the selected file.</span></span> <span data-ttu-id="acf66-335">Visual Studio 'ya dönün ve GridView 'un üzerinde `FileContents` adlı bir metin kutusu ekleyin.</span><span class="sxs-lookup"><span data-stu-id="acf66-335">Return to Visual Studio and add a TextBox named `FileContents` above the GridView.</span></span> <span data-ttu-id="acf66-336">`TextMode` özelliğini `MultiLine` ve `Columns` ve `Rows` özellikleri sırasıyla %95 ve 10 olarak ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="acf66-336">Set its `TextMode` property to `MultiLine` and its `Columns` and `Rows` properties to 95% and 10, respectively.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample11.aspx)]

<span data-ttu-id="acf66-337">Sonra, GridView 'un [`SelectedIndexChanged` olayı](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) için bir olay işleyicisi oluşturun ve aşağıdaki kodu ekleyin:</span><span class="sxs-lookup"><span data-stu-id="acf66-337">Next, create an event handler for the GridView's [`SelectedIndexChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) and add the following code:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample12.cs)]

<span data-ttu-id="acf66-338">Bu kod, seçili dosyanın tam dosya adını öğrenmek için GridView 'un `SelectedValue` özelliğini kullanır.</span><span class="sxs-lookup"><span data-stu-id="acf66-338">This code uses the GridView's `SelectedValue` property to determine the full file name of the selected file.</span></span> <span data-ttu-id="acf66-339">Dahili olarak, `SelectedValue`almak için `DataKeys` koleksiyonuna başvurulur, bu nedenle bu adımda daha önce anlatıldığı gibi GridView 'un `DataKeyNames` özelliğini ad olarak ayarlamanız zorunludur.</span><span class="sxs-lookup"><span data-stu-id="acf66-339">Internally, the `DataKeys` collection is referenced in order to obtain the `SelectedValue`, so it is imperative that you set the GridView's `DataKeyNames` property to Name, as described earlier in this step.</span></span> <span data-ttu-id="acf66-340">[`File` sınıfı](https://msdn.microsoft.com/library/system.io.file.aspx) seçili dosyanın içeriğini bir dizeye okumak için kullanılır. Bu, daha sonra `FileContents` TextBox 'ın `Text` özelliğine atanır ve bu sayede seçili dosyanın içeriğini sayfada görüntüler.</span><span class="sxs-lookup"><span data-stu-id="acf66-340">The [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) is used to read the selected file's contents into a string, which is then assigned to the `FileContents` TextBox's `Text` property, thereby displaying the contents of the selected file on the page.</span></span>

<span data-ttu-id="acf66-341">[![seçili dosyanın Içeriği metin kutusunda görüntülenir](user-based-authorization-cs/_static/image23.png)](user-based-authorization-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-341">[![The Selected File's Contents are Displayed in the TextBox](user-based-authorization-cs/_static/image23.png)](user-based-authorization-cs/_static/image22.png)</span></span>

<span data-ttu-id="acf66-342">**Şekil 8**: Seçili dosyanın içeriği metin kutusunda görüntülenir ([tam boyutlu görüntüyü görüntülemek için tıklayın](user-based-authorization-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-342">**Figure 8**: The Selected File's Contents are Displayed in the TextBox  ([Click to view full-size image](user-based-authorization-cs/_static/image24.png))</span></span>

> [!NOTE]
> <span data-ttu-id="acf66-343">HTML işaretlemesi içeren bir dosyanın içeriğini görüntüleyip bir dosyayı görüntülemeyi veya silmeyi denerseniz, bir `HttpRequestValidationException` hatası alırsınız.</span><span class="sxs-lookup"><span data-stu-id="acf66-343">If you view the contents of a file that contains HTML markup, and then attempt to view or delete a file, you will receive an `HttpRequestValidationException` error.</span></span> <span data-ttu-id="acf66-344">Bunun nedeni, geri göndermede metin kutusu içeriğinin Web sunucusuna geri gönderilmesi nedeniyle oluşur.</span><span class="sxs-lookup"><span data-stu-id="acf66-344">This occurs because on postback the TextBox's contents are sent back to the web server.</span></span> <span data-ttu-id="acf66-345">Varsayılan olarak, ASP.NET, olası tehlikeli geri gönderme içerikleri (HTML biçimlendirme gibi) algılandığında `HttpRequestValidationException` bir hata oluşturur.</span><span class="sxs-lookup"><span data-stu-id="acf66-345">By default, ASP.NET raises an `HttpRequestValidationException` error whenever potentially dangerous postback content, such as HTML markup, is detected.</span></span> <span data-ttu-id="acf66-346">Bu hatanın oluşmasını devre dışı bırakmak için `@Page` yönergesine `ValidateRequest="false"` ekleyerek sayfanın istek doğrulamasını kapatın.</span><span class="sxs-lookup"><span data-stu-id="acf66-346">To disable this error from occurring, turn off request validation for the page by adding `ValidateRequest="false"` to the `@Page` directive.</span></span> <span data-ttu-id="acf66-347">İstek doğrulamanın avantajları ve bunu devre dışı bırakırken gerçekleştirmeniz gereken önlemler hakkında daha fazla bilgi için, [Istek doğrulama-betiği engellemeyi](https://asp.net/learn/whitepapers/request-validation/)okuyun.</span><span class="sxs-lookup"><span data-stu-id="acf66-347">For more information on the benefits of request validation as well as what precautions you should take when disabling it, read [Request Validation - Preventing Script Attacks](https://asp.net/learn/whitepapers/request-validation/).</span></span>

<span data-ttu-id="acf66-348">Son olarak, GridView 'un [`RowDeleting` olayı](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx)için aşağıdaki kodla bir olay işleyicisi ekleyin:</span><span class="sxs-lookup"><span data-stu-id="acf66-348">Finally, add an event handler with the following code for the GridView's [`RowDeleting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample13.cs)]

<span data-ttu-id="acf66-349">Kod, dosyanın gerçekten *silinmeksizin* `FileContents` metin kutusunda silinecek dosyanın tam adını görüntüler.</span><span class="sxs-lookup"><span data-stu-id="acf66-349">The code simply displays the full name of the file to delete in the `FileContents` TextBox *without* actually deleting the file.</span></span>

<span data-ttu-id="acf66-350">[Sil düğmesine tıklamak ![dosyayı gerçekten silmez](user-based-authorization-cs/_static/image26.png)](user-based-authorization-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-350">[![Clicking the Delete Button Does Not Actually Delete the File](user-based-authorization-cs/_static/image26.png)](user-based-authorization-cs/_static/image25.png)</span></span>

<span data-ttu-id="acf66-351">**Şekil 9**: Sil düğmesine tıklamak dosyayı gerçekten silmez ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-351">**Figure 9**: Clicking the Delete Button Does Not Actually Delete the File  ([Click to view full-size image](user-based-authorization-cs/_static/image27.png))</span></span>

<span data-ttu-id="acf66-352">1\. adımda, anonim kullanıcıların `Membership` klasöründeki sayfaları görüntülemesini engellemek için URL yetkilendirme kurallarını yapılandırdık.</span><span class="sxs-lookup"><span data-stu-id="acf66-352">In Step 1 we configured the URL authorization rules to prohibit anonymous users from viewing the pages in the `Membership` folder.</span></span> <span data-ttu-id="acf66-353">İnce bir kimlik doğrulaması daha iyi bir şekilde sergilebilmek için anonim kullanıcıların `UserBasedAuthorization.aspx` sayfasını ziyaret edebilmesine izin verlim, ancak sınırlı işlevsellikle.</span><span class="sxs-lookup"><span data-stu-id="acf66-353">In order to better exhibit fine grain authentication, let's allow anonymous users to visit the `UserBasedAuthorization.aspx` page, but with limited functionality.</span></span> <span data-ttu-id="acf66-354">Bu sayfayı tüm kullanıcılar tarafından erişilecek şekilde açmak için, aşağıdaki `<location>` öğesini `Membership` klasöründeki `Web.config` dosyasına ekleyin:</span><span class="sxs-lookup"><span data-stu-id="acf66-354">To open this page up to be accessed by all users, add the following `<location>` element to the `Web.config` file in the `Membership` folder:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample14.xml)]

<span data-ttu-id="acf66-355">Bu `<location>` öğesi eklendikten sonra, site oturumunu kapatarak yeni URL yetkilendirme kurallarını test edin.</span><span class="sxs-lookup"><span data-stu-id="acf66-355">After adding this `<location>` element, test the new URL authorization rules by logging out of the site.</span></span> <span data-ttu-id="acf66-356">Anonim bir kullanıcı olarak `UserBasedAuthorization.aspx` sayfasını ziyaret etmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="acf66-356">As an anonymous user you should be permitted to visit the `UserBasedAuthorization.aspx` page.</span></span>

<span data-ttu-id="acf66-357">Şu anda, kimliği doğrulanmış veya anonim kullanıcı `UserBasedAuthorization.aspx` sayfasını ziyaret edebilir ve dosyaları görüntüleyebilir veya silebilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-357">Currently, any authenticated or anonymous user can visit the `UserBasedAuthorization.aspx` page and view or delete files.</span></span> <span data-ttu-id="acf66-358">Yalnızca kimliği doğrulanmış kullanıcıların bir dosyanın içeriğini görüntüleyebilmesini ve bir dosyayı silebilmesini sağlamak için bunu yapalim.</span><span class="sxs-lookup"><span data-stu-id="acf66-358">Let's make it so that only authenticated users can view contents of a file and only Tito can delete a file.</span></span> <span data-ttu-id="acf66-359">Bu tür ince yetkilendirme kuralları bildirimli, programlı bir şekilde veya her iki yöntemin bir birleşimi aracılığıyla uygulanabilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-359">Such fine grain authorization rules can be applied declaratively, programmatically, or through a combination of both methods.</span></span> <span data-ttu-id="acf66-360">Bir dosyanın içeriğini kimlerin görebileceğini sınırlamak için bildirim temelli yaklaşımı kullanalım; bir dosyayı kimin silebilen ile sınırlamak için programlama yaklaşımını kullanacağız.</span><span class="sxs-lookup"><span data-stu-id="acf66-360">Let's use the declarative approach to limit who can view the contents of a file; we'll use the programmatic approach to limit who can delete a file.</span></span>

### <a name="using-the-loginview-control"></a><span data-ttu-id="acf66-361">LoginView denetimini kullanma</span><span class="sxs-lookup"><span data-stu-id="acf66-361">Using the LoginView Control</span></span>

<span data-ttu-id="acf66-362">Geçmiş öğreticilerde gördüğünüze göre, LoginView denetimi, kimliği doğrulanmış ve anonim kullanıcılara yönelik farklı arabirimleri görüntülemek için yararlıdır ve anonim kullanıcılar tarafından erişilemeyen işlevselliği gizlemek için kolay bir yol sunar.</span><span class="sxs-lookup"><span data-stu-id="acf66-362">As we've seen in past tutorials, the LoginView control is useful for displaying different interfaces for authenticated and anonymous users, and offers an easy way to hide functionality that is not accessible to anonymous users.</span></span> <span data-ttu-id="acf66-363">Anonim kullanıcılar dosyaları görüntüleyemez veya silemezduğundan, sayfa kimliği doğrulanmış bir kullanıcı tarafından ziyaret edildiğinde yalnızca `FileContents` metin kutusunu göstermemiz gerekir.</span><span class="sxs-lookup"><span data-stu-id="acf66-363">Since anonymous users cannot view or delete files, we only need to show the `FileContents` TextBox when the page is visited by an authenticated user.</span></span> <span data-ttu-id="acf66-364">Bunu başarmak için, sayfaya bir LoginView denetimi ekleyin, `LoginViewForFileContentsTextBox`adlandırın ve `FileContents` metin kutusunun bildirime dayalı işaretlemesini LoginView denetiminin `LoggedInTemplate`taşıyın.</span><span class="sxs-lookup"><span data-stu-id="acf66-364">To achieve this, add a LoginView control to the page, name it `LoginViewForFileContentsTextBox`, and move the `FileContents` TextBox's declarative markup into the LoginView control's `LoggedInTemplate`.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample15.aspx)]

<span data-ttu-id="acf66-365">LoginView şablonlarındaki Web denetimlerine artık arka plan kod sınıfından doğrudan erişilebilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-365">The Web controls in the LoginView's templates are no longer directly accessible from the code-behind class.</span></span> <span data-ttu-id="acf66-366">Örneğin, `FilesGrid` GridView 'un `SelectedIndexChanged` ve `RowDeleting` olay işleyicileri Şu anda `FileContents` TextBox denetimine şu şekilde başvurabilir:</span><span class="sxs-lookup"><span data-stu-id="acf66-366">For example, the `FilesGrid` GridView's `SelectedIndexChanged` and `RowDeleting` event handlers currently reference the `FileContents` TextBox control with code like:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample16.cs)]

<span data-ttu-id="acf66-367">Ancak, bu kod artık geçerli değildir.</span><span class="sxs-lookup"><span data-stu-id="acf66-367">However, this code is no longer valid.</span></span> <span data-ttu-id="acf66-368">`FileContents` metin kutusunu `LoggedInTemplate` içine taşıyarak TextBox 'a doğrudan erişilemez.</span><span class="sxs-lookup"><span data-stu-id="acf66-368">By moving the `FileContents` TextBox into the `LoggedInTemplate` the TextBox cannot be directly accessed.</span></span> <span data-ttu-id="acf66-369">Bunun yerine, denetime programlı olarak başvurmak için `FindControl("controlId")` metodunu kullandık.</span><span class="sxs-lookup"><span data-stu-id="acf66-369">Instead, we must use the `FindControl("controlId")` method to programmatically reference the control.</span></span> <span data-ttu-id="acf66-370">`FilesGrid` olay işleyicilerini metin kutusuna başvuracak şekilde güncelleştirin:</span><span class="sxs-lookup"><span data-stu-id="acf66-370">Update the `FilesGrid` event handlers to reference the TextBox like so:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample17.cs)]

<span data-ttu-id="acf66-371">TextBox 'ı LoginView 'ın `LoggedInTemplate` taşıdıktan ve sayfanın kodunu, `FindControl("controlId")` modelini kullanarak TextBox 'a başvuracak şekilde güncelleştirdikten sonra, sayfayı anonim kullanıcı olarak ziyaret edin.</span><span class="sxs-lookup"><span data-stu-id="acf66-371">After moving the TextBox to the LoginView's `LoggedInTemplate` and updating the page's code to reference the TextBox using the `FindControl("controlId")` pattern, visit the page as an anonymous user.</span></span> <span data-ttu-id="acf66-372">Şekil 10 ' da gösterildiği gibi, `FileContents` metin kutusu görüntülenmez.</span><span class="sxs-lookup"><span data-stu-id="acf66-372">As Figure 10 shows, the `FileContents` TextBox is not displayed.</span></span> <span data-ttu-id="acf66-373">Bununla birlikte, View LinkButton hala görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="acf66-373">However, the View LinkButton is still displayed.</span></span>

<span data-ttu-id="acf66-374">[![LoginView denetimi yalnızca kimliği doğrulanmış kullanıcılar için dosya Içeriği metin kutusunu Işler](user-based-authorization-cs/_static/image29.png)](user-based-authorization-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-374">[![The LoginView Control Only Renders the FileContents TextBox for Authenticated Users](user-based-authorization-cs/_static/image29.png)](user-based-authorization-cs/_static/image28.png)</span></span>

<span data-ttu-id="acf66-375">**Şekil 10**: LoginView denetimi yalnızca kimliği doğrulanmış kullanıcılar Için `FileContents` metin kutusunu işler ([tam boyutlu görüntüyü görüntülemek için tıklayın](user-based-authorization-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-375">**Figure 10**: The LoginView Control Only Renders the `FileContents` TextBox for Authenticated Users  ([Click to view full-size image](user-based-authorization-cs/_static/image30.png))</span></span>

<span data-ttu-id="acf66-376">Anonim kullanıcılar için Görünüm düğmesini gizlemenin bir yolu, GridView alanını bir TemplateField 'a dönüştürmesidir.</span><span class="sxs-lookup"><span data-stu-id="acf66-376">One way to hide the View button for anonymous users is to convert the GridView field into a TemplateField.</span></span> <span data-ttu-id="acf66-377">Bu, View LinkButton için bildirim temelli biçimlendirmeyi içeren bir şablon oluşturur.</span><span class="sxs-lookup"><span data-stu-id="acf66-377">This will generate a template that contains the declarative markup for the View LinkButton.</span></span> <span data-ttu-id="acf66-378">Daha sonra TemplateField 'a bir LoginView denetimi ekleyebilir ve LinkButton öğesini LoginView 'ın `LoggedInTemplate`içine yerleştirebilir ve böylece, anonim ziyaretçilerin Görünüm düğmesini gizliyoruz.</span><span class="sxs-lookup"><span data-stu-id="acf66-378">We can then add a LoginView control to the TemplateField and place the LinkButton within the LoginView's `LoggedInTemplate`, thereby hiding the View button from anonymous visitors.</span></span> <span data-ttu-id="acf66-379">Bunu gerçekleştirmek için GridView 'un akıllı etiketindeki sütunları düzenle bağlantısına tıklayarak alanlar iletişim kutusunu başlatın.</span><span class="sxs-lookup"><span data-stu-id="acf66-379">To accomplish this, click on the Edit Columns link from the GridView's Smart Tag to launch the Fields dialog box.</span></span> <span data-ttu-id="acf66-380">Sonra sol alt köşedeki listeden Seç düğmesini seçin ve ardından bu alanı bir TemplateField öğesine Dönüştür bağlantısına tıklayın.</span><span class="sxs-lookup"><span data-stu-id="acf66-380">Next, select the Select button from the list in the lower left corner and then click the Convert this field to a TemplateField link.</span></span> <span data-ttu-id="acf66-381">Bunun yapılması, alanın bildirim temelli işaretlemesini şuradan değiştirecek:</span><span class="sxs-lookup"><span data-stu-id="acf66-381">Doing so will modify the field's declarative markup from:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample18.aspx)]

 <span data-ttu-id="acf66-382">Hedef:</span><span class="sxs-lookup"><span data-stu-id="acf66-382">To:</span></span> 

[!code-aspx[Main](user-based-authorization-cs/samples/sample19.aspx)]

<span data-ttu-id="acf66-383">Bu noktada, TemplateField 'a bir LoginView ekleyebiliriz.</span><span class="sxs-lookup"><span data-stu-id="acf66-383">At this point, we can add a LoginView to the TemplateField.</span></span> <span data-ttu-id="acf66-384">Aşağıdaki biçimlendirme yalnızca kimliği doğrulanmış kullanıcılar için Linkview düğmesini görüntüler.</span><span class="sxs-lookup"><span data-stu-id="acf66-384">The following markup displays the View LinkButton only for authenticated users.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample20.aspx)]

<span data-ttu-id="acf66-385">Şekil 11 ' de gösterildiği gibi, son sonuç, sütun içindeki görüntüleme bağlantı düğmeleri gizlense de görünüm sütununun görüntülenmesiyle ilgili değildir.</span><span class="sxs-lookup"><span data-stu-id="acf66-385">As Figure 11 shows, the end result is not that pretty as the View column is still displayed even though the View LinkButtons within the column are hidden.</span></span> <span data-ttu-id="acf66-386">Sonraki bölümde tüm GridView sütununu (yalnızca LinkButton değil) nasıl gizleyelim.</span><span class="sxs-lookup"><span data-stu-id="acf66-386">We will look at how to hide the entire GridView column (and not just the LinkButton) in the next section.</span></span>

<span data-ttu-id="acf66-387">[![LoginView denetimi, anonim ziyaretçi için LinkButtons görünümünü gizler](user-based-authorization-cs/_static/image32.png)](user-based-authorization-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-387">[![The LoginView Control Hides the View LinkButtons for Anonymous Visitors](user-based-authorization-cs/_static/image32.png)](user-based-authorization-cs/_static/image31.png)</span></span>

<span data-ttu-id="acf66-388">**Şekil 11**: LoginView denetimi anonim ziyaretçilerin görünüm Linkbuttons 'ı gizler ([tam boyutlu görüntüyü görüntülemek için tıklayın](user-based-authorization-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-388">**Figure 11**: The LoginView Control Hides the View LinkButtons for Anonymous Visitors  ([Click to view full-size image](user-based-authorization-cs/_static/image33.png))</span></span>

### <a name="programmatically-limiting-functionality"></a><span data-ttu-id="acf66-389">Işlevselliği programlı bir şekilde sınırlandırma</span><span class="sxs-lookup"><span data-stu-id="acf66-389">Programmatically Limiting Functionality</span></span>

<span data-ttu-id="acf66-390">Bazı durumlarda, bir sayfada işlevselliği kısıtlamak için bildirim temelli teknikler yetersizdir.</span><span class="sxs-lookup"><span data-stu-id="acf66-390">In some circumstances, declarative techniques are insufficient for limiting functionality to a page.</span></span> <span data-ttu-id="acf66-391">Örneğin, belirli sayfa işlevselliğinin kullanılabilirliği, sayfayı ziyaret eden kullanıcının anonim veya kimliği doğrulanmış olduğu ölçütlere bağlı olabilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-391">For example, the availability of certain page functionality may be dependent on criteria beyond whether the user visiting the page is anonymous or authenticated.</span></span> <span data-ttu-id="acf66-392">Bu gibi durumlarda, çeşitli kullanıcı arabirimi öğeleri programlı yollarla görüntülenebilir veya gizlenebilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-392">In such cases, the various user interface elements can be displayed or hidden through programmatic means.</span></span>

<span data-ttu-id="acf66-393">İşlevselliği programlı bir şekilde sınırlandırmak için iki görev gerçekleştirmeniz gerekir:</span><span class="sxs-lookup"><span data-stu-id="acf66-393">In order to limit the functionality programmatically, we need to perform two tasks:</span></span>

1. <span data-ttu-id="acf66-394">Sayfayı ziyaret eden kullanıcının işlevlere erişip erişemeyeceğini belirleme ve</span><span class="sxs-lookup"><span data-stu-id="acf66-394">Determine whether the user visiting the page can access the functionality, and</span></span>
2. <span data-ttu-id="acf66-395">Kullanıcı arabirimini, kullanıcının söz konusu işlevselliğe erişiminin olup olmadığına göre programlı bir şekilde değiştirin.</span><span class="sxs-lookup"><span data-stu-id="acf66-395">Programmatically modify the user interface based on whether the user has access to the functionality in question.</span></span>

<span data-ttu-id="acf66-396">Bu iki görevin uygulamasını göstermek için, yalnızca GridView 'dan dosyaları silmeye izin veriyorum.</span><span class="sxs-lookup"><span data-stu-id="acf66-396">To demonstrate the application of these two tasks, let's only allow Tito to delete files from the GridView.</span></span> <span data-ttu-id="acf66-397">İlk göreviniz, sayfanın ziyaret edilip edilmeyeceğini belirlemektir.</span><span class="sxs-lookup"><span data-stu-id="acf66-397">Our first task, then, is to determine whether it is Tito visiting the page.</span></span> <span data-ttu-id="acf66-398">Bu belirlendikten sonra GridView 'un silme sütununu gizlemeniz (veya göstermemiz) gerekir.</span><span class="sxs-lookup"><span data-stu-id="acf66-398">Once that has been determined, we need to hide (or show) the GridView's Delete column.</span></span> <span data-ttu-id="acf66-399">GridView 'un sütunlarına `Columns` özelliği aracılığıyla erişilebilir; bir sütun yalnızca `Visible` özelliği `true` (varsayılan) olarak ayarlandıysa işlenir.</span><span class="sxs-lookup"><span data-stu-id="acf66-399">The GridView's columns are accessible through its `Columns` property; a column is only rendered if its `Visible` property is set to `true` (the default).</span></span>

<span data-ttu-id="acf66-400">Verileri GridView 'a bağlamadan önce aşağıdaki kodu `Page_Load` olay işleyicisine ekleyin:</span><span class="sxs-lookup"><span data-stu-id="acf66-400">Add the following code to the `Page_Load` event handler prior to binding the data to the GridView:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample21.cs)]

<span data-ttu-id="acf66-401">[*Forms kimlik doğrulaması öğreticisine genel bakış*](../introduction/an-overview-of-forms-authentication-cs.md) konusunda anlatıldığı gibi, `User.Identity.Name` kimliğin adını döndürür.</span><span class="sxs-lookup"><span data-stu-id="acf66-401">As we discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, `User.Identity.Name` returns the identity's name.</span></span> <span data-ttu-id="acf66-402">Bu, oturum açma denetiminde girilen kullanıcı adına karşılık gelir.</span><span class="sxs-lookup"><span data-stu-id="acf66-402">This corresponds to the username entered in the Login control.</span></span> <span data-ttu-id="acf66-403">Sayfayı ziyaret etmek için, GridView 'un ikinci sütununun `Visible` özelliği `true`olarak ayarlanır; Aksi takdirde, `false`olarak ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="acf66-403">If it is Tito visiting the page, the GridView's second column's `Visible` property is set to `true`; otherwise, it is set to `false`.</span></span> <span data-ttu-id="acf66-404">Net sonuç, sayfada başka bir kimliği doğrulanmış kullanıcı veya anonim kullanıcı, silme sütununun işlenmediğinde (bkz. Şekil 12); Ancak, sayfa ne zaman ziyaret edildiğinde silme sütunu mevcuttur (bkz. Şekil 13).</span><span class="sxs-lookup"><span data-stu-id="acf66-404">The net result is that when someone other than Tito visits the page, either another authenticated user or an anonymous user, the Delete column is not rendered (see Figure 12); however, when Tito visits the page, the Delete column is present (see Figure 13).</span></span>

<span data-ttu-id="acf66-405">[![sütunu, Tito (deneme) dışında bir kişi tarafından ziyaret edildiğinde Işlenmez](user-based-authorization-cs/_static/image35.png)](user-based-authorization-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-405">[![The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)](user-based-authorization-cs/_static/image35.png)](user-based-authorization-cs/_static/image34.png)</span></span>

<span data-ttu-id="acf66-406">**Şekil 12**: silme sütunu Tito (deneme) dışında bir kişi tarafından ziyaret edildiğinde işlenmez ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-406">**Figure 12**: The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)  ([Click to view full-size image](user-based-authorization-cs/_static/image36.png))</span></span>

<span data-ttu-id="acf66-407">[![, Tito için silme sütunu Işlendi](user-based-authorization-cs/_static/image38.png)](user-based-authorization-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-407">[![The Delete Column is Rendered for Tito](user-based-authorization-cs/_static/image38.png)](user-based-authorization-cs/_static/image37.png)</span></span>

<span data-ttu-id="acf66-408">**Şekil 13**: silme sütunu Tito için işlenir ([tam boyutlu görüntüyü görüntülemek için tıklayın](user-based-authorization-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-408">**Figure 13**: The Delete Column is Rendered for Tito  ([Click to view full-size image](user-based-authorization-cs/_static/image39.png))</span></span>

## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a><span data-ttu-id="acf66-409">4\. Adım: sınıflara ve yöntemlere yetkilendirme kuralları uygulama</span><span class="sxs-lookup"><span data-stu-id="acf66-409">Step 4: Applying Authorization Rules to Classes and Methods</span></span>

<span data-ttu-id="acf66-410">Adım 3 ' te anonim kullanıcıların bir dosyanın içeriğini görüntülemesini ve tüm kullanıcıları yasaklamasının yanı sıra dosyaları silmekten izin vermedik.</span><span class="sxs-lookup"><span data-stu-id="acf66-410">In Step 3 we disallowed anonymous users from viewing a file's contents and prohibited all users but Tito from deleting files.</span></span> <span data-ttu-id="acf66-411">Bu, bildirim temelli ve programlı teknikler aracılığıyla yetkisiz ziyaretçilerin ilişkili kullanıcı arabirimi öğelerini gizleyerek elde edildi.</span><span class="sxs-lookup"><span data-stu-id="acf66-411">This was accomplished by hiding the associated user interface elements for unauthorized visitors through declarative and programmatic techniques.</span></span> <span data-ttu-id="acf66-412">Basit örneğimiz için, Kullanıcı arabirimi öğelerinin düzgün bir şekilde gizlenmesi basittir, ancak aynı işlevselliği gerçekleştirmenin birçok farklı yolu olabileceği daha karmaşık siteler hakkında ne var?</span><span class="sxs-lookup"><span data-stu-id="acf66-412">For our simple example, properly hiding the user interface elements was straightforward, but what about more complex sites where there may be many different ways to perform the same functionality?</span></span> <span data-ttu-id="acf66-413">Bu işlevselliği yetkisiz kullanıcılara sınırlamak için, geçerli kullanıcı arabirimi öğelerini gizlemeyi veya devre dışı bırakmayı unuturuz ne olur?</span><span class="sxs-lookup"><span data-stu-id="acf66-413">In limiting that functionality to unauthorized users, what happens if we forget to hide or disable all of the applicable user interface elements?</span></span>

<span data-ttu-id="acf66-414">Belirli bir işlevselliğe yetkisiz bir kullanıcı tarafından erişilememesini sağlamanın kolay bir yolu, bu sınıfı veya yöntemi [`PrincipalPermission` özniteliğiyle](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx)tasarlamanız sağlamaktır.</span><span class="sxs-lookup"><span data-stu-id="acf66-414">An easy way to ensure that a particular piece of functionality cannot be accessed by an unauthorized user is to decorate that class or method with the [`PrincipalPermission` attribute](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span></span> <span data-ttu-id="acf66-415">.NET çalışma zamanı bir sınıfı kullandığında veya yöntemlerinden birini yürüttüğünde, geçerli güvenlik bağlamının sınıfı kullanma veya yöntemi yürütme izni olduğundan emin olmak için kontrol eder.</span><span class="sxs-lookup"><span data-stu-id="acf66-415">When the .NET runtime uses a class or executes one of its methods, it checks to ensure that the current security context has permission to use the class or execute the method.</span></span> <span data-ttu-id="acf66-416">`PrincipalPermission` özniteliği, bu kuralları tanımlayabilmemiz için bir mekanizma sağlar.</span><span class="sxs-lookup"><span data-stu-id="acf66-416">The `PrincipalPermission` attribute provides a mechanism through which we can define these rules.</span></span>

<span data-ttu-id="acf66-417">GridView 'un `SelectedIndexChanged` ve `RowDeleting` olay işleyicilerinde `PrincipalPermission` özniteliğini kullanarak, sırasıyla adsız kullanıcılar ve kullanıcılar tarafından yürütmeyi yasaklayagörelim.</span><span class="sxs-lookup"><span data-stu-id="acf66-417">Let's demonstrate using the `PrincipalPermission` attribute on the GridView's `SelectedIndexChanged` and `RowDeleting` event handlers to prohibit execution by anonymous users and users other than Tito, respectively.</span></span> <span data-ttu-id="acf66-418">Tüm yapmanız gereken, her bir işlev tanımının uygun özniteliğini eklemektir:</span><span class="sxs-lookup"><span data-stu-id="acf66-418">All we need to do is add the appropriate attribute atop each function definition:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample22.cs)]

<span data-ttu-id="acf66-419">`SelectedIndexChanged` olay işleyicisi özniteliği, yalnızca kimliği doğrulanmış kullanıcıların olay işleyicisini yürütemeyeceğini belirler. burada, `RowDeleting` olay işleyicisindeki öznitelik, yürütmeyi Tito 'ya sınırlar.</span><span class="sxs-lookup"><span data-stu-id="acf66-419">The attribute for the `SelectedIndexChanged` event handler dictates that only authenticated users can execute the event handler, where as the attribute on the `RowDeleting` event handler limits the execution to Tito.</span></span>

<span data-ttu-id="acf66-420">`RowDeleting` olay işleyicisini yürütmeye veya kimliği doğrulanmamış bir kullanıcıya `SelectedIndexChanged` olay işleyicisini yürütmeyi denediğinde, .NET çalışma zamanı bir `SecurityException`yükseltir.</span><span class="sxs-lookup"><span data-stu-id="acf66-420">If, somehow, a user other than Tito attempts to execute the `RowDeleting` event handler or a non-authenticated user attempts to execute the `SelectedIndexChanged` event handler, the .NET runtime will raise a `SecurityException`.</span></span>

<span data-ttu-id="acf66-421">[![güvenlik bağlamının yöntemi yürütme yetkisi yoksa bir SecurityException atılır](user-based-authorization-cs/_static/image41.png)](user-based-authorization-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="acf66-421">[![If the Security Context is not Authorized to Execute the Method, a SecurityException is Thrown](user-based-authorization-cs/_static/image41.png)](user-based-authorization-cs/_static/image40.png)</span></span>

<span data-ttu-id="acf66-422">**Şekil 14**: güvenlik bağlamının yöntemi yürütme yetkisi yoksa bir `SecurityException` oluşturulur ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="acf66-422">**Figure 14**: If the Security Context is not Authorized to Execute the Method, a `SecurityException` is Thrown  ([Click to view full-size image](user-based-authorization-cs/_static/image42.png))</span></span>

> [!NOTE]
> <span data-ttu-id="acf66-423">Birden çok güvenlik bağlamının bir sınıfa veya yönteme erişmesine izin vermek için, her güvenlik bağlamı için bir `PrincipalPermission` özniteliğiyle sınıfı veya yöntemi süslemek.</span><span class="sxs-lookup"><span data-stu-id="acf66-423">To allow multiple security contexts to access a class or method, decorate the class or method with a `PrincipalPermission` attribute for each security context.</span></span> <span data-ttu-id="acf66-424">Diğer bir deyişle, her ikisinin de `RowDeleting` olay işleyicisini yürütmesine izin vermek için *iki* `PrincipalPermission` özniteliği ekleyin:</span><span class="sxs-lookup"><span data-stu-id="acf66-424">That is, to allow both Tito and Bruce to execute the `RowDeleting` event handler, add *two* `PrincipalPermission` attributes:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample23.cs)]

<span data-ttu-id="acf66-425">ASP.NET sayfalarına ek olarak, birçok uygulamanın Iş mantığı ve veri erişimi katmanları gibi çeşitli katmanları içeren bir mimarisi de vardır.</span><span class="sxs-lookup"><span data-stu-id="acf66-425">In addition to ASP.NET pages, many applications also have an architecture that includes various layers, such as Business Logic and Data Access Layers.</span></span> <span data-ttu-id="acf66-426">Bu katmanlar genellikle sınıf kitaplıkları olarak uygulanır ve iş mantığı ve verilerle ilgili işlevleri gerçekleştirmek için sınıflar ve yöntemler sunar.</span><span class="sxs-lookup"><span data-stu-id="acf66-426">These layers are typically implemented as Class Libraries and offer classes and methods for performing business logic- and data-related functionality.</span></span> <span data-ttu-id="acf66-427">`PrincipalPermission` özniteliği, bu katmanlara yetkilendirme kuralları uygulamak için yararlıdır.</span><span class="sxs-lookup"><span data-stu-id="acf66-427">The `PrincipalPermission` attribute is useful for applying authorization rules to these layers.</span></span>

<span data-ttu-id="acf66-428">Sınıflarda ve yöntemlerde yetkilendirme kurallarını tanımlamak için `PrincipalPermission` özniteliğini kullanma hakkında daha fazla bilgi için, [`PrincipalPermissionAttributes`kullanarak iş ve veri katmanlarına yetkilendirme kuralları ekleme ](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx) [Scott Guthrie](https://weblogs.asp.net/scottgu/)'nin Blog girdisine bakın.</span><span class="sxs-lookup"><span data-stu-id="acf66-428">For more information on using the `PrincipalPermission` attribute to define authorization rules on classes and methods, refer to [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry [Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="acf66-429">Özet</span><span class="sxs-lookup"><span data-stu-id="acf66-429">Summary</span></span>

<span data-ttu-id="acf66-430">Bu öğreticide, Kullanıcı tabanlı yetkilendirme kurallarının nasıl uygulanacağını inceledik.</span><span class="sxs-lookup"><span data-stu-id="acf66-430">In this tutorial we looked at how to apply user-based authorization rules.</span></span> <span data-ttu-id="acf66-431">ASP 'ye göz atacağız. NET 'in URL yetkilendirme çerçevesi.</span><span class="sxs-lookup"><span data-stu-id="acf66-431">We started with a look at ASP.NET's URL authorization framework.</span></span> <span data-ttu-id="acf66-432">Her istekte, ASP.NET altyapısının `UrlAuthorizationModule`, kimliğin istenen kaynağa erişme yetkisine sahip olup olmadığını anlamak için uygulamanın yapılandırmasında tanımlanan URL yetkilendirme kurallarını inceler.</span><span class="sxs-lookup"><span data-stu-id="acf66-432">On each request, the ASP.NET engine's `UrlAuthorizationModule` inspects the URL authorization rules defined in the application's configuration to determine whether the identity is authorized to access the requested resource.</span></span> <span data-ttu-id="acf66-433">Kısaca, URL yetkilendirmesi belirli bir sayfa için veya belirli bir dizindeki tüm sayfalar için yetkilendirme kuralları belirtmeyi kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="acf66-433">In short, URL authorization makes it easy to specify authorization rules for a specific page or for all pages in a particular directory.</span></span>

<span data-ttu-id="acf66-434">URL yetkilendirme çerçevesi, bir sayfa temelinde yetkilendirme kuralları uygular.</span><span class="sxs-lookup"><span data-stu-id="acf66-434">The URL authorization framework applies authorization rules on a page-by-page basis.</span></span> <span data-ttu-id="acf66-435">URL yetkilendirmesi ile, istenen kimliğin belirli bir kaynağa erişme yetkisi vardır.</span><span class="sxs-lookup"><span data-stu-id="acf66-435">With URL authorization, either the requesting identity is authorized to access a particular resource or not.</span></span> <span data-ttu-id="acf66-436">Ancak, çok sayıda senaryo daha ince yetkilendirme kuralları için çağrı yapar.</span><span class="sxs-lookup"><span data-stu-id="acf66-436">Many scenarios, however, call for more fine grain authorization rules.</span></span> <span data-ttu-id="acf66-437">Bir sayfaya kimlerin erişebileceğini tanımlamak yerine herkesin bir sayfaya erişmesine izin vermek, ancak farklı verileri göstermek veya sayfayı ziyaret eden kullanıcıya bağlı olarak farklı işlevler sunmak için gerekli olabilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-437">Rather than defining who is permitted to access a page, we may need to let everyone access a page, but to show different data or offer different functionality depending on the user visiting the page.</span></span> <span data-ttu-id="acf66-438">Sayfa düzeyi yetkilendirme, genellikle yetkisiz kullanıcıların yasaklanmış işlevlere erişmesini engellemek için belirli kullanıcı arabirimi öğelerini gizlemeyi içerir.</span><span class="sxs-lookup"><span data-stu-id="acf66-438">Page-level authorization usually involves hiding specific user interface elements in order to prevent unauthorized users from accessing prohibited functionality.</span></span> <span data-ttu-id="acf66-439">Bunlara ek olarak, belirli kullanıcılar için kendi yöntemlerinin sınıflarına ve yürütülmesine erişimi kısıtlamak üzere öznitelikleri kullanmak mümkündür.</span><span class="sxs-lookup"><span data-stu-id="acf66-439">Additionally, it is possible to use attributes to restrict access to classes and execution of its methods for certain users.</span></span>

<span data-ttu-id="acf66-440">Programlamanın kutlu olsun!</span><span class="sxs-lookup"><span data-stu-id="acf66-440">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="acf66-441">Daha Fazla Bilgi</span><span class="sxs-lookup"><span data-stu-id="acf66-441">Further Reading</span></span>

<span data-ttu-id="acf66-442">Bu öğreticide ele alınan konular hakkında daha fazla bilgi için aşağıdaki kaynaklara bakın:</span><span class="sxs-lookup"><span data-stu-id="acf66-442">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="acf66-443">`PrincipalPermissionAttributes` kullanarak Iş ve veri katmanlarına yetkilendirme kuralları ekleme</span><span class="sxs-lookup"><span data-stu-id="acf66-443">Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`</span></span>](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [<span data-ttu-id="acf66-444">ASP.NET yetkilendirmesi</span><span class="sxs-lookup"><span data-stu-id="acf66-444">ASP.NET Authorization</span></span>](https://msdn.microsoft.com/library/wce3kxhd.aspx)
- [<span data-ttu-id="acf66-445">IıS6 ve ııS7 güvenliği arasındaki değişiklikler</span><span class="sxs-lookup"><span data-stu-id="acf66-445">Changes Between IIS6 and IIS7 Security</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [<span data-ttu-id="acf66-446">Belirli dosyaları ve alt dizinleri yapılandırma</span><span class="sxs-lookup"><span data-stu-id="acf66-446">Configuring Specific Files and Subdirectories</span></span>](https://msdn.microsoft.com/library/6hbkh9s7.aspx)
- [<span data-ttu-id="acf66-447">Kullanıcıya bağlı olarak veri değişikliği Işlevselliğini sınırlama</span><span class="sxs-lookup"><span data-stu-id="acf66-447">Limiting Data Modification Functionality Based on the User</span></span>](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-cs.md)
- [<span data-ttu-id="acf66-448">LoginView denetimi hızlı başlangıçlarını Başlat</span><span class="sxs-lookup"><span data-stu-id="acf66-448">LoginView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [<span data-ttu-id="acf66-449">IıS7 URL yetkilendirmesini anlama</span><span class="sxs-lookup"><span data-stu-id="acf66-449">Understanding IIS7 URL Authorization</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [<span data-ttu-id="acf66-450">`UrlAuthorizationModule` teknik belgeler</span><span class="sxs-lookup"><span data-stu-id="acf66-450">`UrlAuthorizationModule` Technical Documentation</span></span>](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)
- [<span data-ttu-id="acf66-451">ASP.NET 2,0 'de verilerle çalışma</span><span class="sxs-lookup"><span data-stu-id="acf66-451">Working with Data in ASP.NET 2.0</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="acf66-452">Yazar hakkında</span><span class="sxs-lookup"><span data-stu-id="acf66-452">About the Author</span></span>

<span data-ttu-id="acf66-453">Birden çok ASP/ASP. NET Books ve 4GuysFromRolla.com 'in yazarı Scott Mitchell, 1998 sürümünden bu yana Microsoft Web teknolojileriyle birlikte çalışıyor.</span><span class="sxs-lookup"><span data-stu-id="acf66-453">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="acf66-454">Scott bağımsız danışman, Trainer ve yazıcı olarak çalışıyor.</span><span class="sxs-lookup"><span data-stu-id="acf66-454">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="acf66-455">En son kitabı, *[24 saat içinde ASP.NET 2,0 kendi kendinize eğitim](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* ister.</span><span class="sxs-lookup"><span data-stu-id="acf66-455">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="acf66-456">Scott 'a [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) veya blogundan [http://ScottOnWriting.NET](http://scottonwriting.net/)üzerinden erişilebilir.</span><span class="sxs-lookup"><span data-stu-id="acf66-456">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="acf66-457">Özel olarak teşekkürler</span><span class="sxs-lookup"><span data-stu-id="acf66-457">Special Thanks To</span></span>

<span data-ttu-id="acf66-458">Bu öğretici serisi birçok yararlı gözden geçirenler tarafından incelendi.</span><span class="sxs-lookup"><span data-stu-id="acf66-458">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="acf66-459">Yaklaşan MSDN makalelerimi gözden geçiriyor musunuz?</span><span class="sxs-lookup"><span data-stu-id="acf66-459">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="acf66-460">Öyleyse, beni [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)bir satır bırakın.</span><span class="sxs-lookup"><span data-stu-id="acf66-460">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="acf66-461">[Önceki](validating-user-credentials-against-the-membership-user-store-cs.md)
> [İleri](storing-additional-user-information-cs.md)</span><span class="sxs-lookup"><span data-stu-id="acf66-461">[Previous](validating-user-credentials-against-the-membership-user-store-cs.md)
[Next](storing-additional-user-information-cs.md)</span></span>
