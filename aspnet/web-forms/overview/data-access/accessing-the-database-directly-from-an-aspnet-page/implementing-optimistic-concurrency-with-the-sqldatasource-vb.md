---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-vb
title: SqlDataSource ile Iyimser eşzamanlılık uygulama (VB) | Microsoft Docs
author: rick-anderson
description: Bu öğreticide, iyimser eşzamanlılık denetiminin temel bileşenleri inceliyoruz ve ardından SqlDataSource denetimini kullanarak nasıl uygulanacağını keşfedebilirsiniz.
ms.author: riande
ms.date: 02/20/2007
ms.assetid: a8fa72ee-8328-4854-a419-c1b271772303
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-vb
msc.type: authoredcontent
ms.openlocfilehash: 431734b5245c20ac840147cf0827fa7f8d1e4d17
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78553020"
---
# <a name="implementing-optimistic-concurrency-with-the-sqldatasource-vb"></a><span data-ttu-id="937ab-103">SqlDataSource ile İyimser Eşzamanlılık Uygulama (VB)</span><span class="sxs-lookup"><span data-stu-id="937ab-103">Implementing Optimistic Concurrency with the SqlDataSource (VB)</span></span>

<span data-ttu-id="937ab-104">[Scott Mitchell](https://twitter.com/ScottOnWriting) tarafından</span><span class="sxs-lookup"><span data-stu-id="937ab-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="937ab-105">[Örnek uygulamayı indirin](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_VB.exe) veya [PDF 'yi indirin](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/datatutorial50vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="937ab-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_VB.exe) or [Download PDF](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/datatutorial50vb1.pdf)</span></span>

> <span data-ttu-id="937ab-106">Bu öğreticide, iyimser eşzamanlılık denetiminin temel bileşenleri inceliyoruz ve ardından SqlDataSource denetimini kullanarak nasıl uygulanacağını keşfedebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="937ab-106">In this tutorial we review the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource control.</span></span>

## <a name="introduction"></a><span data-ttu-id="937ab-107">Giriş</span><span class="sxs-lookup"><span data-stu-id="937ab-107">Introduction</span></span>

<span data-ttu-id="937ab-108">Önceki öğreticide, SqlDataSource denetimine ekleme, güncelleştirme ve silme yeteneklerini nasıl ekleyeceğiniz incelendi.</span><span class="sxs-lookup"><span data-stu-id="937ab-108">In the preceding tutorial we examined how to add inserting, updating, and deleting capabilities to the SqlDataSource control.</span></span> <span data-ttu-id="937ab-109">Kısacası, bu özellikleri, `UpdateCommand`, `DeleteCommand` ve `InsertParameters`koleksiyonlardaki uygun parametrelerle birlikte denetim s `InsertCommand`, `UpdateParameters`veya `DeleteParameters` özelliklerinde karşılık gelen `INSERT`, `UPDATE`veya `DELETE` SQL deyimlerinin belirtilmesi gerekiyordu.</span><span class="sxs-lookup"><span data-stu-id="937ab-109">In short, to provide these features we needed to specify the corresponding `INSERT`, `UPDATE`, or `DELETE` SQL statement in the control s `InsertCommand`, `UpdateCommand`, or `DeleteCommand` properties, along with the appropriate parameters in the `InsertParameters`, `UpdateParameters`, and `DeleteParameters` collections.</span></span> <span data-ttu-id="937ab-110">Bu özellikler ve koleksiyonlar el ile belirtiken, veri kaynağı Yapılandırma Sihirbazı s Gelişmiş düğmesi, bu ifadeleri `SELECT` bildirimine göre otomatik olarak oluşturacak `INSERT`, `UPDATE`ve `DELETE` deyimler onay kutusu sunar.</span><span class="sxs-lookup"><span data-stu-id="937ab-110">While these properties and collections can be specified manually, the Configure Data Source wizard s Advanced button offers a Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox that will auto-create these statements based on the `SELECT` statement.</span></span>

<span data-ttu-id="937ab-111">`INSERT`oluşturma, `UPDATE`ve `DELETE` deyimleriyle birlikte, gelişmiş SQL oluşturma seçenekleri iletişim kutusu, iyimser eşzamanlılık seçeneğini kullanın (bkz. Şekil 1).</span><span class="sxs-lookup"><span data-stu-id="937ab-111">Along with the Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox, the Advanced SQL Generation Options dialog box includes a Use optimistic concurrency option (see Figure 1).</span></span> <span data-ttu-id="937ab-112">İşaretlendiğinde, otomatik olarak oluşturulan `UPDATE` ve `DELETE` deyimlerdeki `WHERE` yan tümceleri yalnızca, kullanıcının verileri kılavuza en son yüklemesinden bu yana temel alınan veritabanı verileri değiştirilmemişse güncelleştirme veya silme işlemleri için değiştirilir.</span><span class="sxs-lookup"><span data-stu-id="937ab-112">When checked, the `WHERE` clauses in the autogenerated `UPDATE` and `DELETE` statements are modified to only perform the update or delete if the underlying database data hasn't been modified since the user last loaded the data into the grid.</span></span>

![Gelişmiş SQL oluşturma seçenekleri Iletişim kutusundan Iyimser eşzamanlılık desteği ekleyebilirsiniz](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image1.gif)

<span data-ttu-id="937ab-114">**Şekil 1**: Gelişmiş SQL oluşturma seçenekleri Iletişim kutusundan Iyimser eşzamanlılık desteği ekleyebilirsiniz</span><span class="sxs-lookup"><span data-stu-id="937ab-114">**Figure 1**: You Can Add Optimistic Concurrency Support from the Advanced SQL Generation Options Dialog Box</span></span>

<span data-ttu-id="937ab-115">[Iyimser eşzamanlılık](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) öğreticisini uygulayarak, iyimser eşzamanlılık denetiminin temellerini ve bunu ObjectDataSource 'a eklemeyi inceledik.</span><span class="sxs-lookup"><span data-stu-id="937ab-115">Back in the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial we examined the fundamentals of optimistic concurrency control and how to add it to the ObjectDataSource.</span></span> <span data-ttu-id="937ab-116">Bu öğreticide, iyimser eşzamanlılık denetiminin temel bileşenleri ile iletişime geçeceğiz ve ardından SqlDataSource kullanarak nasıl uygulanacağını araştırıyoruz.</span><span class="sxs-lookup"><span data-stu-id="937ab-116">In this tutorial we'll retouch on the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource.</span></span>

## <a name="a-recap-of-optimistic-concurrency"></a><span data-ttu-id="937ab-117">Iyimser eşzamanlılık bir üst sınırı</span><span class="sxs-lookup"><span data-stu-id="937ab-117">A Recap of Optimistic Concurrency</span></span>

<span data-ttu-id="937ab-118">Birden çok, eşzamanlı kullanıcının aynı verileri düzenlemesine veya silmesine izin veren Web uygulamaları için, bir kullanıcının yanlışlıkla başka bir değişikliği geçersiz yazabilecekleri bir olasılık vardır.</span><span class="sxs-lookup"><span data-stu-id="937ab-118">For web applications that allow multiple, simultaneous users to edit or delete the same data, there exists a possibility that one user may accidentally overwrite another s changes.</span></span> <span data-ttu-id="937ab-119">[Iyimser eşzamanlılık](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) öğreticisini uygulamak için aşağıdaki örneği sağladım:</span><span class="sxs-lookup"><span data-stu-id="937ab-119">In the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial I provided the following example:</span></span>

<span data-ttu-id="937ab-120">İki kullanıcı olan Jisun ve Sam, ziyaretçilerin bir GridView denetimiyle ürünleri güncelleştirmesine ve silmesine izin veren bir uygulamada bir sayfa ziyaret ettiğini düşünün.</span><span class="sxs-lookup"><span data-stu-id="937ab-120">Imagine that two users, Jisun and Sam, were both visiting a page in an application that allowed visitors to update and delete products through a GridView control.</span></span> <span data-ttu-id="937ab-121">Her ikisi de aynı anda Chai için Düzenle düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-121">Both click the Edit button for Chai around the same time.</span></span> <span data-ttu-id="937ab-122">Jisa ürün adını Chai Tea olarak değiştirir ve Güncelleştir düğmesine tıklar.</span><span class="sxs-lookup"><span data-stu-id="937ab-122">Jisun changes the product name to Chai Tea and clicks the Update button.</span></span> <span data-ttu-id="937ab-123">Net sonuç, *Tüm* ürün öğeleri güncelleştirilebilir alanları ayarlayan veritabanına gönderilen bir `UPDATE` deyimidir (jıse yalnızca bir alan, `ProductName`).</span><span class="sxs-lookup"><span data-stu-id="937ab-123">The net result is an `UPDATE` statement that is sent to the database, which sets *all* of the product s updateable fields (even though Jisun only updated one field, `ProductName`).</span></span> <span data-ttu-id="937ab-124">Bu noktada, veritabanı Chai Tea, kategori Içnoktaları, tedarikçi Exotic Litids ve bu ürüne yönelik olarak, bu ürünün bu değerlerini içerir.</span><span class="sxs-lookup"><span data-stu-id="937ab-124">At this point in time, the database has the values Chai Tea, the category Beverages, the supplier Exotic Liquids, and so on for this particular product.</span></span> <span data-ttu-id="937ab-125">Ancak, Sam s ekranındaki GridView, hala, düzenlenebilir GridView satırındaki ürün adını Chai olarak gösterir.</span><span class="sxs-lookup"><span data-stu-id="937ab-125">However, the GridView on Sam s screen still shows the product name in the editable GridView row as Chai.</span></span> <span data-ttu-id="937ab-126">Jisun değişikliklerinin işlendiği birkaç saniye sonra, Sam kategoriyi koşullu olarak güncelleştirir ve Güncelleştir ' i tıklatır.</span><span class="sxs-lookup"><span data-stu-id="937ab-126">A few seconds after Jisun s changes have been committed, Sam updates the category to Condiments and clicks Update.</span></span> <span data-ttu-id="937ab-127">Bu, ürün adını Chai olarak ayarlayan veritabanına gönderilen `UPDATE` bildirimine, karşılık gelen koşullu kategori KIMLIĞINE `CategoryID` ve bu şekilde devam eder.</span><span class="sxs-lookup"><span data-stu-id="937ab-127">This results in an `UPDATE` statement sent to the database that sets the product name to Chai, the `CategoryID` to the corresponding Condiments category ID, and so on.</span></span> <span data-ttu-id="937ab-128">Ürün adında yapılan jisun değişikliklerinin üzerine yazıldı.</span><span class="sxs-lookup"><span data-stu-id="937ab-128">Jisun s changes to the product name have been overwritten.</span></span>

<span data-ttu-id="937ab-129">Şekil 2 bu etkileşimi gösterir.</span><span class="sxs-lookup"><span data-stu-id="937ab-129">Figure 2 illustrates this interaction.</span></span>

<span data-ttu-id="937ab-130">[Iki kullanıcı aynı anda bir kaydı güncelleştirirken ![bir kullanıcının diğer s değişikliklerinin üzerine yazılmasına neden olacak değişiklikler](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="937ab-130">[![When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image1.png)</span></span>

<span data-ttu-id="937ab-131">**Şekil 2**: Iki kullanıcı aynı anda bir kaydı güncelleştirirken, bir kullanıcının diğer öğeleri üzerine yazılmasına yönelik değişiklikler ([tam boyutlu görüntüyü görüntülemek için tıklatın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="937ab-131">**Figure 2**: When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.png))</span></span>

<span data-ttu-id="937ab-132">Bu senaryonun katlamayı engellemek için bir [eşzamanlılık denetimi](http://en.wikipedia.org/wiki/Concurrency_control) formu uygulanmalıdır.</span><span class="sxs-lookup"><span data-stu-id="937ab-132">To prevent this scenario from unfolding, a form of [concurrency control](http://en.wikipedia.org/wiki/Concurrency_control) must be implemented.</span></span> <span data-ttu-id="937ab-133">[İyimser eşzamanlılık](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) Bu öğreticinin odağı, şu anda eşzamanlılık çakışmaları olabileceğinden varsayımını ve sonra bu tür çakışmaların büyük çoğunluğunu görmemesi durumunda işe yarar.</span><span class="sxs-lookup"><span data-stu-id="937ab-133">[Optimistic concurrency](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) the focus of this tutorial works on the assumption that while there may be concurrency conflicts every now and then, the vast majority of the time such conflicts won't arise.</span></span> <span data-ttu-id="937ab-134">Bu nedenle, bir çakışma ortaya çıkarsa, iyimser eşzamanlılık denetimi kullanıcıya, farklı bir kullanıcı aynı verileri değiştirdiği için yaptıkları değişikliklerin kaydedimeyeceğini bildirir.</span><span class="sxs-lookup"><span data-stu-id="937ab-134">Therefore, if a conflict does arise, optimistic concurrency control simply informs the user that their changes can t be saved because another user has modified the same data.</span></span>

> [!NOTE]
> <span data-ttu-id="937ab-135">Birçok eşzamanlılık çakışması olacağını veya bu çakışmaların tolerandışı olduğunu varsaymayan uygulamalar için, bunun yerine Kötümser eşzamanlılık denetimi kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="937ab-135">For applications where it is assumed that there will be many concurrency conflicts or if such conflicts are not tolerable, then pessimistic concurrency control can be used instead.</span></span> <span data-ttu-id="937ab-136">Kötümser eşzamanlılık denetimi hakkında daha kapsamlı bir tartışma için [Iyimser eşzamanlılık](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) öğreticisine geri dönün.</span><span class="sxs-lookup"><span data-stu-id="937ab-136">Refer back to the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial for a more thorough discussion on pessimistic concurrency control.</span></span>

<span data-ttu-id="937ab-137">İyimser eşzamanlılık denetimi, güncelleştirilmesi veya silinmekte olan kaydın güncelleştirme ya da silme işlemi başladığında yaptığı gibi aynı değerlere sahip olduğundan emin olarak çalışarak işe yarar.</span><span class="sxs-lookup"><span data-stu-id="937ab-137">Optimistic concurrency control works by ensuring that the record being updated or deleted has the same values as it did when the updating or deleting process started.</span></span> <span data-ttu-id="937ab-138">Örneğin, düzenlenebilir bir GridView 'da Düzenle düğmesine tıkladığınızda, kayıt değerleri veritabanından okunmalıdır ve metin kutuları ve diğer Web denetimlerinde görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="937ab-138">For example, when clicking the Edit button in an editable GridView, the record s values are read from the database and displayed in TextBoxes and other Web controls.</span></span> <span data-ttu-id="937ab-139">Bu orijinal değerler GridView tarafından kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="937ab-139">These original values are saved by the GridView.</span></span> <span data-ttu-id="937ab-140">Daha sonra Kullanıcı, değişiklikleri yaptıktan ve Update düğmesine tıkladıktan sonra, kullanılan `UPDATE` deyimin özgün değerleri ve yeni değerleri dikkate almalıdır ve yalnızca kullanıcının düzenlemesini başlattığı özgün değerler veritabanında hala aynı değerlerle aynıysa temel alınan veritabanı kaydını güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="937ab-140">Later, after the user makes her changes and clicks the Update button, the `UPDATE` statement used must take into account the original values plus the new values and only update the underlying database record if the original values that the user started editing are identical to the values still in the database.</span></span> <span data-ttu-id="937ab-141">Şekil 3 ' te bu olay dizisi gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="937ab-141">Figure 3 depicts this sequence of events.</span></span>

<span data-ttu-id="937ab-142">[Güncelleştirme veya silme Işleminin başarılı olması için ![, özgün değerler geçerli veritabanı değerlerine eşit olmalıdır](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="937ab-142">[![For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.png)</span></span>

<span data-ttu-id="937ab-143">**Şekil 3**: güncelleştirme veya silme işleminin başarılı olması Için, özgün değerler geçerli veritabanı değerlerine eşit olmalıdır ([tam boyutlu görüntüyü görüntülemek için tıklatın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="937ab-143">**Figure 3**: For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.png))</span></span>

<span data-ttu-id="937ab-144">İyimser eşzamanlılığı uygulamaya yönelik çeşitli yaklaşımlar vardır (bir dizi seçeneğe kısa bir bakış için bkz. [Peter a. Bromberg](http://peterbromberg.net/)'ın [Iyimser eşzamanlılık güncelleştirme mantığı](http://www.eggheadcafe.com/articles/20050719.asp) ).</span><span class="sxs-lookup"><span data-stu-id="937ab-144">There are various approaches to implementing optimistic concurrency (see [Peter A. Bromberg](http://peterbromberg.net/)'s [Optimistic Concurrency Updating Logic](http://www.eggheadcafe.com/articles/20050719.asp) for a brief look at a number of options).</span></span> <span data-ttu-id="937ab-145">SqlDataSource tarafından kullanılan teknik (ve veri erişim katmanımızda kullanılan ADO.NET türü belirtilmiş veri kümelerinde), tüm özgün değerleri bir karşılaştırma dahil etmek için `WHERE` yan tümcesini geliştirir.</span><span class="sxs-lookup"><span data-stu-id="937ab-145">The technique used by the SqlDataSource (as well as by the ADO.NET Typed DataSets used in our Data Access Layer) augments the `WHERE` clause to include a comparison of all of the original values.</span></span> <span data-ttu-id="937ab-146">Örneğin, aşağıdaki `UPDATE` deyimleriyle, bir ürünün adını ve fiyatını yalnızca geçerli veritabanı değerleri GridView 'daki kayıt güncelleştirilirken başlangıçta alınan değerlere eşitse günceller.</span><span class="sxs-lookup"><span data-stu-id="937ab-146">The following `UPDATE` statement, for example, updates the name and price of a product only if the current database values are equal to the values that were originally retrieved when updating the record in the GridView.</span></span> <span data-ttu-id="937ab-147">`@ProductName` ve `@UnitPrice` parametreleri Kullanıcı tarafından girilen yeni değerleri içerir, ancak Düzenle düğmesine tıklandığında `@original_ProductName` ve `@original_UnitPrice` ilk olarak GridView 'a yüklenmiş olan değerleri içerir:</span><span class="sxs-lookup"><span data-stu-id="937ab-147">The `@ProductName` and `@UnitPrice` parameters contain the new values entered by the user, whereas `@original_ProductName` and `@original_UnitPrice` contain the values that were originally loaded into the GridView when the Edit button was clicked:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample1.sql)]

<span data-ttu-id="937ab-148">Bu öğreticide göreceğiniz gibi, SqlDataSource ile iyimser eşzamanlılık denetimini etkinleştirmek, bir CheckBox denetimi yapmak kadar basittir.</span><span class="sxs-lookup"><span data-stu-id="937ab-148">As we'll see in this tutorial, enabling optimistic concurrency control with the SqlDataSource is as simple as checking a checkbox.</span></span>

## <a name="step-1-creating-a-sqldatasource-that-supports-optimistic-concurrency"></a><span data-ttu-id="937ab-149">1\. Adım: Iyimser eşzamanlılık destekleyen bir SqlDataSource oluşturma</span><span class="sxs-lookup"><span data-stu-id="937ab-149">Step 1: Creating a SqlDataSource that Supports Optimistic Concurrency</span></span>

<span data-ttu-id="937ab-150">`SqlDataSource` klasöründen `OptimisticConcurrency.aspx` sayfasını açarak başlayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-150">Start by opening the `OptimisticConcurrency.aspx` page from the `SqlDataSource` folder.</span></span> <span data-ttu-id="937ab-151">Araç kutusundan bir SqlDataSource denetimini tasarımcı üzerine sürükleyin, `ID` özelliğini `ProductsDataSourceWithOptimisticConcurrency`olarak ayarlar.</span><span class="sxs-lookup"><span data-stu-id="937ab-151">Drag a SqlDataSource control from the Toolbox onto the Designer, settings its `ID` property to `ProductsDataSourceWithOptimisticConcurrency`.</span></span> <span data-ttu-id="937ab-152">Sonra, denetim öğeleri akıllı etiketinden veri kaynağını Yapılandır bağlantısına tıklayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-152">Next, click on the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="937ab-153">Sihirbazın ilk ekranından `NORTHWINDConnectionString` çalışmayı seçip Ileri ' ye tıklayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-153">From the first screen in the wizard, choose to work with the `NORTHWINDConnectionString` and click Next.</span></span>

<span data-ttu-id="937ab-154">[![NORTHWINDConnectionString ile çalışmayı seçme](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="937ab-154">[![Choose to Work with the NORTHWINDConnectionString](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.png)</span></span>

<span data-ttu-id="937ab-155">**Şekil 4**: `NORTHWINDConnectionString` ile çalışmayı seçme ([tam boyutlu görüntüyü görüntülemek için tıklayın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="937ab-155">**Figure 4**: Choose to Work with the `NORTHWINDConnectionString` ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.png))</span></span>

<span data-ttu-id="937ab-156">Bu örnekte, kullanıcıların `Products` tablosunu düzenlemesini sağlayan bir GridView ekleyeceğiz.</span><span class="sxs-lookup"><span data-stu-id="937ab-156">For this example we'll be adding a GridView that enables users to edit the `Products` table.</span></span> <span data-ttu-id="937ab-157">Bu nedenle, select Ifadesini Yapılandır ekranında, açılan listeden `Products` tablosunu seçin ve Şekil 5 ' te gösterildiği gibi `ProductID`, `ProductName`, `UnitPrice`ve `Discontinued` sütunlarını seçin.</span><span class="sxs-lookup"><span data-stu-id="937ab-157">Therefore, from the Configure the Select Statement screen, choose the `Products` table from the drop-down list and select the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` columns, as shown in Figure 5.</span></span>

<span data-ttu-id="937ab-158">[Products tablosundan ![ProductID, ProductName, UnitPrice ve Discontinued sütunlarını döndürün](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="937ab-158">[![From the Products Table, Return the ProductID, ProductName, UnitPrice, and Discontinued Columns](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.png)</span></span>

<span data-ttu-id="937ab-159">**Şekil 5**: `Products` tablosundan `ProductID`, `ProductName`, `UnitPrice`ve `Discontinued` sütunlarını ([tam boyutlu görüntüyü görüntülemek Için tıklayın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.png)) döndürün</span><span class="sxs-lookup"><span data-stu-id="937ab-159">**Figure 5**: From the `Products` Table, Return the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` Columns ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.png))</span></span>

<span data-ttu-id="937ab-160">Sütunları seçtikten sonra Gelişmiş düğmesine tıklayarak Gelişmiş SQL oluşturma seçenekleri iletişim kutusunu açın.</span><span class="sxs-lookup"><span data-stu-id="937ab-160">After picking the columns, click the Advanced button to bring up the Advanced SQL Generation Options dialog box.</span></span> <span data-ttu-id="937ab-161">`INSERT`, `UPDATE`ve `DELETE` deyimlerini oluşturun ve iyimser eşzamanlılık onay kutularını kullanın ve Tamam 'a tıklayın (bir ekran görüntüsü için Şekil 1 ' e geri bakın).</span><span class="sxs-lookup"><span data-stu-id="937ab-161">Check the Generate `INSERT`, `UPDATE`, and `DELETE` statements and Use optimistic concurrency checkboxes and click OK (refer back to Figure 1 for a screenshot).</span></span> <span data-ttu-id="937ab-162">Ileri ' ye ve ardından son ' a tıklayarak Sihirbazı doldurun.</span><span class="sxs-lookup"><span data-stu-id="937ab-162">Complete the wizard by clicking Next, then Finish.</span></span>

<span data-ttu-id="937ab-163">Veri kaynağı Yapılandırma Sihirbazı 'nı tamamladıktan sonra, elde edilen `DeleteCommand` ve `UpdateCommand` özelliklerini ve `DeleteParameters` ve `UpdateParameters` koleksiyonlarını incelemek için bir dakikanızı ayırın.</span><span class="sxs-lookup"><span data-stu-id="937ab-163">After completing the Configure Data Source wizard, take a moment to examine the resulting `DeleteCommand` and `UpdateCommand` properties and the `DeleteParameters` and `UpdateParameters` collections.</span></span> <span data-ttu-id="937ab-164">Bunu yapmanın en kolay yolu, sayfanın bildirim temelli sözdizimini görmek için sol alt köşedeki kaynak sekmesine tıklamanız olur.</span><span class="sxs-lookup"><span data-stu-id="937ab-164">The easiest way to do this is to click on the Source tab in the lower left corner to see the page s declarative syntax.</span></span> <span data-ttu-id="937ab-165">`UpdateCommand` bir değeri bulacaksınız:</span><span class="sxs-lookup"><span data-stu-id="937ab-165">There you will find an `UpdateCommand` value of:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample2.sql)]

<span data-ttu-id="937ab-166">`UpdateParameters` koleksiyonunda yedi parametre ile:</span><span class="sxs-lookup"><span data-stu-id="937ab-166">With seven parameters in the `UpdateParameters` collection:</span></span>

[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample3.aspx)]

<span data-ttu-id="937ab-167">Benzer şekilde, `DeleteCommand` özelliği ve `DeleteParameters` koleksiyonu aşağıdaki gibi görünmelidir:</span><span class="sxs-lookup"><span data-stu-id="937ab-167">Similarly, the `DeleteCommand` property and `DeleteParameters` collection should look like the following:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample4.sql)]

[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample5.aspx)]

<span data-ttu-id="937ab-168">`UpdateCommand` ve `DeleteCommand` özelliklerinin `WHERE` yan tümcelerini genişletmenin yanı sıra (ve ilgili parametre koleksiyonlarına ek parametreler eklemek), iyimser eşzamanlılık kullan seçeneğini belirlemek diğer iki özelliği ayarlar:</span><span class="sxs-lookup"><span data-stu-id="937ab-168">In addition to augmenting the `WHERE` clauses of the `UpdateCommand` and `DeleteCommand` properties (and adding the additional parameters to the respective parameter collections), selecting the Use optimistic concurrency option adjusts two other properties:</span></span>

- <span data-ttu-id="937ab-169">[`ConflictDetection` özelliğini](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) `OverwriteChanges` (varsayılan) olan `CompareAllValues` olarak değiştirir</span><span class="sxs-lookup"><span data-stu-id="937ab-169">Changes the [`ConflictDetection` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) from `OverwriteChanges` (the default) to `CompareAllValues`</span></span>
- <span data-ttu-id="937ab-170">[`OldValuesParameterFormatString` özelliğini](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) {0} (varsayılan) olarak orijinal\_{0} değiştirir.</span><span class="sxs-lookup"><span data-stu-id="937ab-170">Changes the [`OldValuesParameterFormatString` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) from {0} (the default) to original\_{0} .</span></span>

<span data-ttu-id="937ab-171">Data Web Control, SqlDataSource s `Update()` veya `Delete()` metodunu çağırdığında, özgün değerleri geçirir.</span><span class="sxs-lookup"><span data-stu-id="937ab-171">When the data Web control invokes the SqlDataSource s `Update()` or `Delete()` method, it passes in the original values.</span></span> <span data-ttu-id="937ab-172">SqlDataSource s `ConflictDetection` özelliği `CompareAllValues`olarak ayarlandıysa, bu özgün değerler komuta eklenir.</span><span class="sxs-lookup"><span data-stu-id="937ab-172">If the SqlDataSource s `ConflictDetection` property is set to `CompareAllValues`, these original values are added to the command.</span></span> <span data-ttu-id="937ab-173">`OldValuesParameterFormatString` özelliği, bu özgün değer parametreleri için kullanılan adlandırma modelini sağlar.</span><span class="sxs-lookup"><span data-stu-id="937ab-173">The `OldValuesParameterFormatString` property provides the naming pattern used for these original value parameters.</span></span> <span data-ttu-id="937ab-174">Veri kaynağını yapılandırma Sihirbazı özgün\_{0} kullanır ve `UpdateCommand` ve `DeleteCommand` özellikleri ve `UpdateParameters` ve `DeleteParameters` koleksiyonlarında her bir özgün parametreyi adlandırır.</span><span class="sxs-lookup"><span data-stu-id="937ab-174">The Configure Data Source wizard uses original\_{0} and names each original parameter in the `UpdateCommand` and `DeleteCommand` properties and `UpdateParameters` and `DeleteParameters` collections accordingly.</span></span>

> [!NOTE]
> <span data-ttu-id="937ab-175">SqlDataSource denetim ekleme özelliklerini kullandığımızdan, `InsertCommand` özelliğini ve `InsertParameters` koleksiyonunu kaldırmayı ücretsiz olarak hissettik.</span><span class="sxs-lookup"><span data-stu-id="937ab-175">Since we re not using the SqlDataSource control s inserting capabilities, feel free to remove the `InsertCommand` property and its `InsertParameters` collection.</span></span>

## <a name="correctly-handlingnullvalues"></a><span data-ttu-id="937ab-176">`NULL`değerlerini doğru şekilde Işleme</span><span class="sxs-lookup"><span data-stu-id="937ab-176">Correctly Handling`NULL`Values</span></span>

<span data-ttu-id="937ab-177">Ne yazık ki, iyimser eşzamanlılık kullanılırken genişletilmiş `UPDATE` ve `DELETE` deyimleri veri kaynağını yapılandırma Sihirbazı tarafından otomatik olarak oluşturulur `NULL` değerler içeren *kayıtlarla çalışmaz.*</span><span class="sxs-lookup"><span data-stu-id="937ab-177">Unfortunately, the augmented `UPDATE` and `DELETE` statements autogenerated by the Configure Data Source wizard when using optimistic concurrency do *not* work with records that contain `NULL` values.</span></span> <span data-ttu-id="937ab-178">Nedenini görmek için, SqlDataSource s `UpdateCommand`göz önünde bulundurun:</span><span class="sxs-lookup"><span data-stu-id="937ab-178">To see why, consider our SqlDataSource s `UpdateCommand`:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample6.sql)]

<span data-ttu-id="937ab-179">`Products` tablosundaki `UnitPrice` sütununda `NULL` değeri olabilir.</span><span class="sxs-lookup"><span data-stu-id="937ab-179">The `UnitPrice` column in the `Products` table can have `NULL` values.</span></span> <span data-ttu-id="937ab-180">Belirli bir kaydın `UnitPrice`için `NULL` bir değeri varsa, `NULL = NULL` her zaman false döndürdüğünden `[UnitPrice] = @original_UnitPrice` `WHERE` yan tümce bölümü *her zaman* false olarak değerlendirilir.</span><span class="sxs-lookup"><span data-stu-id="937ab-180">If a particular record has a `NULL` value for `UnitPrice`, the `WHERE` clause portion `[UnitPrice] = @original_UnitPrice` will *always* evaluate to False because `NULL = NULL` always returns False.</span></span> <span data-ttu-id="937ab-181">Bu nedenle, `UPDATE` ve `DELETE` deyimleri `WHERE` yan tümceleri güncelleştirmek veya silmek için herhangi bir satır döndürülmeyeceği için `NULL` değerleri içeren kayıtlar düzenlenemez veya silinemez.</span><span class="sxs-lookup"><span data-stu-id="937ab-181">Therefore, records that contain `NULL` values cannot be edited or deleted, as the `UPDATE` and `DELETE` statements `WHERE` clauses won't return any rows to update or delete.</span></span>

> [!NOTE]
> <span data-ttu-id="937ab-182">Bu hata ilk olarak Microsoft 'a, SqlDataSource 'da 2004 Haziran ayında [yanlış SQL deyimleri oluşturuyor](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) ve ASP.net 'in bir sonraki sürümünde düzeltilmesi planlanacaktır.</span><span class="sxs-lookup"><span data-stu-id="937ab-182">This bug was first reported to Microsoft in June of 2004 in [SqlDataSource Generates Incorrect SQL Statements](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) and is reportedly scheduled to be fixed in the next version of ASP.NET.</span></span>

<span data-ttu-id="937ab-183">Bunu yapmak için, `NULL` değerlerine sahip olan **Tüm** sütunlar için hem `UpdateCommand` hem de `DeleteCommand` özelliklerde `WHERE` yan tümceleri el ile güncelleştirmemiz gerekir.</span><span class="sxs-lookup"><span data-stu-id="937ab-183">To fix this, we have to manually update the `WHERE` clauses in both the `UpdateCommand` and `DeleteCommand` properties for **all** columns that can have `NULL` values.</span></span> <span data-ttu-id="937ab-184">Genel olarak `[ColumnName] = @original_ColumnName` şu şekilde değiştirin:</span><span class="sxs-lookup"><span data-stu-id="937ab-184">In general, change `[ColumnName] = @original_ColumnName` to:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample7.sql)]

<span data-ttu-id="937ab-185">Bu değişiklik bildirime dayalı biçimlendirme aracılığıyla doğrudan, Özellikler penceresi UpdateQuery veya DeleteQuery seçenekleri aracılığıyla ya da veri yapılandırma içindeki özel bir SQL deyimi veya saklı yordam belirleme seçeneğinde GÜNCELLEŞTIRME ve SILME sekmeleri aracılığıyla yapılabilir Kaynak Sihirbazı.</span><span class="sxs-lookup"><span data-stu-id="937ab-185">This modification can be made directly through the declarative markup, via the UpdateQuery or DeleteQuery options from the Properties window, or through the UPDATE and DELETE tabs in the Specify a custom SQL statement or stored procedure option in the Configure Data Source wizard.</span></span> <span data-ttu-id="937ab-186">Bu değişiklik, `UpdateCommand` ve `DeleteCommand` s `WHERE` yan tümcesindeki `NULL` değerleri içerebilen *her* sütun için yapılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="937ab-186">Again, this modification must be made for *every* column in the `UpdateCommand` and `DeleteCommand` s `WHERE` clause that can contain `NULL` values.</span></span>

<span data-ttu-id="937ab-187">Bunu örneğimize uygulamak aşağıdaki değiştirilen `UpdateCommand` ve `DeleteCommand` değerlerine neden olur:</span><span class="sxs-lookup"><span data-stu-id="937ab-187">Applying this to our example results in the following modified `UpdateCommand` and `DeleteCommand` values:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample8.sql)]

## <a name="step-2-adding-a-gridview-with-edit-and-delete-options"></a><span data-ttu-id="937ab-188">2\. Adım: düzenleme ve silme seçenekleriyle GridView ekleme</span><span class="sxs-lookup"><span data-stu-id="937ab-188">Step 2: Adding a GridView with Edit and Delete Options</span></span>

<span data-ttu-id="937ab-189">İyimser eşzamanlılığı destekleyecek şekilde yapılandırılmış SqlDataSource ile, bu eşzamanlılık denetimini kullanan sayfaya bir veri Web denetimi eklemektir.</span><span class="sxs-lookup"><span data-stu-id="937ab-189">With the SqlDataSource configured to support optimistic concurrency, all that remains is to add a data Web control to the page that utilizes this concurrency control.</span></span> <span data-ttu-id="937ab-190">Bu öğreticide, s için hem düzenleme hem de silme işlevselliği sağlayan bir GridView ekleyelim.</span><span class="sxs-lookup"><span data-stu-id="937ab-190">For this tutorial, let s add a GridView that provides both edit and delete functionality.</span></span> <span data-ttu-id="937ab-191">Bunu gerçekleştirmek için araç kutusundan Tasarımcı üzerine bir GridView sürükleyin ve `ID` `Products`olarak ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-191">To accomplish this, drag a GridView from the Toolbox onto the Designer and set its `ID` to `Products`.</span></span> <span data-ttu-id="937ab-192">GridView s akıllı etiketinden, 1. adımda eklenen `ProductsDataSourceWithOptimisticConcurrency` SqlDataSource denetimine bağlayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-192">From the GridView s smart tag, bind it to the `ProductsDataSourceWithOptimisticConcurrency` SqlDataSource control added in Step 1.</span></span> <span data-ttu-id="937ab-193">Son olarak, düzenlemenizi etkinleştir ve akıllı etiketteki silme seçeneklerini etkinleştir seçeneğini işaretleyin.</span><span class="sxs-lookup"><span data-stu-id="937ab-193">Finally, check the Enable Editing and Enable Deleting options from the smart tag.</span></span>

<span data-ttu-id="937ab-194">[GridView 'ı SqlDataSource 'a bağlamak ve Düzenle ve silmeyi etkinleştirmek ![](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="937ab-194">[![Bind the GridView to the SqlDataSource and Enable Editing and Deleting](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.png)</span></span>

<span data-ttu-id="937ab-195">**Şekil 6**: GridView 'ı SqlDataSource 'a bağlayın ve düzenlemenizi ve silmeyi etkinleştirin ([tam boyutlu görüntüyü görüntülemek için tıklayın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="937ab-195">**Figure 6**: Bind the GridView to the SqlDataSource and Enable Editing and Deleting ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image10.png))</span></span>

<span data-ttu-id="937ab-196">GridView eklendikten sonra, `ProductID` BoundField ' ı kaldırarak ve `ProductName` BoundField s `HeaderText` özelliğini ürün olarak değiştirerek ve `HeaderText` özelliğinin yalnızca fiyatı olacak şekilde `UnitPrice` BoundField güncelleyerek görünümünü yapılandırın.</span><span class="sxs-lookup"><span data-stu-id="937ab-196">After adding the GridView, configure its appearance by removing the `ProductID` BoundField, changing the `ProductName` BoundField s `HeaderText` property to Product, and updating the `UnitPrice` BoundField so that its `HeaderText` property is simply Price.</span></span> <span data-ttu-id="937ab-197">İdeal olarak, `ProductName` değeri için bir RequiredFieldValidator ve `UnitPrice` değeri için bir CompareValidator (düzgün şekilde biçimlendirilen bir sayısal değer olduğundan emin olmak için) için bir RequiredFieldValidator eklemek üzere, düzen arabirimini geliştirdik.</span><span class="sxs-lookup"><span data-stu-id="937ab-197">Ideally, we d enhance the editing interface to include a RequiredFieldValidator for the `ProductName` value and a CompareValidator for the `UnitPrice` value (to ensure it s a properly formatted numeric value).</span></span> <span data-ttu-id="937ab-198">Daha ayrıntılı bir bakış için bkz. [veri değişikliği arabirimi](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) öğreticisini özelleştirme, GridView s Düzenle arabirimini özelleştirmeye bakın.</span><span class="sxs-lookup"><span data-stu-id="937ab-198">Refer to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial for a more in-depth look at customizing the GridView s editing interface.</span></span>

> [!NOTE]
> <span data-ttu-id="937ab-199">GridView 'dan SqlDataSource 'a geçirilen özgün değerler görüntüleme durumunda depolandığından, GridView s görünüm durumu etkinleştirilmelidir.</span><span class="sxs-lookup"><span data-stu-id="937ab-199">The GridView s view state must be enabled since the original values passed from the GridView to the SqlDataSource are stored in view state.</span></span>

<span data-ttu-id="937ab-200">GridView 'da bu değişiklikleri yaptıktan sonra GridView ve SqlDataSource bildirim temelli biçimlendirme aşağıdakine benzer olmalıdır:</span><span class="sxs-lookup"><span data-stu-id="937ab-200">After making these modifications to the GridView, the GridView and SqlDataSource declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample9.aspx)]

<span data-ttu-id="937ab-201">İyimser eşzamanlılık denetimini çalışırken görmek için iki tarayıcı penceresi açın ve `OptimisticConcurrency.aspx` sayfasını her ikisine de yükleyin.</span><span class="sxs-lookup"><span data-stu-id="937ab-201">To see the optimistic concurrency control in action, open two browser windows and load the `OptimisticConcurrency.aspx` page in both.</span></span> <span data-ttu-id="937ab-202">Her iki tarayıcıda da ilk ürünün düzenleme düğmelerine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-202">Click on the Edit buttons for the first product in both browsers.</span></span> <span data-ttu-id="937ab-203">Tek bir tarayıcıda ürün adını değiştirin ve Güncelleştir ' e tıklayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-203">In one browser, change the product name and click Update.</span></span> <span data-ttu-id="937ab-204">Tarayıcı geri göndermeye ve GridView, yeni düzenlenen kayıt için yeni ürün adını gösterecek şekilde ön düzenleme moduna geri döner.</span><span class="sxs-lookup"><span data-stu-id="937ab-204">The browser will postback and the GridView will return to its pre-editing mode, showing the new product name for the record just edited.</span></span>

<span data-ttu-id="937ab-205">İkinci tarayıcı penceresinde, fiyatı değiştirin (ancak ürün adını özgün değeri olarak bırakın) ve Güncelleştir ' e tıklayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-205">In the second browser window, change the price (but leave the product name as its original value) and click Update.</span></span> <span data-ttu-id="937ab-206">Geri göndermede, kılavuz, ön Düzenle moduna geri döner, ancak fiyata yapılan değişiklik kaydedilmez.</span><span class="sxs-lookup"><span data-stu-id="937ab-206">On postback, the grid returns to its pre-editing mode, but the change to the price is not recorded.</span></span> <span data-ttu-id="937ab-207">İkinci tarayıcı, eski fiyata sahip olan ilk yeni ürün adıyla aynı değeri gösterir.</span><span class="sxs-lookup"><span data-stu-id="937ab-207">The second browser shows the same value as the first one the new product name with the old price.</span></span> <span data-ttu-id="937ab-208">İkinci tarayıcı penceresinde yapılan değişiklikler kayboldu.</span><span class="sxs-lookup"><span data-stu-id="937ab-208">The changes made in the second browser window were lost.</span></span> <span data-ttu-id="937ab-209">Üstelik, bir eşzamanlılık ihlalinin gerçekleşmediğini belirten bir özel durum veya ileti olmadığından, değişiklikler sessizce kaybedilir.</span><span class="sxs-lookup"><span data-stu-id="937ab-209">Moreover, the changes were lost rather quietly, as there was no exception or message indicating that a concurrency violation just occurred.</span></span>

<span data-ttu-id="937ab-210">[Ikinci tarayıcı penceresindeki değişiklikler sessizce kayboldu ![](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="937ab-210">[![The Changes in the Second Browser Window Were Silently Lost](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image11.png)</span></span>

<span data-ttu-id="937ab-211">**Şekil 7**: Ikinci tarayıcı penceresindeki değişiklikler sessizce kayboldu ([tam boyutlu görüntüyü görüntülemek için tıklayın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="937ab-211">**Figure 7**: The Changes in the Second Browser Window Were Silently Lost ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image12.png))</span></span>

<span data-ttu-id="937ab-212">İkinci tarayıcı değişikliklerinin neden yürütülmedi, `UPDATE` deyimi `WHERE` yan tümcesi tüm kayıtları filtreledi ve bu nedenle herhangi bir satırı etkilemediği için oldu.</span><span class="sxs-lookup"><span data-stu-id="937ab-212">The reason why the second browser s changes were not committed was because the `UPDATE` statement s `WHERE` clause filtered out all records and therefore did not affect any rows.</span></span> <span data-ttu-id="937ab-213">`UPDATE` deyiminize tekrar göz atalım:</span><span class="sxs-lookup"><span data-stu-id="937ab-213">Let s look at the `UPDATE` statement again:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample10.sql)]

<span data-ttu-id="937ab-214">İkinci tarayıcı penceresi kaydı güncelleştirdiğinde, `WHERE` yan tümcesinde belirtilen özgün ürün adı, var olan ürün adı ile eşleşmiyor (ilk tarayıcı tarafından değiştirildiğinden).</span><span class="sxs-lookup"><span data-stu-id="937ab-214">When the second browser window updates the record, the original product name specified in the `WHERE` clause doesn t match up with the existing product name (since it was changed by the first browser).</span></span> <span data-ttu-id="937ab-215">Bu nedenle, deyimin `[ProductName] = @original_ProductName` false değerini döndürür ve `UPDATE` hiçbir kaydı etkilemez.</span><span class="sxs-lookup"><span data-stu-id="937ab-215">Therefore, the statement `[ProductName] = @original_ProductName` returns False, and the `UPDATE` does not affect any records.</span></span>

> [!NOTE]
> <span data-ttu-id="937ab-216">Aynı şekilde çalışma öğesini silin.</span><span class="sxs-lookup"><span data-stu-id="937ab-216">Delete works in the same manner.</span></span> <span data-ttu-id="937ab-217">İki tarayıcı penceresi açıkken, belirli bir ürünü tek bir düzenleyerek ve sonra değişiklikleri kaydederek başlayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-217">With two browser windows open, start by editing a given product with one, and then saving its changes.</span></span> <span data-ttu-id="937ab-218">Değişiklikleri tek bir tarayıcıda kaydettikten sonra, diğer üründe aynı ürünün Sil düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-218">After saving the changes in the one browser, click the Delete button for the same product in the other.</span></span> <span data-ttu-id="937ab-219">Özgün değerler `DELETE` deyimi s `WHERE` yan tümcesinde eşleşmediğinden, silme işlemi sessizce başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="937ab-219">Since the original values don t match up in the `DELETE` statement s `WHERE` clause, the delete silently fails.</span></span>

<span data-ttu-id="937ab-220">İkinci tarayıcı penceresinde Son Kullanıcı perspektifinden, güncelleştirme düğmesine tıkladıktan sonra kılavuz, ön Düzenle moduna geri döner, ancak değişiklikleri kaybedilir.</span><span class="sxs-lookup"><span data-stu-id="937ab-220">From the end user s perspective in the second browser window, after clicking the Update button the grid returns to the pre-editing mode, but their changes were lost.</span></span> <span data-ttu-id="937ab-221">Ancak, değişikliklerinin hiçbir görsel geri bildirimi yok.</span><span class="sxs-lookup"><span data-stu-id="937ab-221">However, there s no visual feedback that their changes didn't stick.</span></span> <span data-ttu-id="937ab-222">İdeal olarak, bir Kullanıcı değişikliklerinin eşzamanlılık ihlaline karşı kaybolması durumunda onlara bildirimde bulunur ve belki de Kılavuzu düzenleme modunda tutabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="937ab-222">Ideally, if a user s changes are lost to a concurrency violation, we d notify them and, perhaps, keep the grid in edit mode.</span></span> <span data-ttu-id="937ab-223">Bunun nasıl yapılacağını göz atalım.</span><span class="sxs-lookup"><span data-stu-id="937ab-223">Let s look at how to accomplish this.</span></span>

## <a name="step-3-determining-when-a-concurrency-violation-has-occurred"></a><span data-ttu-id="937ab-224">3\. Adım: bir eşzamanlılık Ihlalinin ne zaman gerçekleştiğini belirleme</span><span class="sxs-lookup"><span data-stu-id="937ab-224">Step 3: Determining When a Concurrency Violation Has Occurred</span></span>

<span data-ttu-id="937ab-225">Bir eşzamanlılık ihlali yaptığı değişiklikleri reddettiğinde, bir eşzamanlılık ihlali oluştuğunda kullanıcıyı uyarmak iyi olacaktır.</span><span class="sxs-lookup"><span data-stu-id="937ab-225">Since a concurrency violation rejects the changes one has made, it would be nice to alert the user when a concurrency violation has occurred.</span></span> <span data-ttu-id="937ab-226">Kullanıcıyı uyarmak için, `ConcurrencyViolationMessage` adlı sayfanın en üstüne, `Text` özelliği şu iletiyi görüntüleyen bir etiket Web denetimi ekleyelim: başka bir kullanıcı tarafından aynı anda güncelleştirilmiş bir kaydı güncelleştirmeye veya silmeye çalıştınız.</span><span class="sxs-lookup"><span data-stu-id="937ab-226">To alert the user, let s add a Label Web control to the top of the page named `ConcurrencyViolationMessage` whose `Text` property displays the following message: You have attempted to update or delete a record that was simultaneously updated by another user.</span></span> <span data-ttu-id="937ab-227">Lütfen diğer kullanıcının değişikliklerini gözden geçirin ve sonra güncelleştirmenizi veya silmeyi yeniden yapın.</span><span class="sxs-lookup"><span data-stu-id="937ab-227">Please review the other user's changes and then redo your update or delete.</span></span> <span data-ttu-id="937ab-228">Etiketi Control s `CssClass` özelliğini, bir kırmızı, italik, kalın ve büyük yazı tipinde metin görüntüleyen `Styles.css` tanımlanmış bir CSS sınıfı olan uyarı olarak ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-228">Set the Label control s `CssClass` property to Warning, which is a CSS class defined in `Styles.css` that displays text in a red, italic, bold, and large font.</span></span> <span data-ttu-id="937ab-229">Son olarak, etiket s `Visible` ve `EnableViewState` özelliklerini `False`olarak ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-229">Finally, set the Label s `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="937ab-230">Bu, yalnızca `Visible` özelliğini açıkça `True`olarak ayarlamış olduğumuz geri göndermeler haricinde etiketi gizler.</span><span class="sxs-lookup"><span data-stu-id="937ab-230">This will hide the Label except for only those postbacks where we explicitly set its `Visible` property to `True`.</span></span>

<span data-ttu-id="937ab-231">[Uyarıyı göstermek için sayfaya bir etiket denetimi eklemek ![](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="937ab-231">[![Add a Label Control to the Page to Display the Warning](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image13.png)</span></span>

<span data-ttu-id="937ab-232">**Şekil 8**: uyarıyı görüntülemek için sayfaya bir etiket denetimi ekleyin ([tam boyutlu görüntüyü görüntülemek için tıklayın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="937ab-232">**Figure 8**: Add a Label Control to the Page to Display the Warning ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image14.png))</span></span>

<span data-ttu-id="937ab-233">Bir güncelleştirme veya silme gerçekleştirirken, GridView s `RowUpdated` ve `RowDeleted` olay işleyicileri, veri kaynağı denetimi istenen güncelleştirmeyi veya silmeyi gerçekleştirdikten sonra harekete geçmektedir.</span><span class="sxs-lookup"><span data-stu-id="937ab-233">When performing an update or delete, the GridView s `RowUpdated` and `RowDeleted` event handlers fire after its data source control has performed the requested update or delete.</span></span> <span data-ttu-id="937ab-234">Bu olay işleyicilerinden işlemden kaç satır etkilendiğini belirleyebiliriz.</span><span class="sxs-lookup"><span data-stu-id="937ab-234">We can determine how many rows were affected by the operation from these event handlers.</span></span> <span data-ttu-id="937ab-235">Sıfır satır etkileniyorsa, `ConcurrencyViolationMessage` etiketini göstermek istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="937ab-235">If zero rows were affected, we want to display the `ConcurrencyViolationMessage` Label.</span></span>

<span data-ttu-id="937ab-236">Hem `RowUpdated` hem de `RowDeleted` olayları için bir olay işleyicisi oluşturun ve aşağıdaki kodu ekleyin:</span><span class="sxs-lookup"><span data-stu-id="937ab-236">Create an event handler for both the `RowUpdated` and `RowDeleted` events and add the following code:</span></span>

[!code-vb[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample11.vb)]

<span data-ttu-id="937ab-237">Her iki olay işleyicilerinde de `e.AffectedRows` özelliğini denetliyoruz ve 0 ' a eşitse, `ConcurrencyViolationMessage` Label s `Visible` özelliğini `True`olarak ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="937ab-237">In both event handlers we check the `e.AffectedRows` property and, if it equals 0, set the `ConcurrencyViolationMessage` Label s `Visible` property to `True`.</span></span> <span data-ttu-id="937ab-238">`RowUpdated` olay işleyicisinde, GridView 'un, `KeepInEditMode` özelliğini true olarak ayarlayarak düzenleme modunda kalmasını de sağlarız.</span><span class="sxs-lookup"><span data-stu-id="937ab-238">In the `RowUpdated` event handler, we also instruct the GridView to stay in edit mode by setting the `KeepInEditMode` property to true.</span></span> <span data-ttu-id="937ab-239">Bunu yaparken, verileri kılavuza yeniden bağlamanız gerekir, böylece diğer Kullanıcı verileri, düzen arabirimine yüklenir.</span><span class="sxs-lookup"><span data-stu-id="937ab-239">In doing so, we need to rebind the data to the grid so that the other user s data is loaded into the editing interface.</span></span> <span data-ttu-id="937ab-240">Bu, GridView s `DataBind()` yöntemi çağırarak gerçekleştirilir.</span><span class="sxs-lookup"><span data-stu-id="937ab-240">This is accomplished by calling the GridView s `DataBind()` method.</span></span>

<span data-ttu-id="937ab-241">Şekil 9 ' da gösterildiği gibi, bu iki olay işleyicileriyle bir eşzamanlılık ihlali meydana geldiğinde çok dikkat çekici bir ileti görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="937ab-241">As Figure 9 shows, with these two event handlers, a very noticeable message is displayed whenever a concurrency violation occurs.</span></span>

<span data-ttu-id="937ab-242">[![bir Ileti eşzamanlılık Ihlalinin Yüzinde görüntülenir](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="937ab-242">[![A Message is Displayed in the Face of a Concurrency Violation](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image15.png)</span></span>

<span data-ttu-id="937ab-243">**Şekil 9**: bir Ileti eşzamanlılık Ihlali tarafında görüntülenir ([tam boyutlu görüntüyü görüntülemek için tıklayın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="937ab-243">**Figure 9**: A Message is Displayed in the Face of a Concurrency Violation ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image16.png))</span></span>

## <a name="summary"></a><span data-ttu-id="937ab-244">Özet</span><span class="sxs-lookup"><span data-stu-id="937ab-244">Summary</span></span>

<span data-ttu-id="937ab-245">Birden çok eş zamanlı kullanıcının aynı verileri düzenlemekte olabileceği bir Web uygulaması oluştururken, eşzamanlılık denetim seçeneklerini göz önünde bulundurmanız önemlidir.</span><span class="sxs-lookup"><span data-stu-id="937ab-245">When creating a web application where multiple, concurrent users may be editing the same data, it is important to consider concurrency control options.</span></span> <span data-ttu-id="937ab-246">Varsayılan olarak, ASP.NET Data Web denetimleri ve veri kaynağı denetimleri herhangi bir eşzamanlılık denetimi kullanmaz.</span><span class="sxs-lookup"><span data-stu-id="937ab-246">By default, the ASP.NET data Web controls and data source controls do not employ any concurrency control.</span></span> <span data-ttu-id="937ab-247">Bu öğreticide gördüğünüz gibi, SqlDataSource ile iyimser eşzamanlılık denetimini uygulamak nispeten hızlı ve kolaydır.</span><span class="sxs-lookup"><span data-stu-id="937ab-247">As we saw in this tutorial, implementing optimistic concurrency control with the SqlDataSource is relatively quick and easy.</span></span> <span data-ttu-id="937ab-248">SqlDataSource, otomatik olarak düzenlenen `UPDATE` ve `DELETE` deyimlerine genişletilmiş `WHERE` yan tümceleri eklemek için yasalların çoğunu işler, ancak `NULL` değerlerini doğru şekilde Işleme bölümünde anlatıldığı gibi, `NULL` değer sütunlarını işlemek için birkaç alt tledide vardır.</span><span class="sxs-lookup"><span data-stu-id="937ab-248">The SqlDataSource handles most of the legwork for your adding augmented `WHERE` clauses to the autogenerated `UPDATE` and `DELETE` statements but there are a few subtleties in handling `NULL` value columns, as discussed in the Correctly Handling `NULL` Values section.</span></span>

<span data-ttu-id="937ab-249">Bu öğretici, SqlDataSource incelemesini yerine eriyor.</span><span class="sxs-lookup"><span data-stu-id="937ab-249">This tutorial concludes our examination of the SqlDataSource.</span></span> <span data-ttu-id="937ab-250">Kalan öğreticilerimiz, ObjectDataSource ve katmanlı mimari kullanılarak verilerle çalışmaya geri dönecektir.</span><span class="sxs-lookup"><span data-stu-id="937ab-250">Our remaining tutorials will return to working with data using the ObjectDataSource and tiered architecture.</span></span>

<span data-ttu-id="937ab-251">Programlamanın kutlu olsun!</span><span class="sxs-lookup"><span data-stu-id="937ab-251">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="937ab-252">Yazar hakkında</span><span class="sxs-lookup"><span data-stu-id="937ab-252">About the Author</span></span>

<span data-ttu-id="937ab-253">4GuysFromRolla.com 'in, [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), yedi ASP/ASP. net books ve [](http://www.4guysfromrolla.com)'in yazarı, 1998 sürümünden bu yana Microsoft Web teknolojileriyle çalışmaktadır.</span><span class="sxs-lookup"><span data-stu-id="937ab-253">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="937ab-254">Scott bağımsız danışman, Trainer ve yazıcı olarak çalışıyor.</span><span class="sxs-lookup"><span data-stu-id="937ab-254">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="937ab-255">En son kitabı, [*24 saat içinde ASP.NET 2,0 kendi kendinize eğitim*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ister.</span><span class="sxs-lookup"><span data-stu-id="937ab-255">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="937ab-256">mitchell@4GuysFromRolla.comadresinden erişilebilir [.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="937ab-256">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="937ab-257">ya da blog aracılığıyla [http://ScottOnWriting.NET](http://ScottOnWriting.NET)bulabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="937ab-257">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="937ab-258">Öncekini</span><span class="sxs-lookup"><span data-stu-id="937ab-258">Previous</span></span>](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)
