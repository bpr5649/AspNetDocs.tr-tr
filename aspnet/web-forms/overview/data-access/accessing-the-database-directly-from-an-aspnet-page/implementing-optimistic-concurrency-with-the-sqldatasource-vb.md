---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-vb
title: (VB) SqlDataSource ile iyimser eşzamanlılık uygulama | Microsoft Docs
author: rick-anderson
description: Bu öğreticide iyimser eşzamanlılık denetiminin temel bilgileri gözden geçirin ve ardından SqlDataSource denetimi kullanarak nasıl keşfedin.
ms.author: riande
ms.date: 02/20/2007
ms.assetid: a8fa72ee-8328-4854-a419-c1b271772303
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-vb
msc.type: authoredcontent
ms.openlocfilehash: 879f0f491461ec49c4eef9dc8add747ac2b22f90
ms.sourcegitcommit: 289e051cc8a90e8f7127e239fda73047bde4de12
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/25/2019
ms.locfileid: "58422109"
---
<a name="implementing-optimistic-concurrency-with-the-sqldatasource-vb"></a><span data-ttu-id="594c6-103">SqlDataSource ile İyimser Eşzamanlılık Uygulama (VB)</span><span class="sxs-lookup"><span data-stu-id="594c6-103">Implementing Optimistic Concurrency with the SqlDataSource (VB)</span></span>
====================
<span data-ttu-id="594c6-104">tarafından [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="594c6-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="594c6-105">[Örnek uygulamayı indirin](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_VB.exe) veya [PDF olarak indirin](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/datatutorial50vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="594c6-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_VB.exe) or [Download PDF](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/datatutorial50vb1.pdf)</span></span>

> <span data-ttu-id="594c6-106">Bu öğreticide iyimser eşzamanlılık denetiminin temel bilgileri gözden geçirin ve ardından SqlDataSource denetimi kullanarak nasıl keşfedin.</span><span class="sxs-lookup"><span data-stu-id="594c6-106">In this tutorial we review the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource control.</span></span>


## <a name="introduction"></a><span data-ttu-id="594c6-107">Giriş</span><span class="sxs-lookup"><span data-stu-id="594c6-107">Introduction</span></span>

<span data-ttu-id="594c6-108">Önceki öğreticide biz ekleme, güncelleştirme ve silme SqlDataSource denetimi olanağı ekleme incelenir.</span><span class="sxs-lookup"><span data-stu-id="594c6-108">In the preceding tutorial we examined how to add inserting, updating, and deleting capabilities to the SqlDataSource control.</span></span> <span data-ttu-id="594c6-109">Kısacası, bu özellikleri sağlamak için buna karşılık gelen belirtmek ihtiyacımız `INSERT`, `UPDATE`, veya `DELETE` s denetimi SQL deyiminde `InsertCommand`, `UpdateCommand`, veya `DeleteCommand` uygun birlikte özellikleri parametrelerinde `InsertParameters`, `UpdateParameters`, ve `DeleteParameters` koleksiyonları.</span><span class="sxs-lookup"><span data-stu-id="594c6-109">In short, to provide these features we needed to specify the corresponding `INSERT`, `UPDATE`, or `DELETE` SQL statement in the control s `InsertCommand`, `UpdateCommand`, or `DeleteCommand` properties, along with the appropriate parameters in the `InsertParameters`, `UpdateParameters`, and `DeleteParameters` collections.</span></span> <span data-ttu-id="594c6-110">Bu özellikler ve Koleksiyonlar el ile belirtilebilir, ancak veri kaynağı Yapılandırma Sihirbazı'nı s Gelişmiş düğmesine bir Oluştur sunar `INSERT`, `UPDATE`, ve `DELETE` otomatik oluşturur-Bu deyimler deyimleri onay kutusuna bağlı olarak `SELECT` deyimi.</span><span class="sxs-lookup"><span data-stu-id="594c6-110">While these properties and collections can be specified manually, the Configure Data Source wizard s Advanced button offers a Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox that will auto-create these statements based on the `SELECT` statement.</span></span>

<span data-ttu-id="594c6-111">Generate birlikte `INSERT`, `UPDATE`, ve `DELETE` deyimleri onay kutusunu Gelişmiş SQL oluşturma seçenekleri iletişim kutusu içeren iyimser eşzamanlılık seçeneğini kullanın (bkz. Şekil 1).</span><span class="sxs-lookup"><span data-stu-id="594c6-111">Along with the Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox, the Advanced SQL Generation Options dialog box includes a Use optimistic concurrency option (see Figure 1).</span></span> <span data-ttu-id="594c6-112">Bu onay kutusu işaretlendiğinde, `WHERE` otomatik olarak oluşturulan yan tümcelerinde `UPDATE` ve `DELETE` deyimleri yalnızca güncelleştirmeyi gerçekleştirmek veya kullanıcı kılavuza en son veriler yüklendikten sonra temel alınan veritabanı verileri değiştirilmemiş silme için değiştirildiğinde.</span><span class="sxs-lookup"><span data-stu-id="594c6-112">When checked, the `WHERE` clauses in the autogenerated `UPDATE` and `DELETE` statements are modified to only perform the update or delete if the underlying database data hasn't been modified since the user last loaded the data into the grid.</span></span>


![İyimser eşzamanlılık destek Gelişmiş ekleyebilirsiniz SQL oluşturma iletişim kutusu seçenekleri](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image1.gif)

<span data-ttu-id="594c6-114">**Şekil 1**: İyimser eşzamanlılık destek Gelişmiş ekleyebilirsiniz SQL oluşturma iletişim kutusu seçenekleri</span><span class="sxs-lookup"><span data-stu-id="594c6-114">**Figure 1**: You Can Add Optimistic Concurrency Support from the Advanced SQL Generation Options Dialog Box</span></span>


<span data-ttu-id="594c6-115">Geri [iyimser eşzamanlılık uygulama](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) öğretici iyimser eşzamanlılık denetimi ve ObjectDataSource için ekleme temelleri biz incelenir.</span><span class="sxs-lookup"><span data-stu-id="594c6-115">Back in the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial we examined the fundamentals of optimistic concurrency control and how to add it to the ObjectDataSource.</span></span> <span data-ttu-id="594c6-116">Bu öğreticide biz iyimser eşzamanlılık denetiminin hakkında temel bilgiler rötuşlama ve ardından SqlDataSource kullanarak nasıl keşfetmek.</span><span class="sxs-lookup"><span data-stu-id="594c6-116">In this tutorial we'll retouch on the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource.</span></span>

## <a name="a-recap-of-optimistic-concurrency"></a><span data-ttu-id="594c6-117">İyimser eşzamanlılık bir özeti</span><span class="sxs-lookup"><span data-stu-id="594c6-117">A Recap of Optimistic Concurrency</span></span>

<span data-ttu-id="594c6-118">Birden çok izin veren web uygulamaları için Düzenle veya aynı verileri silmek için eşzamanlı kullanıcıların bir kullanıcı başka bir s değişikliklerin yanlışlıkla üzerine olasılığı vardır.</span><span class="sxs-lookup"><span data-stu-id="594c6-118">For web applications that allow multiple, simultaneous users to edit or delete the same data, there exists a possibility that one user may accidentally overwrite another s changes.</span></span> <span data-ttu-id="594c6-119">İçinde [iyimser eşzamanlılık uygulama](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) öğretici miyim sağlanan aşağıdaki örnekte:</span><span class="sxs-lookup"><span data-stu-id="594c6-119">In the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial I provided the following example:</span></span>

<span data-ttu-id="594c6-120">İki kullanıcı, Jisun ve Vedat, hem de ziyaretçiler, güncelleştirme ve silme ürünler aracılığıyla bir GridView denetimi izin verilen bir uygulamada bir sayfasını ziyaret düşünün.</span><span class="sxs-lookup"><span data-stu-id="594c6-120">Imagine that two users, Jisun and Sam, were both visiting a page in an application that allowed visitors to update and delete products through a GridView control.</span></span> <span data-ttu-id="594c6-121">Her ikisi de Düzenle düğmesini ayrıntılarını aynı anda tıklayın.</span><span class="sxs-lookup"><span data-stu-id="594c6-121">Both click the Edit button for Chai around the same time.</span></span> <span data-ttu-id="594c6-122">Jisun Chai Çay için ürün adını değiştirir ve güncelleştir düğmesine tıklar.</span><span class="sxs-lookup"><span data-stu-id="594c6-122">Jisun changes the product name to Chai Tea and clicks the Update button.</span></span> <span data-ttu-id="594c6-123">Net sonucu olan bir `UPDATE` ayarlar veritabanına gönderilen bildirimi *tüm* ürün s güncelleştirilebilir alanların (Jisun yalnızca bir alan güncelleştirilmiş olmasa bile `ProductName`).</span><span class="sxs-lookup"><span data-stu-id="594c6-123">The net result is an `UPDATE` statement that is sent to the database, which sets *all* of the product s updateable fields (even though Jisun only updated one field, `ProductName`).</span></span> <span data-ttu-id="594c6-124">Bu anda, veritabanında Chai Çay, İçecekler, kategori vb. Bu belirli bir ürün için tedarikçi Exotic Liquids değerleri var.</span><span class="sxs-lookup"><span data-stu-id="594c6-124">At this point in time, the database has the values Chai Tea, the category Beverages, the supplier Exotic Liquids, and so on for this particular product.</span></span> <span data-ttu-id="594c6-125">Ancak, Sam s ekranında GridView hala ürün adı düzenlenebilir GridView satırında Chai gösterilir.</span><span class="sxs-lookup"><span data-stu-id="594c6-125">However, the GridView on Sam s screen still shows the product name in the editable GridView row as Chai.</span></span> <span data-ttu-id="594c6-126">Birkaç saniye Jisun s değişiklikleri işlendikten sonra Sam kategorisi için Çeşniler güncelleştirir ve güncelleştirme tıklar.</span><span class="sxs-lookup"><span data-stu-id="594c6-126">A few seconds after Jisun s changes have been committed, Sam updates the category to Condiments and clicks Update.</span></span> <span data-ttu-id="594c6-127">Sonuçlanır bir `UPDATE` Chai için ürün adını ayarlar veritabanına gönderilen deyimi `CategoryID` karşılık gelen Çeşniler kategori kimliği ve benzeri.</span><span class="sxs-lookup"><span data-stu-id="594c6-127">This results in an `UPDATE` statement sent to the database that sets the product name to Chai, the `CategoryID` to the corresponding Condiments category ID, and so on.</span></span> <span data-ttu-id="594c6-128">Ürün adı Jisun s değişikliklerin üzerine yazıldı.</span><span class="sxs-lookup"><span data-stu-id="594c6-128">Jisun s changes to the product name have been overwritten.</span></span>

<span data-ttu-id="594c6-129">Şekil 2, bu etkileşim gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="594c6-129">Figure 2 illustrates this interaction.</span></span>


<span data-ttu-id="594c6-130">[![İki kullanıcı aynı anda bir kayıt güncelleştirdiğinizde var. bir kullanıcıyı s potansiyeli diğer s üzerine yazmak için değişir](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="594c6-130">[![When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image1.png)</span></span>

<span data-ttu-id="594c6-131">**Şekil 2**: Ne zaman iki kullanıcı aynı anda güncelleştirmesi bir kaydı var. s olası bir kullanıcıyı diğer s için üzerine yazma değiştirir ([tam boyutlu görüntüyü görmek için tıklatın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="594c6-131">**Figure 2**: When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.png))</span></span>


<span data-ttu-id="594c6-132">Bu senaryo unfolding gelen, çeşit önlemek için [eşzamanlılık denetimi](http://en.wikipedia.org/wiki/Concurrency_control) uygulanmalıdır.</span><span class="sxs-lookup"><span data-stu-id="594c6-132">To prevent this scenario from unfolding, a form of [concurrency control](http://en.wikipedia.org/wiki/Concurrency_control) must be implemented.</span></span> <span data-ttu-id="594c6-133">[İyimser eşzamanlılık](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) odak noktası, Bu öğretici, eşzamanlılık çakışmalarını every zorunluluğu, olabilecek çalışırken orada varsayımına vermiyor gibi çakışmalar ortaya zaman büyük çoğunluğu çalışır.</span><span class="sxs-lookup"><span data-stu-id="594c6-133">[Optimistic concurrency](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) the focus of this tutorial works on the assumption that while there may be concurrency conflicts every now and then, the vast majority of the time such conflicts won't arise.</span></span> <span data-ttu-id="594c6-134">Bir çakışma oluşursa, bu nedenle, iyimser eşzamanlılık denetimi yalnızca kullanıcının aynı verileri başka bir kullanıcı tarafından değiştirildiğinden, değişiklikleri can t kaydedilmesi bildirir.</span><span class="sxs-lookup"><span data-stu-id="594c6-134">Therefore, if a conflict does arise, optimistic concurrency control simply informs the user that their changes can t be saved because another user has modified the same data.</span></span>

> [!NOTE]
> <span data-ttu-id="594c6-135">Burada, çok fazla eşzamanlılık çakışma olur ya da bu gibi çakışmaları fazla değilseniz varsayılır uygulamalar için ardından kötümser eşzamanlılık denetimi yerine kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="594c6-135">For applications where it is assumed that there will be many concurrency conflicts or if such conflicts are not tolerable, then pessimistic concurrency control can be used instead.</span></span> <span data-ttu-id="594c6-136">Kiracıurl [iyimser eşzamanlılık uygulama](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) kötümser eşzamanlılık denetimi hakkında daha kapsamlı bir tartışma için öğretici.</span><span class="sxs-lookup"><span data-stu-id="594c6-136">Refer back to the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial for a more thorough discussion on pessimistic concurrency control.</span></span>


<span data-ttu-id="594c6-137">İyimser eşzamanlılık denetimi, güncelleştirme veya silme işlemi başlatıldığında gibi kayıt güncelleştirildiğinde veya silindiğinde değerlerin aynı olduğundan emin olarak çalışır.</span><span class="sxs-lookup"><span data-stu-id="594c6-137">Optimistic concurrency control works by ensuring that the record being updated or deleted has the same values as it did when the updating or deleting process started.</span></span> <span data-ttu-id="594c6-138">Örneğin, düzenlenebilir bir GridView Düzenle düğmesine tıklandığında, kayıt s değerleri veritabanından okunur ve metin kutuları ve diğer Web denetimleri görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="594c6-138">For example, when clicking the Edit button in an editable GridView, the record s values are read from the database and displayed in TextBoxes and other Web controls.</span></span> <span data-ttu-id="594c6-139">Bu özgün değerlerine GridView tarafından kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="594c6-139">These original values are saved by the GridView.</span></span> <span data-ttu-id="594c6-140">Daha sonra kullanıcı değişiklikleri yapar ve güncelleştir düğmesine tıkladığında `UPDATE` kullanılan deyimi özgün değerlerine yanı sıra yeni değerleri dikkate alın ve kullanıcı düzenlemeye başladığını orijinal değerleri yalnızca temel alınan veritabanı kaydı güncelleştirin yine de veritabanında değerleri aynıdır.</span><span class="sxs-lookup"><span data-stu-id="594c6-140">Later, after the user makes her changes and clicks the Update button, the `UPDATE` statement used must take into account the original values plus the new values and only update the underlying database record if the original values that the user started editing are identical to the values still in the database.</span></span> <span data-ttu-id="594c6-141">Şekil 3, bu olayların sırasını gösterir.</span><span class="sxs-lookup"><span data-stu-id="594c6-141">Figure 3 depicts this sequence of events.</span></span>


<span data-ttu-id="594c6-142">[![Update veya Delete için başarılı olması, orijinal değerleri geçerli veritabanı değerlere eşit olmalıdır](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="594c6-142">[![For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.png)</span></span>

<span data-ttu-id="594c6-143">**Şekil 3**: Update veya Delete Succeed, özgün değer gerekir olması eşit geçerli veritabanı için ([tam boyutlu görüntüyü görmek için tıklatın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="594c6-143">**Figure 3**: For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.png))</span></span>


<span data-ttu-id="594c6-144">İyimser eşzamanlılık uygulama çeşitli yaklaşımları vardır (bkz [Peter A. Bromberg](http://peterbromberg.net/)'s [iyimser eşzamanlılık güncelleştirme mantığı](http://www.eggheadcafe.com/articles/20050719.asp) birçok seçenek kısa göz atmak için).</span><span class="sxs-lookup"><span data-stu-id="594c6-144">There are various approaches to implementing optimistic concurrency (see [Peter A. Bromberg](http://peterbromberg.net/)'s [Optimistic Concurrency Updating Logic](http://www.eggheadcafe.com/articles/20050719.asp) for a brief look at a number of options).</span></span> <span data-ttu-id="594c6-145">SqlDataSource (veya ADO.NET yazılan bizim veri erişim katmanındaki kullanılan veri kümelerine göre) kullanılan bir teknik artırmaktadır `WHERE` tüm orijinal değerleri karşılaştırması içerecek şekilde yan tümcesi.</span><span class="sxs-lookup"><span data-stu-id="594c6-145">The technique used by the SqlDataSource (as well as by the ADO.NET Typed DataSets used in our Data Access Layer) augments the `WHERE` clause to include a comparison of all of the original values.</span></span> <span data-ttu-id="594c6-146">Aşağıdaki `UPDATE` deyimi, örneğin, güncelleştirmeleri adı ve ürünün fiyatı yalnızca geçerli veritabanı değerler GridView kaydında güncelleştirirken ilk olarak alınan değerlerle eşitse.</span><span class="sxs-lookup"><span data-stu-id="594c6-146">The following `UPDATE` statement, for example, updates the name and price of a product only if the current database values are equal to the values that were originally retrieved when updating the record in the GridView.</span></span> <span data-ttu-id="594c6-147">`@ProductName` Ve `@UnitPrice` parametreleri ise kullanıcı tarafından girilen yeni değerleri içeren `@original_ProductName` ve `@original_UnitPrice` Düzenle düğmesine tıklandığında GridView yüklenen ilk değerleri içerir:</span><span class="sxs-lookup"><span data-stu-id="594c6-147">The `@ProductName` and `@UnitPrice` parameters contain the new values entered by the user, whereas `@original_ProductName` and `@original_UnitPrice` contain the values that were originally loaded into the GridView when the Edit button was clicked:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample1.sql)]

<span data-ttu-id="594c6-148">Bu öğreticide anlatıldığı gibi SqlDataSource ile iyimser eşzamanlılık denetimini etkinleştirme olarak bir onay kutusunu işaretlemek kadar kolaydır.</span><span class="sxs-lookup"><span data-stu-id="594c6-148">As we'll see in this tutorial, enabling optimistic concurrency control with the SqlDataSource is as simple as checking a checkbox.</span></span>

## <a name="step-1-creating-a-sqldatasource-that-supports-optimistic-concurrency"></a><span data-ttu-id="594c6-149">1. Adım: İyimser eşzamanlılık destekleyen bir SqlDataSource oluşturma</span><span class="sxs-lookup"><span data-stu-id="594c6-149">Step 1: Creating a SqlDataSource that Supports Optimistic Concurrency</span></span>

<span data-ttu-id="594c6-150">Başlangıç açarak `OptimisticConcurrency.aspx` gelen sayfasında `SqlDataSource` klasör.</span><span class="sxs-lookup"><span data-stu-id="594c6-150">Start by opening the `OptimisticConcurrency.aspx` page from the `SqlDataSource` folder.</span></span> <span data-ttu-id="594c6-151">SqlDataSource denetimi ayarları Tasarımcısı araç kutusundan sürükleyin, `ID` özelliğini `ProductsDataSourceWithOptimisticConcurrency`.</span><span class="sxs-lookup"><span data-stu-id="594c6-151">Drag a SqlDataSource control from the Toolbox onto the Designer, settings its `ID` property to `ProductsDataSourceWithOptimisticConcurrency`.</span></span> <span data-ttu-id="594c6-152">Ardından, Denetim s akıllı etiket yapılandırmak veri kaynağı bağlantısından tıklayın.</span><span class="sxs-lookup"><span data-stu-id="594c6-152">Next, click on the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="594c6-153">Sihirbazın ilk ekranından ile çalışmayı tercih `NORTHWINDConnectionString` ve İleri'ye tıklayın.</span><span class="sxs-lookup"><span data-stu-id="594c6-153">From the first screen in the wizard, choose to work with the `NORTHWINDConnectionString` and click Next.</span></span>


<span data-ttu-id="594c6-154">[![NORTHWINDConnectionString çalışmak için seçin](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="594c6-154">[![Choose to Work with the NORTHWINDConnectionString](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.png)</span></span>

<span data-ttu-id="594c6-155">**Şekil 4**: Çalışmak için istediğinize `NORTHWINDConnectionString` ([tam boyutlu görüntüyü görmek için tıklatın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="594c6-155">**Figure 4**: Choose to Work with the `NORTHWINDConnectionString` ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.png))</span></span>


<span data-ttu-id="594c6-156">Bu örneğin ekleyeceğiz, kullanıcıların düzenlemesine olanak sağlayan GridView `Products` tablo.</span><span class="sxs-lookup"><span data-stu-id="594c6-156">For this example we'll be adding a GridView that enables users to edit the `Products` table.</span></span> <span data-ttu-id="594c6-157">Bu nedenle, Select deyimini ekran yapılandırma seçin `Products` tablosunu aşağı açılan listeden seçip `ProductID`, `ProductName`, `UnitPrice`, ve `Discontinued` sütunları, Şekil 5'te gösterildiği gibi.</span><span class="sxs-lookup"><span data-stu-id="594c6-157">Therefore, from the Configure the Select Statement screen, choose the `Products` table from the drop-down list and select the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` columns, as shown in Figure 5.</span></span>


<span data-ttu-id="594c6-158">[![Ürünleri tablo, ProductID, ProductName, UnitPrice ve artık sağlanmayan sütunları döndürür.](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="594c6-158">[![From the Products Table, Return the ProductID, ProductName, UnitPrice, and Discontinued Columns](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.png)</span></span>

<span data-ttu-id="594c6-159">**Şekil 5**: Gelen `Products` tablo, iade `ProductID`, `ProductName`, `UnitPrice`, ve `Discontinued` sütunları ([tam boyutlu görüntüyü görmek için tıklatın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="594c6-159">**Figure 5**: From the `Products` Table, Return the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` Columns ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.png))</span></span>


<span data-ttu-id="594c6-160">Sütunları seçtikten sonra Gelişmiş SQL oluşturma seçenekleri iletişim kutusunu Getir için Gelişmiş düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="594c6-160">After picking the columns, click the Advanced button to bring up the Advanced SQL Generation Options dialog box.</span></span> <span data-ttu-id="594c6-161">Generate denetleyin `INSERT`, `UPDATE`, ve `DELETE` deyimleri ve iyimser eşzamanlılık onay kutularını kullanın ve Tamam'a tıklayın (Şekil 1'e bir ekran için geri bakın).</span><span class="sxs-lookup"><span data-stu-id="594c6-161">Check the Generate `INSERT`, `UPDATE`, and `DELETE` statements and Use optimistic concurrency checkboxes and click OK (refer back to Figure 1 for a screenshot).</span></span> <span data-ttu-id="594c6-162">İleri'yi tıklatarak Sihirbazı tamamlayın ve ardından son.</span><span class="sxs-lookup"><span data-stu-id="594c6-162">Complete the wizard by clicking Next, then Finish.</span></span>

<span data-ttu-id="594c6-163">Veri Kaynağı Yapılandırma Sihirbazı'nı tamamladıktan sonra ortaya çıkan incelemek için bir dakikanızı ayırarak `DeleteCommand` ve `UpdateCommand` özellikleri ve `DeleteParameters` ve `UpdateParameters` koleksiyonları.</span><span class="sxs-lookup"><span data-stu-id="594c6-163">After completing the Configure Data Source wizard, take a moment to examine the resulting `DeleteCommand` and `UpdateCommand` properties and the `DeleteParameters` and `UpdateParameters` collections.</span></span> <span data-ttu-id="594c6-164">Bunu yapmanın en kolay yolu, sayfa s bildirim temelli söz dizimi görmek için sol alt köşesine kaynağı sekmesinde tıklayın sağlamaktır.</span><span class="sxs-lookup"><span data-stu-id="594c6-164">The easiest way to do this is to click on the Source tab in the lower left corner to see the page s declarative syntax.</span></span> <span data-ttu-id="594c6-165">Burada bulacaksınız bir `UpdateCommand` değeri:</span><span class="sxs-lookup"><span data-stu-id="594c6-165">There you will find an `UpdateCommand` value of:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample2.sql)]

<span data-ttu-id="594c6-166">Yedi parametrelerinde ile `UpdateParameters` koleksiyonu:</span><span class="sxs-lookup"><span data-stu-id="594c6-166">With seven parameters in the `UpdateParameters` collection:</span></span>


[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample3.aspx)]

<span data-ttu-id="594c6-167">Benzer şekilde, `DeleteCommand` özelliği ve `DeleteParameters` koleksiyonu, aşağıdaki gibi görünmelidir:</span><span class="sxs-lookup"><span data-stu-id="594c6-167">Similarly, the `DeleteCommand` property and `DeleteParameters` collection should look like the following:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample4.sql)]


[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample5.aspx)]

<span data-ttu-id="594c6-168">Deneyimlerinizi yanı sıra `WHERE` yan tümcelerini `UpdateCommand` ve `DeleteCommand` özellikleri (ve karşılık gelen parametre koleksiyonlara ek parametreler ekleyerek), iyimser eşzamanlılık seçeneği iki diğer ayarlar kullanımı seçme Özellikler:</span><span class="sxs-lookup"><span data-stu-id="594c6-168">In addition to augmenting the `WHERE` clauses of the `UpdateCommand` and `DeleteCommand` properties (and adding the additional parameters to the respective parameter collections), selecting the Use optimistic concurrency option adjusts two other properties:</span></span>

- <span data-ttu-id="594c6-169">Değişiklikleri [ `ConflictDetection` özelliği](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) gelen `OverwriteChanges` (varsayılan) için `CompareAllValues`</span><span class="sxs-lookup"><span data-stu-id="594c6-169">Changes the [`ConflictDetection` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) from `OverwriteChanges` (the default) to `CompareAllValues`</span></span>
- <span data-ttu-id="594c6-170">Değişiklikleri [ `OldValuesParameterFormatString` özelliği](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) gelen {0} (varsayılan) için özgün\_ {0} .</span><span class="sxs-lookup"><span data-stu-id="594c6-170">Changes the [`OldValuesParameterFormatString` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) from {0} (the default) to original\_{0} .</span></span>

<span data-ttu-id="594c6-171">Ne zaman Web denetimi veri çağırır SqlDataSource s `Update()` veya `Delete()` yöntemi, özgün değerleri geçirir.</span><span class="sxs-lookup"><span data-stu-id="594c6-171">When the data Web control invokes the SqlDataSource s `Update()` or `Delete()` method, it passes in the original values.</span></span> <span data-ttu-id="594c6-172">Varsa SqlDataSource s `ConflictDetection` özelliği `CompareAllValues`, özgün bu değerleri komutu eklenir.</span><span class="sxs-lookup"><span data-stu-id="594c6-172">If the SqlDataSource s `ConflictDetection` property is set to `CompareAllValues`, these original values are added to the command.</span></span> <span data-ttu-id="594c6-173">`OldValuesParameterFormatString` Bu özgün değer parametreler için kullanılan adlandırma deseni özelliği sağlar.</span><span class="sxs-lookup"><span data-stu-id="594c6-173">The `OldValuesParameterFormatString` property provides the naming pattern used for these original value parameters.</span></span> <span data-ttu-id="594c6-174">Özgün veri kaynağı Yapılandırma Sihirbazı'nı kullanan\_ {0} ve özgün her parametre adları `UpdateCommand` ve `DeleteCommand` özellikleri ve `UpdateParameters` ve `DeleteParameters` koleksiyonları uygun şekilde.</span><span class="sxs-lookup"><span data-stu-id="594c6-174">The Configure Data Source wizard uses original\_{0} and names each original parameter in the `UpdateCommand` and `DeleteCommand` properties and `UpdateParameters` and `DeleteParameters` collections accordingly.</span></span>

> [!NOTE]
> <span data-ttu-id="594c6-175">Biz yetenekleri ekleme SqlDataSource denetimi s kullanmayan re düşünüyorsanız bu yana kaldırmak ücretsiz `InsertCommand` özelliği ve kendi `InsertParameters` koleksiyonu.</span><span class="sxs-lookup"><span data-stu-id="594c6-175">Since we re not using the SqlDataSource control s inserting capabilities, feel free to remove the `InsertCommand` property and its `InsertParameters` collection.</span></span>


## <a name="correctly-handlingnullvalues"></a><span data-ttu-id="594c6-176">Doğru şekilde`NULL`değerleri</span><span class="sxs-lookup"><span data-stu-id="594c6-176">Correctly Handling`NULL`Values</span></span>

<span data-ttu-id="594c6-177">Ne yazık ki, Genişletilmiş `UPDATE` ve `DELETE` ifadeleri otomatik olarak oluşturulan iyimser eşzamanlılık kullanırken veri kaynağı Yapılandırma Sihirbazı tarafından yapmak *değil* içeren kayıtlar ile çalışmak `NULL` değerleri.</span><span class="sxs-lookup"><span data-stu-id="594c6-177">Unfortunately, the augmented `UPDATE` and `DELETE` statements autogenerated by the Configure Data Source wizard when using optimistic concurrency do *not* work with records that contain `NULL` values.</span></span> <span data-ttu-id="594c6-178">Nedenini görmek için bizim SqlDataSource s göz önünde bulundurun. `UpdateCommand`:</span><span class="sxs-lookup"><span data-stu-id="594c6-178">To see why, consider our SqlDataSource s `UpdateCommand`:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample6.sql)]

<span data-ttu-id="594c6-179">`UnitPrice` Sütununda `Products` tablo olabilir `NULL` değerleri.</span><span class="sxs-lookup"><span data-stu-id="594c6-179">The `UnitPrice` column in the `Products` table can have `NULL` values.</span></span> <span data-ttu-id="594c6-180">Belirli bir kayıt varsa bir `NULL` değerini `UnitPrice`, `WHERE` yan tümcesi bölümü `[UnitPrice] = @original_UnitPrice` olacak *her zaman* False olarak değerlendirilemiyor çünkü `NULL = NULL` her zaman false değerini döndürür.</span><span class="sxs-lookup"><span data-stu-id="594c6-180">If a particular record has a `NULL` value for `UnitPrice`, the `WHERE` clause portion `[UnitPrice] = @original_UnitPrice` will *always* evaluate to False because `NULL = NULL` always returns False.</span></span> <span data-ttu-id="594c6-181">Bu nedenle, kayıtları içeren `NULL` değerler düzenlenemez veya silinmiş olarak `UPDATE` ve `DELETE` deyimleri `WHERE` yan tümceleri olmaz güncelleştirmek veya silmek için herhangi bir satır döndürür.</span><span class="sxs-lookup"><span data-stu-id="594c6-181">Therefore, records that contain `NULL` values cannot be edited or deleted, as the `UPDATE` and `DELETE` statements `WHERE` clauses won't return any rows to update or delete.</span></span>

> [!NOTE]
> <span data-ttu-id="594c6-182">Bu hata, 2004'ın Haziran Microsoft'a ilk raporlandı [SqlDataSource hatalı SQL deyimleri oluşturan](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) ve ASP.NET'in bir sonraki sürümünde düzeltilen bağlarsanız zamanlandı.</span><span class="sxs-lookup"><span data-stu-id="594c6-182">This bug was first reported to Microsoft in June of 2004 in [SqlDataSource Generates Incorrect SQL Statements](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) and is reportedly scheduled to be fixed in the next version of ASP.NET.</span></span>


<span data-ttu-id="594c6-183">Bu sorunu gidermek için el ile güncelleştirmeniz sahibiz `WHERE` yan tümce hem de `UpdateCommand` ve `DeleteCommand` özelliklerini **tüm** olabilir sütunlar `NULL` değerleri.</span><span class="sxs-lookup"><span data-stu-id="594c6-183">To fix this, we have to manually update the `WHERE` clauses in both the `UpdateCommand` and `DeleteCommand` properties for **all** columns that can have `NULL` values.</span></span> <span data-ttu-id="594c6-184">Genel olarak, değişiklik `[ColumnName] = @original_ColumnName` için:</span><span class="sxs-lookup"><span data-stu-id="594c6-184">In general, change `[ColumnName] = @original_ColumnName` to:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample7.sql)]

<span data-ttu-id="594c6-185">Bu değişikliği doğrudan Özellikler penceresinden veUpdateQuery veya DeleteQuery seçeneği aracılığıyla bildirim temelli bir işaretleme veya UPDATE aracılığıyla yapılabilir ve özel bir SQL deyimi veya saklı yordam verilerini Yapılandır seçeneğinde belirtin sekmelerde Sil Kaynağı Sihirbazı.</span><span class="sxs-lookup"><span data-stu-id="594c6-185">This modification can be made directly through the declarative markup, via the UpdateQuery or DeleteQuery options from the Properties window, or through the UPDATE and DELETE tabs in the Specify a custom SQL statement or stored procedure option in the Configure Data Source wizard.</span></span> <span data-ttu-id="594c6-186">Yeniden, bu değişiklik yapılması *her* sütununda `UpdateCommand` ve `DeleteCommand` s `WHERE` içerebilir yan tümcesi `NULL` değerleri.</span><span class="sxs-lookup"><span data-stu-id="594c6-186">Again, this modification must be made for *every* column in the `UpdateCommand` and `DeleteCommand` s `WHERE` clause that can contain `NULL` values.</span></span>

<span data-ttu-id="594c6-187">Bu örneğimizde için uygulama sonuçları aşağıdaki değişiklik `UpdateCommand` ve `DeleteCommand` değerleri:</span><span class="sxs-lookup"><span data-stu-id="594c6-187">Applying this to our example results in the following modified `UpdateCommand` and `DeleteCommand` values:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample8.sql)]

## <a name="step-2-adding-a-gridview-with-edit-and-delete-options"></a><span data-ttu-id="594c6-188">2. Adım: GridView düzenleme ve silme seçenekleri ekleme</span><span class="sxs-lookup"><span data-stu-id="594c6-188">Step 2: Adding a GridView with Edit and Delete Options</span></span>

<span data-ttu-id="594c6-189">SqlDataSource ile iyimser eşzamanlılığı desteklemek için yapılandırılmış kalan tek şey bu eşzamanlılık denetimi yararlanan sayfasına bir veri Web denetimi eklemek için.</span><span class="sxs-lookup"><span data-stu-id="594c6-189">With the SqlDataSource configured to support optimistic concurrency, all that remains is to add a data Web control to the page that utilizes this concurrency control.</span></span> <span data-ttu-id="594c6-190">Bu öğretici için iki Düzen sağlayan GridView ekleme ve silme işlevlerini sağlar.</span><span class="sxs-lookup"><span data-stu-id="594c6-190">For this tutorial, let s add a GridView that provides both edit and delete functionality.</span></span> <span data-ttu-id="594c6-191">Bunu gerçekleştirmek için ayarlama ve Tasarımcısı araç kutusundan GridView sürükleyin, `ID` için `Products`.</span><span class="sxs-lookup"><span data-stu-id="594c6-191">To accomplish this, drag a GridView from the Toolbox onto the Designer and set its `ID` to `Products`.</span></span> <span data-ttu-id="594c6-192">GridView s akıllı etiketten için bağlama `ProductsDataSourceWithOptimisticConcurrency` 1. adımda eklenen SqlDataSource denetimi.</span><span class="sxs-lookup"><span data-stu-id="594c6-192">From the GridView s smart tag, bind it to the `ProductsDataSourceWithOptimisticConcurrency` SqlDataSource control added in Step 1.</span></span> <span data-ttu-id="594c6-193">Son olarak, akıllı etiket düzenlemeyi etkinleştir ve silmeyi etkinleştir seçeneklerden denetleyin.</span><span class="sxs-lookup"><span data-stu-id="594c6-193">Finally, check the Enable Editing and Enable Deleting options from the smart tag.</span></span>


<span data-ttu-id="594c6-194">[![GridView SqlDataSource için bağlama ve düzenleme ve silme etkinleştir](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="594c6-194">[![Bind the GridView to the SqlDataSource and Enable Editing and Deleting](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.png)</span></span>

<span data-ttu-id="594c6-195">**Şekil 6**: GridView SqlDataSource ve düzenlemeyi etkinleştir ve silme için bağlama ([tam boyutlu görüntüyü görmek için tıklatın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="594c6-195">**Figure 6**: Bind the GridView to the SqlDataSource and Enable Editing and Deleting ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image10.png))</span></span>


<span data-ttu-id="594c6-196">GridView ekledikten sonra onun görünümünü kaldırarak yapılandırma `ProductID` BoundField değiştirme, `ProductName` BoundField s `HeaderText` ürün ve güncelleştirme özelliğini `UnitPrice` BoundField böylece kendi `HeaderText` özelliği yalnızca fiyat.</span><span class="sxs-lookup"><span data-stu-id="594c6-196">After adding the GridView, configure its appearance by removing the `ProductID` BoundField, changing the `ProductName` BoundField s `HeaderText` property to Product, and updating the `UnitPrice` BoundField so that its `HeaderText` property is simply Price.</span></span> <span data-ttu-id="594c6-197">İdeal olarak, d biz düzenleme arabirimi için bir RequiredFieldValidator içerecek şekilde geliştirmek `ProductName` değer ve bir CompareValidator `UnitPrice` (s düzgün biçimlendirilmiş bir sayısal değer sağlamak üzere) değeri.</span><span class="sxs-lookup"><span data-stu-id="594c6-197">Ideally, we d enhance the editing interface to include a RequiredFieldValidator for the `ProductName` value and a CompareValidator for the `UnitPrice` value (to ensure it s a properly formatted numeric value).</span></span> <span data-ttu-id="594c6-198">Başvurmak [veri değişikliği arabirimini özelleştirme](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) arabirimini düzenleme GridView s özelleştirme bir daha derinlemesine bakış Öğreticisi.</span><span class="sxs-lookup"><span data-stu-id="594c6-198">Refer to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial for a more in-depth look at customizing the GridView s editing interface.</span></span>

> [!NOTE]
> <span data-ttu-id="594c6-199">GridView ' SqlDataSource için geçirilen orijinal değerleri olduğundan s görünüm durumu etkinleştirilmelidir GridView Görünüm durumu depolanır.</span><span class="sxs-lookup"><span data-stu-id="594c6-199">The GridView s view state must be enabled since the original values passed from the GridView to the SqlDataSource are stored in view state.</span></span>


<span data-ttu-id="594c6-200">GridView bu değişiklikleri yaptıktan sonra GridView ve SqlDataSource bildirim temelli biçimlendirme aşağıdakine benzer görünmelidir:</span><span class="sxs-lookup"><span data-stu-id="594c6-200">After making these modifications to the GridView, the GridView and SqlDataSource declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample9.aspx)]

<span data-ttu-id="594c6-201">İyimser eşzamanlılık denetimi iş başında görmek için iki tarayıcı penceresi açın ve yük `OptimisticConcurrency.aspx` hem de sayfa.</span><span class="sxs-lookup"><span data-stu-id="594c6-201">To see the optimistic concurrency control in action, open two browser windows and load the `OptimisticConcurrency.aspx` page in both.</span></span> <span data-ttu-id="594c6-202">İlk ürün hem tarayıcılarda düzenleme düğmelerini tıklayın.</span><span class="sxs-lookup"><span data-stu-id="594c6-202">Click on the Edit buttons for the first product in both browsers.</span></span> <span data-ttu-id="594c6-203">Bir tarayıcıda, ürün adı değiştirin ve Güncelleştir'e tıklayın.</span><span class="sxs-lookup"><span data-stu-id="594c6-203">In one browser, change the product name and click Update.</span></span> <span data-ttu-id="594c6-204">Tarayıcı geri gönderilir ve GridView düzenlemiş kaydı için yeni ürün adını gösteren önceden düzenleme moduna döndürür.</span><span class="sxs-lookup"><span data-stu-id="594c6-204">The browser will postback and the GridView will return to its pre-editing mode, showing the new product name for the record just edited.</span></span>

<span data-ttu-id="594c6-205">İkinci bir tarayıcı penceresi içinde fiyatı (ancak özgün değeri olarak ürün adını bırakın) değiştirin ve Güncelleştir'e tıklayın.</span><span class="sxs-lookup"><span data-stu-id="594c6-205">In the second browser window, change the price (but leave the product name as its original value) and click Update.</span></span> <span data-ttu-id="594c6-206">Geri gönderme, kılavuz, önceden düzenleme moduna döner, ancak fiyat değişikliği kaydedilmedi.</span><span class="sxs-lookup"><span data-stu-id="594c6-206">On postback, the grid returns to its pre-editing mode, but the change to the price is not recorded.</span></span> <span data-ttu-id="594c6-207">İkinci tarayıcı eski fiyat yeni ürün adıyla aynı değeri ilk olarak gösterir.</span><span class="sxs-lookup"><span data-stu-id="594c6-207">The second browser shows the same value as the first one the new product name with the old price.</span></span> <span data-ttu-id="594c6-208">İkinci bir tarayıcı penceresi içinde yapılan değişiklikler kayboldu.</span><span class="sxs-lookup"><span data-stu-id="594c6-208">The changes made in the second browser window were lost.</span></span> <span data-ttu-id="594c6-209">Hiçbir özel durum veya bir eşzamanlılık ihlali yalnızca oluştuğunu belirten ileti haliyle Ayrıca, değişiklikler yerine sessizce kayboldu.</span><span class="sxs-lookup"><span data-stu-id="594c6-209">Moreover, the changes were lost rather quietly, as there was no exception or message indicating that a concurrency violation just occurred.</span></span>


<span data-ttu-id="594c6-210">[![İkinci bir tarayıcı penceresi değişiklikleri sessizce kayboldu](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="594c6-210">[![The Changes in the Second Browser Window Were Silently Lost](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image11.png)</span></span>

<span data-ttu-id="594c6-211">**Şekil 7**: İkinci tarayıcı penceresi olan sessizce kayıp değişiklikleri ([tam boyutlu görüntüyü görmek için tıklatın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="594c6-211">**Figure 7**: The Changes in the Second Browser Window Were Silently Lost ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image12.png))</span></span>


<span data-ttu-id="594c6-212">Neden ikinci tarayıcı s değişiklikleri yapılan değil neden nedeni `UPDATE` deyimi s `WHERE` yan tümcesi tüm kayıtları süzer filtrelenmiş ve bu nedenle hiçbir satırı etkilemeyen.</span><span class="sxs-lookup"><span data-stu-id="594c6-212">The reason why the second browser s changes were not committed was because the `UPDATE` statement s `WHERE` clause filtered out all records and therefore did not affect any rows.</span></span> <span data-ttu-id="594c6-213">S bakmak istiyorum `UPDATE` deyimi yeniden:</span><span class="sxs-lookup"><span data-stu-id="594c6-213">Let s look at the `UPDATE` statement again:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample10.sql)]

<span data-ttu-id="594c6-214">İkinci bir tarayıcı penceresi kaydı güncelleştirir, orijinal ürün adı belirtilen `WHERE` yan tümcesi eklenmemişse t eşleme ile mevcut ürün adı (ilk tarayıcı tarafından değiştirilmesinden bu yana).</span><span class="sxs-lookup"><span data-stu-id="594c6-214">When the second browser window updates the record, the original product name specified in the `WHERE` clause doesn t match up with the existing product name (since it was changed by the first browser).</span></span> <span data-ttu-id="594c6-215">Bu nedenle, deyim `[ProductName] = @original_ProductName` yanlış döndürür ve `UPDATE` herhangi bir kayıt etkilemez.</span><span class="sxs-lookup"><span data-stu-id="594c6-215">Therefore, the statement `[ProductName] = @original_ProductName` returns False, and the `UPDATE` does not affect any records.</span></span>

> [!NOTE]
> <span data-ttu-id="594c6-216">Delete aynı şekilde çalışır.</span><span class="sxs-lookup"><span data-stu-id="594c6-216">Delete works in the same manner.</span></span> <span data-ttu-id="594c6-217">İki tarayıcı penceresi ile açık, belirli bir ürün olan bir düzenleme ve ardından değişiklikleri kaydetme başlatın.</span><span class="sxs-lookup"><span data-stu-id="594c6-217">With two browser windows open, start by editing a given product with one, and then saving its changes.</span></span> <span data-ttu-id="594c6-218">Bir tarayıcıda değişiklikleri kaydettikten sonra diğer aynı ürün için Sil düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="594c6-218">After saving the changes in the one browser, click the Delete button for the same product in the other.</span></span> <span data-ttu-id="594c6-219">İçinde orijinal değerleri don t eşleşme olduğundan `DELETE` deyimi s `WHERE` yan tümcesi silme sessizce başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="594c6-219">Since the original values don t match up in the `DELETE` statement s `WHERE` clause, the delete silently fails.</span></span>


<span data-ttu-id="594c6-220">Son kullanıcı s açısından ikinci bir tarayıcı penceresi içinde güncelleştir düğmesine tıkladıktan sonra önceden düzenleme moduna kılavuz döndürür ancak değişikliklerini kayboldu.</span><span class="sxs-lookup"><span data-stu-id="594c6-220">From the end user s perspective in the second browser window, after clicking the Update button the grid returns to the pre-editing mode, but their changes were lost.</span></span> <span data-ttu-id="594c6-221">Bununla birlikte, burada s değişikliklerini takılıyor istemediğiniz hiçbir görsel geri bildirim.</span><span class="sxs-lookup"><span data-stu-id="594c6-221">However, there s no visual feedback that their changes didn't stick.</span></span> <span data-ttu-id="594c6-222">İdeal olarak, kullanıcı s değişiklikleri eşzamanlılık ihlalinin kaybolması durumunda, biz d bildirmek ve belki de düzenleme modunda kılavuz tutun.</span><span class="sxs-lookup"><span data-stu-id="594c6-222">Ideally, if a user s changes are lost to a concurrency violation, we d notify them and, perhaps, keep the grid in edit mode.</span></span> <span data-ttu-id="594c6-223">Bunu gerçekleştirmek nasıl ilişkilendirildiğine baktık s olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="594c6-223">Let s look at how to accomplish this.</span></span>

## <a name="step-3-determining-when-a-concurrency-violation-has-occurred"></a><span data-ttu-id="594c6-224">3. Adım: Ne zaman bir eşzamanlılık ihlali oluştu belirleme</span><span class="sxs-lookup"><span data-stu-id="594c6-224">Step 3: Determining When a Concurrency Violation Has Occurred</span></span>

<span data-ttu-id="594c6-225">Eşzamanlılık ihlalinin bir yaptığı değişiklikleri reddettiğinde olduğundan, bir eşzamanlılık ihlali oluştuğunda kullanıcıyı uyarmak iyi olurdu.</span><span class="sxs-lookup"><span data-stu-id="594c6-225">Since a concurrency violation rejects the changes one has made, it would be nice to alert the user when a concurrency violation has occurred.</span></span> <span data-ttu-id="594c6-226">Let s kullanıcıyı uyarmak için bir etiket Web denetimi adlı sayfanın üst kısmına ekleyin `ConcurrencyViolationMessage` olan `Text` özelliği şu iletiyi görüntüler: Güncelleştirme veya başka bir kullanıcı tarafından aynı anda güncelleştirilen bir kaydı silme girişiminde bulundunuz.</span><span class="sxs-lookup"><span data-stu-id="594c6-226">To alert the user, let s add a Label Web control to the top of the page named `ConcurrencyViolationMessage` whose `Text` property displays the following message: You have attempted to update or delete a record that was simultaneously updated by another user.</span></span> <span data-ttu-id="594c6-227">Lütfen diğer kullanıcının yaptığı değişiklikleri gözden geçirin ve ardından güncelleştirmeyi yeniden veya silin.</span><span class="sxs-lookup"><span data-stu-id="594c6-227">Please review the other user's changes and then redo your update or delete.</span></span> <span data-ttu-id="594c6-228">Etiket denetimi s ayarlama `CssClass` bir CSS sınıfı olan uyarı özelliğini tanımlanan `Styles.css` kırmızı, italik, kalın ve büyük yazı tipiyle metni görüntüleyen.</span><span class="sxs-lookup"><span data-stu-id="594c6-228">Set the Label control s `CssClass` property to Warning, which is a CSS class defined in `Styles.css` that displays text in a red, italic, bold, and large font.</span></span> <span data-ttu-id="594c6-229">Son olarak, ' % s'etiketi s ayarlamak `Visible` ve `EnableViewState` özelliklerine `False`.</span><span class="sxs-lookup"><span data-stu-id="594c6-229">Finally, set the Label s `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="594c6-230">Bu etiketi yalnızca biz açıkça ayarlandığı geri dışında gizlenir, `Visible` özelliğini `True`.</span><span class="sxs-lookup"><span data-stu-id="594c6-230">This will hide the Label except for only those postbacks where we explicitly set its `Visible` property to `True`.</span></span>


<span data-ttu-id="594c6-231">[![Uyarı görüntüleyecek şekilde sayfasına bir etiket denetimi ekleme](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="594c6-231">[![Add a Label Control to the Page to Display the Warning](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image13.png)</span></span>

<span data-ttu-id="594c6-232">**Şekil 8**: Sayfaya uyarı görüntüleyecek şekilde bir etiket denetimi ekleyin ([tam boyutlu görüntüyü görmek için tıklatın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="594c6-232">**Figure 8**: Add a Label Control to the Page to Display the Warning ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image14.png))</span></span>


<span data-ttu-id="594c6-233">Gerçekleştirirken bir update veya delete, GridView s `RowUpdated` ve `RowDeleted` olay işleyicileri yangın kendi veri kaynağı denetimi istenen update veya delete işlemi gerçekleştirdikten sonra.</span><span class="sxs-lookup"><span data-stu-id="594c6-233">When performing an update or delete, the GridView s `RowUpdated` and `RowDeleted` event handlers fire after its data source control has performed the requested update or delete.</span></span> <span data-ttu-id="594c6-234">Bu olay işleyicileri işlemi kaç satır etkilendiğini belirleyebiliriz.</span><span class="sxs-lookup"><span data-stu-id="594c6-234">We can determine how many rows were affected by the operation from these event handlers.</span></span> <span data-ttu-id="594c6-235">Sıfır satır etkilendi, biz görüntülemek istediğiniz `ConcurrencyViolationMessage` etiketi.</span><span class="sxs-lookup"><span data-stu-id="594c6-235">If zero rows were affected, we want to display the `ConcurrencyViolationMessage` Label.</span></span>

<span data-ttu-id="594c6-236">Bir olay işleyicisi her ikisi için oluşturmak `RowUpdated` ve `RowDeleted` olayları ve aşağıdaki kodu ekleyin:</span><span class="sxs-lookup"><span data-stu-id="594c6-236">Create an event handler for both the `RowUpdated` and `RowDeleted` events and add the following code:</span></span>


[!code-vb[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample11.vb)]

<span data-ttu-id="594c6-237">Her iki olay işleyicileri biz denetleyin `e.AffectedRows` özelliği ve 0 eşittir verilirse `ConcurrencyViolationMessage` etiket s `Visible` özelliğini `True`.</span><span class="sxs-lookup"><span data-stu-id="594c6-237">In both event handlers we check the `e.AffectedRows` property and, if it equals 0, set the `ConcurrencyViolationMessage` Label s `Visible` property to `True`.</span></span> <span data-ttu-id="594c6-238">İçinde `RowUpdated` olay işleyicisi, biz de isteyin ayarlayarak düzenleme modunda kalmayı GridView `KeepInEditMode` özelliği true.</span><span class="sxs-lookup"><span data-stu-id="594c6-238">In the `RowUpdated` event handler, we also instruct the GridView to stay in edit mode by setting the `KeepInEditMode` property to true.</span></span> <span data-ttu-id="594c6-239">Bunun yapılması, bir kullanıcı s veri düzenleme arabirimine yüklenmesi kılavuza veriler yeniden bağlamak ihtiyacımız var.</span><span class="sxs-lookup"><span data-stu-id="594c6-239">In doing so, we need to rebind the data to the grid so that the other user s data is loaded into the editing interface.</span></span> <span data-ttu-id="594c6-240">Bu GridView s çağrılarak gerçekleştirilir `DataBind()` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="594c6-240">This is accomplished by calling the GridView s `DataBind()` method.</span></span>

<span data-ttu-id="594c6-241">Şekil 9, bu iki olay işleyicileri ile gösterildiği gibi bir eşzamanlılık ihlali oluştuğunda çok belirgin bir ileti görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="594c6-241">As Figure 9 shows, with these two event handlers, a very noticeable message is displayed whenever a concurrency violation occurs.</span></span>


<span data-ttu-id="594c6-242">[![Bir eşzamanlılık ihlali karşılaşıldığında bir ileti görüntülenir.](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="594c6-242">[![A Message is Displayed in the Face of a Concurrency Violation](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image15.png)</span></span>

<span data-ttu-id="594c6-243">**Şekil 9**: Bir eşzamanlılık ihlali karşılaşıldığında bir ileti görüntülenir ([tam boyutlu görüntüyü görmek için tıklatın](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="594c6-243">**Figure 9**: A Message is Displayed in the Face of a Concurrency Violation ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image16.png))</span></span>


## <a name="summary"></a><span data-ttu-id="594c6-244">Özet</span><span class="sxs-lookup"><span data-stu-id="594c6-244">Summary</span></span>

<span data-ttu-id="594c6-245">Bir web uygulaması oluştururken burada birden çok, eşzamanlı kullanıcılar aynı verileri düzenleme eşzamanlılık denetimi seçeneklerini göz önünde bulundurmanız önemlidir.</span><span class="sxs-lookup"><span data-stu-id="594c6-245">When creating a web application where multiple, concurrent users may be editing the same data, it is important to consider concurrency control options.</span></span> <span data-ttu-id="594c6-246">Varsayılan olarak, ASP.NET veri Web denetimleri ve veri kaynağı denetimleri herhangi bir eşzamanlılık denetimi dağıtıyorsunuz değil.</span><span class="sxs-lookup"><span data-stu-id="594c6-246">By default, the ASP.NET data Web controls and data source controls do not employ any concurrency control.</span></span> <span data-ttu-id="594c6-247">Bu öğreticide gördüğümüz gibi SqlDataSource ile iyimser eşzamanlılık denetimi uygulamak görece hızlı ve kolay.</span><span class="sxs-lookup"><span data-stu-id="594c6-247">As we saw in this tutorial, implementing optimistic concurrency control with the SqlDataSource is relatively quick and easy.</span></span> <span data-ttu-id="594c6-248">Ekleme, genişletilmiş için SqlDataSource çalıştırabilirsiniz çoğunu işler `WHERE` otomatik olarak oluşturulan yan tümceyi `UPDATE` ve `DELETE` ancak deyimleri olan birkaç ıot'nin işlemede `NULL` anlatıldığı gibi sütun değeri Doğru şekilde `NULL` değerleri bölümü.</span><span class="sxs-lookup"><span data-stu-id="594c6-248">The SqlDataSource handles most of the legwork for your adding augmented `WHERE` clauses to the autogenerated `UPDATE` and `DELETE` statements but there are a few subtleties in handling `NULL` value columns, as discussed in the Correctly Handling `NULL` Values section.</span></span>

<span data-ttu-id="594c6-249">Bu öğreticiyi SqlDataSource bizim incelenmesi sonlandırır.</span><span class="sxs-lookup"><span data-stu-id="594c6-249">This tutorial concludes our examination of the SqlDataSource.</span></span> <span data-ttu-id="594c6-250">ObjectDataSource ile katmanlı mimari verilerle çalışmaya kalan öğreticilerimizden döndürür.</span><span class="sxs-lookup"><span data-stu-id="594c6-250">Our remaining tutorials will return to working with data using the ObjectDataSource and tiered architecture.</span></span>

<span data-ttu-id="594c6-251">Mutlu programlama!</span><span class="sxs-lookup"><span data-stu-id="594c6-251">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="594c6-252">Yazar hakkında</span><span class="sxs-lookup"><span data-stu-id="594c6-252">About the Author</span></span>

<span data-ttu-id="594c6-253">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), yazar yedi ASP/ASP.NET kitaplardan ve poshbeauty.com sitesinin [4GuysFromRolla.com](http://www.4guysfromrolla.com), Microsoft Web teknolojileriyle beri 1998'de çalışmaktadır.</span><span class="sxs-lookup"><span data-stu-id="594c6-253">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="594c6-254">Scott, bağımsız Danışman, Eğitimci ve yazıcı çalışır.</span><span class="sxs-lookup"><span data-stu-id="594c6-254">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="594c6-255">En son nitelemiştir olan [ *Unleashed'i öğretin kendiniz ASP.NET 2.0 24 saat içindeki*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="594c6-255">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="594c6-256">He adresinden ulaşılabilir [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="594c6-256">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="594c6-257">veya kendi blog hangi bulunabilir [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="594c6-257">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="594c6-258">Önceki</span><span class="sxs-lookup"><span data-stu-id="594c6-258">Previous</span></span>](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)
