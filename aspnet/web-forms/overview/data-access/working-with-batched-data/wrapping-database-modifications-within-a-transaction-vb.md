---
uid: web-forms/overview/data-access/working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb
title: Veritabanı değişikliklerini bir Işlem içinde sarmalama (VB) | Microsoft Docs
author: rick-anderson
description: Bu öğretici, veri toplu işlerini güncelleştirme, silme ve ekleme konusunda görünen dört ilkidir. Bu öğreticide veritabanı işlemlerinin nasıl izin vereceğinizi öğreniyoruz...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 7d821db5-6cbb-4b38-af14-198f9155fc82
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb
msc.type: authoredcontent
ms.openlocfilehash: dee95ee2789a69aac5aa79b8358e58e3ee99e1b2
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74636493"
---
# <a name="wrapping-database-modifications-within-a-transaction-vb"></a><span data-ttu-id="bcd70-104">Veritabanı Değişikliklerini Bir İşlemin İçinde Sarmalama (VB)</span><span class="sxs-lookup"><span data-stu-id="bcd70-104">Wrapping Database Modifications within a Transaction (VB)</span></span>

<span data-ttu-id="bcd70-105">[Scott Mitchell](https://twitter.com/ScottOnWriting) tarafından</span><span class="sxs-lookup"><span data-stu-id="bcd70-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="bcd70-106">[Kodu indirin](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_63_VB.zip) veya [PDF 'yi indirin](wrapping-database-modifications-within-a-transaction-vb/_static/datatutorial63vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="bcd70-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_63_VB.zip) or [Download PDF](wrapping-database-modifications-within-a-transaction-vb/_static/datatutorial63vb1.pdf)</span></span>

> <span data-ttu-id="bcd70-107">Bu öğretici, veri toplu işlerini güncelleştirme, silme ve ekleme konusunda görünen dört ilkidir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-107">This tutorial is the first of four that looks at updating, deleting, and inserting batches of data.</span></span> <span data-ttu-id="bcd70-108">Bu öğreticide, veritabanı işlemlerinin toplu iş değişikliklerinin bir atomik işlem olarak nasıl gerçekleştirilebildiğini öğrenir, bu da tüm adımların başarılı veya tüm adımların başarısız olmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="bcd70-108">In this tutorial we learn how database transactions allow batch modifications to be carried out as an atomic operation, which ensures that either all steps succeed or all steps fail.</span></span>

## <a name="introduction"></a><span data-ttu-id="bcd70-109">Giriş</span><span class="sxs-lookup"><span data-stu-id="bcd70-109">Introduction</span></span>

<span data-ttu-id="bcd70-110">Veri öğreticisini [ekleme, güncelleştirme ve silmeye Ilişkin genel bakışa](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) Başlarken, GridView, satır düzeyinde Düzenle ve silme için yerleşik destek sağlar.</span><span class="sxs-lookup"><span data-stu-id="bcd70-110">As we saw starting with the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) tutorial, the GridView provides built-in support for row-level editing and deleting.</span></span> <span data-ttu-id="bcd70-111">Fareyle birkaç tıklamayla, bir kod satırı yazmadan zengin veri değişikliği arabirimi oluşturmak mümkündür. bu nedenle, her satır için Düzenle ve siliniyor içeriklerde olduğu sürece.</span><span class="sxs-lookup"><span data-stu-id="bcd70-111">With a few clicks of the mouse it is possible to create a rich data modification interface without writing a line of code, so long as you are content with editing and deleting on a per-row basis.</span></span> <span data-ttu-id="bcd70-112">Ancak, bazı senaryolarda bu yeterli değildir ve kullanıcılara bir kayıt kümesini düzenleme veya silme olanağı sağlamamız gerekir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-112">However, in certain scenarios this is insufficient and we need to provide users with the ability to edit or delete a batch of records.</span></span>

<span data-ttu-id="bcd70-113">Örneğin, çoğu Web tabanlı e-posta istemcisi, her satırın e-posta bilgilerini (konu, gönderen ve benzeri) içeren bir onay kutusu içerdiği her iletiyi listelemek için bir kılavuz kullanır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-113">For example, most web-based email clients use a grid to list each message where each row includes a checkbox along with the email s information (subject, sender, and so forth).</span></span> <span data-ttu-id="bcd70-114">Bu arabirim, kullanıcının birden çok iletiyi denetleyerek ve sonra seçili Iletileri Sil düğmesine tıklayarak silmesine izin verir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-114">This interface permits the user to delete multiple messages by checking them and then clicking a Delete Selected Messages button.</span></span> <span data-ttu-id="bcd70-115">Toplu düzenleme arabirimi, kullanıcıların birçok farklı kaydı yaygın olarak düzenleyebildiği durumlarda idealdir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-115">A batch editing interface is ideal in situations where users commonly edit many different records.</span></span> <span data-ttu-id="bcd70-116">Kullanıcının Düzenle ' ye tıklaması, değişiklik yapması ve ardından değiştirilmesi gereken her kayıt için Güncelleştir ' e tıklaması yerine, bir Batch düzenleme arabirimi her bir satırı düzenleme arabirimiyle işler.</span><span class="sxs-lookup"><span data-stu-id="bcd70-116">Rather than forcing the user to click Edit, make their change, and then click Update for each record that needs to be modified, a batch editing interface renders each row with its editing interface.</span></span> <span data-ttu-id="bcd70-117">Kullanıcı değiştirilmesi gereken satır kümesini hızlıca değiştirebilir ve sonra Tümünü Güncelleştir düğmesine tıklayarak bu değişiklikleri kaydeder.</span><span class="sxs-lookup"><span data-stu-id="bcd70-117">The user can quickly modify the set of rows that need to be changed and then save these changes by clicking an Update All button.</span></span> <span data-ttu-id="bcd70-118">Bu öğretici kümesinde, verilerin toplu olarak eklenmesi, düzenlenmesine ve silinmesine yönelik arabirimlerin nasıl oluşturulacağını inceleyeceğiz.</span><span class="sxs-lookup"><span data-stu-id="bcd70-118">In this set of tutorials we'll examine how to create interfaces for inserting, editing, and deleting batches of data.</span></span>

<span data-ttu-id="bcd70-119">Toplu işlem gerçekleştirirken, toplu işteki bazı işlemlerden bazılarının başarılı olması durumunda başarısız olması gerekip gerekmediğini belirleme açısından önemlidir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-119">When performing batch operations it s important to determine whether it should be possible for some of the operations in the batch to succeed while others fail.</span></span> <span data-ttu-id="bcd70-120">Toplu işi silme arabirimi-seçili olan ilk kayıt başarıyla silinirse ne olması gerekir, ancak ikinci biri başarısız olursa, yabancı anahtar kısıtlaması ihlali nedeniyle ne olur?</span><span class="sxs-lookup"><span data-stu-id="bcd70-120">Consider a batch deleting interface - what should happen if the first selected record is deleted successfully, but the second one fails, say, because of a foreign key constraint violation?</span></span> <span data-ttu-id="bcd70-121">İlk kaydın silinmesi geri alınır mi yoksa ilk kaydın silinme için kabul edilebilir mi?</span><span class="sxs-lookup"><span data-stu-id="bcd70-121">Should the first record s delete be rolled back or is it acceptable for the first record to remain deleted?</span></span>

<span data-ttu-id="bcd70-122">Toplu işlemin bir [atomik işlem](http://en.wikipedia.org/wiki/Atomic_operation)olarak değerlendirilmesini istiyorsanız, tüm adımların başarılı veya adımların tümü başarısız olursa, veri erişim katmanının [veritabanı işlemlerine](http://en.wikipedia.org/wiki/Database_transaction)yönelik destek içerecek şekilde artırılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-122">If you want the batch operation to be treated as an [atomic operation](http://en.wikipedia.org/wiki/Atomic_operation), one where either all of the steps succeed or all of the steps fail, then the Data Access Layer needs to be augmented to include support for [database transactions](http://en.wikipedia.org/wiki/Database_transaction).</span></span> <span data-ttu-id="bcd70-123">Veritabanı işlemleri, işlemin şemsiye altında yürütülen `INSERT`, `UPDATE`ve `DELETE` deyimlerinin kararlılığını garanti eder ve tüm modern veritabanı sistemleri tarafından desteklenen bir özelliktir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-123">Database transactions guarantee atomicity for the set of `INSERT`, `UPDATE`, and `DELETE` statements executed under the umbrella of the transaction and are a feature supported by most all modern database systems.</span></span>

<span data-ttu-id="bcd70-124">Bu öğreticide, veritabanı işlemlerini kullanmak için DAL genişletme bölümüne bakacağız.</span><span class="sxs-lookup"><span data-stu-id="bcd70-124">In this tutorial we'll look at how to extend the DAL to use database transactions.</span></span> <span data-ttu-id="bcd70-125">Sonraki öğreticiler, toplu iş ekleme, güncelleştirme ve silme arabirimleri için Web sayfalarını uygulamayı inceler.</span><span class="sxs-lookup"><span data-stu-id="bcd70-125">Subsequent tutorials will examine implementing web pages for batch inserting, updating, and deleting interfaces.</span></span> <span data-ttu-id="bcd70-126">Haydi başlayın!</span><span class="sxs-lookup"><span data-stu-id="bcd70-126">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="bcd70-127">Toplu işlemdeki verileri değiştirirken, kararlılık her zaman gerekli değildir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-127">When modifying data in a batch transaction, atomicity is not always needed.</span></span> <span data-ttu-id="bcd70-128">Bazı senaryolarda, bir Web tabanlı e-posta istemcisinden bir e-posta kümesini silerken, bazı veri değişikliklerinin başarılı olması ve aynı toplu işteki diğer kişilerin başarısız olması kabul edilebilir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-128">In some scenarios, it may be acceptable to have some data modifications succeed and others in the same batch fail, such as when deleting a set of emails from a web-based email client.</span></span> <span data-ttu-id="bcd70-129">Silme işlemi boyunca bir veritabanı hatası algıladığında, bu, hata olmadan işlenen kayıtların silinmesini de kabul eder.</span><span class="sxs-lookup"><span data-stu-id="bcd70-129">If there s a database error midway through the deletion process, it s probably acceptable that those records processed without error remain deleted.</span></span> <span data-ttu-id="bcd70-130">Bu gibi durumlarda, DAL veritabanı işlemlerini destekleyecek şekilde değiştirilmemelidir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-130">In such cases, the DAL does not need to be modified to support database transactions.</span></span> <span data-ttu-id="bcd70-131">Ancak, kararlılık 'in çok önemli olduğu diğer toplu işlem senaryoları vardır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-131">There are other batch operation scenarios, however, where atomicity is vital.</span></span> <span data-ttu-id="bcd70-132">Bir müşteri fonlarını bir banka hesabından diğerine taşıdıkça iki işlem gerçekleştirilmelidir: fonlar ilk hesaptan düşülmeli ve sonra ikincisine eklenmelidir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-132">When a customer moves her funds from one bank account to another, two operations must be performed: the funds must be deducted from the first account and then added to the second.</span></span> <span data-ttu-id="bcd70-133">Bankanın ilk adımı başarılı bir şekilde gerçekleştiremeyebilir, ancak ikinci adım başarısız olsa da, müşterileri daha iyi bir şekilde daha fazla olmaz.</span><span class="sxs-lookup"><span data-stu-id="bcd70-133">While the bank may not mind having the first step succeed but the second step fail, its customers would understandably be upset.</span></span> <span data-ttu-id="bcd70-134">Bu öğreticide ilerleyerek ve veritabanı işlemlerini desteklemek için DAL geliştirmeleri uygulayıp, bunları Batch ekleme, güncelleştirme ve silme toplu işlemlerinde kullanmayı planlamıyorsanız, aşağıdaki üç öğreticide oluşturacağız.</span><span class="sxs-lookup"><span data-stu-id="bcd70-134">I encourage you to work through this tutorial and implement the enhancements to the DAL to support database transactions even if you do not plan on using them in the batch inserting, updating, and deleting interfaces we'll be building in the following three tutorials.</span></span>

## <a name="an-overview-of-transactions"></a><span data-ttu-id="bcd70-135">Işlemlere genel bakış</span><span class="sxs-lookup"><span data-stu-id="bcd70-135">An Overview of Transactions</span></span>

<span data-ttu-id="bcd70-136">Çoğu veritabanı, birden çok veritabanı komutunun tek bir mantıksal iş biriminde gruplandırılmasına olanak sağlayan *işlemler*için destek içerir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-136">Most databases include support for *transactions*, which enable multiple database commands to be grouped into a single logical unit of work.</span></span> <span data-ttu-id="bcd70-137">Bir işlemi oluşturan veritabanı komutlarının atomik olduğu garanti edilir, yani tüm komutların başarısız olduğu veya tümünün başarılı olacağı anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-137">The database commands that comprise a transaction are guaranteed to be atomic, meaning that either all commands will fail or all will succeed.</span></span>

<span data-ttu-id="bcd70-138">Genel olarak, işlemler SQL deyimleriyle aşağıdaki model kullanılarak uygulanır:</span><span class="sxs-lookup"><span data-stu-id="bcd70-138">In general, transactions are implemented through SQL statements using the following pattern:</span></span>

1. <span data-ttu-id="bcd70-139">İşlemin başlangıcını belirtir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-139">Indicate the start of a transaction.</span></span>
2. <span data-ttu-id="bcd70-140">İşlemi oluşturan SQL deyimlerini yürütün.</span><span class="sxs-lookup"><span data-stu-id="bcd70-140">Execute the SQL statements that comprise the transaction.</span></span>
3. <span data-ttu-id="bcd70-141">2\. adımdaki deyimlerden birinde bir hata varsa, işlemi geri alın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-141">If there is an error in one of the statements from Step 2, rollback the transaction.</span></span>
4. <span data-ttu-id="bcd70-142">2\. adımdaki tüm deyimler hata olmadan tamamlandıysanız, işlemi yürütün.</span><span class="sxs-lookup"><span data-stu-id="bcd70-142">If all of the statements from Step 2 complete without error, commit the transaction.</span></span>

<span data-ttu-id="bcd70-143">İşlemin oluşturulması, yürütülmesi ve geri dönmesi için kullanılan SQL deyimleri, SQL betikleri yazarken veya saklı yordamlar oluştururken el ile veya ADO.NET ya da [`System.Transactions` ad alanındaki](https://msdn.microsoft.com/library/system.transactions.aspx)sınıfların kullanılmasıyla programlama yoluyla el ile girilebilir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-143">The SQL statements used to create, commit, and roll back the transaction can be entered manually when writing SQL scripts or creating stored procedures, or through programmatic means using either ADO.NET or the classes in the [`System.Transactions` namespace](https://msdn.microsoft.com/library/system.transactions.aspx).</span></span> <span data-ttu-id="bcd70-144">Bu öğreticide, yalnızca ADO.NET kullanarak işlem yönetimini inceleyeceğiz.</span><span class="sxs-lookup"><span data-stu-id="bcd70-144">In this tutorial we will only examine managing transactions using ADO.NET.</span></span> <span data-ttu-id="bcd70-145">Gelecekteki bir öğreticide, veri erişim katmanında saklı yordamların nasıl kullanılacağına göz atacağız. Bu durumda, işlemleri oluşturmak, geri almak ve yürütmek için SQL deyimlerini keşfedeceğiz.</span><span class="sxs-lookup"><span data-stu-id="bcd70-145">In a future tutorial we will look at how to use stored procedures in the Data Access Layer, at which time we'll explore the SQL statements for creating, rolling back, and committing transactions.</span></span> <span data-ttu-id="bcd70-146">Bu sırada daha fazla bilgi için [SQL Server saklı yordamlarındaki Işlemleri yönetme](http://www.4guysfromrolla.com/webtech/080305-1.shtml) konusuna bakın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-146">In the meantime, consult [Managing Transactions in SQL Server Stored Procedures](http://www.4guysfromrolla.com/webtech/080305-1.shtml) for more information.</span></span>

> [!NOTE]
> <span data-ttu-id="bcd70-147">`System.Transactions` ad alanındaki [`TransactionScope` sınıfı](https://msdn.microsoft.com/library/system.transactions.transactionscope.aspx) , geliştiricilerin bir işlem kapsamındaki bir deyim serisini programlama yoluyla sarmasını ve bir Microsoft SQL Server veritabanı, Oracle veritabanı ve bir Web hizmeti gibi iki farklı veritabanı ya da heterojen veri deposu türleri gibi birden çok kaynağı içeren karmaşık işlemler için destek içerir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-147">The [`TransactionScope` class](https://msdn.microsoft.com/library/system.transactions.transactionscope.aspx) in the `System.Transactions` namespace enables developers to programmatically wrap a series of statements within the scope of a transaction and includes support for complex transactions that involve multiple sources, such as two different databases or even heterogeneous types of data stores, such as a Microsoft SQL Server database, an Oracle database, and a Web service.</span></span> <span data-ttu-id="bcd70-148">ADO.NET sınıfı `TransactionScope` yerine bu öğreticide ADO.NET işlemleri kullanmaya karar verdim ve çoğu durumda, çok daha az kaynak kullanımı.</span><span class="sxs-lookup"><span data-stu-id="bcd70-148">I ve decided to use ADO.NET transactions for this tutorial instead of the `TransactionScope` class because ADO.NET is more specific for database transactions and, in many cases, is far less resource intensive.</span></span> <span data-ttu-id="bcd70-149">Ayrıca, bazı senaryolarda `TransactionScope` sınıfı Microsoft Dağıtılmış İşlem Düzenleyicisi (MSDTC) kullanır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-149">In addition, under certain scenarios the `TransactionScope` class uses the Microsoft Distributed Transaction Coordinator (MSDTC).</span></span> <span data-ttu-id="bcd70-150">MSDTC 'nin içindeki yapılandırma, uygulama ve performans sorunları, Bu öğreticilerin kapsamını özelleştirilmiş ve gelişmiş bir konuyla ve bunların ötesinde kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-150">The configuration, implementation, and performance issues surrounding MSDTC makes it a rather specialized and advanced topic and beyond the scope of these tutorials.</span></span>

<span data-ttu-id="bcd70-151">ADO.NET ' de SqlClient sağlayıcısıyla çalışırken işlemler, bir [`SqlTransaction` nesnesi](https://msdn.microsoft.com/library/system.data.sqlclient.sqltransaction.aspx)döndüren [`SqlConnection` sınıf](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) s [`BeginTransaction` yöntemine](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.begintransaction.aspx)yapılan bir çağrıyla başlatılır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-151">When working with the SqlClient provider in ADO.NET, transactions are initiated through a call to the [`SqlConnection` class](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) s [`BeginTransaction` method](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.begintransaction.aspx), which returns a [`SqlTransaction` object](https://msdn.microsoft.com/library/system.data.sqlclient.sqltransaction.aspx).</span></span> <span data-ttu-id="bcd70-152">İşlemi oluşturan veri değiştirme deyimleri `try...catch` bir blok içine yerleştirilir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-152">The data modification statements that makeup the transaction are placed within a `try...catch` block.</span></span> <span data-ttu-id="bcd70-153">`try` bloğundaki bir ifadede bir hata oluşursa, yürütme, işlemin `SqlTransaction` nesne s [`Rollback` yöntemi](https://msdn.microsoft.com/library/system.data.sqlclient.sqltransaction.rollback.aspx)aracılığıyla geri aktargetirilebileceği `catch` bloğuna aktarılır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-153">If an error occurs in a statement in the `try` block, execution transfers to the `catch` block where the transaction can be rolled back via the `SqlTransaction` object s [`Rollback` method](https://msdn.microsoft.com/library/system.data.sqlclient.sqltransaction.rollback.aspx).</span></span> <span data-ttu-id="bcd70-154">Tüm deyimler başarıyla tamamlandıysanız, `try` bloğunun sonundaki `SqlTransaction` nesne s [`Commit` yöntemine](https://msdn.microsoft.com/library/system.data.sqlclient.sqltransaction.commit.aspx) yapılan bir çağrı işlemi kaydeder.</span><span class="sxs-lookup"><span data-stu-id="bcd70-154">If all of the statements complete successfully, a call to the `SqlTransaction` object s [`Commit` method](https://msdn.microsoft.com/library/system.data.sqlclient.sqltransaction.commit.aspx) at the end of the `try` block commits the transaction.</span></span> <span data-ttu-id="bcd70-155">Aşağıdaki kod parçacığında bu desenler gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-155">The following code snippet illustrates this pattern.</span></span> <span data-ttu-id="bcd70-156">Ek sözdizimi ve ADO.NET ile işlem kullanma örnekleri için [işlem Ile veritabanı tutarlılığını koruma](http://aspnet.4guysfromrolla.com/articles/072705-1.aspx) konusuna bakın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-156">See [Maintaining Database Consistency with Transactions](http://aspnet.4guysfromrolla.com/articles/072705-1.aspx) for additional syntax and examples of using transactions with ADO.NET.</span></span>

[!code-vb[Main](wrapping-database-modifications-within-a-transaction-vb/samples/sample1.vb)]

<span data-ttu-id="bcd70-157">Varsayılan olarak, bir türü belirtilmiş veri kümesindeki TableAdapters işlemleri kullanmaz.</span><span class="sxs-lookup"><span data-stu-id="bcd70-157">By default, the TableAdapters in a Typed DataSet do not use transactions.</span></span> <span data-ttu-id="bcd70-158">Bir işlemin kapsamı içinde bir dizi veri değişikliği deyimi gerçekleştirmek için yukarıdaki kalıbı kullanan ek yöntemler dahil olmak üzere TableAdapter sınıflarını geliştirmemiz gereken işlemler için destek sağlamak üzere.</span><span class="sxs-lookup"><span data-stu-id="bcd70-158">To provide support for transactions we need to augment the TableAdapter classes to include additional methods that use the above pattern to perform a series of data modification statements within the scope of a transaction.</span></span> <span data-ttu-id="bcd70-159">2\. adımda, bu yöntemleri eklemek için kısmi sınıfların nasıl kullanılacağını öğreneceğiz.</span><span class="sxs-lookup"><span data-stu-id="bcd70-159">In Step 2 we'll see how to use partial classes to add these methods.</span></span>

## <a name="step-1-creating-the-working-with-batched-data-web-pages"></a><span data-ttu-id="bcd70-160">1\. Adım: toplu veri Web sayfalarıyla çalışmayı oluşturma</span><span class="sxs-lookup"><span data-stu-id="bcd70-160">Step 1: Creating the Working with Batched Data Web Pages</span></span>

<span data-ttu-id="bcd70-161">Veritabanı işlemlerini desteklemek için DAL 'nin nasıl geliştirdiğine yönelik keşfetmeye başlamadan önce, bu öğretici için ihtiyaç duyduğumuz ASP.NET Web sayfalarını ve bu öğreticiyi izleyen üç işlem için ilk olarak bir süre sürme.</span><span class="sxs-lookup"><span data-stu-id="bcd70-161">Before we start exploring how to augment the DAL to support database transactions, let s first take a moment to create the ASP.NET web pages that we will need for this tutorial and the three that follow.</span></span> <span data-ttu-id="bcd70-162">`BatchData` adlı yeni bir klasör ekleyerek başlayın ve ardından her sayfayı `Site.master` ana sayfayla ilişkilendirerek aşağıdaki ASP.NET sayfalarını ekleyin.</span><span class="sxs-lookup"><span data-stu-id="bcd70-162">Start by adding a new folder named `BatchData` and then add the following ASP.NET pages, associating each page with the `Site.master` master page.</span></span>

- `Default.aspx`
- `Transactions.aspx`
- `BatchUpdate.aspx`
- `BatchDelete.aspx`
- `BatchInsert.aspx`

![SqlDataSource ile Ilgili öğreticiler için ASP.NET sayfaları ekleyin](wrapping-database-modifications-within-a-transaction-vb/_static/image1.gif)

<span data-ttu-id="bcd70-164">**Şekil 1**: SqlDataSource Ile ilgili öğreticiler Için ASP.NET sayfaları ekleme</span><span class="sxs-lookup"><span data-stu-id="bcd70-164">**Figure 1**: Add the ASP.NET Pages for the SqlDataSource-Related Tutorials</span></span>

<span data-ttu-id="bcd70-165">Diğer klasörlerde olduğu gibi, `Default.aspx` kendi bölümünde öğreticileri listelemek için `SectionLevelTutorialListing.ascx` Kullanıcı denetimini kullanacaktır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-165">As with the other folders, `Default.aspx` will use the `SectionLevelTutorialListing.ascx` User Control to list the tutorials within its section.</span></span> <span data-ttu-id="bcd70-166">Bu nedenle, bu kullanıcı denetimini Çözüm Gezgini sayfa s Tasarım görünümü üzerine sürükleyerek `Default.aspx` ekleyin.</span><span class="sxs-lookup"><span data-stu-id="bcd70-166">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="bcd70-167">[SectionLevelTutorialListing. ascx Kullanıcı denetimini default. aspx öğesine eklemek ![](wrapping-database-modifications-within-a-transaction-vb/_static/image2.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="bcd70-167">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](wrapping-database-modifications-within-a-transaction-vb/_static/image2.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image1.png)</span></span>

<span data-ttu-id="bcd70-168">**Şekil 2**: `SectionLevelTutorialListing.ascx` kullanıcı denetimini `Default.aspx` ekleyin ([tam boyutlu görüntüyü görüntülemek için tıklayın](wrapping-database-modifications-within-a-transaction-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="bcd70-168">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-vb/_static/image2.png))</span></span>

<span data-ttu-id="bcd70-169">Son olarak, bu dört sayfayı `Web.sitemap` dosyasına girdi olarak ekleyin.</span><span class="sxs-lookup"><span data-stu-id="bcd70-169">Lastly, add these four pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="bcd70-170">Özellikle, site haritasını özelleştirdikten sonra aşağıdaki biçimlendirmeyi ekleyin `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="bcd70-170">Specifically, add the following markup after the Customizing the Site Map `<siteMapNode>`:</span></span>

[!code-xml[Main](wrapping-database-modifications-within-a-transaction-vb/samples/sample2.xml)]

<span data-ttu-id="bcd70-171">`Web.sitemap`güncelleştirildikten sonra Öğreticiler Web sitesini bir tarayıcıdan görüntülemek için bir dakikanızı ayırın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-171">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="bcd70-172">Sol taraftaki menüde artık toplu veri öğreticileri ile çalışma için öğeler yer almaktadır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-172">The menu on the left now includes items for the working with batched data tutorials.</span></span>

![Site Haritası artık toplu veri öğreticileri ile çalışmaya yönelik girişleri Içerir](wrapping-database-modifications-within-a-transaction-vb/_static/image3.gif)

<span data-ttu-id="bcd70-174">**Şekil 3**: site haritasında artık toplu veri öğreticileri ile çalışmaya yönelik girişler yer almaktadır</span><span class="sxs-lookup"><span data-stu-id="bcd70-174">**Figure 3**: The Site Map Now Includes Entries for the Working with Batched Data Tutorials</span></span>

## <a name="step-2-updating-the-data-access-layer-to-support-database-transactions"></a><span data-ttu-id="bcd70-175">2\. Adım: veri erişim katmanını, veritabanı Işlemlerini destekleyecek şekilde güncelleştirme</span><span class="sxs-lookup"><span data-stu-id="bcd70-175">Step 2: Updating the Data Access Layer to Support Database Transactions</span></span>

<span data-ttu-id="bcd70-176">İlk öğreticide geri değindiğimiz gibi, [bir veri erişim katmanı oluştururken](../introduction/creating-a-data-access-layer-vb.md), Içindeki türü belirtilmiş veri kümesi DataTable ve TableAdapters ' den oluşur.</span><span class="sxs-lookup"><span data-stu-id="bcd70-176">As we discussed back in the first tutorial, [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md), the Typed DataSet in our DAL is composed of DataTables and TableAdapters.</span></span> <span data-ttu-id="bcd70-177">TableAdapters, veritabanından verileri veri okuma, DataTable üzerinde yapılan değişikliklerle veritabanını güncelleştirme, vb. gibi verileri bir veritabanına dönüştürür.</span><span class="sxs-lookup"><span data-stu-id="bcd70-177">The DataTables hold data while the TableAdapters provide the functionality to read data from the database into the DataTables, to update the database with changes made to the DataTables, and so forth.</span></span> <span data-ttu-id="bcd70-178">TableAdapters 'in, Batch Update ve DB-Direct olarak adlandırılan verileri güncelleştirmek için iki desen sunmaya yönelik olduğunu hatırlayın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-178">Recall that the TableAdapters provide two patterns for updating data, which I referred to as Batch Update and DB-Direct.</span></span> <span data-ttu-id="bcd70-179">Batch Update düzeniyle, TableAdapter bir DataSet, DataTable veya DataRow koleksiyonu iletilir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-179">With the Batch Update pattern, the TableAdapter is passed a DataSet, DataTable, or collection of DataRows.</span></span> <span data-ttu-id="bcd70-180">Bu veriler, her Inserted, Modified veya Deleted satırı için numaralandırılır, `InsertCommand`, `UpdateCommand`veya `DeleteCommand` yürütülür.</span><span class="sxs-lookup"><span data-stu-id="bcd70-180">This data is enumerated and for each inserted, modified, or deleted row, the `InsertCommand`, `UpdateCommand`, or `DeleteCommand` is executed.</span></span> <span data-ttu-id="bcd70-181">DB-Direct düzeniyle, TableAdapter, tek bir kaydı eklemek, güncelleştirmek veya silmek için gereken sütunların değerlerini geçti.</span><span class="sxs-lookup"><span data-stu-id="bcd70-181">With the DB-Direct pattern, the TableAdapter is instead passed the values of the columns necessary for inserting, updating, or deleting a single record.</span></span> <span data-ttu-id="bcd70-182">Daha sonra DB doğrudan model yöntemi, uygun `InsertCommand`, `UpdateCommand`veya `DeleteCommand` ifadesini yürütmek için bu geçirilen değerleri kullanır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-182">The DB Direct pattern method then uses those passed-in values to execute the appropriate `InsertCommand`, `UpdateCommand`, or `DeleteCommand` statement.</span></span>

<span data-ttu-id="bcd70-183">Kullanılan güncelleştirme düzeniyle bağımsız olarak, TableAdapters otomatik oluşturulan Yöntemler işlemleri kullanmaz.</span><span class="sxs-lookup"><span data-stu-id="bcd70-183">Regardless of the update pattern used, the TableAdapters auto-generated methods do not use transactions.</span></span> <span data-ttu-id="bcd70-184">Varsayılan olarak, TableAdapter tarafından gerçekleştirilen her bir INSERT, Update veya delete tek bir ayrık işlem olarak değerlendirilir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-184">By default each insert, update, or delete performed by the TableAdapter is treated as a single discrete operation.</span></span> <span data-ttu-id="bcd70-185">Örneğin, veritabanına on kayıt eklemek için BLL içindeki bazı kodlar tarafından DB-Direct deseninin kullanıldığını düşünün.</span><span class="sxs-lookup"><span data-stu-id="bcd70-185">For instance, imagine that the DB-Direct pattern is used by some code in the BLL to insert ten records into the database.</span></span> <span data-ttu-id="bcd70-186">Bu kod, TableAdapter s `Insert` yöntemini on kez çağırırdı.</span><span class="sxs-lookup"><span data-stu-id="bcd70-186">This code would call the TableAdapter s `Insert` method ten times.</span></span> <span data-ttu-id="bcd70-187">İlk beş ekleme başarılı, ancak altıncı bir özel durumla sonuçlanmış ise, ilk beş kayıt veritabanında kalır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-187">If the first five inserts succeed, but the sixth one resulted in an exception, the first five inserted records would remain in the database.</span></span> <span data-ttu-id="bcd70-188">Benzer şekilde, bir DataTable içindeki eklenen, değiştirilen ve silinen satırlarda ekleme, güncelleştirme ve silme işlemleri gerçekleştirmek için toplu güncelleştirme düzeninde kullanılırsa, ilk birkaç değişiklik başarılı olduysa ancak daha sonra bir hatayla karşılaştıysa, bu, önceki değişiklikleri tamamlandı, veritabanında kalır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-188">Similarly, if the Batch Update pattern is used to perform inserts, updates, and deletes to the inserted, modified, and deleted rows in a DataTable, if the first several modifications succeeded but a later one encountered an error, those earlier modifications that completed would remain in the database.</span></span>

<span data-ttu-id="bcd70-189">Belirli senaryolarda, bir dizi değişiklik genelinde kararlılık sağlamak istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="bcd70-189">In certain scenarios we want to ensure atomicity across a series of modifications.</span></span> <span data-ttu-id="bcd70-190">Bunu gerçekleştirmek için, bir işlemin şemsiye altında `InsertCommand`, `UpdateCommand`ve `DeleteCommand` çalıştıran yeni yöntemler ekleyerek TableAdapter 'ı el ile genişletmelidir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-190">To accomplish this we must manually extend the TableAdapter by adding new methods that execute the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` s under the umbrella of a transaction.</span></span> <span data-ttu-id="bcd70-191">[Veri erişim katmanı oluşturma](../introduction/creating-a-data-access-layer-vb.md) bölümünde, yazılan veri kümesi içindeki DataTable işlevlerinin işlevselliğini uzatmak için [kısmi sınıflar](http://en.wikipedia.org/wiki/Partial_type) kullanma konusunda baktık.</span><span class="sxs-lookup"><span data-stu-id="bcd70-191">In [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) we looked at using [partial classes](http://en.wikipedia.org/wiki/Partial_type) to extend the functionality of the DataTables within the Typed DataSet.</span></span> <span data-ttu-id="bcd70-192">Bu teknik, TableAdapters ile de kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-192">This technique can also be used with TableAdapters.</span></span>

<span data-ttu-id="bcd70-193">Yazılan veri kümesi `Northwind.xsd` `App_Code` klasör s `DAL` alt klasöründe bulunur.</span><span class="sxs-lookup"><span data-stu-id="bcd70-193">The Typed DataSet `Northwind.xsd` is located in the `App_Code` folder s `DAL` subfolder.</span></span> <span data-ttu-id="bcd70-194">`TransactionSupport` adlı `DAL` klasörde bir alt klasör oluşturun ve `ProductsTableAdapter.TransactionSupport.vb` adlı yeni bir sınıf dosyası ekleyin (bkz. Şekil 4).</span><span class="sxs-lookup"><span data-stu-id="bcd70-194">Create a subfolder in the `DAL` folder named `TransactionSupport` and add a new class file named `ProductsTableAdapter.TransactionSupport.vb` (see Figure 4).</span></span> <span data-ttu-id="bcd70-195">Bu dosya, bir işlem kullanarak veri değişiklikleri gerçekleştirmeye yönelik yöntemleri içeren `ProductsTableAdapter` kısmi uygulamasını tutacaktır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-195">This file will hold the partial implementation of the `ProductsTableAdapter` that includes methods for performing data modifications using a transaction.</span></span>

![TransactionSupport adlı bir klasör ve ProductsTableAdapter. TransactionSupport. vb adlı bir sınıf dosyası ekleyin](wrapping-database-modifications-within-a-transaction-vb/_static/image4.gif)

<span data-ttu-id="bcd70-197">**Şekil 4**: `TransactionSupport` adlı bir klasör ve `ProductsTableAdapter.TransactionSupport.vb` adlı bir sınıf dosyası ekleyin</span><span class="sxs-lookup"><span data-stu-id="bcd70-197">**Figure 4**: Add a Folder Named `TransactionSupport` and a Class File Named `ProductsTableAdapter.TransactionSupport.vb`</span></span>

<span data-ttu-id="bcd70-198">`ProductsTableAdapter.TransactionSupport.vb` dosyasına aşağıdaki kodu girin:</span><span class="sxs-lookup"><span data-stu-id="bcd70-198">Enter the following code into the `ProductsTableAdapter.TransactionSupport.vb` file:</span></span>

[!code-vb[Main](wrapping-database-modifications-within-a-transaction-vb/samples/sample3.vb)]

<span data-ttu-id="bcd70-199">Burada sınıf bildiriminde `Partial` anahtar sözcüğü, içinde eklenen üyelerin `NorthwindTableAdapters` ad alanındaki `ProductsTableAdapter` sınıfına ekleneceğini belirtir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-199">The `Partial` keyword in the class declaration here indicates to the compiler that the members added within are to be added to the `ProductsTableAdapter` class in the `NorthwindTableAdapters` namespace.</span></span> <span data-ttu-id="bcd70-200">Dosyanın en üstündeki `Imports System.Data.SqlClient` bildirimine göz önünde edin.</span><span class="sxs-lookup"><span data-stu-id="bcd70-200">Note the `Imports System.Data.SqlClient` statement at the top of the file.</span></span> <span data-ttu-id="bcd70-201">TableAdapter, SqlClient sağlayıcısını kullanacak şekilde yapılandırıldığından, kendi komutlarını veritabanına vermek için bir [`SqlDataAdapter`](https://msdn.microsoft.com/library/system.data.sqlclient.sqldataadapter.aspx) nesnesi kullanır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-201">Since the TableAdapter was configured to use the SqlClient provider, internally it uses a [`SqlDataAdapter`](https://msdn.microsoft.com/library/system.data.sqlclient.sqldataadapter.aspx) object to issue its commands to the database.</span></span> <span data-ttu-id="bcd70-202">Sonuç olarak, işlemi başlatmak ve sonra yürütmek ya da geri almak için `SqlTransaction` sınıfını kullandık.</span><span class="sxs-lookup"><span data-stu-id="bcd70-202">Consequently, we need to use the `SqlTransaction` class to begin the transaction and then to commit it or roll it back.</span></span> <span data-ttu-id="bcd70-203">Microsoft SQL Server dışında bir veri deposu kullanıyorsanız, uygun sağlayıcıyı kullanmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-203">If you are using a data store other than Microsoft SQL Server, you'll need to use the appropriate provider.</span></span>

<span data-ttu-id="bcd70-204">Bu yöntemler, bir işlemi başlatmak, geri almak ve yürütmek için gereken yapı taşlarını sağlar.</span><span class="sxs-lookup"><span data-stu-id="bcd70-204">These methods provide the building blocks needed to start, rollback, and commit a transaction.</span></span> <span data-ttu-id="bcd70-205">Bunlar `Public`işaretlenir, bu, DAL içindeki başka bir sınıftan veya BLL gibi mimarideki başka bir katmandan `ProductsTableAdapter`kullanılmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="bcd70-205">They are marked `Public`, enabling them to be used from within the `ProductsTableAdapter`, from another class in the DAL, or from another layer in the architecture, such as the BLL.</span></span> <span data-ttu-id="bcd70-206">`BeginTransaction` TableAdapter iç `SqlConnection` açar (gerekirse), işlemi başlatır ve `Transaction` özelliğine atar ve işlemi iç `SqlDataAdapter` s `SqlCommand` nesnelerine ekler.</span><span class="sxs-lookup"><span data-stu-id="bcd70-206">`BeginTransaction` opens the TableAdapter s internal `SqlConnection` (if needed), begins the transaction and assigns it to the `Transaction` property, and attaches the transaction to the internal `SqlDataAdapter` s `SqlCommand` objects.</span></span> <span data-ttu-id="bcd70-207">`CommitTransaction` ve `RollbackTransaction` iç `Rollback` nesnesini kapatmadan önce, sırasıyla `Transaction` nesne s `Commit` ve `Connection` Yöntemleri çağırın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-207">`CommitTransaction` and `RollbackTransaction` call the `Transaction` object s `Commit` and `Rollback` methods, respectively, before closing the internal `Connection` object.</span></span>

## <a name="step-3-adding-methods-to-update-and-delete-data-under-the-umbrella-of-a-transaction"></a><span data-ttu-id="bcd70-208">3\. Adım: bir Işlemin şemsiye altında verileri güncelleştirmek ve silmek için yöntemler ekleme</span><span class="sxs-lookup"><span data-stu-id="bcd70-208">Step 3: Adding Methods to Update and Delete Data Under the Umbrella of a Transaction</span></span>

<span data-ttu-id="bcd70-209">Bu yöntemler tamamlansa, bir işlemin şemsiye altında bir dizi komut gerçekleştiren `ProductsDataTable` veya BLL 'e Yöntemler eklemeye hazırız.</span><span class="sxs-lookup"><span data-stu-id="bcd70-209">With these methods complete, we re ready to add methods to `ProductsDataTable` or the BLL that perform a series of commands under the umbrella of a transaction.</span></span> <span data-ttu-id="bcd70-210">Aşağıdaki yöntem bir işlem kullanarak bir `ProductsDataTable` örneğini güncelleştirmek için Batch güncelleştirme modelini kullanır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-210">The following method uses the Batch Update pattern to update a `ProductsDataTable` instance using a transaction.</span></span> <span data-ttu-id="bcd70-211">`BeginTransaction` yöntemini çağırarak bir işlem başlatır ve sonra veri değiştirme deyimlerini vermek için bir `Try...Catch` bloğu kullanır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-211">It starts a transaction by calling the `BeginTransaction` method and then uses a `Try...Catch` block to issue the data modification statements.</span></span> <span data-ttu-id="bcd70-212">`Adapter` nesne `Update` yöntemine yapılan çağrı bir özel durumla sonuçlanırsa, yürütme hareketin geri alındığı ve özel durumun yeniden oluşturulduğu `catch` bloğuna aktarılır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-212">If the call to the `Adapter` object s `Update` method results in an exception, execution will transfer to the `catch` block where the transaction will be rolled back and the exception re-thrown.</span></span> <span data-ttu-id="bcd70-213">`Update` yönteminin, sağlanan `ProductsDataTable` satırları numaralandırarak ve gerekli `InsertCommand`, `UpdateCommand`ve `DeleteCommand` işlemlerini gerçekleştirerek Batch güncelleştirme modelini uyguladığını unutmayın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-213">Recall that the `Update` method implements the Batch Update pattern by enumerating the rows of the supplied `ProductsDataTable` and performing the necessary `InsertCommand`, `UpdateCommand`, and `DeleteCommand` s.</span></span> <span data-ttu-id="bcd70-214">Bu komutlardan herhangi biri bir hata ile sonuçlanırsa işlem, işlem ömrü boyunca yapılan önceki değişiklikleri geri alarak geri alınır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-214">If any one of these commands results in an error, the transaction is rolled back, undoing the previous modifications made during the transaction s lifetime.</span></span> <span data-ttu-id="bcd70-215">`Update` deyimin hatasız tamamlanabilmesi gerekir, işlem tamamen işlenir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-215">Should the `Update` statement complete without error, the transaction is committed in its entirety.</span></span>

[!code-vb[Main](wrapping-database-modifications-within-a-transaction-vb/samples/sample4.vb)]

<span data-ttu-id="bcd70-216">`UpdateWithTransaction` yöntemini `ProductsTableAdapter.TransactionSupport.vb`parçalı sınıfı aracılığıyla `ProductsTableAdapter` sınıfına ekleyin.</span><span class="sxs-lookup"><span data-stu-id="bcd70-216">Add the `UpdateWithTransaction` method to the `ProductsTableAdapter` class through the partial class in `ProductsTableAdapter.TransactionSupport.vb`.</span></span> <span data-ttu-id="bcd70-217">Alternatif olarak, bu yöntem bazı küçük sözdizimsel değişikliklerle Iş mantığı katmanı s `ProductsBLL` sınıfına eklenebilir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-217">Alternatively, this method could be added to the Business Logic Layer s `ProductsBLL` class with a few minor syntactical changes.</span></span> <span data-ttu-id="bcd70-218">Yani, `Me.BeginTransaction()`, `Me.CommitTransaction()`ve `Me.RollbackTransaction()` anahtar sözcüğünün `Me` `Adapter` ile değiştirilmeleri gerekir (Bu `Adapter`, `ProductsBLL` türündeki `ProductsTableAdapter`bir özelliğin adıdır).</span><span class="sxs-lookup"><span data-stu-id="bcd70-218">Namely, the keyword `Me` in `Me.BeginTransaction()`, `Me.CommitTransaction()`, and `Me.RollbackTransaction()` would need to be replaced with `Adapter` (recall that `Adapter` is the name of a property in `ProductsBLL` of type `ProductsTableAdapter`).</span></span>

<span data-ttu-id="bcd70-219">`UpdateWithTransaction` yöntemi Batch güncelleştirme modelini kullanır, ancak aşağıdaki yöntemin gösterdiği gibi bir dizi VERITABANı doğrudan çağrısı da bir işlemin kapsamı içinde kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-219">The `UpdateWithTransaction` method uses the Batch Update pattern, but a series of DB-Direct calls can also be used within the scope of a transaction, as the following method shows.</span></span> <span data-ttu-id="bcd70-220">`DeleteProductsWithTransaction` yöntemi, silinecek `ProductID` s olan `Integer`türünde bir `List(Of T)` girdi olarak kabul eder.</span><span class="sxs-lookup"><span data-stu-id="bcd70-220">The `DeleteProductsWithTransaction` method accepts as input a `List(Of T)` of type `Integer`, which are the `ProductID` s to delete.</span></span> <span data-ttu-id="bcd70-221">Yöntemi, `BeginTransaction` çağrısı yoluyla işlemi başlatır ve sonra `Try` bloğunda, her `ProductID` değeri için DB-Direct model `Delete` yöntemini çağıran sağlanan liste boyunca yinelenir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-221">The method initiates the transaction via a call to `BeginTransaction` and then, in the `Try` block, iterates through the supplied list calling the DB-Direct pattern `Delete` method for each `ProductID` value.</span></span> <span data-ttu-id="bcd70-222">`Delete` çağrılarından herhangi biri başarısız olursa, denetim işlemin geri alındığı ve özel durumun yeniden oluşturulduğu `Catch` bloğuna aktarılır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-222">If any of the calls to `Delete` fails, control is transferred to the `Catch` block where the transaction is rolled back and the exception re-thrown.</span></span> <span data-ttu-id="bcd70-223">`Delete` yapılan tüm çağrılar başarılı olursa işlem gerçekleştirilir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-223">If all calls to `Delete` succeed, then transaction is committed.</span></span> <span data-ttu-id="bcd70-224">Bu yöntemi `ProductsBLL` sınıfına ekleyin.</span><span class="sxs-lookup"><span data-stu-id="bcd70-224">Add this method to the `ProductsBLL` class.</span></span>

[!code-vb[Main](wrapping-database-modifications-within-a-transaction-vb/samples/sample5.vb)]

## <a name="applying-transactions-across-multiple-tableadapters"></a><span data-ttu-id="bcd70-225">Birden çok TableAdapters arasında Işlem uygulama</span><span class="sxs-lookup"><span data-stu-id="bcd70-225">Applying Transactions Across Multiple TableAdapters</span></span>

<span data-ttu-id="bcd70-226">Bu öğreticide incelenen işlemle ilgili kod, `ProductsTableAdapter` birden çok deyimin atomik bir işlem olarak işlenmesine izin verir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-226">The transaction-related code examined in this tutorial allows for multiple statements against the `ProductsTableAdapter` to be treated as an atomic operation.</span></span> <span data-ttu-id="bcd70-227">Ancak, farklı veritabanı tablolarında birden fazla değişiklik otomatik olarak gerçekleştirilmesi gerekiyorsa ne olur?</span><span class="sxs-lookup"><span data-stu-id="bcd70-227">But what if multiple modifications to different database tables need to be performed atomically?</span></span> <span data-ttu-id="bcd70-228">Örneğin, bir kategoriyi silerken, önce geçerli ürünlerini başka bir kategoriye yeniden atamak isteyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="bcd70-228">For instance, when deleting a category, we might first want to reassign its current products to some other category.</span></span> <span data-ttu-id="bcd70-229">Bu iki adım, ürünleri yeniden atayarak ve kategoriyi silmenin atomik bir işlem olarak yürütülmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-229">These two steps reassigning the products and deleting the category should be executed as an atomic operation.</span></span> <span data-ttu-id="bcd70-230">Ancak `ProductsTableAdapter` yalnızca `Products` tablosunu değiştirme yöntemleri içerir ve `CategoriesTableAdapter` yalnızca `Categories` tablosunu değiştirme yöntemlerini içerir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-230">But the `ProductsTableAdapter` includes only methods for modifying the `Products` table and the `CategoriesTableAdapter` includes only methods for modifying the `Categories` table.</span></span> <span data-ttu-id="bcd70-231">Bu nedenle bir işlem hem TableAdapters?</span><span class="sxs-lookup"><span data-stu-id="bcd70-231">So how can a transaction encompass both TableAdapters?</span></span>

<span data-ttu-id="bcd70-232">Bir seçenek, `DeleteCategoryAndReassignProducts(categoryIDtoDelete, reassignToCategoryID)` adlı `CategoriesTableAdapter` bir yöntem eklemektir ve bu yöntemin, her ikisi de ürünleri yeniden atar ve saklı yordamda tanımlanan bir işlemin kapsamındaki kategoriyi sildiği bir saklı yordam çağırmasıdır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-232">One option is to add a method to the `CategoriesTableAdapter` named `DeleteCategoryAndReassignProducts(categoryIDtoDelete, reassignToCategoryID)` and have that method call a stored procedure that both reassigns the products and deletes the category within the scope of a transaction defined within the stored procedure.</span></span> <span data-ttu-id="bcd70-233">Daha sonraki bir öğreticide saklı yordamlarda işlem başlatma, işleme ve geri alma işlemlerine bakacağız.</span><span class="sxs-lookup"><span data-stu-id="bcd70-233">We'll look at how to begin, commit, and rollback transactions in stored procedures in a future tutorial.</span></span>

<span data-ttu-id="bcd70-234">Başka bir seçenek de `DeleteCategoryAndReassignProducts(categoryIDtoDelete, reassignToCategoryID)` yöntemini içeren DAL içinde yardımcı sınıf oluşturmaktır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-234">Another option is to create a helper class in the DAL that contains the `DeleteCategoryAndReassignProducts(categoryIDtoDelete, reassignToCategoryID)` method.</span></span> <span data-ttu-id="bcd70-235">Bu yöntem `CategoriesTableAdapter` ve `ProductsTableAdapter` bir örneğini oluşturur ve sonra bu iki TableAdapters `Connection` özelliklerini aynı `SqlConnection` örneğine ayarlar.</span><span class="sxs-lookup"><span data-stu-id="bcd70-235">This method would create an instance of the `CategoriesTableAdapter` and the `ProductsTableAdapter` and then set these two TableAdapters `Connection` properties to the same `SqlConnection` instance.</span></span> <span data-ttu-id="bcd70-236">Bu noktada, iki TableAdapters birini `BeginTransaction`çağrısı olan işlemi başlatır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-236">At that point, either one of the two TableAdapters would initiate the transaction with a call to `BeginTransaction`.</span></span> <span data-ttu-id="bcd70-237">Ürünleri yeniden atama ve kategoriyi silme TableAdapters yöntemleri, işlemin yürütüldüğü veya geri alındığı bir `Try...Catch` bloğunda çağrılır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-237">The TableAdapters methods for reassigning the products and deleting the category would be invoked in a `Try...Catch` block with the transaction committed or rolled back as needed.</span></span>

## <a name="step-4-adding-theupdatewithtransactionmethod-to-the-business-logic-layer"></a><span data-ttu-id="bcd70-238">4\. Adım:`UpdateWithTransaction`yöntemini Iş mantığı katmanına ekleme</span><span class="sxs-lookup"><span data-stu-id="bcd70-238">Step 4: Adding the`UpdateWithTransaction`Method to the Business Logic Layer</span></span>

<span data-ttu-id="bcd70-239">3\. adımda, DAL içindeki `ProductsTableAdapter` bir `UpdateWithTransaction` yöntemi ekledik.</span><span class="sxs-lookup"><span data-stu-id="bcd70-239">In Step 3 we added an `UpdateWithTransaction` method to the `ProductsTableAdapter` in the DAL.</span></span> <span data-ttu-id="bcd70-240">BLL 'ye karşılık gelen bir yöntem ekleyeceğiz.</span><span class="sxs-lookup"><span data-stu-id="bcd70-240">We should add a corresponding method to the BLL.</span></span> <span data-ttu-id="bcd70-241">Sunum katmanı `UpdateWithTransaction` yöntemi çağırmak için doğrudan DAL 'ye çağrı yapmış olsa da bu öğreticiler, sunum katmanından DAL oluşturan katmanlı bir mimari tanımlamaya çalışır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-241">While the Presentation Layer could call directly down to the DAL to invoke the `UpdateWithTransaction` method, these tutorials have strived to define a layered architecture that insulates the DAL from the Presentation Layer.</span></span> <span data-ttu-id="bcd70-242">Bu nedenle, behooves bizimle bu yaklaşıma devam etmemizi sağlar.</span><span class="sxs-lookup"><span data-stu-id="bcd70-242">Therefore, it behooves us to continue this approach.</span></span>

<span data-ttu-id="bcd70-243">`ProductsBLL` sınıf dosyasını açın ve yalnızca karşılık gelen DAL yöntemine çağıran `UpdateWithTransaction` adlı bir yöntem ekleyin.</span><span class="sxs-lookup"><span data-stu-id="bcd70-243">Open the `ProductsBLL` class file and add a method named `UpdateWithTransaction` that simply calls down to the corresponding DAL method.</span></span> <span data-ttu-id="bcd70-244">`ProductsBLL`Şu anda, yeni eklediğiniz ve adım 3 ' te eklenen `DeleteProductsWithTransaction`olan `UpdateWithTransaction`iki yeni yöntem olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-244">There should now be two new methods in `ProductsBLL`: `UpdateWithTransaction`, which you just added, and `DeleteProductsWithTransaction`, which was added in Step 3.</span></span>

[!code-vb[Main](wrapping-database-modifications-within-a-transaction-vb/samples/sample6.vb)]

> [!NOTE]
> <span data-ttu-id="bcd70-245">Bu yöntemler, doğrudan ASP.NET Pages arka plan kod sınıflarından bu yöntemleri çağırabiletireceğiz için `ProductsBLL` sınıfındaki diğer yöntemlere atanan `DataObjectMethodAttribute` özniteliğini içermez.</span><span class="sxs-lookup"><span data-stu-id="bcd70-245">These methods do not include the `DataObjectMethodAttribute` attribute assigned to most other methods in the `ProductsBLL` class because we'll be invoking these methods directly from the ASP.NET pages code-behind classes.</span></span> <span data-ttu-id="bcd70-246">Bu `DataObjectMethodAttribute`, ObjectDataSource 'un veri kaynağını Yapılandır sihirbazında ve hangi sekmenin (SELECT, UPDATE, INSERT veya DELETE) altında görünmesi gerektiğini işaretlemek için kullanıldığını unutmayın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-246">Recall that `DataObjectMethodAttribute` is used to flag what methods should appear in the ObjectDataSource s Configure Data Source wizard and under what tab (SELECT, UPDATE, INSERT, or DELETE).</span></span> <span data-ttu-id="bcd70-247">GridView, toplu iş düzenlemesi veya silme için yerleşik bir destek olmadığından, kod içermeyen bildirim yaklaşımını kullanmak yerine bu yöntemleri programlı bir şekilde çağırmamız gerekir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-247">Since the GridView lacks any built-in support for batch editing or deleting, we'll have to invoke these methods programmatically rather than use the code-free declarative approach.</span></span>

## <a name="step-5-atomically-updating-database-data-from-the-presentation-layer"></a><span data-ttu-id="bcd70-248">5\. Adım: veritabanı verilerini sunu katmanından otomatik olarak güncelleştirme</span><span class="sxs-lookup"><span data-stu-id="bcd70-248">Step 5: Atomically Updating Database Data from the Presentation Layer</span></span>

<span data-ttu-id="bcd70-249">İşlemin toplu bir kayıt güncelleştirmesinde olduğu etkiyi göstermek için, bir GridView içindeki tüm ürünleri listeleyen bir kullanıcı arabirimi oluşturun ve tıklandığı zaman, ürün `CategoryID` değerleri yeniden atar.</span><span class="sxs-lookup"><span data-stu-id="bcd70-249">To illustrate the effect that the transaction has when updating a batch of records, let s create a user interface that lists all products in a GridView and includes a Button Web control that, when clicked, reassigns the products `CategoryID` values.</span></span> <span data-ttu-id="bcd70-250">Özellikle, bazı birkaç ürüne geçerli bir `CategoryID` değeri atanarak, diğer bir deyişle mevcut olmayan bir `CategoryID` değerine atanmadığından, kategori yeniden ataması devam edecektir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-250">In particular, the category reassignment will progress so that the first several products are assigned a valid `CategoryID` value while others are purposefully assigned a non-existent `CategoryID` value.</span></span> <span data-ttu-id="bcd70-251">`CategoryID` var olan bir `CategoryID`kategoriyle eşleşmeyen bir ürünle veritabanını güncelleştirmeye çalışarız, yabancı anahtar kısıtlaması ihlali oluşur ve bir özel durum oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="bcd70-251">If we attempt to update the database with a product whose `CategoryID` does not match an existing category s `CategoryID`, a foreign key constraint violation will occur and an exception will be raised.</span></span> <span data-ttu-id="bcd70-252">Bu örnekte, bir işlem kullanılırken, yabancı anahtar kısıtlaması ihlalinden kaynaklanan özel durum, önceki geçerli `CategoryID` değişikliklerinin geri alınmasına neden olur.</span><span class="sxs-lookup"><span data-stu-id="bcd70-252">What we'll see in this example is that when using a transaction the exception raised from the foreign key constraint violation will cause the previous valid `CategoryID` changes to be rolled back.</span></span> <span data-ttu-id="bcd70-253">Ancak, bir işlem kullanmadığınız zaman, ilk kategorilerdeki değişiklikler kalır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-253">When not using a transaction, however, the modifications to the initial categories will remain.</span></span>

<span data-ttu-id="bcd70-254">`Transactions.aspx` sayfasını `BatchData` klasöründen açarak başlatın ve araç kutusundan bir GridView 'ı tasarımcı üzerine sürükleyin.</span><span class="sxs-lookup"><span data-stu-id="bcd70-254">Start by opening the `Transactions.aspx` page in the `BatchData` folder and drag a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="bcd70-255">`ID` `Products` ve akıllı etiketinden `ProductsDataSource`adlı yeni bir ObjectDataSource bağlayın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-255">Set its `ID` to `Products` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="bcd70-256">`ProductsBLL` sınıf s `GetProducts` yönteminden verileri çekmek için ObjectDataSource 'ı yapılandırın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-256">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="bcd70-257">Bu, salt okunurdur bir GridView olacaktır, bu nedenle GÜNCELLEŞTIRME, ekleme ve SILME sekmelerinden (yok) açılır listeleri ayarlayın ve son ' a tıklayın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-257">This will be a read-only GridView, so set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and click Finish.</span></span>

<span data-ttu-id="bcd70-258">[![, ObjectDataSource 'ı ProductsBLL sınıfı s GetProducts metodunu kullanacak şekilde yapılandırma](wrapping-database-modifications-within-a-transaction-vb/_static/image5.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="bcd70-258">[![Configure the ObjectDataSource to Use the ProductsBLL Class s GetProducts Method](wrapping-database-modifications-within-a-transaction-vb/_static/image5.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image3.png)</span></span>

<span data-ttu-id="bcd70-259">**Şekil 5**: `ProductsBLL` sınıf s `GetProducts` metodunu ([tam boyutlu görüntüyü görüntülemek Için tıklayın](wrapping-database-modifications-within-a-transaction-vb/_static/image4.png)) kullanmak üzere ObjectDataSource 'ı yapılandırın</span><span class="sxs-lookup"><span data-stu-id="bcd70-259">**Figure 5**: Configure the ObjectDataSource to Use the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-vb/_static/image4.png))</span></span>

<span data-ttu-id="bcd70-260">[GÜNCELLEŞTIRME, ekleme ve SILME sekmelerindeki açılan listeleri (hiçbiri) ![ayarla](wrapping-database-modifications-within-a-transaction-vb/_static/image6.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="bcd70-260">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](wrapping-database-modifications-within-a-transaction-vb/_static/image6.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image5.png)</span></span>

<span data-ttu-id="bcd70-261">**Şekil 6**: GÜNCELLEŞTIRME, ekleme ve silme sekmelerinden açılan listeleri (yok) ayarlayın ([tam boyutlu görüntüyü görüntülemek için tıklayın](wrapping-database-modifications-within-a-transaction-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="bcd70-261">**Figure 6**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-vb/_static/image6.png))</span></span>

<span data-ttu-id="bcd70-262">Veri kaynağı Yapılandırma Sihirbazı 'nı tamamladıktan sonra, Visual Studio, ürün verileri alanları için BoundFields ve bir CheckBoxField oluşturacaktır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-262">After completing the Configure Data Source wizard, Visual Studio will create BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="bcd70-263">`ProductID`, `ProductName`, `CategoryID`ve `CategoryName` hariç tüm bu alanları kaldırın ve `ProductName` ve `CategoryName` BoundFields `HeaderText` özellikleri sırasıyla ürün ve kategori olarak yeniden adlandırın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-263">Remove all of these fields except for `ProductID`, `ProductName`, `CategoryID`, and `CategoryName` and rename the `ProductName` and `CategoryName` BoundFields `HeaderText` properties to Product and Category, respectively.</span></span> <span data-ttu-id="bcd70-264">Akıllı etikette, sayfalama etkinleştir seçeneğini işaretleyin.</span><span class="sxs-lookup"><span data-stu-id="bcd70-264">From the smart tag, check the Enable Paging option.</span></span> <span data-ttu-id="bcd70-265">Bu değişiklikleri yaptıktan sonra, GridView ve ObjectDataSource 'lar bildirim temelli biçimlendirme aşağıdaki gibi görünmelidir:</span><span class="sxs-lookup"><span data-stu-id="bcd70-265">After making these modifications, the GridView and ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](wrapping-database-modifications-within-a-transaction-vb/samples/sample7.aspx)]

<span data-ttu-id="bcd70-266">Sonra, GridView 'un üstüne üç düğme web denetimi ekleyin.</span><span class="sxs-lookup"><span data-stu-id="bcd70-266">Next, add three Button Web controls above the GridView.</span></span> <span data-ttu-id="bcd70-267">İlk düğme s metin özelliğini kılavuz Yenile, kategorileri değiştirmek için ikinci s (Işlem Ile) ve üçüncü bir tane Kategoriler (Işlem olmadan) olacak şekilde ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-267">Set the first Button s Text property to Refresh Grid, the second s to Modify Categories (WITH TRANSACTION), and the third one s to Modify Categories (WITHOUT TRANSACTION) .</span></span>

[!code-aspx[Main](wrapping-database-modifications-within-a-transaction-vb/samples/sample8.aspx)]

<span data-ttu-id="bcd70-268">Bu noktada, Visual Studio 'daki Tasarım görünümü Şekil 7 ' de gösterilen ekran görüntüsüne benzer şekilde görünmelidir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-268">At this point the Design view in Visual Studio should look similar to the screen shot shown in Figure 7.</span></span>

<span data-ttu-id="bcd70-269">[Sayfada bir GridView ve üç düğme web denetimi Içeren ![](wrapping-database-modifications-within-a-transaction-vb/_static/image7.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="bcd70-269">[![The Page Contains a GridView and Three Button Web Controls](wrapping-database-modifications-within-a-transaction-vb/_static/image7.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image7.png)</span></span>

<span data-ttu-id="bcd70-270">**Şekil 7**: sayfa bir GridView ve üç düğme web denetimi içerir ([tam boyutlu görüntüyü görüntülemek için tıklayın](wrapping-database-modifications-within-a-transaction-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="bcd70-270">**Figure 7**: The Page Contains a GridView and Three Button Web Controls ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-vb/_static/image8.png))</span></span>

<span data-ttu-id="bcd70-271">Üç düğme `Click` olayının her biri için olay işleyicileri oluşturun ve aşağıdaki kodu kullanın:</span><span class="sxs-lookup"><span data-stu-id="bcd70-271">Create event handlers for each of the three Button s `Click` events and use the following code:</span></span>

[!code-vb[Main](wrapping-database-modifications-within-a-transaction-vb/samples/sample9.vb)]

<span data-ttu-id="bcd70-272">Yenileme düğmesi s `Click` olay işleyicisi, `Products` GridView s `DataBind` metodunu çağırarak verileri GridView 'a yeniden bağlar.</span><span class="sxs-lookup"><span data-stu-id="bcd70-272">The refresh Button s `Click` event handler simply rebinds the data to the GridView by calling the `Products` GridView s `DataBind` method.</span></span>

<span data-ttu-id="bcd70-273">İkinci olay işleyicisi, ürünleri `CategoryID` öğeleri yeniden atar ve bir işlemin şemsiye altında veritabanı güncelleştirmelerini gerçekleştirmek için BLL 'den yeni işlem yöntemini kullanır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-273">The second event handler reassigns the products `CategoryID` s and uses the new transaction method from the BLL to perform the database updates under the umbrella of a transaction.</span></span> <span data-ttu-id="bcd70-274">Her ürünün `CategoryID` rastgele `ProductID`aynı değere ayarlandığını unutmayın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-274">Note that each product s `CategoryID` is arbitrarily set to the same value as its `ProductID`.</span></span> <span data-ttu-id="bcd70-275">Bu ürünler geçerli `CategoryID` s ile eşlenecek `ProductID` değerler içerdiğinden, ilk birkaç ürün için bu işlem sorunsuz çalışacaktır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-275">This will work fine for the first few products, since those products have `ProductID` values that happen to map to valid `CategoryID` s.</span></span> <span data-ttu-id="bcd70-276">Ancak `ProductID` s çok büyük bir süre sonra başlatıldıktan sonra, `ProductID` s ve `CategoryID` s 'nin bu coarızalımesi artık geçerli değildir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-276">But once the `ProductID` s start getting too large, this coincidental overlap of `ProductID` s and `CategoryID` s no longer applies.</span></span>

<span data-ttu-id="bcd70-277">Üçüncü `Click` olay işleyicisi, ürünleri `CategoryID` öğeleri aynı şekilde güncelleştirir, ancak `ProductsTableAdapter` s varsayılan `Update` yöntemini kullanarak güncelleştirmeyi veritabanına gönderir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-277">The third `Click` event handler updates the products `CategoryID` s in the same manner, but sends the update to the database using the `ProductsTableAdapter` s default `Update` method.</span></span> <span data-ttu-id="bcd70-278">Bu `Update` yöntemi bir işlem içindeki komut serisini sarmaz, bu nedenle bu değişiklikler ilk karşılaşılan yabancı anahtar kısıtlaması ihlali hatası devam edecek.</span><span class="sxs-lookup"><span data-stu-id="bcd70-278">This `Update` method does not wrap the series of commands within a transaction, so those changes are made prior to the first encountered foreign key constraint violation error will persist.</span></span>

<span data-ttu-id="bcd70-279">Bu davranışı göstermek için bu sayfayı bir tarayıcı aracılığıyla ziyaret edin.</span><span class="sxs-lookup"><span data-stu-id="bcd70-279">To demonstrate this behavior, visit this page through a browser.</span></span> <span data-ttu-id="bcd70-280">Başlangıçta, Şekil 8 ' de gösterildiği gibi ilk veri sayfasını görmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-280">Initially you should see the first page of data as shown in Figure 8.</span></span> <span data-ttu-id="bcd70-281">Sonra, kategorileri Değiştir (Işlem Ile) düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-281">Next, click the Modify Categories (WITH TRANSACTION) button.</span></span> <span data-ttu-id="bcd70-282">Bu, geri göndermeye neden olur ve tüm ürünlerin `CategoryID` değerlerini güncelleştirmeye çalışır, ancak yabancı anahtar kısıtlaması ihlaline neden olur (bkz. Şekil 9).</span><span class="sxs-lookup"><span data-stu-id="bcd70-282">This will cause a postback and attempt to update all of the products `CategoryID` values, but will result in a foreign key constraint violation (see Figure 9).</span></span>

<span data-ttu-id="bcd70-283">[![ürünleri sayfalanabilir GridView 'da görüntülenir](wrapping-database-modifications-within-a-transaction-vb/_static/image8.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="bcd70-283">[![The Products are Displayed in a Pageable GridView](wrapping-database-modifications-within-a-transaction-vb/_static/image8.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image9.png)</span></span>

<span data-ttu-id="bcd70-284">**Şekil 8**: ürünler bir sayfalanabilir GridView 'da görüntülenir ([tam boyutlu görüntüyü görüntülemek için tıklayın](wrapping-database-modifications-within-a-transaction-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="bcd70-284">**Figure 8**: The Products are Displayed in a Pageable GridView ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-vb/_static/image10.png))</span></span>

<span data-ttu-id="bcd70-285">[![Kategoriler bir yabancı anahtar kısıtlaması Ihlaline neden olur](wrapping-database-modifications-within-a-transaction-vb/_static/image9.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="bcd70-285">[![Reassigning the Categories Results in a Foreign Key Constraint Violation](wrapping-database-modifications-within-a-transaction-vb/_static/image9.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image11.png)</span></span>

<span data-ttu-id="bcd70-286">**Şekil 9**: kategorileri yeniden atama yabancı anahtar kısıtlaması ihlaline neden olur ([tam boyutlu görüntüyü görüntülemek için tıklayın](wrapping-database-modifications-within-a-transaction-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="bcd70-286">**Figure 9**: Reassigning the Categories Results in a Foreign Key Constraint Violation ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-vb/_static/image12.png))</span></span>

<span data-ttu-id="bcd70-287">Şimdi tarayıcı geri düğmesine basın ve ardından kılavuza Yenile düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-287">Now hit your browser s Back button and then click the Refresh Grid button.</span></span> <span data-ttu-id="bcd70-288">Verileri yenilemeden sonra, Şekil 8 ' de gösterildiği gibi tam olarak aynı çıktıyı görmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-288">Upon refreshing the data you should see the exact same output as shown in Figure 8.</span></span> <span data-ttu-id="bcd70-289">Diğer bir deyişle, bazı `CategoryID` ürünlerden bazıları yasal değerler olarak değiştirilse ve veritabanında güncelleştirilene karşın, yabancı anahtar kısıtlaması ihlali oluştuğunda geri alınır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-289">That is, even though some of the products `CategoryID` s were changed to legal values and updated in the database, they were rolled back when the foreign key constraint violation occurred.</span></span>

<span data-ttu-id="bcd70-290">Şimdi kategorileri Değiştir (Işlem olmadan) düğmesini tıklatmaya çalışın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-290">Now try clicking the Modify Categories (WITHOUT TRANSACTION) button.</span></span> <span data-ttu-id="bcd70-291">Bu, aynı yabancı anahtar kısıtlaması ihlali hatasına neden olur (bkz. Şekil 9), ancak bu sefer `CategoryID` değerleri geçerli bir değer olarak değiştirilen ürünler geri alınmaz.</span><span class="sxs-lookup"><span data-stu-id="bcd70-291">This will result in the same foreign key constraint violation error (see Figure 9), but this time those products whose `CategoryID` values were changed to a legal value will not be rolled back.</span></span> <span data-ttu-id="bcd70-292">Tarayıcınızın geri düğmesine ve ardından Kılavuz Yenile düğmesine basın.</span><span class="sxs-lookup"><span data-stu-id="bcd70-292">Hit your browser s Back button and then the Refresh Grid button.</span></span> <span data-ttu-id="bcd70-293">Şekil 10 ' da gösterildiği gibi, ilk sekiz ürünün `CategoryID` s ' i yeniden atandı.</span><span class="sxs-lookup"><span data-stu-id="bcd70-293">As Figure 10 shows, the `CategoryID` s of the first eight products have been reassigned.</span></span> <span data-ttu-id="bcd70-294">Örneğin, Şekil 8 ' de, Chang 1 ' in `CategoryID` vardı, ancak Şekil 10 ' da 2 ' ye yeniden atandı.</span><span class="sxs-lookup"><span data-stu-id="bcd70-294">For example, in Figure 8, Chang had a `CategoryID` of 1, but in Figure 10 it s been reassigned to 2.</span></span>

<span data-ttu-id="bcd70-295">[![bazı ürünlerin CategoryID değerlerinin güncelleştirildiği sırada güncelleştirilmiş olması](wrapping-database-modifications-within-a-transaction-vb/_static/image10.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="bcd70-295">[![Some Products CategoryID Values were Updated While Others Were Not](wrapping-database-modifications-within-a-transaction-vb/_static/image10.gif)](wrapping-database-modifications-within-a-transaction-vb/_static/image13.png)</span></span>

<span data-ttu-id="bcd70-296">**Şekil 10**: bazı ürün `CategoryID` değerleri, diğerleri oluşturulmazken güncelleştirildi ([tam boyutlu görüntüyü görüntülemek için tıklayın](wrapping-database-modifications-within-a-transaction-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="bcd70-296">**Figure 10**: Some Products `CategoryID` Values were Updated While Others Were Not ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-vb/_static/image14.png))</span></span>

## <a name="summary"></a><span data-ttu-id="bcd70-297">Özet</span><span class="sxs-lookup"><span data-stu-id="bcd70-297">Summary</span></span>

<span data-ttu-id="bcd70-298">Varsayılan olarak, TableAdapter s yöntemleri yürütülen veritabanı deyimlerini bir işlemin kapsamı içinde sarmaz, ancak küçük bir çalışmalarla bir işlem oluşturacak, kaydedilecek ve geri alacak Yöntemler ekleyebiliriz.</span><span class="sxs-lookup"><span data-stu-id="bcd70-298">By default, the TableAdapter s methods do not wrap the executed database statements within the scope of a transaction, but with a little work we can add methods that will create, commit, and rollback a transaction.</span></span> <span data-ttu-id="bcd70-299">Bu öğreticide `ProductsTableAdapter` sınıfında üç tür yöntem oluşturduk: `BeginTransaction`, `CommitTransaction`ve `RollbackTransaction`.</span><span class="sxs-lookup"><span data-stu-id="bcd70-299">In this tutorial we created three such methods in the `ProductsTableAdapter` class: `BeginTransaction`, `CommitTransaction`, and `RollbackTransaction`.</span></span> <span data-ttu-id="bcd70-300">Bu yöntemlerin bir dizi veri değiştirme deyimini atomik hale getirmek için bir `Try...Catch` bloğuyla birlikte nasıl kullanılacağını gördük.</span><span class="sxs-lookup"><span data-stu-id="bcd70-300">We saw how to use these methods along with a `Try...Catch` block to make a series of data modification statements atomic.</span></span> <span data-ttu-id="bcd70-301">Özellikle, sağlanan bir `ProductsDataTable`satırlarda gerekli değişiklikleri gerçekleştirmek için Batch güncelleştirme modelini kullanan `ProductsTableAdapter``UpdateWithTransaction` yöntemi oluşturduk.</span><span class="sxs-lookup"><span data-stu-id="bcd70-301">In particular, we created the `UpdateWithTransaction` method in the `ProductsTableAdapter`, which uses the Batch Update pattern to perform the necessary modifications to the rows of a supplied `ProductsDataTable`.</span></span> <span data-ttu-id="bcd70-302">Ayrıca, `DeleteProductsWithTransaction` yöntemini, giriş olarak `ProductID` değerleri `List` kabul eden ve her `Delete` için DB-Direct model yöntemini çağıran BLL içindeki `ProductsBLL` sınıfına ekledik.</span><span class="sxs-lookup"><span data-stu-id="bcd70-302">We also added the `DeleteProductsWithTransaction` method to the `ProductsBLL` class in the BLL, which accepts a `List` of `ProductID` values as its input and calls the DB-Direct pattern method `Delete` for each `ProductID`.</span></span> <span data-ttu-id="bcd70-303">Her iki yöntem de bir işlem oluşturarak ve sonra veri değiştirme deyimlerini bir `Try...Catch` bloğu içinde yürütülerek başlar.</span><span class="sxs-lookup"><span data-stu-id="bcd70-303">Both methods start by creating a transaction and then executing the data modification statements within a `Try...Catch` block.</span></span> <span data-ttu-id="bcd70-304">Bir özel durum oluşursa, işlem geri alınır, aksi takdirde işlenir.</span><span class="sxs-lookup"><span data-stu-id="bcd70-304">If an exception occurs, the transaction is rolled back, otherwise it is committed.</span></span>

<span data-ttu-id="bcd70-305">5\. adım, işlem toplu iş güncelleştirmelerinin bir işlem kullanmak için ihmal edilen toplu güncelleştirmeler ile ilgili etkisini</span><span class="sxs-lookup"><span data-stu-id="bcd70-305">Step 5 illustrated the effect of transactional batch updates versus batch updates that neglected to use a transaction.</span></span> <span data-ttu-id="bcd70-306">Sonraki üç öğreticide, bu öğreticide bulunan temel üzerine oluşturacağız ve toplu güncelleştirme, silme ve ekleme işlemlerini gerçekleştirmek için Kullanıcı arabirimleri oluşturacağız.</span><span class="sxs-lookup"><span data-stu-id="bcd70-306">In the next three tutorials we will build upon the foundation laid in this tutorial and create user interfaces for performing batch updates, deletes, and inserts.</span></span>

<span data-ttu-id="bcd70-307">Programlamanın kutlu olsun!</span><span class="sxs-lookup"><span data-stu-id="bcd70-307">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="bcd70-308">Daha Fazla Bilgi</span><span class="sxs-lookup"><span data-stu-id="bcd70-308">Further Reading</span></span>

<span data-ttu-id="bcd70-309">Bu öğreticide ele alınan konular hakkında daha fazla bilgi için aşağıdaki kaynaklara bakın:</span><span class="sxs-lookup"><span data-stu-id="bcd70-309">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="bcd70-310">Işlemlerle veritabanı tutarlılığını sürdürme</span><span class="sxs-lookup"><span data-stu-id="bcd70-310">Maintaining Database Consistency with Transactions</span></span>](http://aspnet.4guysfromrolla.com/articles/072705-1.aspx)
- [<span data-ttu-id="bcd70-311">SQL Server saklı yordamlarda Işlemleri yönetme</span><span class="sxs-lookup"><span data-stu-id="bcd70-311">Managing Transactions in SQL Server Stored Procedures</span></span>](http://www.4guysfromrolla.com/webtech/080305-1.shtml)
- [<span data-ttu-id="bcd70-312">İşlemler kolaylaştırıldı: `System.Transactions`</span><span class="sxs-lookup"><span data-stu-id="bcd70-312">Transactions Made Easy: `System.Transactions`</span></span>](https://blogs.msdn.com/florinlazar/archive/2004/07/23/192239.aspx)
- [<span data-ttu-id="bcd70-313">TransactionScope ve DataAdapter</span><span class="sxs-lookup"><span data-stu-id="bcd70-313">TransactionScope and DataAdapters</span></span>](http://andyclymer.blogspot.com/2007/01/transactionscope-and-dataadapters.html)
- [<span data-ttu-id="bcd70-314">.NET ' te Oracle Database Işlemleri kullanma</span><span class="sxs-lookup"><span data-stu-id="bcd70-314">Using Oracle Database Transactions in .NET</span></span>](http://www.oracle.com/technology/pub/articles/price_dbtrans_dotnet.html)

## <a name="about-the-author"></a><span data-ttu-id="bcd70-315">Yazar hakkında</span><span class="sxs-lookup"><span data-stu-id="bcd70-315">About the Author</span></span>

<span data-ttu-id="bcd70-316">4GuysFromRolla.com 'in, [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), yedi ASP/ASP. net books ve [](http://www.4guysfromrolla.com)'in yazarı, 1998 sürümünden bu yana Microsoft Web teknolojileriyle çalışmaktadır.</span><span class="sxs-lookup"><span data-stu-id="bcd70-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="bcd70-317">Scott bağımsız danışman, Trainer ve yazıcı olarak çalışıyor.</span><span class="sxs-lookup"><span data-stu-id="bcd70-317">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="bcd70-318">En son kitabı, [*24 saat içinde ASP.NET 2,0 kendi kendinize eğitim*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ister.</span><span class="sxs-lookup"><span data-stu-id="bcd70-318">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="bcd70-319">mitchell@4GuysFromRolla.comadresinden erişilebilir [.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="bcd70-319">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="bcd70-320">ya da blog aracılığıyla [http://ScottOnWriting.NET](http://ScottOnWriting.NET)bulabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="bcd70-320">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="bcd70-321">Özel olarak teşekkürler</span><span class="sxs-lookup"><span data-stu-id="bcd70-321">Special Thanks To</span></span>

<span data-ttu-id="bcd70-322">Bu öğretici serisi birçok yararlı gözden geçirenler tarafından incelendi.</span><span class="sxs-lookup"><span data-stu-id="bcd70-322">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="bcd70-323">Bu öğreticide lider gözden geçirenler, Gardner, Tepton Giesenow ve Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="bcd70-323">Lead reviewers for this tutorial were Dave Gardner, Hilton Giesenow, and Teresa Murphy.</span></span> <span data-ttu-id="bcd70-324">Yaklaşan MSDN makalelerimi gözden geçiriyor musunuz?</span><span class="sxs-lookup"><span data-stu-id="bcd70-324">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="bcd70-325">Öyleyse, benimitchell@4GuysFromRolla.combir satır bırakın [.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="bcd70-325">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="bcd70-326">[Önceki](batch-inserting-cs.md)
> [İleri](batch-updating-vb.md)</span><span class="sxs-lookup"><span data-stu-id="bcd70-326">[Previous](batch-inserting-cs.md)
[Next](batch-updating-vb.md)</span></span>
