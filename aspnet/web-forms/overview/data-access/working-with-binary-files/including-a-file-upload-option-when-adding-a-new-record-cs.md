---
uid: web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-cs
title: Yeni kayıt eklerken karşıya dosya yükleme seçeneği ekleme (C#) | Microsoft Docs
author: rick-anderson
description: Bu öğreticide, kullanıcının metin verileri girmesine ve ikili dosyaları yüklemesine izin veren bir Web arabirimi oluşturma işleminin nasıl yapılacağı gösterilmektedir. Kullanılabilir seçenekleri göstermek için...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: 362ade25-3965-4fb2-88d2-835c4786244f
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-cs
msc.type: authoredcontent
ms.openlocfilehash: f1287e180151b3034a7b90ef4b3f1fbe68354a09
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74576923"
---
# <a name="including-a-file-upload-option-when-adding-a-new-record-c"></a><span data-ttu-id="e1e0e-104">Yeni Kayıt Eklerken Karşıya Dosya Yükleme Seçeneği Ekleme (C#)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-104">Including a File Upload Option When Adding a New Record (C#)</span></span>

<span data-ttu-id="e1e0e-105">[Scott Mitchell](https://twitter.com/ScottOnWriting) tarafından</span><span class="sxs-lookup"><span data-stu-id="e1e0e-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e1e0e-106">[Örnek uygulamayı indirin](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_CS.exe) veya [PDF 'yi indirin](including-a-file-upload-option-when-adding-a-new-record-cs/_static/datatutorial56cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_CS.exe) or [Download PDF](including-a-file-upload-option-when-adding-a-new-record-cs/_static/datatutorial56cs1.pdf)</span></span>

> <span data-ttu-id="e1e0e-107">Bu öğreticide, kullanıcının metin verileri girmesine ve ikili dosyaları yüklemesine izin veren bir Web arabirimi oluşturma işleminin nasıl yapılacağı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-107">This tutorial shows how to create a Web interface that allows the user to both enter text data and upload binary files.</span></span> <span data-ttu-id="e1e0e-108">İkili verileri depolamak için kullanılabilen seçenekleri göstermek için, diğeri dosya sisteminde depolanırken bir dosya veritabanına kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-108">To illustrate the options available to store binary data, one file will be saved in the database while the other is stored in the file system.</span></span>

## <a name="introduction"></a><span data-ttu-id="e1e0e-109">Giriş</span><span class="sxs-lookup"><span data-stu-id="e1e0e-109">Introduction</span></span>

<span data-ttu-id="e1e0e-110">Önceki iki öğreticide, uygulama veri modeliyle ilişkili ikili verileri depolama tekniklerini araştırırken, dosyaları istemciden Web sunucusuna göndermek için dosya yükleme denetiminin nasıl kullanılacağı ve bu ikili verilerin bir veri W 'da nasıl görüntüleneceği gördünüz. EB denetimi.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-110">In the previous two tutorials we explored techniques for storing binary data that is associated with the application s data model, looked at how to use the FileUpload control to send files from the client to the web server, and saw how to present this binary data in a data Web control.</span></span> <span data-ttu-id="e1e0e-111">Yine de karşıya yüklenen verileri veri modeliyle ilişkilendirme hakkında konuşuyoruz, ancak.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-111">We ve yet to talk about how to associate uploaded data with the data model, though.</span></span>

<span data-ttu-id="e1e0e-112">Bu öğreticide, yeni bir kategori eklemek için bir Web sayfası oluşturacağız.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-112">In this tutorial we will create a web page to add a new category.</span></span> <span data-ttu-id="e1e0e-113">Kategori adı ve açıklaması için metin kutularına ek olarak, bu sayfanın yeni kategori s resmi ve bir broşür için bir tane olmak üzere iki dosya yükleme denetimini içermesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-113">In addition to TextBoxes for the category s name and description, this page will need to include two FileUpload controls one for the new category s picture and one for the brochure.</span></span> <span data-ttu-id="e1e0e-114">Karşıya yüklenen resim, yeni kayıt s `Picture` sütununda doğrudan depolanacak, ancak broşür yeni kayıt s `BrochurePath` sütununda kaydedilen dosyanın yoluyla `~/Brochures` klasöre kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-114">The uploaded picture will be stored directly in the new record s `Picture` column, whereas the brochure will be saved to the `~/Brochures` folder with the path to the file saved in the new record s `BrochurePath` column.</span></span>

<span data-ttu-id="e1e0e-115">Bu yeni Web sayfasını oluşturmadan önce mimariyi güncelleştirmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-115">Before creating this new web page, we'll need to update the architecture.</span></span> <span data-ttu-id="e1e0e-116">`CategoriesTableAdapter` s ana sorgusu `Picture` sütununu almaz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-116">The `CategoriesTableAdapter` s main query does not retrieve the `Picture` column.</span></span> <span data-ttu-id="e1e0e-117">Sonuç olarak, otomatik olarak oluşturulan `Insert` yönteminin yalnızca `CategoryName`, `Description`ve `BrochurePath` alanları için girişleri vardır.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-117">Consequently, the auto-generated `Insert` method only has inputs for the `CategoryName`, `Description`, and `BrochurePath` fields.</span></span> <span data-ttu-id="e1e0e-118">Bu nedenle, TableAdapter 'ta dört `Categories` alanı için istemde bulunan ek bir yöntem oluşturuyoruz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-118">Therefore, we need to create an additional method in the TableAdapter that prompts for all four `Categories` fields.</span></span> <span data-ttu-id="e1e0e-119">Iş mantığı katmanındaki `CategoriesBLL` sınıfının de güncellenmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-119">The `CategoriesBLL` class in the Business Logic Layer will also need to be updated.</span></span>

## <a name="step-1-adding-aninsertwithpicturemethod-to-thecategoriestableadapter"></a><span data-ttu-id="e1e0e-120">1\. Adım:`CategoriesTableAdapter``InsertWithPicture`yöntemi ekleme</span><span class="sxs-lookup"><span data-stu-id="e1e0e-120">Step 1: Adding an`InsertWithPicture`Method to the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="e1e0e-121">[Veri erişim katmanı oluşturma](../introduction/creating-a-data-access-layer-cs.md) öğreticisinde geri `CategoriesTableAdapter` oluşturduğumuz, bunu ana sorguya göre otomatik olarak `INSERT`, `UPDATE`ve `DELETE` deyimlerini oluşturacak şekilde yapılandırdık.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-121">When we created the `CategoriesTableAdapter` back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial, we configured it to automatically generate `INSERT`, `UPDATE`, and `DELETE` statements based on the main query.</span></span> <span data-ttu-id="e1e0e-122">Üstelik, TableAdapter 'ın `Insert`, `Update`ve `Delete`' i oluşturan VERITABANı doğrudan yaklaşımını benimseme konusunda talimat verdik.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-122">Moreover, we instructed the TableAdapter to employ the DB Direct approach, which created the methods `Insert`, `Update`, and `Delete`.</span></span> <span data-ttu-id="e1e0e-123">Bu yöntemler, otomatik olarak oluşturulan `INSERT`, `UPDATE`ve `DELETE` deyimlerini yürütür ve sonuç olarak ana sorgu tarafından döndürülen sütunlara göre giriş parametrelerini kabul eder.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-123">These methods execute the auto-generated `INSERT`, `UPDATE`, and `DELETE` statements and, consequently, accept input parameters based on the columns returned by the main query.</span></span> <span data-ttu-id="e1e0e-124">[Dosyaları karşıya yükleme](uploading-files-cs.md) öğreticisinde, `BrochurePath` sütununu kullanmak için `CategoriesTableAdapter` s ana sorgusunu genişlettik.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-124">In the [Uploading Files](uploading-files-cs.md) tutorial we augmented the `CategoriesTableAdapter` s main query to use the `BrochurePath` column.</span></span>

<span data-ttu-id="e1e0e-125">`CategoriesTableAdapter` s ana sorgusu `Picture` sütununa başvurmadığından, yeni bir kayıt eklememiz veya mevcut bir kaydı `Picture` sütunu için bir değer ile güncelleştirebiliriz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-125">Since the `CategoriesTableAdapter` s main query does not reference the `Picture` column, we can neither add a new record nor update an existing record with a value for the `Picture` column.</span></span> <span data-ttu-id="e1e0e-126">Bu bilgileri yakalamak için, TableAdapter 'ta ikili verilerle bir kayıt eklemek için kullanılan yeni bir yöntem oluşturabilir ya da otomatik olarak oluşturulan `INSERT` ifadesini özelleştirebiliriz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-126">In order to capture this information, we can either create a new method in the TableAdapter that is used specifically to insert a record with binary data or we can customize the auto-generated `INSERT` statement.</span></span> <span data-ttu-id="e1e0e-127">Otomatik olarak oluşturulan `INSERT` deyimin özelleştirilmesi sorunu, özelleştirmelerimizin üzerine, sihirbaz tarafından geçersiz kılınmasından risklidir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-127">The problem with customizing the auto-generated `INSERT` statement is that we risk having our customizations overwritten by the wizard.</span></span> <span data-ttu-id="e1e0e-128">Örneğin, `Picture` sütununun kullanımını dahil etmek için `INSERT` ifadesini özelleştirdiğinizi düşünün.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-128">For example, imagine that we customized the `INSERT` statement to include use of the `Picture` column.</span></span> <span data-ttu-id="e1e0e-129">Bu, TableAdapter s `Insert` yöntemini, kategori s Picture s ikili verileri için ek bir giriş parametresi içerecek şekilde güncelleştirir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-129">This would update the TableAdapter s `Insert` method to include an additional input parameter for the category s picture s binary data.</span></span> <span data-ttu-id="e1e0e-130">Daha sonra bu DAL yöntemini kullanmak için Iş mantığı katmanında bir yöntem oluşturabilir ve bu BLL metodunu sunum katmanı üzerinden çağırabilirsiniz ve her şey wonderfully çalışacaktır.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-130">We could then create a method in the Business Logic Layer to use this DAL method and invoke this BLL method through the Presentation Layer, and everything would work wonderfully.</span></span> <span data-ttu-id="e1e0e-131">Diğer bir deyişle, TableAdapter Yapılandırma Sihirbazı aracılığıyla TableAdapter 'ı yapılandırdığımızda.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-131">That is, until the next time we configured the TableAdapter through the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="e1e0e-132">Sihirbaz tamamlandıktan hemen sonra, `INSERT` deyimindeki özelleştirmelerimiz üzerine yazılır, `Insert` yöntemi eski biçimine döndürülür ve kodumuz artık derlenmeyebilir!</span><span class="sxs-lookup"><span data-stu-id="e1e0e-132">As soon as the wizard completed, our customizations to the `INSERT` statement would be overwritten, the `Insert` method would revert to its old form, and our code would no longer compile!</span></span>

> [!NOTE]
> <span data-ttu-id="e1e0e-133">Bu annoyance, ad-hoc SQL deyimleri yerine saklı yordamlar kullanılırken bir sorun değildir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-133">This annoyance is a non-issue when using stored procedures instead of ad-hoc SQL statements.</span></span> <span data-ttu-id="e1e0e-134">Gelecekteki bir öğreticide, veri erişim katmanında geçici SQL deyimleri yerine saklı yordamlar kullanılarak araştırılacak.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-134">A future tutorial will explore using stored procedures in lieu of ad-hoc SQL statements in the Data Access Layer.</span></span>

<span data-ttu-id="e1e0e-135">Bunun yerine, otomatik olarak oluşturulan SQL deyimlerini özelleştirmek yerine, bu olası headache 'i önlemek için TableAdapter için yeni bir yöntem oluşturun.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-135">To avoid this potential headache, rather than customizing the auto-generated SQL statements let s instead create a new method for the TableAdapter.</span></span> <span data-ttu-id="e1e0e-136">`InsertWithPicture`adlı bu yöntem, `CategoryName`, `Description`, `BrochurePath`ve `Picture` sütunlarının değerlerini kabul eder ve tüm dört değeri yeni bir kayıtta depolayan bir `INSERT` ifadesini yürütür.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-136">This method, named `InsertWithPicture`, will accept values for the `CategoryName`, `Description`, `BrochurePath`, and `Picture` columns and execute an `INSERT` statement that stores all four values in a new record.</span></span>

<span data-ttu-id="e1e0e-137">Türü belirtilmiş veri kümesini açın ve tasarımcıdan `CategoriesTableAdapter` s başlığına sağ tıklayıp bağlam menüsünden sorgu Ekle ' yi seçin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-137">Open the Typed DataSet and, from the Designer, right-click on the `CategoriesTableAdapter` s header and choose Add Query from the context menu.</span></span> <span data-ttu-id="e1e0e-138">Bu, TableAdapter sorgusunun veritabanına nasıl erişmesi gerektiğini bize sorarak başlayan TableAdapter sorgu Yapılandırma Sihirbazı 'nı başlatır.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-138">This launches the TableAdapter Query Configuration Wizard, which begins by asking us how the TableAdapter query should access the database.</span></span> <span data-ttu-id="e1e0e-139">SQL deyimlerini kullan ' ı seçin ve Ileri ' ye tıklayın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-139">Choose Use SQL statements and click Next.</span></span> <span data-ttu-id="e1e0e-140">Sonraki adım, oluşturulacak sorgu türünü sorar.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-140">The next step prompts for the type of query to be generated.</span></span> <span data-ttu-id="e1e0e-141">`Categories` tabloya yeni bir kayıt eklemek için bir sorgu oluşturduğumuz için, Ekle ' yi seçin ve Ileri ' ye tıklayın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-141">Since we re creating a query to add a new record to the `Categories` table, choose INSERT and click Next.</span></span>

<span data-ttu-id="e1e0e-142">[![Ekle seçeneğini belirleyin](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-142">[![Select the INSERT Option](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.png)</span></span>

<span data-ttu-id="e1e0e-143">**Şekil 1**: Ekle seçeneğini belirleyin ([tam boyutlu görüntüyü görüntülemek için tıklayın](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="e1e0e-143">**Figure 1**: Select the INSERT Option ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.png))</span></span>

<span data-ttu-id="e1e0e-144">Artık `INSERT` SQL ifadesini belirtmemiz gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-144">We now need to specify the `INSERT` SQL statement.</span></span> <span data-ttu-id="e1e0e-145">Sihirbaz, TableAdapter s ana sorgusuna karşılık gelen bir `INSERT` ifadesini otomatik olarak önerir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-145">The wizard automatically suggests an `INSERT` statement corresponding to the TableAdapter s main query.</span></span> <span data-ttu-id="e1e0e-146">Bu durumda, `CategoryName`, `Description`ve `BrochurePath` değerlerini ekleyen bir `INSERT` deyimidir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-146">In this case, it s an `INSERT` statement that inserts the `CategoryName`, `Description`, and `BrochurePath` values.</span></span> <span data-ttu-id="e1e0e-147">`Picture` sütunun bir `@Picture` parametresiyle birlikte dahil edilmesini sağlamak için ifadeyi güncelleştirin, örneğin:</span><span class="sxs-lookup"><span data-stu-id="e1e0e-147">Update the statement so that the `Picture` column is included along with a `@Picture` parameter, like so:</span></span>

[!code-sql[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample1.sql)]

<span data-ttu-id="e1e0e-148">Sihirbazın son ekranında yeni TableAdapter metodunu adlandırma bize sorulur.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-148">The final screen of the wizard asks us to name the new TableAdapter method.</span></span> <span data-ttu-id="e1e0e-149">`InsertWithPicture` girin ve son ' a tıklayın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-149">Enter `InsertWithPicture` and click Finish.</span></span>

<span data-ttu-id="e1e0e-150">[![yeni TableAdapter metodunu ınsertwithpicture olarak adlandırın](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-150">[![Name the New TableAdapter Method InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.png)</span></span>

<span data-ttu-id="e1e0e-151">**Şekil 2**: yeni TableAdapter metodunu adlandırma `InsertWithPicture` ([tam boyutlu görüntüyü görüntülemek için tıklayın](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="e1e0e-151">**Figure 2**: Name the New TableAdapter Method `InsertWithPicture` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.png))</span></span>

## <a name="step-2-updating-the-business-logic-layer"></a><span data-ttu-id="e1e0e-152">2\. Adım: Iş mantığı katmanını güncelleştirme</span><span class="sxs-lookup"><span data-stu-id="e1e0e-152">Step 2: Updating the Business Logic Layer</span></span>

<span data-ttu-id="e1e0e-153">Sunum katmanı yalnızca veri erişim katmanına doğrudan gitmek yerine yalnızca Iş mantığı katmanıyla arabirim gerektirdiğinden, yeni oluşturduğumuz DAL yöntemini (`InsertWithPicture`) çağıran bir BLL yöntemi oluşturuyoruz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-153">Since the Presentation Layer should only interface with the Business Logic Layer rather than bypassing it to go directly to the Data Access Layer, we need to create a BLL method that invokes the DAL method we just created (`InsertWithPicture`).</span></span> <span data-ttu-id="e1e0e-154">Bu öğreticide, giriş üç `string` ve bir `byte` dizisi olarak kabul eden `InsertWithPicture` adlı `CategoriesBLL` sınıfında bir yöntem oluşturun.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-154">For this tutorial, create a method in the `CategoriesBLL` class named `InsertWithPicture` that accepts as input three `string` s and a `byte` array.</span></span> <span data-ttu-id="e1e0e-155">`string` giriş parametreleri, kategori s adı, açıklaması ve broşür dosya yolu için, `byte` dizisi ise kategori s resminin ikili içeriğine yöneliktir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-155">The `string` input parameters are for the category s name, description, and brochure file path, while the `byte` array is for the binary contents of the category s picture.</span></span> <span data-ttu-id="e1e0e-156">Aşağıdaki kodda gösterildiği gibi, bu BLL yöntemi karşılık gelen DAL yöntemini çağırır:</span><span class="sxs-lookup"><span data-stu-id="e1e0e-156">As the following code shows, this BLL method invokes the corresponding DAL method:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample2.cs)]

> [!NOTE]
> <span data-ttu-id="e1e0e-157">`InsertWithPicture` metodunu BLL 'e eklemeden önce, yazılan veri kümesini kaydettiğinizden emin olun.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-157">Make sure that you have saved the Typed DataSet before adding the `InsertWithPicture` method to the BLL.</span></span> <span data-ttu-id="e1e0e-158">`CategoriesTableAdapter` sınıfı kodu, türü belirtilmiş veri kümesine göre otomatik olarak oluşturulduğundan, yaptığınız değişiklikleri ilk olarak yazılan veri kümesine kaydedemezsiniz `Adapter` özelliği `InsertWithPicture` yöntemi hakkında bilgi vermez.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-158">Since the `CategoriesTableAdapter` class code is auto-generated based on the Typed DataSet, if you don t first save your changes to the Typed DataSet the `Adapter` property won't know about the `InsertWithPicture` method.</span></span>

## <a name="step-3-listing-the-existing-categories-and-their-binary-data"></a><span data-ttu-id="e1e0e-159">3\. Adım: mevcut kategorileri ve bunların Ikili verilerini listeleme</span><span class="sxs-lookup"><span data-stu-id="e1e0e-159">Step 3: Listing the Existing Categories and their Binary Data</span></span>

<span data-ttu-id="e1e0e-160">Bu öğreticide, son kullanıcının sisteme yeni bir kategori eklemesine izin veren bir sayfa oluşturacak ve yeni kategori için bir resim ve broşür sağlamamız gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-160">In this tutorial we will create a page that allows an end user to add a new category to the system, providing a picture and brochure for the new category.</span></span> <span data-ttu-id="e1e0e-161">[Önceki öğreticide](displaying-binary-data-in-the-data-web-controls-cs.md) , her bir kategorinin adını, açıklamasını, resmini ve bir bağlantıyı, onun broşürini indirmek için bir bağlantı görüntüleyecek bir TemplateField ve ImageField Içeren bir GridView kullandık.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-161">In the [preceding tutorial](displaying-binary-data-in-the-data-web-controls-cs.md) we used a GridView with a TemplateField and ImageField to display each category s name, description, picture, and a link to download its brochure.</span></span> <span data-ttu-id="e1e0e-162">Bu öğreticide, her iki mevcut kategoriyi listeleyen ve yenilerini oluşturulmasına izin veren bir sayfa oluşturmak için bu işlevselliği çoğaltmasına izin verin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-162">Let s replicate that functionality for this tutorial, creating a page that both lists all existing categories and allows for new ones to be created.</span></span>

<span data-ttu-id="e1e0e-163">`BinaryData` klasöründen `DisplayOrDownload.aspx` sayfasını açarak başlayın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-163">Start by opening the `DisplayOrDownload.aspx` page from the `BinaryData` folder.</span></span> <span data-ttu-id="e1e0e-164">Kaynak görünümüne gidin ve GridView ve ObjectDataSource öğelerinin bildirime dayalı sözdizimini kopyalayın ve `UploadInDetailsView.aspx``<asp:Content>` öğesi içinde yapıştırın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-164">Go to the Source view and copy the GridView and ObjectDataSource s declarative syntax, pasting it within the `<asp:Content>` element in `UploadInDetailsView.aspx`.</span></span> <span data-ttu-id="e1e0e-165">Ayrıca, `DisplayOrDownload.aspx` arka plan kod sınıfından `UploadInDetailsView.aspx``GenerateBrochureLink` yöntemi kopyalamayı unutmayın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-165">Also, don t forget to copy over the `GenerateBrochureLink` method from the code-behind class of `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx`.</span></span>

<span data-ttu-id="e1e0e-166">[![DisplayOrDownload. aspx konumundan Uploadındetailsview. aspx ' e bildirim temelli sözdizimini kopyalayıp yapıştırın](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-166">[![Copy and Paste the Declarative Syntax from DisplayOrDownload.aspx to UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.png)</span></span>

<span data-ttu-id="e1e0e-167">**Şekil 3**: `DisplayOrDownload.aspx` bildirime dayalı sözdizimini kopyalayıp `UploadInDetailsView.aspx` yapıştırın ([tam boyutlu görüntüyü görüntülemek için tıklayın](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="e1e0e-167">**Figure 3**: Copy and Paste the Declarative Syntax from `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.png))</span></span>

<span data-ttu-id="e1e0e-168">Bildirim temelli sözdizimini ve `GenerateBrochureLink` yöntemini `UploadInDetailsView.aspx` sayfasına kopyaladıktan sonra, her şeyin doğru şekilde kopyalandığından emin olmak için sayfayı bir tarayıcı üzerinden görüntüleyin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-168">After copying the declarative syntax and `GenerateBrochureLink` method over to the `UploadInDetailsView.aspx` page, view the page through a browser to ensure that everything was copied over correctly.</span></span> <span data-ttu-id="e1e0e-169">Broşür ve kategori s resmini indirmek için bir bağlantı içeren sekiz kategorinin listelendiği bir GridView görmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-169">You should see a GridView listing the eight categories that includes a link to download the brochure as well as the category s picture.</span></span>

<span data-ttu-id="e1e0e-170">[![her kategoriyi Ikili verilerle birlikte görmeniz gerekir](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-170">[![You Should Now See Each Category Along with Its Binary Data](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.png)</span></span>

<span data-ttu-id="e1e0e-171">**Şekil 4**: artık her kategoriyi Ikili verilerle birlikte görmeniz gerekir ([tam boyutlu görüntüyü görüntülemek için tıklayın](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="e1e0e-171">**Figure 4**: You Should Now See Each Category Along with Its Binary Data ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.png))</span></span>

## <a name="step-4-configuring-thecategoriesdatasourceto-support-inserting"></a><span data-ttu-id="e1e0e-172">4\. Adım: eklemeyi desteklemek için`CategoriesDataSource`yapılandırma</span><span class="sxs-lookup"><span data-stu-id="e1e0e-172">Step 4: Configuring the`CategoriesDataSource`to Support Inserting</span></span>

<span data-ttu-id="e1e0e-173">`Categories` GridView tarafından kullanılan `CategoriesDataSource` ObjectDataSource Şu anda veri ekleme özelliği sağlamıyor.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-173">The `CategoriesDataSource` ObjectDataSource used by the `Categories` GridView currently does not provide the ability to insert data.</span></span> <span data-ttu-id="e1e0e-174">Bu veri kaynağı denetimini eklemeyi desteklemek için, `Insert` yöntemini temel alınan nesnesindeki bir yönteme eşliyoruz gerekir, `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-174">In order to support inserting through this data source control, we need to map its `Insert` method to a method in its underlying object, `CategoriesBLL`.</span></span> <span data-ttu-id="e1e0e-175">Özellikle, bu dosyayı adım 2 ' de geri eklediğimiz `CategoriesBLL` yöntemiyle eşlemek istiyoruz `InsertWithPicture`.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-175">In particular, we want to map it to the `CategoriesBLL` method we added back in Step 2, `InsertWithPicture`.</span></span>

<span data-ttu-id="e1e0e-176">Başlat ' ın akıllı etiketinden veri kaynağını Yapılandır bağlantısına tıklayarak başlayın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-176">Start by clicking the Configure Data Source link from the ObjectDataSource s smart tag.</span></span> <span data-ttu-id="e1e0e-177">İlk ekranda, veri kaynağının ile birlikte çalışmak üzere yapılandırıldığı nesne gösterilir `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-177">The first screen shows the object the data source is configured to work with, `CategoriesBLL`.</span></span> <span data-ttu-id="e1e0e-178">Bu ayarı olduğu gibi bırakın ve veri yöntemlerini tanımla ekranına ilerlemek için Ileri ' ye tıklayın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-178">Leave this setting as-is and click Next to advance to the Define Data Methods screen.</span></span> <span data-ttu-id="e1e0e-179">Ekle sekmesine gidin ve açılan listeden `InsertWithPicture` yöntemini seçin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-179">Move to the INSERT tab and pick the `InsertWithPicture` method from the drop-down list.</span></span> <span data-ttu-id="e1e0e-180">Sihirbazı tamamladığınızda son ' a tıklayın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-180">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="e1e0e-181">[![ınsertwithpicture metodunu kullanmak için ObjectDataSource 'ı yapılandırma](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-181">[![Configure the ObjectDataSource to use the InsertWithPicture Method](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.png)</span></span>

<span data-ttu-id="e1e0e-182">**Şekil 5**: `InsertWithPicture` yöntemini kullanmak için ObjectDataSource 'ı yapılandırın ([tam boyutlu görüntüyü görüntülemek için tıklayın](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="e1e0e-182">**Figure 5**: Configure the ObjectDataSource to use the `InsertWithPicture` Method ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.png))</span></span>

> [!NOTE]
> <span data-ttu-id="e1e0e-183">Sihirbaz tamamlandıktan sonra Visual Studio, veri Web denetimleri alanlarını yeniden oluşturacak alanları ve anahtarları yenilemek isteyip istemediğinizi sorabilir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-183">Upon completing the wizard, Visual Studio may ask if you want to Refresh Fields and Keys, which will regenerate the data Web controls fields.</span></span> <span data-ttu-id="e1e0e-184">Evet ' i seçmek, yapmış olduğunuz tüm alan özelleştirmelerinin üzerine yazacak şekilde Hayır ' ı seçin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-184">Choose No, because choosing Yes will overwrite any field customizations you may have made.</span></span>

<span data-ttu-id="e1e0e-185">Sihirbazı tamamladıktan sonra, ObjectDataSource artık `InsertMethod` özelliği için bir değer ve dört Kategori sütunu için `InsertParameters` ve aşağıdaki bildirime dayalı biçimlendirme gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="e1e0e-185">After completing the wizard, the ObjectDataSource will now include a value for its `InsertMethod` property as well as `InsertParameters` for the four category columns, as the following declarative markup illustrates:</span></span>

[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample3.aspx)]

## <a name="step-5-creating-the-inserting-interface"></a><span data-ttu-id="e1e0e-186">5\. Adım: ekleme arabirimi oluşturma</span><span class="sxs-lookup"><span data-stu-id="e1e0e-186">Step 5: Creating the Inserting Interface</span></span>

<span data-ttu-id="e1e0e-187">[Veri ekleme, güncelleştirme ve silme konusunda genel bakış](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)kapsamında, DetailsView denetimi, eklemeyi destekleyen bir veri kaynağı denetimiyle çalışırken kullanılabilecek bir yerleşik ekleme arabirimi sağlar.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-187">As first covered in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md), the DetailsView control provides a built-in inserting interface that can be utilized when working with a data source control that supports inserting.</span></span> <span data-ttu-id="e1e0e-188">Ekleme arabirimini kalıcı olarak işleyecek GridView 'un bu sayfaya bir DetailsView denetimi ekleyelim, böylece bir kullanıcının kolayca yeni bir kategori eklemesine izin verilir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-188">Let s add a DetailsView control to this page above the GridView that will permanently render its inserting interface, allowing a user to quickly add a new category.</span></span> <span data-ttu-id="e1e0e-189">DetailsView 'a yeni bir kategori eklendiğinde, bunun altındaki GridView otomatik olarak yenilenir ve yeni kategoriyi görüntüler.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-189">Upon adding a new category in the DetailsView, the GridView beneath it will automatically refresh and display the new category.</span></span>

<span data-ttu-id="e1e0e-190">Araç kutusundan GridView 'un üzerindeki tasarımcı üzerine bir DetailsView sürükleyip `ID` özelliğini `NewCategory` ve `Height` ve `Width` özellik değerlerini temizleyerek başlatın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-190">Start by dragging a DetailsView from the Toolbox onto the Designer above the GridView, setting its `ID` property to `NewCategory` and clearing out the `Height` and `Width` property values.</span></span> <span data-ttu-id="e1e0e-191">DetailsView 'un akıllı etiketinde, mevcut `CategoriesDataSource` bağlayın ve sonra eklemeyi etkinleştir onay kutusunu işaretleyin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-191">From the DetailsView s smart tag, bind it to the existing `CategoriesDataSource` and then check the Enable Inserting checkbox.</span></span>

<span data-ttu-id="e1e0e-192">[DetailsView öğesini Kategorilerverikaynağına bağlamak ve ekleme özelliğini etkinleştirmek ![](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-192">[![Bind the DetailsView to the CategoriesDataSource and Enable Inserting](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.png)</span></span>

<span data-ttu-id="e1e0e-193">**Şekil 6**: DetailsView 'ı `CategoriesDataSource` bağlayın ve eklemeyi etkinleştirin ([tam boyutlu görüntüyü görüntülemek için tıklayın](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="e1e0e-193">**Figure 6**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image12.png))</span></span>

<span data-ttu-id="e1e0e-194">DetailsView 'u ekleme arabiriminde kalıcı olarak işlemek için `DefaultMode` özelliğini `Insert`olarak ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-194">To permanently render the DetailsView in its inserting interface, set its `DefaultMode` property to `Insert`.</span></span>

<span data-ttu-id="e1e0e-195">DetailsView 'un `BrochurePath` özelliği `CategoryID` olarak ayarlandığı için, `InsertVisible` BoundField `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`ve `false`beş BoundFields olduğunu unutmayın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-195">Note that the DetailsView has five BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` although the `CategoryID` BoundField is not rendered in the inserting interface because its `InsertVisible` property is set to `false`.</span></span> <span data-ttu-id="e1e0e-196">Bu BoundFields, ObjectDataSource 'un verileri almak için çağırdığı `GetCategories()` yöntemi tarafından döndürülen sütunlar olduklarından oluşur.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-196">These BoundFields exists because they are the columns returned by the `GetCategories()` method, which is what the ObjectDataSource invokes to retrieve its data.</span></span> <span data-ttu-id="e1e0e-197">Bununla birlikte, ekleme için kullanıcının `NumberOfProducts`bir değer belirtmesini istiyorum.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-197">For inserting, however, we don t want to let the user specify a value for `NumberOfProducts`.</span></span> <span data-ttu-id="e1e0e-198">Üstelik, bu kullanıcıların yeni kategori için bir resim yüklemesine ve broşür için bir PDF 'YI karşıya yüklemesine izin vermemiz gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-198">Moreover, we need to allow them to upload a picture for the new category as well as upload a PDF for the brochure.</span></span>

<span data-ttu-id="e1e0e-199">DetailsView `NumberOfProducts` BoundField öğesini tamamen kaldırın ve ardından `CategoryName` ve `BrochurePath` BoundFields `HeaderText` özelliklerini sırasıyla kategori ve broşür olarak güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-199">Remove the `NumberOfProducts` BoundField from the DetailsView altogether and then update the `HeaderText` properties of the `CategoryName` and `BrochurePath` BoundFields to Category and Brochure, respectively.</span></span> <span data-ttu-id="e1e0e-200">Sonra, `BrochurePath` BoundField öğesini TemplateField öğesine dönüştürün ve resme yeni bir TemplateField ekleyin, bu yeni TemplateField değerini bir resim `HeaderText` olarak verir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-200">Next, convert the `BrochurePath` BoundField into a TemplateField and add a new TemplateField for the picture, giving this new TemplateField a `HeaderText` value of Picture.</span></span> <span data-ttu-id="e1e0e-201">`Picture` TemplateField alanını `BrochurePath` TemplateField ve CommandField arasında olacak şekilde taşıyın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-201">Move the `Picture` TemplateField so that it is between the `BrochurePath` TemplateField and CommandField.</span></span>

![DetailsView 'u Kategorilerverikaynağına bağlayın ve eklemeyi etkinleştirin](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.gif)

<span data-ttu-id="e1e0e-203">**Şekil 7**: DetailsView 'ı `CategoriesDataSource` bağlayın ve eklemeyi etkinleştirin</span><span class="sxs-lookup"><span data-stu-id="e1e0e-203">**Figure 7**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting</span></span>

<span data-ttu-id="e1e0e-204">Alanları Düzenle iletişim kutusu aracılığıyla `BrochurePath` BoundField öğesini bir TemplateField 'a dönüştürdüyseniz, TemplateField bir `ItemTemplate`, `EditItemTemplate`ve `InsertItemTemplate`içerir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-204">If you converted the `BrochurePath` BoundField into a TemplateField through the Edit Fields dialog box, the TemplateField includes an `ItemTemplate`, `EditItemTemplate`, and `InsertItemTemplate`.</span></span> <span data-ttu-id="e1e0e-205">Ancak yalnızca `InsertItemTemplate` gereklidir, bu nedenle diğer iki şablonu kaldırmayı ücretsiz olarak hissetmekten çekinmeyin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-205">Only the `InsertItemTemplate` is needed, however, so feel free to remove the other two templates.</span></span> <span data-ttu-id="e1e0e-206">Bu noktada, DetailsView 'un bildirime dayalı sözdizimi aşağıdaki gibi görünmelidir:</span><span class="sxs-lookup"><span data-stu-id="e1e0e-206">At this point your DetailsView s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample4.aspx)]

## <a name="adding-fileupload-controls-for-the-brochure-and-picture-fields"></a><span data-ttu-id="e1e0e-207">Broşür ve resim alanları için dosya yükleme denetimleri ekleme</span><span class="sxs-lookup"><span data-stu-id="e1e0e-207">Adding FileUpload Controls for the Brochure and Picture Fields</span></span>

<span data-ttu-id="e1e0e-208">Şu anda `BrochurePath` TemplateField `InsertItemTemplate` bir TextBox içerir, ancak `Picture` TemplateField herhangi bir şablon içermez.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-208">Presently, the `BrochurePath` TemplateField s `InsertItemTemplate` contains a TextBox, while the `Picture` TemplateField does not contain any templates.</span></span> <span data-ttu-id="e1e0e-209">Bu iki TemplateField s `InsertItemTemplate`, dosya yükleme denetimlerini kullanacak şekilde güncelleştirmemiz gerekiyor.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-209">We need to update these two TemplateField s `InsertItemTemplate` s to use FileUpload controls.</span></span>

<span data-ttu-id="e1e0e-210">DetailsView 'un akıllı etiketinde Şablonları Düzenle seçeneğini belirleyin ve ardından açılan listeden `BrochurePath` TemplateField `InsertItemTemplate` ' ı seçin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-210">From the DetailsView s smart tag, choose the Edit Templates option and then select the `BrochurePath` TemplateField s `InsertItemTemplate` from the drop-down list.</span></span> <span data-ttu-id="e1e0e-211">TextBox ' ı kaldırın ve ardından araç kutusundan bir dosya yükleme denetimini şablona sürükleyin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-211">Remove the TextBox and then drag a FileUpload control from the Toolbox into the template.</span></span> <span data-ttu-id="e1e0e-212">Dosya karşıya yükleme denetim s `ID` `BrochureUpload`olarak ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-212">Set the FileUpload control s `ID` to `BrochureUpload`.</span></span> <span data-ttu-id="e1e0e-213">Benzer şekilde, `Picture` TemplateField s `InsertItemTemplate`bir dosya karşıya yükleme denetimi ekleyin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-213">Similarly, add a FileUpload control to the `Picture` TemplateField s `InsertItemTemplate`.</span></span> <span data-ttu-id="e1e0e-214">Bu dosya yükleme denetim s `ID` `PictureUpload`olarak ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-214">Set this FileUpload control s `ID` to `PictureUpload`.</span></span>

<span data-ttu-id="e1e0e-215">[InsertItemTemplate 'e dosya yükleme denetimi ekleme ![](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-215">[![Add a FileUpload Control to the InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image13.png)</span></span>

<span data-ttu-id="e1e0e-216">**Şekil 8**: `InsertItemTemplate` bir dosya yükleme denetimi ekleme ([tam boyutlu görüntüyü görüntülemek için tıklayın](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="e1e0e-216">**Figure 8**: Add a FileUpload Control to the `InsertItemTemplate` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image14.png))</span></span>

<span data-ttu-id="e1e0e-217">Bu eklemeleri yaptıktan sonra, iki TemplateField bildirim sözdizimi şu şekilde olur:</span><span class="sxs-lookup"><span data-stu-id="e1e0e-217">After making these additions, the two TemplateField s declarative syntax will be:</span></span>

[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample5.aspx)]

<span data-ttu-id="e1e0e-218">Bir Kullanıcı yeni bir kategori eklediğinde, broşür ve resmin doğru dosya türünde olduğundan emin olmak istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-218">When a user adds a new category, we want to ensure that the brochure and picture are of the correct file type.</span></span> <span data-ttu-id="e1e0e-219">Broşür için kullanıcının bir PDF sağlaması gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-219">For the brochure, the user must supply a PDF.</span></span> <span data-ttu-id="e1e0e-220">Resimde, kullanıcının bir resim dosyasını karşıya yüklemesi gerekir, ancak *herhangi* bir görüntü dosyası ya da yalnızca belirli bir türdeki (örneğin, GIF 'Ler veya jpgs) görüntü dosyaları izin veririz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-220">For the picture, we need the user to upload an image file, but do we allow *any* image file or only image files of a particular type, such as GIFs or JPGs?</span></span> <span data-ttu-id="e1e0e-221">Farklı dosya türlerine izin vermek için, `Categories` şemayı, bu türün `DisplayCategoryPicture.aspx`içindeki `Response.ContentType` aracılığıyla istemciye gönderilebilmesi için dosya türünü yakalayan bir sütun içerecek şekilde genişletmemiz gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-221">In order to allow for different file types, we d need to extend the `Categories` schema to include a column that captures the file type so that this type can be sent to the client through `Response.ContentType` in `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="e1e0e-222">Böyle bir sütun olmadığı için, kullanıcıların yalnızca belirli bir görüntü dosyası türü sağlaması için akıllıca olur.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-222">Since we don t have such a column, it would be prudent to restrict users to only providing a specific image file type.</span></span> <span data-ttu-id="e1e0e-223">`Categories` tablo var olan görüntüler bit eşlemlerdir, ancak JPGs Web üzerinden sunulan görüntüler için daha uygun bir dosya biçimidir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-223">The `Categories` table s existing images are bitmaps, but JPGs are a more appropriate file format for images served over the web.</span></span>

<span data-ttu-id="e1e0e-224">Bir Kullanıcı yanlış bir dosya türünü karşıya yüklediğinde, eklemeyi iptal etmemiz ve sorunu belirten bir ileti görüntülemesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-224">If a user uploads an incorrect file type, we need to cancel the insert and display a message indicating the problem.</span></span> <span data-ttu-id="e1e0e-225">DetailsView 'un altına bir etiket Web denetimi ekleyin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-225">Add a Label Web control beneath the DetailsView.</span></span> <span data-ttu-id="e1e0e-226">`ID` özelliğini `UploadWarning`olarak ayarlayın, `Text` özelliğini temizleyin, `CssClass` özelliğini uyarı olarak ayarlayın ve `Visible` ve `EnableViewState` özelliklerini `false`.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-226">Set its `ID` property to `UploadWarning`, clear out its `Text` property, set the `CssClass` property to Warning, and the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="e1e0e-227">`Warning` CSS sınıfı `Styles.css` tanımlanır ve metni büyük, kırmızı, italik, kalın yazı tipiyle işler.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-227">The `Warning` CSS class is defined in `Styles.css` and renders the text in a large, red, italicized, bold font.</span></span>

> [!NOTE]
> <span data-ttu-id="e1e0e-228">İdeal olarak, `CategoryName` ve `Description` BoundFields alanları TemplateFields 'e, eklenen arabirimleri de özelleştirilmiş olarak dönüştürülür.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-228">Ideally, the `CategoryName` and `Description` BoundFields would be converted to TemplateFields and their inserting interfaces customized.</span></span> <span data-ttu-id="e1e0e-229">Örneğin, `Description` ekleme arabirimi, büyük olasılıkla çok satırlı bir metin kutusuyla daha uygun olabilir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-229">The `Description` inserting interface, for example, would likely be better suited through a multi-line textbox.</span></span> <span data-ttu-id="e1e0e-230">`CategoryName` sütunu `NULL` değerlerini kabul etmediğinden, kullanıcının yeni kategori s adı için bir değer sağladığından emin olmak için bir RequiredFieldValidator eklenmelidir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-230">And since the `CategoryName` column does not accept `NULL` values, a RequiredFieldValidator should be added to ensure the user provides a value for the new category s name.</span></span> <span data-ttu-id="e1e0e-231">Bu adımlar, okuyucuya bir alıştırma olarak kalır.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-231">These steps are left as an exercise to the reader.</span></span> <span data-ttu-id="e1e0e-232">Veri değiştirme arabirimlerini genişletmekten derinlemesine bir bakış için [veri değiştirme arabirimini özelleştirmek](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) üzere geri bakın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-232">Refer back to [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) for an in-depth look at augmenting the data modification interfaces.</span></span>

## <a name="step-6-saving-the-uploaded-brochure-to-the-web-server-s-file-system"></a><span data-ttu-id="e1e0e-233">6\. Adım: karşıya yüklenen broşürü Web sunucusu s dosya sistemine kaydetme</span><span class="sxs-lookup"><span data-stu-id="e1e0e-233">Step 6: Saving the Uploaded Brochure to the Web Server s File System</span></span>

<span data-ttu-id="e1e0e-234">Kullanıcı yeni bir kategorinin değerlerini girdiğinde ve Ekle düğmesine tıkladığında, bir geri gönderme gerçekleşir ve iş akışı kaldırılıyor.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-234">When the user enters the values for a new category and clicks the Insert button, a postback occurs and the inserting workflow unfolds.</span></span> <span data-ttu-id="e1e0e-235">İlk olarak, DetailsView [`ItemInserting` olayı](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) ateşlenir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-235">First, the DetailsView s [`ItemInserting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) fires.</span></span> <span data-ttu-id="e1e0e-236">Ardından, ObjectDataSource s `Insert()` yöntemi çağrılır ve bu, `Categories` tablosuna yeni bir kaydın eklenmesine neden olur.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-236">Next, the ObjectDataSource s `Insert()` method is invoked, which results in a new record being added to the `Categories` table.</span></span> <span data-ttu-id="e1e0e-237">Bundan sonra, DetailsView [`ItemInserted` olayı](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) ateşlenir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-237">After that, the DetailsView s [`ItemInserted` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) fires.</span></span>

<span data-ttu-id="e1e0e-238">ObjectDataSource `Insert()` yöntemi çağrılmadan önce, önce uygun dosya türlerinin Kullanıcı tarafından karşıya yüklendiğinden emin olunması ve sonra Broşür PDF 'YI Web sunucusu s dosya sistemine kaydetmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-238">Before the ObjectDataSource s `Insert()` method is invoked, we must first ensure that the appropriate file types were uploaded by the user and then save the brochure PDF to the web server s file system.</span></span> <span data-ttu-id="e1e0e-239">DetailsView `ItemInserting` olayı için bir olay işleyicisi oluşturun ve aşağıdaki kodu ekleyin:</span><span class="sxs-lookup"><span data-stu-id="e1e0e-239">Create an event handler for the DetailsView s `ItemInserting` event and add the following code:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample6.cs)]

<span data-ttu-id="e1e0e-240">Olay işleyicisi, DetailsView 'un şablonlarından `BrochureUpload` FileUpload denetimine başvurulduğunda başlar.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-240">The event handler starts by referencing the `BrochureUpload` FileUpload control from the DetailsView s templates.</span></span> <span data-ttu-id="e1e0e-241">Daha sonra, bir broşür karşıya yüklenmişse karşıya yüklenen dosya uzantıları incelenir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-241">Then, if a brochure has been uploaded, the uploaded file s extension is examined.</span></span> <span data-ttu-id="e1e0e-242">Uzantı yoksa. PDF, sonra bir uyarı görüntülenir, ekleme iptal edilir ve olay işleyicisinin yürütülmesi sona erer.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-242">If the extension is not .PDF, then a warning is displayed, the insert is cancelled, and the execution of the event handler ends.</span></span>

> [!NOTE]
> <span data-ttu-id="e1e0e-243">Karşıya yüklenen dosya uzantısına bağlı olarak, karşıya yüklenen dosyanın bir PDF belgesi olduğundan emin olmak için bir,-Fire yöntemi değildir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-243">Relying on the uploaded file s extension is not a sure-fire technique for ensuring that the uploaded file is a PDF document.</span></span> <span data-ttu-id="e1e0e-244">Kullanıcının uzantısı `.Brochure`geçerli bir PDF belgesi olabilir ya da PDF olmayan bir belge alınmış ve bir `.pdf` uzantısı vermiş olabilir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-244">The user could have a valid PDF document with the extension `.Brochure`, or could have taken a non-PDF document and given it a `.pdf` extension.</span></span> <span data-ttu-id="e1e0e-245">Dosya türünü daha yaratacağı doğrulamak için dosyanın ikili içeriğinin programlı bir şekilde incelenmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-245">The file s binary content would need to be programmatically examined in order to more conclusively verify the file type.</span></span> <span data-ttu-id="e1e0e-246">Ancak, bu tür kapsamlı yaklaşımlar genellikle fazla sonlandırılmalıdır; uzantının çoğu senaryo için yeterli olup olmadığı denetleniyor.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-246">Such thorough approaches, though, are often overkill; checking the extension is sufficient for most scenarios.</span></span>

<span data-ttu-id="e1e0e-247">[Dosyaları karşıya](uploading-files-cs.md) yükleme öğreticisinde açıklandığı gibi, bir kullanıcının karşıya yüklenmesi başka bir veritabanının üzerine yazılmaması için dosyaları dosya sistemine kaydederken dikkatli olunmalıdır.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-247">As discussed in the [Uploading Files](uploading-files-cs.md) tutorial, care must be taken when saving files to the file system so that one user s upload does not overwrite another s.</span></span> <span data-ttu-id="e1e0e-248">Bu öğretici için karşıya yüklenen dosyayla aynı adı kullanmayı deneyeceğiz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-248">For this tutorial we will attempt to use the same name as the uploaded file.</span></span> <span data-ttu-id="e1e0e-249">`~/Brochures` dizininde aynı dosya adıyla bir dosya zaten varsa, benzersiz bir ad bulunana kadar sonuna bir sayı eklenir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-249">If there already exists a file in the `~/Brochures` directory with that same file name, however, we'll append a number at the end until a unique name is found.</span></span> <span data-ttu-id="e1e0e-250">Örneğin, Kullanıcı `Meats.pdf`adlı bir broşür dosyasını karşıya yüklediğinde, ancak `~/Brochures` klasöründe `Meats.pdf` adında bir dosya zaten varsa, kaydedilen dosya adını `Meats-1.pdf`olarak değiştireceksiniz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-250">For example, if the user uploads a brochure file named `Meats.pdf`, but there is already a file named `Meats.pdf` in the `~/Brochures` folder, we'll change the saved file name to `Meats-1.pdf`.</span></span> <span data-ttu-id="e1e0e-251">Bu varsa, benzersiz bir dosya adı bulunana kadar `Meats-2.pdf`, vb. deneyeceğiz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-251">If that exists, we'll try `Meats-2.pdf`, and so on, until a unique file name is found.</span></span>

<span data-ttu-id="e1e0e-252">Aşağıdaki kod, belirtilen dosya adına sahip bir dosyanın zaten mevcut olup olmadığını anlamak için [`File.Exists(path)` yöntemini](https://msdn.microsoft.com/library/system.io.file.exists.aspx) kullanır.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-252">The following code uses the [`File.Exists(path)` method](https://msdn.microsoft.com/library/system.io.file.exists.aspx) to determine if a file already exists with the specified file name.</span></span> <span data-ttu-id="e1e0e-253">Bu durumda, çakışma bulunana kadar broşür için yeni dosya adları denemeye devam eder.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-253">If so, it continues to try new file names for the brochure until no conflict is found.</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample7.cs)]

<span data-ttu-id="e1e0e-254">Geçerli bir dosya adı bulunduğunda, dosyanın dosya sistemine kaydedilmesi gerekir ve bu dosya adının veritabanına yazılması için ObjectDataSource s `brochurePath``InsertParameter` değerinin güncelleştirilmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-254">Once a valid file name has been found, the file needs to be saved to the file system and the ObjectDataSource s `brochurePath``InsertParameter` value needs to be updated so that this file name is written to the database.</span></span> <span data-ttu-id="e1e0e-255">*Karşıya yükleme dosyaları* öğreticisinde geri döndüğünüzde dosya, FileUpload denetim s `SaveAs(path)` yöntemi kullanılarak kaydedilebilir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-255">As we saw back in the *Uploading Files* tutorial, the file can be saved using the FileUpload control s `SaveAs(path)` method.</span></span> <span data-ttu-id="e1e0e-256">ObjectDataSource s `brochurePath` parametresini güncelleştirmek için `e.Values` koleksiyonunu kullanın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-256">To update the ObjectDataSource s `brochurePath` parameter, use the `e.Values` collection.</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample8.cs)]

## <a name="step-7-saving-the-uploaded-picture-to-the-database"></a><span data-ttu-id="e1e0e-257">7\. Adım: karşıya yüklenen resmi veritabanına kaydetme</span><span class="sxs-lookup"><span data-stu-id="e1e0e-257">Step 7: Saving the Uploaded Picture to the Database</span></span>

<span data-ttu-id="e1e0e-258">Karşıya yüklenen resmi yeni `Categories` kaydına depolamak için, karşıya yüklenen ikili içeriği, DetailsView s `ItemInserting` olayında ObjectDataSource s `picture` parametresine atamamız gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-258">To store the uploaded picture in the new `Categories` record, we need to assign the uploaded binary content to the ObjectDataSource s `picture` parameter in the DetailsView s `ItemInserting` event.</span></span> <span data-ttu-id="e1e0e-259">Ancak, bu atamayı yapmadan önce karşıya yüklenen resmin başka bir görüntü türü değil, bir JPG olduğundan emin olmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-259">Before we make this assignment, however, we need to first make sure that the uploaded picture is a JPG and not some other image type.</span></span> <span data-ttu-id="e1e0e-260">Adım 6 ' da olduğu gibi, ' ın türünü belirlemek için karşıya yüklenen resim dosyası uzantısını kullanmasına izin verin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-260">As in Step 6, let s use the uploaded picture s file extension to ascertain its type.</span></span>

<span data-ttu-id="e1e0e-261">`Categories` tablosu `Picture` sütunu için `NULL` değerlere izin verdiğinden, tüm kategorilerin Şu anda bir resmi vardır.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-261">While the `Categories` table allows `NULL` values for the `Picture` column, all categories currently have a picture.</span></span> <span data-ttu-id="e1e0e-262">Bu sayfa aracılığıyla yeni bir kategori eklerken kullanıcıya bir resim sağlamaya izin verin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-262">Let s force the user to provide a picture when adding a new category through this page.</span></span> <span data-ttu-id="e1e0e-263">Aşağıdaki kod, bir resmin karşıya yüklenmiş ve uygun bir uzantıya sahip olduğundan emin olmak için kontrol eder.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-263">The following code checks to ensure that a picture has been uploaded and that it has an appropriate extension.</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample9.cs)]

<span data-ttu-id="e1e0e-264">Bu kod 6. adımdaki koddan *önce* yerleştirilmelidir, böylece resim karşıya yükleme ile ilgili bir sorun varsa, broşür dosyası dosya sistemine kaydedilmeden önce olay işleyicisi sonlandırılır.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-264">This code should be placed *before* the code from Step 6 so that if there is a problem with the picture upload, the event handler will terminate before the brochure file is saved to the file system.</span></span>

<span data-ttu-id="e1e0e-265">Uygun bir dosyanın karşıya yüklendiğini varsayarak, karşıya yüklenen ikili içeriği resim parametresi s değerine aşağıdaki kod satırıyla atayın:</span><span class="sxs-lookup"><span data-stu-id="e1e0e-265">Assuming that an appropriate file has been uploaded, assign the uploaded binary content to the picture parameter s value with the following line of code:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample10.cs)]

## <a name="the-completeiteminsertingevent-handler"></a><span data-ttu-id="e1e0e-266">Tüm`ItemInserting`olay Işleyicisi</span><span class="sxs-lookup"><span data-stu-id="e1e0e-266">The Complete`ItemInserting`Event Handler</span></span>

<span data-ttu-id="e1e0e-267">Tamamlanma için, `ItemInserting` olay işleyicisi tamamen aşağıda verilmiştir:</span><span class="sxs-lookup"><span data-stu-id="e1e0e-267">For completeness, here is the `ItemInserting` event handler in its entirety:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample11.cs)]

## <a name="step-8-fixing-thedisplaycategorypictureaspxpage"></a><span data-ttu-id="e1e0e-268">8\. Adım:`DisplayCategoryPicture.aspx`sayfasını Düzeltme</span><span class="sxs-lookup"><span data-stu-id="e1e0e-268">Step 8: Fixing the`DisplayCategoryPicture.aspx`Page</span></span>

<span data-ttu-id="e1e0e-269">Son birkaç adımda oluşturulan ekleme arabirimini ve `ItemInserting` olay işleyicisini test etmek için bir süre bekleyin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-269">Let s take a moment to test out the inserting interface and `ItemInserting` event handler that was created over the last few steps.</span></span> <span data-ttu-id="e1e0e-270">`UploadInDetailsView.aspx` sayfasını bir tarayıcıda ziyaret edin ve bir kategori eklemeyi deneyin, ancak resmi atlayın veya JPG olmayan bir resim ya da PDF olmayan bir broşür belirtin.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-270">Visit the `UploadInDetailsView.aspx` page through a browser and attempt to add a category, but omit the picture, or specify a non-JPG picture or a non-PDF brochure.</span></span> <span data-ttu-id="e1e0e-271">Bu durumların hiçbirinde, bir hata iletisi görüntülenir ve ekleme iş akışı iptal edilir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-271">In any of these cases, an error message will be displayed and the insert workflow cancelled.</span></span>

<span data-ttu-id="e1e0e-272">[Geçersiz bir dosya türü karşıya yüklenirse bir uyarı Iletisi ![görüntülenir](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-272">[![A Warning Message is Displayed If an Invalid File Type is Uploaded](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image15.png)</span></span>

<span data-ttu-id="e1e0e-273">**Şekil 9**: geçersiz bir dosya türü karşıya yüklenirse bir uyarı iletisi görüntülenir ([tam boyutlu görüntüyü görüntülemek için tıklayın](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="e1e0e-273">**Figure 9**: A Warning Message is Displayed If an Invalid File Type is Uploaded ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image16.png))</span></span>

<span data-ttu-id="e1e0e-274">Sayfanın karşıya yükleneceğini ve PDF olmayan ya da JPG olmayan dosyaları kabul etmeyeceği doğrulandıktan sonra, geçerli bir JPG resmine sahip yeni bir kategori ekleyerek, broşür alanını boş bırakın.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-274">Once you have verified that the page requires a picture to be uploaded and won't accept non-PDF or non-JPG files, add a new category with a valid JPG picture, leaving the Brochure field empty.</span></span> <span data-ttu-id="e1e0e-275">Ekle düğmesine tıkladıktan sonra, sayfa geri gönderilir ve yeni bir kayıt, `Categories` tablosuna doğrudan veritabanında depolanan karşıya yüklenen resim ikili içeriğiyle birlikte eklenir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-275">After clicking the Insert button, the page will postback and a new record will be added to the `Categories` table with the uploaded image s binary contents stored directly in the database.</span></span> <span data-ttu-id="e1e0e-276">GridView güncellenir ve yeni eklenen kategori için bir satır gösterir, ancak Şekil 10 ' un gösterdiği gibi, yeni kategorinin resmi doğru işlenmez.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-276">The GridView is updated and shows a row for the newly added category, but, as Figure 10 shows, the new category s picture is not rendered correctly.</span></span>

<span data-ttu-id="e1e0e-277">[Yeni kategorinin resim ![görüntülenmiyor](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-277">[![The New Category s Picture is not Displayed](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image17.png)</span></span>

<span data-ttu-id="e1e0e-278">**Şekil 10**: yeni kategori resmi görüntülenmiyor ([tam boyutlu görüntüyü görüntülemek için tıklayın](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="e1e0e-278">**Figure 10**: The New Category s Picture is not Displayed ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image18.png))</span></span>

<span data-ttu-id="e1e0e-279">Yeni resmin görüntülenmediği nedeni, belirtilen bir kategori resmini döndüren `DisplayCategoryPicture.aspx` sayfasının, OLE üst bilgisi olan bit eşlemleri işleyecek şekilde yapılandırılmasının nedeni.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-279">The reason the new picture is not displayed is because the `DisplayCategoryPicture.aspx` page that returns a specified category s picture is configured to process bitmaps that have an OLE header.</span></span> <span data-ttu-id="e1e0e-280">Bu 78 bayt üst bilgisi, istemciye geri gönderilmeden önce `Picture` sütundan ikili içeriklerden çıkarılır.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-280">This 78 byte header is stripped from the `Picture` column s binary contents before they are sent back to the client.</span></span> <span data-ttu-id="e1e0e-281">Ancak yeni kategoride karşıya yüklediğiniz JPG dosyası bu OLE başlığına sahip değil; Bu nedenle, geçerli ve gerekli baytlar Image s binary verilerinden kaldırılıyor.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-281">But the JPG file we just uploaded for the new category does not have this OLE header; therefore, valid, necessary bytes are being removed from the image s binary data.</span></span>

<span data-ttu-id="e1e0e-282">`Categories` tablosunda hem OLE üst bilgileri hem de JPGs olan bit eşlemler olduğundan, OLE üst bilgisinin orijinal sekiz kategoriye göre olması ve daha yeni kategori kayıtları için bu kadar bu kadar bu kadar bu kadar bu kadar bu kadar bu kadar bu kadar bu kadar bu kadar devam edebilmesi için `DisplayCategoryPicture.aspx` güncelleştirme</span><span class="sxs-lookup"><span data-stu-id="e1e0e-282">Since there are now both bitmaps with OLE headers and JPGs in the `Categories` table, we need to update `DisplayCategoryPicture.aspx` so that it does the OLE header stripping for the original eight categories and bypasses this stripping for the newer category records.</span></span> <span data-ttu-id="e1e0e-283">Sonraki öğreticimizde, var olan bir kayıt görüntüsünü güncelleştirmeyi inceleyeceğiz ve tüm eski kategori resimlerini JPGs olacak şekilde güncelleştireceğiz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-283">In our next tutorial we'll examine how to update an existing record s image, and we'll update all of the old category pictures so that they are JPGs.</span></span> <span data-ttu-id="e1e0e-284">Şimdilik, yalnızca özgün sekiz kategori için OLE üstbilgilerini eklemek üzere `DisplayCategoryPicture.aspx` ' de aşağıdaki kodu kullanın:</span><span class="sxs-lookup"><span data-stu-id="e1e0e-284">For now, though, use the following code in `DisplayCategoryPicture.aspx` to strip the OLE headers only for those original eight categories:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample12.cs)]

<span data-ttu-id="e1e0e-285">Bu değişiklik ile, JPG görüntüsü artık GridView 'da doğru şekilde işlenir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-285">With this change, the JPG image is now rendered correctly in the GridView.</span></span>

<span data-ttu-id="e1e0e-286">[Yeni kategoriler için JPG görüntülerinin ![doğru şekilde Işlendiğine](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-286">[![The JPG Images for New Categories are Correctly Rendered](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image19.png)</span></span>

<span data-ttu-id="e1e0e-287">**Şekil 11**: yeni KATEGORILER Için jpg resimleri doğru işlenir ([tam boyutlu görüntüyü görüntülemek için tıklayın](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="e1e0e-287">**Figure 11**: The JPG Images for New Categories are Correctly Rendered ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image20.png))</span></span>

## <a name="step-9-deleting-the-brochure-in-the-face-of-an-exception"></a><span data-ttu-id="e1e0e-288">9\. Adım: bir özel durum durumunda broşürü silme</span><span class="sxs-lookup"><span data-stu-id="e1e0e-288">Step 9: Deleting the Brochure in the Face of an Exception</span></span>

<span data-ttu-id="e1e0e-289">Web sunucusu s dosya sisteminde ikili verileri depolamanın güçlüklerinden biri, veri modeli ve onun ikili verileri arasında bir bağlantı kesmeyi sunmakta.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-289">One of the challenges of storing binary data on the web server s file system is that it introduces a disconnect between the data model and its binary data.</span></span> <span data-ttu-id="e1e0e-290">Bu nedenle, bir kayıt silindiğinde dosya sistemindeki karşılık gelen ikili verilerin de kaldırılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-290">Therefore, whenever a record is deleted, the corresponding binary data on the file system must also be removed.</span></span> <span data-ttu-id="e1e0e-291">Bu, ekleme sırasında da oynatılmasına gelebilir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-291">This can come into play when inserting, as well.</span></span> <span data-ttu-id="e1e0e-292">Aşağıdaki senaryoyu göz önünde bulundurun: bir Kullanıcı, geçerli bir resim ve broşür belirten yeni bir kategori ekler.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-292">Consider the following scenario: a user adds a new category, specifying a valid picture and brochure.</span></span> <span data-ttu-id="e1e0e-293">Ekle düğmesine tıklandıktan sonra, bir geri gönderme gerçekleşir ve DetailsView `ItemInserting` olay ateşlenir ve bu da broşür Web sunucusu s dosya sistemine kaydediliyor.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-293">Upon clicking the Insert button, a postback occurs and the DetailsView s `ItemInserting` event fires, saving the brochure to the web server s file system.</span></span> <span data-ttu-id="e1e0e-294">Daha sonra, `CategoriesTableAdapter` s `InsertWithPicture` yöntemini çağıran `CategoriesBLL` sınıf s `InsertWithPicture` yöntemini çağıran ObjectDataSource s `Insert()` yöntemi çağrılır.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-294">Next, the ObjectDataSource s `Insert()` method is invoked, which calls the `CategoriesBLL` class s `InsertWithPicture` method, which calls the `CategoriesTableAdapter` s `InsertWithPicture` method.</span></span>

<span data-ttu-id="e1e0e-295">Şimdi, veritabanı çevrimdışıysa veya `INSERT` SQL deyimindeki bir hata varsa ne olur?</span><span class="sxs-lookup"><span data-stu-id="e1e0e-295">Now, what happens if the database is offline, or if there is an error in the `INSERT` SQL statement?</span></span> <span data-ttu-id="e1e0e-296">Açıkça ekleme başarısız olur, bu nedenle veritabanına yeni bir kategori satırı eklenmez.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-296">Clearly the INSERT will fail, so no new category row will be added to the database.</span></span> <span data-ttu-id="e1e0e-297">Ancak yine de karşıya yüklenen broşür dosyası Web sunucusu s dosya sisteminde oturduk!</span><span class="sxs-lookup"><span data-stu-id="e1e0e-297">But we still have the uploaded brochure file sitting on the web server s file system!</span></span> <span data-ttu-id="e1e0e-298">Bu dosyanın, ekleme iş akışı sırasında bir özel durum durumunda silinmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-298">This file needs to be deleted in the face of an exception during the inserting workflow.</span></span>

<span data-ttu-id="e1e0e-299">Daha önce [bir ASP.NET sayfa öğreticisindeki BLL ve dal düzeyi özel durumları işleme](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) konusunda anlatıldığı gibi, bir özel durum, mimarinin derinliğinden farklı katmanlar aracılığıyla kabarcıklanmasını.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-299">As discussed previously in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, when an exception is thrown from within the depths of the architecture it is bubbled up through the various layers.</span></span> <span data-ttu-id="e1e0e-300">Sunum katmanında, DetailsView `ItemInserted` olayından bir özel durumun oluşup oluşmadığını belirleyebiliriz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-300">At the Presentation Layer, we can determine if an exception has occurred from the DetailsView s `ItemInserted` event.</span></span> <span data-ttu-id="e1e0e-301">Bu olay işleyicisi, `InsertParameters`ObjectDataSource 'un değerlerini de sağlar.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-301">This event handler also provides the values of the ObjectDataSource s `InsertParameters`.</span></span> <span data-ttu-id="e1e0e-302">Bu nedenle, bir özel durum olup olmadığını denetleyen `ItemInserted` olayı için bir olay işleyicisi oluşturuyoruz ve bu durumda, ObjectDataSource s `brochurePath` parametresi tarafından belirtilen dosyayı siler:</span><span class="sxs-lookup"><span data-stu-id="e1e0e-302">Therefore, we can create an event handler for the `ItemInserted` event that checks if there was an exception and, if so, deletes the file specified by the ObjectDataSource s `brochurePath` parameter:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample13.cs)]

## <a name="summary"></a><span data-ttu-id="e1e0e-303">Özet</span><span class="sxs-lookup"><span data-stu-id="e1e0e-303">Summary</span></span>

<span data-ttu-id="e1e0e-304">İkili veri içeren kayıtları eklemek için Web tabanlı bir arabirim sağlamak üzere gerçekleştirilmesi gereken birkaç adım vardır.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-304">There are a number of steps that must be performed in order to provide a web-based interface for adding records that include binary data.</span></span> <span data-ttu-id="e1e0e-305">İkili veriler doğrudan veritabanına depolanıyorsa, bu durumda, ikili verilerin eklendiği durumu işlemek için belirli yöntemler ekleyerek mimariyi güncelleştirmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-305">If the binary data is being stored directly into the database, chances are you'll need to update the architecture, adding specific methods to handle the case where binary data is being inserted.</span></span> <span data-ttu-id="e1e0e-306">Mimari güncelleştirildikten sonra, bir sonraki adım, her bir ikili veri alanı için bir dosya karşıya yükleme denetimi içerecek şekilde özelleştirilmiş bir DetailsView kullanılarak gerçekleştirilebilen ekleme arabirimini oluşturmaktır.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-306">Once the architecture has been updated, the next step is creating the inserting interface, which can be accomplished using a DetailsView that has been customized to include a FileUpload control for each binary data field.</span></span> <span data-ttu-id="e1e0e-307">Karşıya yüklenen veriler daha sonra Web sunucusu s dosya sistemine kaydedilebilir veya DetailsView s `ItemInserting` olay işleyicisinde bir veri kaynağı parametresine atanabilir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-307">The uploaded data can then be saved to the web server s file system or assigned to a data source parameter in the DetailsView s `ItemInserting` event handler.</span></span>

<span data-ttu-id="e1e0e-308">İkili verileri dosya sistemine kaydetmek, verileri doğrudan veritabanına kaydetmeye kıyasla daha fazla planlama gerektirir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-308">Saving binary data to the file system requires more planning than saving data directly into the database.</span></span> <span data-ttu-id="e1e0e-309">Bir Kullanıcı yüklemesinin karşıya yüklenmesini önlemek için bir adlandırma düzeni seçilmelidir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-309">A naming scheme must be chosen in order to avoid one user s upload overwriting another s.</span></span> <span data-ttu-id="e1e0e-310">Ayrıca, veritabanı ekleme başarısız olursa karşıya yüklenen dosyayı silmek için ek adımların alınması gerekir.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-310">Also, extra steps must be taken to delete the uploaded file if the database insert fails.</span></span>

<span data-ttu-id="e1e0e-311">Artık, bir broşür ve resimle sisteme yeni kategoriler ekleyebilme olanağı sunuyoruz, ancak mevcut bir kategorinin ikili verilerinin nasıl güncelleştireceğiz veya silinen bir kategorinin ikili verilerinin nasıl doğru şekilde kaldırılacağı hakkında daha fazla bakıyoruz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-311">We now have the ability to add new categories to the system with a brochure and picture, but we ve yet to look at how to update an existing category s binary data or how to correctly remove the binary data for a deleted category.</span></span> <span data-ttu-id="e1e0e-312">Sonraki öğreticide bu iki konuyu araştıracağız.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-312">We'll explore these two topics in the next tutorial.</span></span>

<span data-ttu-id="e1e0e-313">Programlamanın kutlu olsun!</span><span class="sxs-lookup"><span data-stu-id="e1e0e-313">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="e1e0e-314">Yazar hakkında</span><span class="sxs-lookup"><span data-stu-id="e1e0e-314">About the Author</span></span>

<span data-ttu-id="e1e0e-315">4GuysFromRolla.com 'in, [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), yedi ASP/ASP. net books ve [](http://www.4guysfromrolla.com)'in yazarı, 1998 sürümünden bu yana Microsoft Web teknolojileriyle çalışmaktadır.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e1e0e-316">Scott bağımsız danışman, Trainer ve yazıcı olarak çalışıyor.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-316">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e1e0e-317">En son kitabı, [*24 saat içinde ASP.NET 2,0 kendi kendinize eğitim*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ister.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-317">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="e1e0e-318">mitchell@4GuysFromRolla.comadresinden erişilebilir [.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-318">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="e1e0e-319">ya da blog aracılığıyla [http://ScottOnWriting.NET](http://ScottOnWriting.NET)bulabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-319">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="e1e0e-320">Özel olarak teşekkürler</span><span class="sxs-lookup"><span data-stu-id="e1e0e-320">Special Thanks To</span></span>

<span data-ttu-id="e1e0e-321">Bu öğretici serisi birçok yararlı gözden geçirenler tarafından incelendi.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-321">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="e1e0e-322">Bu öğreticide lider gözden geçirenler, Gardner, Teresa Murphy ve Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="e1e0e-322">Lead reviewers for this tutorial were Dave Gardner, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="e1e0e-323">Yaklaşan MSDN makalelerimi gözden geçiriyor musunuz?</span><span class="sxs-lookup"><span data-stu-id="e1e0e-323">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="e1e0e-324">Öyleyse, benimitchell@4GuysFromRolla.combir satır bırakın [.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-324">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e1e0e-325">[Önceki](displaying-binary-data-in-the-data-web-controls-cs.md)
> [İleri](updating-and-deleting-existing-binary-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="e1e0e-325">[Previous](displaying-binary-data-in-the-data-web-controls-cs.md)
[Next](updating-and-deleting-existing-binary-data-cs.md)</span></span>
