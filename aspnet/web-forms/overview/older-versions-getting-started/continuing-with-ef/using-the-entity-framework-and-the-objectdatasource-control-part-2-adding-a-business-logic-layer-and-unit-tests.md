---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests
title: 'Kullanarak Entity Framework 4.0 ve ObjectDataSource Denetimi, 2. Bölüm: İş mantığı katmanı ve birim testleri ekleme | Microsoft Docs'
author: tdykstra
description: Bu öğretici serisinde, kullanmaya başlama Entity Framework 4.0 öğretici serisinin tarafından oluşturulan Contoso University web uygulaması oluşturur. BEN...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: efb0e677-10b8-48dc-93d3-9ba3902dd807
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests
msc.type: authoredcontent
ms.openlocfilehash: 6517f037a03bb520ee4f3b3185a255b0eaa9de9a
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57067587"
---
<a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests"></a><span data-ttu-id="d73a9-104">Kullanarak Entity Framework 4.0 ve ObjectDataSource Denetimi, 2. Bölüm: İş Mantığı Katmanı ve Birim Testleri Ekleme</span><span class="sxs-lookup"><span data-stu-id="d73a9-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 2: Adding a Business Logic Layer and Unit Tests</span></span>
====================
<span data-ttu-id="d73a9-105">tarafından [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="d73a9-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="d73a9-106">Bu öğretici serisinde Contoso University web uygulaması tarafından oluşturulan geliştirir [Entity Framework 4.0 ile çalışmaya başlama](https://asp.net/entity-framework/tutorials#Getting%20Started) öğretici serisi.</span><span class="sxs-lookup"><span data-stu-id="d73a9-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) tutorial series.</span></span> <span data-ttu-id="d73a9-107">Önceki öğreticilerde tamamlanmadıysa, Bu öğretici için bir başlangıç noktası olarak yapabilecekleriniz [uygulamayı karşıdan](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) oluşturmuş olduğunuz.</span><span class="sxs-lookup"><span data-stu-id="d73a9-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="d73a9-108">Ayrıca [uygulamayı karşıdan](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) tam öğretici serisinin tarafından oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="d73a9-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="d73a9-109">Öğreticileri hakkında sorularınız varsa, bunları gönderebilir [ASP.NET Entity Framework Forumu](https://forums.asp.net/1227.aspx).</span><span class="sxs-lookup"><span data-stu-id="d73a9-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>


<span data-ttu-id="d73a9-110">Entity Framework kullanarak n katmanlı web uygulaması, önceki öğreticide oluşturduğunuz ve `ObjectDataSource` denetimi.</span><span class="sxs-lookup"><span data-stu-id="d73a9-110">In the previous tutorial you created an n-tier web application using the Entity Framework and the `ObjectDataSource` control.</span></span> <span data-ttu-id="d73a9-111">Bu öğreticide iş mantığı katmanı (BLL) ve veri erişim katmanı (DAL) ayrı tutarken iş mantığı eklemek gösterilir ve BLL için otomatik birim testleri oluşturma işlemini gösterir.</span><span class="sxs-lookup"><span data-stu-id="d73a9-111">This tutorial shows how to add business logic while keeping the business-logic layer (BLL) and the data-access layer (DAL) separate, and it shows how to create automated unit tests for the BLL.</span></span>

<span data-ttu-id="d73a9-112">Bu öğreticide aşağıdaki görevleri tamamlamanız:</span><span class="sxs-lookup"><span data-stu-id="d73a9-112">In this tutorial you'll complete the following tasks:</span></span>

- <span data-ttu-id="d73a9-113">Gereksinim duyduğunuz veri erişim yöntemlerine bildiren bir depo arabirimi oluşturun.</span><span class="sxs-lookup"><span data-stu-id="d73a9-113">Create a repository interface that declares the data-access methods you need.</span></span>
- <span data-ttu-id="d73a9-114">Depo sınıfında depo arabirim uygular.</span><span class="sxs-lookup"><span data-stu-id="d73a9-114">Implement the repository interface in the repository class.</span></span>
- <span data-ttu-id="d73a9-115">Veri erişimi işlevleri gerçekleştirmek için depo sınıfını çağıran bir iş mantığı sınıf oluşturun.</span><span class="sxs-lookup"><span data-stu-id="d73a9-115">Create a business-logic class that calls the repository class to perform data-access functions.</span></span>
- <span data-ttu-id="d73a9-116">Connect `ObjectDataSource` depo sınıfına yerine iş mantığı sınıfına denetimi.</span><span class="sxs-lookup"><span data-stu-id="d73a9-116">Connect the `ObjectDataSource` control to the business-logic class instead of to the repository class.</span></span>
- <span data-ttu-id="d73a9-117">Bir birim testi projesi ve kendi veri deposu için bellek içi koleksiyonları kullanır depo sınıf oluşturun.</span><span class="sxs-lookup"><span data-stu-id="d73a9-117">Create a unit-test project and a repository class that uses in-memory collections for its data store.</span></span>
- <span data-ttu-id="d73a9-118">Birim testi için test çalıştırması ve başarısız görmek iş mantığı sınıfa eklemek istediğiniz iş mantığını oluşturun.</span><span class="sxs-lookup"><span data-stu-id="d73a9-118">Create a unit test for business logic that you want to add to the business-logic class, then run the test and see it fail.</span></span>
- <span data-ttu-id="d73a9-119">İş mantığı sınıfında iş mantığını uygular ve birim testi ve geçer bkz yeniden çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="d73a9-119">Implement the business logic in the business-logic class, then re-run the unit test and see it pass.</span></span>

<span data-ttu-id="d73a9-120">Birlikte çalışma *Departments.aspx* ve *DepartmentsAdd.aspx* önceki öğreticide oluşturulan sayfaları.</span><span class="sxs-lookup"><span data-stu-id="d73a9-120">You'll work with the *Departments.aspx* and *DepartmentsAdd.aspx* pages that you created in the previous tutorial.</span></span>

## <a name="creating-a-repository-interface"></a><span data-ttu-id="d73a9-121">Bir depo arabirimi oluşturma</span><span class="sxs-lookup"><span data-stu-id="d73a9-121">Creating a Repository Interface</span></span>

<span data-ttu-id="d73a9-122">Depo Arabirimi oluşturarak başlarsınız.</span><span class="sxs-lookup"><span data-stu-id="d73a9-122">You'll begin by creating the repository interface.</span></span>

<span data-ttu-id="d73a9-123">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d73a9-123">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image1.png)</span></span>

<span data-ttu-id="d73a9-124">İçinde *DAL* klasöründe yeni bir sınıf dosyası oluşturun, adlandırın *ISchoolRepository.cs*, mevcut kodu şu kodla değiştirin:</span><span class="sxs-lookup"><span data-stu-id="d73a9-124">In the *DAL* folder, create a new class file, name it *ISchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample1.cs)]

<span data-ttu-id="d73a9-125">Bir yöntem her CRUD için arabirimi tanımlar (oluşturma, okuma, güncelleştirme ve silme) depo sınıfında oluşturduğunuz yöntemleri.</span><span class="sxs-lookup"><span data-stu-id="d73a9-125">The interface defines one method for each of the CRUD (create, read, update, delete) methods that you created in the repository class.</span></span>

<span data-ttu-id="d73a9-126">İçinde `SchoolRepository` sınıfını *SchoolRepository.cs*, bu sınıfın uyguladığı belirtmek `ISchoolRepository` arabirimi:</span><span class="sxs-lookup"><span data-stu-id="d73a9-126">In the `SchoolRepository` class in *SchoolRepository.cs*, indicate that this class implements the `ISchoolRepository` interface:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample2.cs)]

## <a name="creating-a-business-logic-class"></a><span data-ttu-id="d73a9-127">Bir iş mantığı sınıfı oluşturma</span><span class="sxs-lookup"><span data-stu-id="d73a9-127">Creating a Business-Logic Class</span></span>

<span data-ttu-id="d73a9-128">Ardından, iş mantığı sınıfı oluşturmayı öğreneceksiniz.</span><span class="sxs-lookup"><span data-stu-id="d73a9-128">Next, you'll create the business-logic class.</span></span> <span data-ttu-id="d73a9-129">Tarafından yürütülecek iş mantığı ekleyebilirsiniz, böylece bunu `ObjectDataSource` henüz bunu değil olsa da, denetim.</span><span class="sxs-lookup"><span data-stu-id="d73a9-129">You do this so that you can add business logic that will be executed by the `ObjectDataSource` control, although you will not do that yet.</span></span> <span data-ttu-id="d73a9-130">Şimdilik, yeni bir iş mantığı sınıf yalnızca depo yapan aynı CRUD işlemleri gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="d73a9-130">For now, the new business-logic class will only perform the same CRUD operations that the repository does.</span></span>

<span data-ttu-id="d73a9-131">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="d73a9-131">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image3.png)</span></span>

<span data-ttu-id="d73a9-132">Yeni bir klasör oluşturun ve adlandırın *BLL*.</span><span class="sxs-lookup"><span data-stu-id="d73a9-132">Create a new folder and name it *BLL*.</span></span> <span data-ttu-id="d73a9-133">(Gerçek bir uygulamada, iş mantığı katmanı genellikle bir sınıf kitaplığı uygulanması — ayrı proje; ancak bu öğreticide basit tutmak için bir proje klasöründe BLL sınıfları tutulacak.)</span><span class="sxs-lookup"><span data-stu-id="d73a9-133">(In a real-world application, the business-logic layer would typically be implemented as a class library — a separate project — but to keep this tutorial simple, BLL classes will be kept in a project folder.)</span></span>

<span data-ttu-id="d73a9-134">İçinde *BLL* klasöründe yeni bir sınıf dosyası oluşturun, adlandırın *SchoolBL.cs*, mevcut kodu şu kodla değiştirin:</span><span class="sxs-lookup"><span data-stu-id="d73a9-134">In the *BLL* folder, create a new class file, name it *SchoolBL.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample3.cs)]

<span data-ttu-id="d73a9-135">Bu kod depo sınıfında daha önce gördüğünüz aynı CRUD yöntemleri oluşturur, ancak Entity Framework yöntemlerini doğrudan erişmek yerine depo sınıfın yöntemlerini çağırır.</span><span class="sxs-lookup"><span data-stu-id="d73a9-135">This code creates the same CRUD methods you saw earlier in the repository class, but instead of accessing the Entity Framework methods directly, it calls the repository class methods.</span></span>

<span data-ttu-id="d73a9-136">Depo sınıfına bir başvuru tutan sınıfı değişkeni bir arabirim türü tanımlanır ve depo sınıfını başlatan kodu iki oluşturucu içinde yer alır.</span><span class="sxs-lookup"><span data-stu-id="d73a9-136">The class variable that holds a reference to the repository class is defined as an interface type, and the code that instantiates the repository class is contained in two constructors.</span></span> <span data-ttu-id="d73a9-137">Parametresiz oluşturucusu tarafından kullanılan `ObjectDataSource` denetimi.</span><span class="sxs-lookup"><span data-stu-id="d73a9-137">The parameterless constructor will be used by the `ObjectDataSource` control.</span></span> <span data-ttu-id="d73a9-138">Örneği oluşturur `SchoolRepository` daha önce oluşturduğunuz sınıfı.</span><span class="sxs-lookup"><span data-stu-id="d73a9-138">It creates an instance of the `SchoolRepository` class that you created earlier.</span></span> <span data-ttu-id="d73a9-139">Diğer Oluşturucu depo arabirimi uygulayan herhangi bir nesne geçirilecek iş mantığı sınıfı örneğini oluşturan hangi kod sağlar.</span><span class="sxs-lookup"><span data-stu-id="d73a9-139">The other constructor allows whatever code that instantiates the business-logic class to pass in any object that implements the repository interface.</span></span>

<span data-ttu-id="d73a9-140">Depo sınıfını ve iki Oluşturucu çağırmak CRUD yöntemleri seçtiğiniz arka uç veri deposuyla iş mantığı sınıfı kullanmayı mümkün kılar.</span><span class="sxs-lookup"><span data-stu-id="d73a9-140">The CRUD methods that call the repository class and the two constructors make it possible to use the business-logic class with whatever back-end data store you choose.</span></span> <span data-ttu-id="d73a9-141">İş mantığı sınıfı, bunu çağırma sınıf verileri nasıl kalıcı dikkat etmeniz gerekmez.</span><span class="sxs-lookup"><span data-stu-id="d73a9-141">The business-logic class does not need to be aware of how the class that it's calling persists the data.</span></span> <span data-ttu-id="d73a9-142">(Buna genellikle denir *Kalıcılık ignorance*.) İş mantığı sınıfı bir şey kullanan basit bir depo uygulaması kurabildiğinden birim testi, bunu kolaylaştırır. bellek içi olarak `List` verileri depolamak için koleksiyon.</span><span class="sxs-lookup"><span data-stu-id="d73a9-142">(This is often called *persistence ignorance*.) This facilitates unit testing, because you can connect the business-logic class to a repository implementation that uses something as simple as in-memory `List` collections to store data.</span></span>

> [!NOTE]
> <span data-ttu-id="d73a9-143">Entity Framework'ın devralan sınıflardan örneği olduğundan varlık nesnesi teknik olarak hala değil Kalıcılık-ignorant, `EntityObject` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="d73a9-143">Technically, the entity objects are still not persistence-ignorant, because they're instantiated from classes that inherit from the Entity Framework's `EntityObject` class.</span></span> <span data-ttu-id="d73a9-144">Tam Kalıcılık ignorance için kullanabileceğiniz *düz eski CLR nesnelerini*, veya *POCOs*, devralınan nesneleri yerine `EntityObject` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="d73a9-144">For complete persistence ignorance, you can use *plain old CLR objects*, or *POCOs*, in place of objects that inherit from the `EntityObject` class.</span></span> <span data-ttu-id="d73a9-145">Bu öğreticinin kapsamı dışındadır POCOs kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="d73a9-145">Using POCOs is beyond the scope of this tutorial.</span></span> <span data-ttu-id="d73a9-146">Daha fazla bilgi için [Sınanabilirlik ve Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx) MSDN Web sitesindeki.)</span><span class="sxs-lookup"><span data-stu-id="d73a9-146">For more information, see [Testability and Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx) on the MSDN website.)</span></span>


<span data-ttu-id="d73a9-147">Şimdi bağlanabilirsiniz `ObjectDataSource` iş mantığı denetimlere depoya sınıfı yerine ve önceden yaptığınız gibi her şeyin çalıştığını doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="d73a9-147">Now you can connect the `ObjectDataSource` controls to the business-logic class instead of to the repository and verify that everything works as it did before.</span></span>

<span data-ttu-id="d73a9-148">İçinde *Departments.aspx* ve *DepartmentsAdd.aspx*, her bir yinelemesini değiştirmek `TypeName="ContosoUniversity.DAL.SchoolRepository"` için `TypeName="ContosoUniversity.BLL.SchoolBL`".</span><span class="sxs-lookup"><span data-stu-id="d73a9-148">In *Departments.aspx* and *DepartmentsAdd.aspx*, change each occurrence of `TypeName="ContosoUniversity.DAL.SchoolRepository"` to `TypeName="ContosoUniversity.BLL.SchoolBL`".</span></span> <span data-ttu-id="d73a9-149">(Dört örnekler vardır tüm.)</span><span class="sxs-lookup"><span data-stu-id="d73a9-149">(There are four instances in all.)</span></span>

<span data-ttu-id="d73a9-150">Çalıştırma *Departments.aspx* ve *DepartmentsAdd.aspx* Öncekine gibi bunlar hala çalıştığını doğrulamak için sayfa.</span><span class="sxs-lookup"><span data-stu-id="d73a9-150">Run the *Departments.aspx* and *DepartmentsAdd.aspx* pages to verify that they still work as they did before.</span></span>

<span data-ttu-id="d73a9-151">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="d73a9-151">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image5.png)</span></span>

<span data-ttu-id="d73a9-152">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="d73a9-152">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image7.png)</span></span>

## <a name="creating-a-unit-test-project-and-repository-implementation"></a><span data-ttu-id="d73a9-153">Bir birim sınama projesini ve depo uygulaması oluşturma</span><span class="sxs-lookup"><span data-stu-id="d73a9-153">Creating a Unit-Test Project and Repository Implementation</span></span>

<span data-ttu-id="d73a9-154">Çözümü kullanarak yeni bir proje ekleyin **Test projesi** şablonunu ve adlandırın `ContosoUniversity.Tests`.</span><span class="sxs-lookup"><span data-stu-id="d73a9-154">Add a new project to the solution using the **Test Project** template, and name it `ContosoUniversity.Tests`.</span></span>

<span data-ttu-id="d73a9-155">Test projesinde başvuru eklemek `System.Data.Entity` ve bir proje başvurusu Ekle `ContosoUniversity` proje.</span><span class="sxs-lookup"><span data-stu-id="d73a9-155">In the test project, add a reference to `System.Data.Entity` and add a project reference to the `ContosoUniversity` project.</span></span>

<span data-ttu-id="d73a9-156">Artık, birim testleri ile kullanacağınız depo sınıfını da oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d73a9-156">You can now create the repository class that you'll use with unit tests.</span></span> <span data-ttu-id="d73a9-157">Bu depo için veri deposu içindeki sınıf olacaktır.</span><span class="sxs-lookup"><span data-stu-id="d73a9-157">The data store for this repository will be within the class.</span></span>

<span data-ttu-id="d73a9-158">[![image12](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="d73a9-158">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image9.png)</span></span>

<span data-ttu-id="d73a9-159">Test projesinde yeni bir sınıf dosyası oluşturun, adlandırın *MockSchoolRepository.cs*, mevcut kodu şu kodla değiştirin:</span><span class="sxs-lookup"><span data-stu-id="d73a9-159">In the test project, create a new class file, name it *MockSchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample4.cs)]

<span data-ttu-id="d73a9-160">Entity Framework doğrudan erişir biri olarak aynı CRUD yöntemler bu depo sınıfına sahip, ancak birlikte çalıştıkları `List` bir veritabanı yerine bellekle koleksiyonları.</span><span class="sxs-lookup"><span data-stu-id="d73a9-160">This repository class has the same CRUD methods as the one that accesses the Entity Framework directly, but they work with `List` collections in memory instead of with a database.</span></span> <span data-ttu-id="d73a9-161">Bu, ayarlamak ve iş mantığı sınıfı için birim testleri doğrulamak bir test sınıfı için kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="d73a9-161">This makes it easier for a test class to set up and validate unit tests for the business-logic class.</span></span>

## <a name="creating-unit-tests"></a><span data-ttu-id="d73a9-162">Birim testleri oluşturma</span><span class="sxs-lookup"><span data-stu-id="d73a9-162">Creating Unit Tests</span></span>

<span data-ttu-id="d73a9-163">**Test** proje şablonu, bir saplama birim test sınıfı oluşturulan ve sonraki göreviniz birim test yöntemlerini iş mantığı sınıfa eklemek istediğiniz iş mantığı için ekleyerek bu sınıfı değiştirin.</span><span class="sxs-lookup"><span data-stu-id="d73a9-163">The **Test** project template created a stub unit test class for you, and your next task is to modify this class by adding unit test methods to it for business logic that you want to add to the business-logic class.</span></span>

<span data-ttu-id="d73a9-164">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="d73a9-164">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image11.png)</span></span>

<span data-ttu-id="d73a9-165">Contoso University'deki herhangi tek bir eğitmen yalnızca tek bir departman Yöneticisi olabilir ve bu kuralını uygulamak için iş mantığı eklemeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="d73a9-165">At Contoso University, any individual instructor can only be the administrator of a single department, and you need to add business logic to enforce this rule.</span></span> <span data-ttu-id="d73a9-166">Testleri ekleme ve bunları başarısız görmek için testleri çalıştırmadan başlar.</span><span class="sxs-lookup"><span data-stu-id="d73a9-166">You will start by adding tests and running the tests to see them fail.</span></span> <span data-ttu-id="d73a9-167">Ardından kod ekleyecek ve bunları geçirmek görmeyi testleri yeniden çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="d73a9-167">You'll then add the code and rerun the tests, expecting to see them pass.</span></span>

<span data-ttu-id="d73a9-168">Açık *UnitTest1.cs* dosya ve ekleme `using` deyimleri ContosoUniversity projede oluşturulan iş mantığı ve veri erişim katmanları için:</span><span class="sxs-lookup"><span data-stu-id="d73a9-168">Open the *UnitTest1.cs* file and add `using` statements for the business logic and data-access layers that you created in the ContosoUniversity project:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample5.cs)]

<span data-ttu-id="d73a9-169">Değiştirin `TestMethod1` aşağıdaki yöntemlerle yöntemi:</span><span class="sxs-lookup"><span data-stu-id="d73a9-169">Replace the `TestMethod1` method with the following methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample6.cs)]

<span data-ttu-id="d73a9-170">`CreateSchoolBL` Yöntemi daha sonra iş mantığı sınıfının yeni bir örneğine geçirir proje, birim testi için oluşturduğunuz havuzu sınıfının bir örneğini oluşturur.</span><span class="sxs-lookup"><span data-stu-id="d73a9-170">The `CreateSchoolBL` method creates an instance of the repository class that you created for the unit test project, which it then passes to a new instance of the business-logic class.</span></span> <span data-ttu-id="d73a9-171">Yöntemi daha sonra kullanabileceğiniz üç Departmanlar test yöntemlerinde eklemek için iş mantığı sınıfı kullanır.</span><span class="sxs-lookup"><span data-stu-id="d73a9-171">The method then uses the business-logic class to insert three departments that you can use in test methods.</span></span>

<span data-ttu-id="d73a9-172">İş mantığı sınıfı biri ile aynı yönetici mevcut bir bölümü olarak yeni bir bölüm eklemek çalışırsa veya birisi kişinin Kimliğini ayarlayarak bir departmanın yöneticisini güncelleştirmek çalışırsa, bir özel durum oluşturur, test yöntemleri doğrulayın zaten başka bir bölüme yöneticisinin kim.</span><span class="sxs-lookup"><span data-stu-id="d73a9-172">The test methods verify that the business-logic class throws an exception if someone tries to insert a new department with the same administrator as an existing department, or if someone tries to update a department's administrator by setting it to the ID of a person who is already the administrator of another department.</span></span>

<span data-ttu-id="d73a9-173">Bu kod derlenmez için özel durum sınıfı henüz oluşturmadınız.</span><span class="sxs-lookup"><span data-stu-id="d73a9-173">You haven't created the exception class yet, so this code will not compile.</span></span> <span data-ttu-id="d73a9-174">Buna derlemeye ulaşmak için sağ `DuplicateAdministratorException` seçip **Oluştur**, ardından **sınıfı**.</span><span class="sxs-lookup"><span data-stu-id="d73a9-174">To get it to compile, right-click `DuplicateAdministratorException` and select **Generate**, and then **Class**.</span></span>

<span data-ttu-id="d73a9-175">[![image14](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="d73a9-175">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image13.png)</span></span>

<span data-ttu-id="d73a9-176">Bu, silmeniz ve test projesinde bir sınıf oluşturur ana proje özel durum sınıfı oluşturduktan sonra.</span><span class="sxs-lookup"><span data-stu-id="d73a9-176">This creates a class in the test project which you can delete after you've created the exception class in the main project.</span></span> <span data-ttu-id="d73a9-177">ve iş mantığı uygulanır.</span><span class="sxs-lookup"><span data-stu-id="d73a9-177">and implemented the business logic.</span></span>

<span data-ttu-id="d73a9-178">Test projesini çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="d73a9-178">Run the test project.</span></span> <span data-ttu-id="d73a9-179">Testler, beklendiği gibi başarısız.</span><span class="sxs-lookup"><span data-stu-id="d73a9-179">As expected, the tests fail.</span></span>

<span data-ttu-id="d73a9-180">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="d73a9-180">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image15.png)</span></span>

## <a name="adding-business-logic-to-make-a-test-pass"></a><span data-ttu-id="d73a9-181">Test geçiş yapmak için iş mantığı ekleme</span><span class="sxs-lookup"><span data-stu-id="d73a9-181">Adding Business Logic to Make a Test Pass</span></span>

<span data-ttu-id="d73a9-182">Ardından, zaten başka bir bölüme yöneticisidir birisi bir departman Yöneticisi olarak ayarlanacak mümkün kılan iş mantığı uygulamanız.</span><span class="sxs-lookup"><span data-stu-id="d73a9-182">Next, you'll implement the business logic that makes it impossible to set as the administrator of a department someone who is already administrator of another department.</span></span> <span data-ttu-id="d73a9-183">Özel durum iş mantığı katmanından ve bir kullanıcı bir departman düzenler ve tıkladığında sunu katmanı catch **güncelleştirme** zaten yönetici olan birisi seçtikten sonra.</span><span class="sxs-lookup"><span data-stu-id="d73a9-183">You'll throw an exception from the business-logic layer, and then catch it in the presentation layer if a user edits a department and clicks **Update** after selecting someone who is already an administrator.</span></span> <span data-ttu-id="d73a9-184">(Eğitmenler sayfayı oluşturmak önce kimin zaten yöneticilerdir aşağı açılan listeden kaldırabilirsiniz, ancak burada amacı ile iş mantığı katmanı çalışmaktır.)</span><span class="sxs-lookup"><span data-stu-id="d73a9-184">(You could also remove instructors from the drop-down list who are already administrators before you render the page, but the purpose here is to work with the business-logic layer.)</span></span>

<span data-ttu-id="d73a9-185">Bir kullanıcı birden fazla bölüm Yöneticisi bir eğitmen yapmaya çalıştığında, throw özel durum sınıfı oluşturarak başlayın.</span><span class="sxs-lookup"><span data-stu-id="d73a9-185">Start by creating the exception class that you'll throw when a user tries to make an instructor the administrator of more than one department.</span></span> <span data-ttu-id="d73a9-186">Ana proje yeni bir sınıf dosyası oluşturma *BLL* klasörünü adlandırın *DuplicateAdministratorException.cs*, mevcut kodu şu kodla değiştirin:</span><span class="sxs-lookup"><span data-stu-id="d73a9-186">In the main project, create a new class file in the *BLL* folder, name it *DuplicateAdministratorException.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample7.cs)]

<span data-ttu-id="d73a9-187">Artık geçici silme *DuplicateAdministratorException.cs* oluşturduğunuz test projesini derlemek için bir dosya.</span><span class="sxs-lookup"><span data-stu-id="d73a9-187">Now delete the temporary *DuplicateAdministratorException.cs* file that you created in the test project earlier in order to be able to compile.</span></span>

<span data-ttu-id="d73a9-188">Ana proje Aç *SchoolBL.cs* dosya ve Doğrulama mantığı içeren aşağıdaki yöntemi ekleyin.</span><span class="sxs-lookup"><span data-stu-id="d73a9-188">In the main project, open the *SchoolBL.cs* file and add the following method that contains the validation logic.</span></span> <span data-ttu-id="d73a9-189">(Kodu daha sonra oluşturacağınız bir Metoda başvuruyor.)</span><span class="sxs-lookup"><span data-stu-id="d73a9-189">(The code refers to a method that you'll create later.)</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample8.cs)]

<span data-ttu-id="d73a9-190">Bu yöntem ekleme veya güncelleştirme kullandığınız zaman sizi ararız `Department` başka bir bölüme aynı yönetici olup olmadığını denetlemek için varlıklar.</span><span class="sxs-lookup"><span data-stu-id="d73a9-190">You'll call this method when you're inserting or updating `Department` entities in order to check whether another department already has the same administrator.</span></span>

<span data-ttu-id="d73a9-191">Kod veritabanı için aranacak bir yöntemi çağıran bir `Department` aynı olan varlık `Administrator` varlık olarak özellik değeri eklenir veya güncelleştirilir.</span><span class="sxs-lookup"><span data-stu-id="d73a9-191">The code calls a method to search the database for a `Department` entity that has the same `Administrator` property value as the entity being inserted or updated.</span></span> <span data-ttu-id="d73a9-192">Bulunması durumunda, kod bir özel durum oluşturur.</span><span class="sxs-lookup"><span data-stu-id="d73a9-192">If one is found, the code throws an exception.</span></span> <span data-ttu-id="d73a9-193">Eklenen veya güncelleştirilen varlığı Hayır varsa hiçbir doğrulama denetimi gereklidir `Administrator` değeri ve hiçbir özel güncelleştirme sırasında yöntemi çağrılırsa oluşturulur ve `Department` varlık eşleşme bulundu `Department` güncelleştirilen varlık.</span><span class="sxs-lookup"><span data-stu-id="d73a9-193">No validation check is required if the entity being inserted or updated has no `Administrator` value, and no exception is thrown if the method is called during an update and the `Department` entity found matches the `Department` entity being updated.</span></span>

<span data-ttu-id="d73a9-194">Yeni yöntemi çağırın `Insert` ve `Update` yöntemleri:</span><span class="sxs-lookup"><span data-stu-id="d73a9-194">Call the new method from the `Insert` and `Update` methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample9.cs)]

<span data-ttu-id="d73a9-195">İçinde *ISchoolRepository.cs*, yeni veri erişim yönteminde aşağıdaki bildirimi ekleyin:</span><span class="sxs-lookup"><span data-stu-id="d73a9-195">In *ISchoolRepository.cs*, add the following declaration for the new data-access method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample10.cs)]

<span data-ttu-id="d73a9-196">İçinde *SchoolRepository.cs*, aşağıdaki `using` deyimi:</span><span class="sxs-lookup"><span data-stu-id="d73a9-196">In *SchoolRepository.cs*, add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample11.cs)]

<span data-ttu-id="d73a9-197">İçinde *SchoolRepository.cs*, aşağıdaki yeni veri erişim yöntemi ekleyin:</span><span class="sxs-lookup"><span data-stu-id="d73a9-197">In *SchoolRepository.cs*, add the following new data-access method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample12.cs)]

<span data-ttu-id="d73a9-198">Bu kod alır `Department` belirtilen yönetici sahip varlıklar.</span><span class="sxs-lookup"><span data-stu-id="d73a9-198">This code retrieves `Department` entities that have a specified administrator.</span></span> <span data-ttu-id="d73a9-199">Yalnızca bir bölüm (varsa) bulunması.</span><span class="sxs-lookup"><span data-stu-id="d73a9-199">Only one department should be found (if any).</span></span> <span data-ttu-id="d73a9-200">Hiçbir kısıtlama veritabanına inşa edildiğinden durumda birden çok bölümler bulundu ancak, dönüş türü bir koleksiyondur.</span><span class="sxs-lookup"><span data-stu-id="d73a9-200">However, because no constraint is built into the database, the return type is a collection in case multiple departments are found.</span></span>

<span data-ttu-id="d73a9-201">Varsayılan olarak, nesne bağlamı veritabanından varlıklar aldığında, bunları kendi nesne durum Yöneticisi'nde izler.</span><span class="sxs-lookup"><span data-stu-id="d73a9-201">By default, when the object context retrieves entities from the database, it keeps track of them in its object state manager.</span></span> <span data-ttu-id="d73a9-202">`MergeOption.NoTracking` Parametresi, bu izleme bu sorgu için yapılan değil belirtir.</span><span class="sxs-lookup"><span data-stu-id="d73a9-202">The `MergeOption.NoTracking` parameter specifies that this tracking will not be done for this query.</span></span> <span data-ttu-id="d73a9-203">Bunun gerekli olmasının nedeni sorgu güncelleştirmeye çalıştığınız tam varlık döndürebilir ve ardından söz konusu varlık eklemek mümkün olmaz.</span><span class="sxs-lookup"><span data-stu-id="d73a9-203">This is necessary because the query might return the exact entity that you're trying to update, and then you would not be able to attach that entity.</span></span> <span data-ttu-id="d73a9-204">Örneğin geçmişi departmanındaki düzenlerseniz, *Departments.aspx* sayfası ve yönetici değiştirmeden bırakın, bu sorguyu döndürür geçmişi bölümü.</span><span class="sxs-lookup"><span data-stu-id="d73a9-204">For example, if you edit the History department in the *Departments.aspx* page and leave the administrator unchanged, this query will return the History department.</span></span> <span data-ttu-id="d73a9-205">Varsa `NoTracking` , nesne bağlamı, nesne durumu Yöneticisi'nde geçmişi departmanı varlık zaten haritamın, ayarlı değil.</span><span class="sxs-lookup"><span data-stu-id="d73a9-205">If `NoTracking` is not set, the object context would already have the History department entity in its object state manager.</span></span> <span data-ttu-id="d73a9-206">Görünüm durumu yeniden oluşturulduğunda geçmişi departmanı varlık eklediğinizde, nesne bağlamı bildiren bir özel durum alanlarına sonra `"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key"`.</span><span class="sxs-lookup"><span data-stu-id="d73a9-206">Then when you attach the History department entity that's re-created from view state, the object context would throw an exception that says `"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key"`.</span></span>

<span data-ttu-id="d73a9-207">(Belirtmek için alternatif olarak `MergeOption.NoTracking`, yalnızca bu sorgu için yeni bir nesne bağlamına oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d73a9-207">(As an alternative to specifying `MergeOption.NoTracking`, you could create a new object context just for this query.</span></span> <span data-ttu-id="d73a9-208">Yeni nesne bağlamı kendi nesne durum Yöneticisi yeterli olacağından olacaktır çakışma çağırdığınızda `Attach` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="d73a9-208">Because the new object context would have its own object state manager, there would be no conflict when you call the `Attach` method.</span></span> <span data-ttu-id="d73a9-209">Bu alternatif yaklaşım, performans cezası en düşük olacaktır. yeni nesne bağlamı özgün nesne bağlamı ile meta verileri ve veritabanı bağlantı paylaşımında yapabileceği.</span><span class="sxs-lookup"><span data-stu-id="d73a9-209">The new object context would share metadata and database connection with the original object context, so the performance penalty of this alternate approach would be minimal.</span></span> <span data-ttu-id="d73a9-210">Bununla birlikte, burada gösterilen bir yaklaşım sunar `NoTracking` seçeneği, hangi diğer bağlamlarda yararlı bulabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d73a9-210">The approach shown here, however, introduces the `NoTracking` option, which you'll find useful in other contexts.</span></span> <span data-ttu-id="d73a9-211">`NoTracking` Seçeneği ele alınmıştır bir sonraki Öğreticide bu serideki diğer.)</span><span class="sxs-lookup"><span data-stu-id="d73a9-211">The `NoTracking` option is discussed further in a later tutorial in this series.)</span></span>

<span data-ttu-id="d73a9-212">Test projesinde yeni bir veri erişim yöntemine ekleyin *MockSchoolRepository.cs*:</span><span class="sxs-lookup"><span data-stu-id="d73a9-212">In the test project, add the new data-access method to *MockSchoolRepository.cs*:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample13.cs)]

<span data-ttu-id="d73a9-213">Bu kod, aynı veri seçimi gerçekleştirmek için LINQ kullanır, `ContosoUniversity` projesinin deposuna LINQ to Entities için kullanır.</span><span class="sxs-lookup"><span data-stu-id="d73a9-213">This code uses LINQ to perform the same data selection that the `ContosoUniversity` project repository uses LINQ to Entities for.</span></span>

<span data-ttu-id="d73a9-214">Test projesi yeniden çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="d73a9-214">Run the test project again.</span></span> <span data-ttu-id="d73a9-215">Şu testler başarılı.</span><span class="sxs-lookup"><span data-stu-id="d73a9-215">This time the tests pass.</span></span>

<span data-ttu-id="d73a9-216">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="d73a9-216">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image17.png)</span></span>

## <a name="handling-objectdatasource-exceptions"></a><span data-ttu-id="d73a9-217">ObjectDataSource özel durumları işleme</span><span class="sxs-lookup"><span data-stu-id="d73a9-217">Handling ObjectDataSource Exceptions</span></span>

<span data-ttu-id="d73a9-218">İçinde `ContosoUniversity` projeyi Çalıştır *Departments.aspx* sayfasında ve zaten başka bir bölüme için yönetici olan bir kişiye yönetici bir departman için değiştirmeyi deneyin.</span><span class="sxs-lookup"><span data-stu-id="d73a9-218">In the `ContosoUniversity` project, run the *Departments.aspx* page and try to change the administrator for a department to someone who is already administrator for another department.</span></span> <span data-ttu-id="d73a9-219">(Veritabanı geçersiz veri ile önceden yüklenmiş geldiğinden, Bu öğretici sırasında eklediğiniz bölümler yalnızca düzenleyebilirsiniz unutmayın.) Aşağıdaki sunucu hata sayfası olursunuz:</span><span class="sxs-lookup"><span data-stu-id="d73a9-219">(Remember that you can only edit departments that you added during this tutorial, because the database comes preloaded with invalid data.) You get the following server error page:</span></span>

<span data-ttu-id="d73a9-220">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="d73a9-220">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image19.png)</span></span>

<span data-ttu-id="d73a9-221">Bu nedenle hata işleme kodu eklemeniz gerekir bu tür bir hata sayfası, kullanıcıların istemezsiniz.</span><span class="sxs-lookup"><span data-stu-id="d73a9-221">You don't want users to see this kind of error page, so you need to add error-handling code.</span></span> <span data-ttu-id="d73a9-222">Açık *Departments.aspx* ve belirtmek için bir işleyici `OnUpdated` olayı `DepartmentsObjectDataSource`.</span><span class="sxs-lookup"><span data-stu-id="d73a9-222">Open *Departments.aspx* and specify a handler for the `OnUpdated` event of the `DepartmentsObjectDataSource`.</span></span> <span data-ttu-id="d73a9-223">`ObjectDataSource` Etiketiyle artık, aşağıdaki örnekte benzer.</span><span class="sxs-lookup"><span data-stu-id="d73a9-223">The `ObjectDataSource` opening tag now resembles the following example.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample14.aspx)]

<span data-ttu-id="d73a9-224">İçinde *Departments.aspx.cs*, aşağıdaki `using` deyimi:</span><span class="sxs-lookup"><span data-stu-id="d73a9-224">In *Departments.aspx.cs*, add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample15.cs)]

<span data-ttu-id="d73a9-225">Aşağıdaki işleyicisi eklemek `Updated` olay:</span><span class="sxs-lookup"><span data-stu-id="d73a9-225">Add the following handler for the `Updated` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample16.cs)]

<span data-ttu-id="d73a9-226">Varsa `ObjectDataSource` denetimi, güncelleştirmeyi gerçekleştirmeye çalıştığında bir özel durum yakalarsa, özel durum olay bağımsız değişkeni geçirir (`e`) için bu işleyici.</span><span class="sxs-lookup"><span data-stu-id="d73a9-226">If the `ObjectDataSource` control catches an exception when it tries to perform the update, it passes the exception in the event argument (`e`) to this handler.</span></span> <span data-ttu-id="d73a9-227">İşleyici kod özel durum yinelenen bir yönetici özel durum olup olmadığını denetler.</span><span class="sxs-lookup"><span data-stu-id="d73a9-227">The code in the handler checks to see if the exception is the duplicate administrator exception.</span></span> <span data-ttu-id="d73a9-228">İse, kod için hata iletisi içeren bir doğrulayıcı denetimi oluşturur `ValidationSummary` görüntülenecek denetimi.</span><span class="sxs-lookup"><span data-stu-id="d73a9-228">If it is, the code creates a validator control that contains an error message for the `ValidationSummary` control to display.</span></span>

<span data-ttu-id="d73a9-229">Sayfayı çalıştırın ve birinin iki bölüm Yöneticisi yeniden çıkarmaya çalışın.</span><span class="sxs-lookup"><span data-stu-id="d73a9-229">Run the page and attempt to make someone the administrator of two departments again.</span></span> <span data-ttu-id="d73a9-230">Bu süre `ValidationSummary` denetimi, bir hata iletisi görüntüler.</span><span class="sxs-lookup"><span data-stu-id="d73a9-230">This time the `ValidationSummary` control displays an error message.</span></span>

<span data-ttu-id="d73a9-231">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="d73a9-231">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image21.png)</span></span>

<span data-ttu-id="d73a9-232">Benzer değişiklik *DepartmentsAdd.aspx* sayfası.</span><span class="sxs-lookup"><span data-stu-id="d73a9-232">Make similar changes to the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="d73a9-233">İçinde *DepartmentsAdd.aspx*, belirtmek için bir işleyici `OnInserted` olayı `DepartmentsObjectDataSource`.</span><span class="sxs-lookup"><span data-stu-id="d73a9-233">In *DepartmentsAdd.aspx*, specify a handler for the `OnInserted` event of the `DepartmentsObjectDataSource`.</span></span> <span data-ttu-id="d73a9-234">Sonuçta elde edilen biçimlendirme, aşağıdaki örneğe benzer.</span><span class="sxs-lookup"><span data-stu-id="d73a9-234">The resulting markup will resemble the following example.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample17.aspx)]

<span data-ttu-id="d73a9-235">İçinde *DepartmentsAdd.aspx.cs*, aynı `using` deyimi:</span><span class="sxs-lookup"><span data-stu-id="d73a9-235">In *DepartmentsAdd.aspx.cs*, add the same `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample18.cs)]

<span data-ttu-id="d73a9-236">Aşağıdaki olay işleyicisini ekleyin:</span><span class="sxs-lookup"><span data-stu-id="d73a9-236">Add the following event handler:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample19.cs)]

<span data-ttu-id="d73a9-237">Artık test *DepartmentsAdd.aspx.cs* sayfasına, birden fazla bölüm Yöneticisi bir kişinin yapma girişimleri de doğru bir şekilde işleme doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="d73a9-237">You can now test the *DepartmentsAdd.aspx.cs* page to verify that it also correctly handles attempts to make one person the administrator of more than one department.</span></span>

<span data-ttu-id="d73a9-238">Bu depo düzeni kullanmak için uygulama giriş tamamlar `ObjectDataSource` Entity Framework ile denetimi.</span><span class="sxs-lookup"><span data-stu-id="d73a9-238">This completes the introduction to implementing the repository pattern for using the `ObjectDataSource` control with the Entity Framework.</span></span> <span data-ttu-id="d73a9-239">Depo düzeni ve Test Edilebilirlik hakkında daha fazla bilgi için bkz MSDN teknik incelemeyi [Sınanabilirlik ve Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx).</span><span class="sxs-lookup"><span data-stu-id="d73a9-239">For more information about the repository pattern and testability, see the MSDN whitepaper [Testability and Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx).</span></span>

<span data-ttu-id="d73a9-240">Aşağıdaki öğreticide, sıralama ve filtreleme uygulamanıza işlevsellik ekleme görürsünüz.</span><span class="sxs-lookup"><span data-stu-id="d73a9-240">In the following tutorial you'll see how to add sorting and filtering functionality to the application.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="d73a9-241">[Önceki](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started.md)
> [İleri](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)</span><span class="sxs-lookup"><span data-stu-id="d73a9-241">[Previous](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started.md)
[Next](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)</span></span>
